var wh=Object.create;var tr=Object.defineProperty;var vh=Object.getOwnPropertyDescriptor;var Mh=Object.getOwnPropertyNames;var Ah=Object.getPrototypeOf,Th=Object.prototype.hasOwnProperty;var Vo=(m,t)=>{for(var e in t)tr(m,e,{get:t[e],enumerable:!0})},Ho=(m,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Mh(t))!Th.call(m,r)&&r!==e&&tr(m,r,{get:()=>t[r],enumerable:!(i=vh(t,r))||i.enumerable});return m};var pn=(m,t,e)=>(e=m!=null?wh(Ah(m)):{},Ho(t||!m||!m.__esModule?tr(e,"default",{value:m,enumerable:!0}):e,m)),Eh=m=>Ho(tr({},"__esModule",{value:!0}),m);var Sc={};Vo(Sc,{AutodeskPin:()=>Gs,Presence3D:()=>Yr});module.exports=Eh(Sc);var rh=require("lodash"),es=require("three");var oi=require("three");var dn="139";var hs=0,Uo=1,Ai=2,Go=1;var fn=1;var jo=100;var Wo=204,qo=205;var Xo=3;var Ti=0;var mn=300;var ci=1e3,li=1001,cs=1002,ls=1003,Yo=1004;var Zo=1005;var us=1006,Jo=1007;var ps=1008;var $o=1009;var Ko=1015;var er=1023;var _e=2300,ke=2301,ir=2302,gn=2400,yn=2401,xn=2402,Qo=2500,ta=2501;var ea=1,ia=2,sa=3e3,Ei=3001,ra=3200;var me=0;var oe="srgb",Re="srgb-linear";var sr=7680;var na=519,ds=35044;var ge=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let r=this._listeners[t];if(r!==void 0){let n=r.indexOf(e);n!==-1&&r.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let i=this._listeners[t.type];if(i!==void 0){t.target=this;let r=i.slice(0);for(let n=0,a=r.length;n<a;n++)r[n].call(this,t);t.target=null}}};var Dt={};Vo(Dt,{DEG2RAD:()=>Si,RAD2DEG:()=>ui,ceilPowerOfTwo:()=>bn,clamp:()=>St,damp:()=>kh,degToRad:()=>Fh,denormalize:()=>Hh,euclideanModulo:()=>rr,floorPowerOfTwo:()=>Oh,generateUUID:()=>Ct,inverseLerp:()=>_h,isPowerOfTwo:()=>Dh,lerp:()=>_i,mapLinear:()=>Sh,normalize:()=>Uh,pingpong:()=>Rh,radToDeg:()=>Lh,randFloat:()=>zh,randFloatSpread:()=>Ph,randInt:()=>Ih,seededRandom:()=>Bh,setQuaternionFromProperEuler:()=>Vh,smootherstep:()=>Nh,smoothstep:()=>Ch});var Lt=[];for(let m=0;m<256;m++)Lt[m]=(m<16?"0":"")+m.toString(16);var oa=1234567,Si=Math.PI/180,ui=180/Math.PI;function Ct(){let m=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Lt[m&255]+Lt[m>>8&255]+Lt[m>>16&255]+Lt[m>>24&255]+"-"+Lt[t&255]+Lt[t>>8&255]+"-"+Lt[t>>16&15|64]+Lt[t>>24&255]+"-"+Lt[e&63|128]+Lt[e>>8&255]+"-"+Lt[e>>16&255]+Lt[e>>24&255]+Lt[i&255]+Lt[i>>8&255]+Lt[i>>16&255]+Lt[i>>24&255]).toLowerCase()}function St(m,t,e){return Math.max(t,Math.min(e,m))}function rr(m,t){return(m%t+t)%t}function Sh(m,t,e,i,r){return i+(m-t)*(r-i)/(e-t)}function _h(m,t,e){return m!==t?(e-m)/(t-m):0}function _i(m,t,e){return(1-e)*m+e*t}function kh(m,t,e,i){return _i(m,t,1-Math.exp(-e*i))}function Rh(m,t=1){return t-Math.abs(rr(m,t*2)-t)}function Ch(m,t,e){return m<=t?0:m>=e?1:(m=(m-t)/(e-t),m*m*(3-2*m))}function Nh(m,t,e){return m<=t?0:m>=e?1:(m=(m-t)/(e-t),m*m*m*(m*(m*6-15)+10))}function Ih(m,t){return m+Math.floor(Math.random()*(t-m+1))}function zh(m,t){return m+Math.random()*(t-m)}function Ph(m){return m*(.5-Math.random())}function Bh(m){m!==void 0&&(oa=m);let t=oa+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Fh(m){return m*Si}function Lh(m){return m*ui}function Dh(m){return(m&m-1)===0&&m!==0}function bn(m){return Math.pow(2,Math.ceil(Math.log(m)/Math.LN2))}function Oh(m){return Math.pow(2,Math.floor(Math.log(m)/Math.LN2))}function Vh(m,t,e,i,r){let n=Math.cos,a=Math.sin,h=n(e/2),c=a(e/2),u=n((t+i)/2),p=a((t+i)/2),d=n((t-i)/2),y=a((t-i)/2),x=n((i-t)/2),M=a((i-t)/2);switch(r){case"XYX":m.set(h*p,c*d,c*y,h*u);break;case"YZY":m.set(c*y,h*p,c*d,h*u);break;case"ZXZ":m.set(c*d,c*y,h*p,h*u);break;case"XZX":m.set(h*p,c*M,c*x,h*u);break;case"YXY":m.set(c*x,h*p,c*M,h*u);break;case"ZYZ":m.set(c*M,c*x,h*p,h*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Hh(m,t){switch(t.constructor){case Float32Array:return m;case Uint16Array:return m/65535;case Uint8Array:return m/255;case Int16Array:return Math.max(m/32767,-1);case Int8Array:return Math.max(m/127,-1);default:throw new Error("Invalid component type.")}}function Uh(m,t){switch(t.constructor){case Float32Array:return m;case Uint16Array:return Math.round(m*65535);case Uint8Array:return Math.round(m*255);case Int16Array:return Math.round(m*32767);case Int8Array:return Math.round(m*127);default:throw new Error("Invalid component type.")}}var K=class{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*i-a*r+t.x,this.y=n*r+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};K.prototype.isVector2=!0;var ae=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,r,n,a,h,c,u){let p=this.elements;return p[0]=t,p[1]=r,p[2]=h,p[3]=e,p[4]=n,p[5]=c,p[6]=i,p[7]=a,p[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,a=i[0],h=i[3],c=i[6],u=i[1],p=i[4],d=i[7],y=i[2],x=i[5],M=i[8],A=r[0],R=r[3],T=r[6],P=r[1],z=r[4],B=r[7],F=r[2],H=r[5],V=r[8];return n[0]=a*A+h*P+c*F,n[3]=a*R+h*z+c*H,n[6]=a*T+h*B+c*V,n[1]=u*A+p*P+d*F,n[4]=u*R+p*z+d*H,n[7]=u*T+p*B+d*V,n[2]=y*A+x*P+M*F,n[5]=y*R+x*z+M*H,n[8]=y*T+x*B+M*V,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],h=t[5],c=t[6],u=t[7],p=t[8];return e*a*p-e*h*u-i*n*p+i*h*c+r*n*u-r*a*c}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],h=t[5],c=t[6],u=t[7],p=t[8],d=p*a-h*u,y=h*c-p*n,x=u*n-a*c,M=e*d+i*y+r*x;if(M===0)return this.set(0,0,0,0,0,0,0,0,0);let A=1/M;return t[0]=d*A,t[1]=(r*u-p*i)*A,t[2]=(h*i-r*a)*A,t[3]=y*A,t[4]=(p*e-r*c)*A,t[5]=(r*n-h*e)*A,t[6]=x*A,t[7]=(i*c-u*e)*A,t[8]=(a*e-i*n)*A,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,a,h){let c=Math.cos(n),u=Math.sin(n);return this.set(i*c,i*u,-i*(c*a+u*h)+a+t,-r*u,r*c,-r*(-u*a+c*h)+h+e,0,0,1),this}scale(t,e){let i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){let e=Math.cos(t),i=Math.sin(t),r=this.elements,n=r[0],a=r[3],h=r[6],c=r[1],u=r[4],p=r[7];return r[0]=e*n+i*c,r[3]=e*a+i*u,r[6]=e*h+i*p,r[1]=-i*n+e*c,r[4]=-i*a+e*u,r[7]=-i*h+e*p,this}translate(t,e){let i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}};ae.prototype.isMatrix3=!0;function aa(m){for(let t=m.length-1;t>=0;--t)if(m[t]>65535)return!0;return!1}function fs(m){return document.createElementNS("http://www.w3.org/1999/xhtml",m)}function Ce(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}function ms(m){return m<.0031308?m*12.92:1.055*Math.pow(m,.41666)-.055}var wn={[oe]:{[Re]:Ce},[Re]:{[oe]:ms}},ee={legacyMode:!0,get workingColorSpace(){return Re},set workingColorSpace(m){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(m,t,e){if(this.legacyMode||t===e||!t||!e)return m;if(wn[t]&&wn[t][e]!==void 0){let i=wn[t][e];return m.r=i(m.r),m.g=i(m.g),m.b=i(m.b),m}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(m,t){return this.convert(m,this.workingColorSpace,t)},toWorkingColorSpace:function(m,t){return this.convert(m,t,this.workingColorSpace)}};var ha={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nt={r:0,g:0,b:0},he={h:0,s:0,l:0},nr={h:0,s:0,l:0};function vn(m,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?m+(t-m)*6*e:e<1/2?t:e<2/3?m+(t-m)*6*(2/3-e):m}function or(m,t){return t.r=m.r,t.g=m.g,t.b=m.b,t}var U=class{constructor(t,e,i){return e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=oe){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=Re){return this.r=t,this.g=e,this.b=i,ee.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=Re){if(t=rr(t,1),e=St(e,0,1),i=St(i,0,1),e===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+e):i+e-i*e,a=2*i-n;this.r=vn(a,n,t+1/3),this.g=vn(a,n,t),this.b=vn(a,n,t-1/3)}return ee.toWorkingColorSpace(this,r),this}setStyle(t,e=oe){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let n,a=r[1],h=r[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,ee.toWorkingColorSpace(this,e),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,ee.toWorkingColorSpace(this,e),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h)){let c=parseFloat(n[1])/360,u=parseInt(n[2],10)/100,p=parseInt(n[3],10)/100;return i(n[4]),this.setHSL(c,u,p,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let n=r[1],a=n.length;if(a===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,ee.toWorkingColorSpace(this,e),this;if(a===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,ee.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=oe){let i=ha[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ce(t.r),this.g=Ce(t.g),this.b=Ce(t.b),this}copyLinearToSRGB(t){return this.r=ms(t.r),this.g=ms(t.g),this.b=ms(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=oe){return ee.fromWorkingColorSpace(or(this,Nt),t),St(Nt.r*255,0,255)<<16^St(Nt.g*255,0,255)<<8^St(Nt.b*255,0,255)<<0}getHexString(t=oe){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Re){ee.fromWorkingColorSpace(or(this,Nt),e);let i=Nt.r,r=Nt.g,n=Nt.b,a=Math.max(i,r,n),h=Math.min(i,r,n),c,u,p=(h+a)/2;if(h===a)c=0,u=0;else{let d=a-h;switch(u=p<=.5?d/(a+h):d/(2-a-h),a){case i:c=(r-n)/d+(r<n?6:0);break;case r:c=(n-i)/d+2;break;case n:c=(i-r)/d+4;break}c/=6}return t.h=c,t.s=u,t.l=p,t}getRGB(t,e=Re){return ee.fromWorkingColorSpace(or(this,Nt),e),t.r=Nt.r,t.g=Nt.g,t.b=Nt.b,t}getStyle(t=oe){return ee.fromWorkingColorSpace(or(this,Nt),t),t!==oe?`color(${t} ${Nt.r} ${Nt.g} ${Nt.b})`:`rgb(${Nt.r*255|0},${Nt.g*255|0},${Nt.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(he),he.h+=t,he.s+=e,he.l+=i,this.setHSL(he.h,he.s,he.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(he),t.getHSL(nr);let i=_i(he.h,nr.h,e),r=_i(he.s,nr.s,e),n=_i(he.l,nr.l,e);return this.setHSL(i,r,n),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};U.NAMES=ha;U.prototype.isColor=!0;U.prototype.r=1;U.prototype.g=1;U.prototype.b=1;var ki,ar=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ki===void 0&&(ki=fs("canvas")),ki.width=t.width,ki.height=t.height;let i=ki.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=ki}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=fs("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let a=0;a<n.length;a++)n[a]=Ce(n[a]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){let e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Ce(e[i]/255)*255):e[i]=Ce(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}};var gs=class{constructor(t=null){this.uuid=Ct(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let a=0,h=r.length;a<h;a++)r[a].isDataTexture?n.push(Mn(r[a].image)):n.push(Mn(r[a]))}else n=Mn(r);i.url=n}return e||(t.images[this.uuid]=i),i}};function Mn(m){return typeof HTMLImageElement<"u"&&m instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&m instanceof ImageBitmap?ar.getDataURL(m):m.data?{data:Array.prototype.slice.call(m.data),width:m.width,height:m.height,type:m.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}gs.prototype.isSource=!0;var Gh=0,Zt=class m extends ge{constructor(t=m.DEFAULT_IMAGE,e=m.DEFAULT_MAPPING,i=li,r=li,n=us,a=ps,h=er,c=$o,u=1,p=sa){super(),Object.defineProperty(this,"id",{value:Gh++}),this.uuid=Ct(),this.name="",this.source=new gs(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=a,this.anisotropy=u,this.format=h,this.internalFormat=null,this.type=c,this.offset=new K(0,0),this.repeat=new K(1,1),this.center=new K(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ae,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==mn)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ci:t.x=t.x-Math.floor(t.x);break;case li:t.x=t.x<0?0:1;break;case cs:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case ci:t.y=t.y-Math.floor(t.y);break;case li:t.y=t.y<0?0:1;break;case cs:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}};Zt.DEFAULT_IMAGE=null;Zt.DEFAULT_MAPPING=mn;Zt.prototype.isTexture=!0;var Pt=class{constructor(t=0,e=0,i=0,r=1){this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*r+a[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n,c=t.elements,u=c[0],p=c[4],d=c[8],y=c[1],x=c[5],M=c[9],A=c[2],R=c[6],T=c[10];if(Math.abs(p-y)<.01&&Math.abs(d-A)<.01&&Math.abs(M-R)<.01){if(Math.abs(p+y)<.1&&Math.abs(d+A)<.1&&Math.abs(M+R)<.1&&Math.abs(u+x+T-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let z=(u+1)/2,B=(x+1)/2,F=(T+1)/2,H=(p+y)/4,V=(d+A)/4,W=(M+R)/4;return z>B&&z>F?z<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(z),r=H/i,n=V/i):B>F?B<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(B),i=H/r,n=W/r):F<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(F),i=V/n,r=W/n),this.set(i,r,n,e),this}let P=Math.sqrt((R-M)*(R-M)+(d-A)*(d-A)+(y-p)*(y-p));return Math.abs(P)<.001&&(P=1),this.x=(R-M)/P,this.y=(d-A)/P,this.z=(y-p)/P,this.w=Math.acos((u+x+T-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};Pt.prototype.isVector4=!0;var _t=class{constructor(t=0,e=0,i=0,r=1){this._x=t,this._y=e,this._z=i,this._w=r}static slerp(t,e,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,r)}static slerpFlat(t,e,i,r,n,a,h){let c=i[r+0],u=i[r+1],p=i[r+2],d=i[r+3],y=n[a+0],x=n[a+1],M=n[a+2],A=n[a+3];if(h===0){t[e+0]=c,t[e+1]=u,t[e+2]=p,t[e+3]=d;return}if(h===1){t[e+0]=y,t[e+1]=x,t[e+2]=M,t[e+3]=A;return}if(d!==A||c!==y||u!==x||p!==M){let R=1-h,T=c*y+u*x+p*M+d*A,P=T>=0?1:-1,z=1-T*T;if(z>Number.EPSILON){let F=Math.sqrt(z),H=Math.atan2(F,T*P);R=Math.sin(R*H)/F,h=Math.sin(h*H)/F}let B=h*P;if(c=c*R+y*B,u=u*R+x*B,p=p*R+M*B,d=d*R+A*B,R===1-h){let F=1/Math.sqrt(c*c+u*u+p*p+d*d);c*=F,u*=F,p*=F,d*=F}}t[e]=c,t[e+1]=u,t[e+2]=p,t[e+3]=d}static multiplyQuaternionsFlat(t,e,i,r,n,a){let h=i[r],c=i[r+1],u=i[r+2],p=i[r+3],d=n[a],y=n[a+1],x=n[a+2],M=n[a+3];return t[e]=h*M+p*d+c*x-u*y,t[e+1]=c*M+p*y+u*d-h*x,t[e+2]=u*M+p*x+h*y-c*d,t[e+3]=p*M-h*d-c*y-u*x,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=t._x,r=t._y,n=t._z,a=t._order,h=Math.cos,c=Math.sin,u=h(i/2),p=h(r/2),d=h(n/2),y=c(i/2),x=c(r/2),M=c(n/2);switch(a){case"XYZ":this._x=y*p*d+u*x*M,this._y=u*x*d-y*p*M,this._z=u*p*M+y*x*d,this._w=u*p*d-y*x*M;break;case"YXZ":this._x=y*p*d+u*x*M,this._y=u*x*d-y*p*M,this._z=u*p*M-y*x*d,this._w=u*p*d+y*x*M;break;case"ZXY":this._x=y*p*d-u*x*M,this._y=u*x*d+y*p*M,this._z=u*p*M+y*x*d,this._w=u*p*d-y*x*M;break;case"ZYX":this._x=y*p*d-u*x*M,this._y=u*x*d+y*p*M,this._z=u*p*M-y*x*d,this._w=u*p*d+y*x*M;break;case"YZX":this._x=y*p*d+u*x*M,this._y=u*x*d+y*p*M,this._z=u*p*M-y*x*d,this._w=u*p*d-y*x*M;break;case"XZY":this._x=y*p*d-u*x*M,this._y=u*x*d-y*p*M,this._z=u*p*M+y*x*d,this._w=u*p*d+y*x*M;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],r=e[4],n=e[8],a=e[1],h=e[5],c=e[9],u=e[2],p=e[6],d=e[10],y=i+h+d;if(y>0){let x=.5/Math.sqrt(y+1);this._w=.25/x,this._x=(p-c)*x,this._y=(n-u)*x,this._z=(a-r)*x}else if(i>h&&i>d){let x=2*Math.sqrt(1+i-h-d);this._w=(p-c)/x,this._x=.25*x,this._y=(r+a)/x,this._z=(n+u)/x}else if(h>d){let x=2*Math.sqrt(1+h-i-d);this._w=(n-u)/x,this._x=(r+a)/x,this._y=.25*x,this._z=(c+p)/x}else{let x=2*Math.sqrt(1+d-i-h);this._w=(a-r)/x,this._x=(n+u)/x,this._y=(c+p)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(St(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,r=t._y,n=t._z,a=t._w,h=e._x,c=e._y,u=e._z,p=e._w;return this._x=i*p+a*h+r*u-n*c,this._y=r*p+a*c+n*h-i*u,this._z=n*p+a*u+i*c-r*h,this._w=a*p-i*h-r*c-n*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,r=this._y,n=this._z,a=this._w,h=a*t._w+i*t._x+r*t._y+n*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=a,this._x=i,this._y=r,this._z=n,this;let c=1-h*h;if(c<=Number.EPSILON){let x=1-e;return this._w=x*a+e*this._w,this._x=x*i+e*this._x,this._y=x*r+e*this._y,this._z=x*n+e*this._z,this.normalize(),this._onChangeCallback(),this}let u=Math.sqrt(c),p=Math.atan2(u,h),d=Math.sin((1-e)*p)/u,y=Math.sin(e*p)/u;return this._w=a*d+this._w*y,this._x=i*d+this._x*y,this._y=r*d+this._y*y,this._z=n*d+this._z*y,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(n),i*Math.cos(n),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};_t.prototype.isQuaternion=!0;var _=class{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ca.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ca.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*a,this}applyQuaternion(t){let e=this.x,i=this.y,r=this.z,n=t.x,a=t.y,h=t.z,c=t.w,u=c*e+a*r-h*i,p=c*i+h*e-n*r,d=c*r+n*i-a*e,y=-n*e-a*i-h*r;return this.x=u*c+y*-n+p*-h-d*-a,this.y=p*c+y*-a+d*-n-u*-h,this.z=d*c+y*-h+u*-a-p*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,r=t.y,n=t.z,a=e.x,h=e.y,c=e.z;return this.x=r*c-n*h,this.y=n*a-i*c,this.z=i*h-r*a,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return An.copy(this).projectOnVector(t),this.sub(An)}reflect(t){return this.sub(An.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(St(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};_.prototype.isVector3=!0;var An=new _,ca=new _t;var Jt=class{constructor(t=new _(1/0,1/0,1/0),e=new _(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,h=-1/0;for(let c=0,u=t.length;c<u;c+=3){let p=t[c],d=t[c+1],y=t[c+2];p<e&&(e=p),d<i&&(i=d),y<r&&(r=y),p>n&&(n=p),d>a&&(a=d),y>h&&(h=y)}return this.min.set(e,i,r),this.max.set(n,a,h),this}setFromBufferAttribute(t){let e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,h=-1/0;for(let c=0,u=t.count;c<u;c++){let p=t.getX(c),d=t.getY(c),y=t.getZ(c);p<e&&(e=p),d<i&&(i=d),y<r&&(r=y),p>n&&(n=p),d>a&&(a=d),y>h&&(h=y)}return this.min.set(e,i,r),this.max.set(n,a,h),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=pi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let a=0,h=n.count;a<h;a++)pi.fromBufferAttribute(n,a).applyMatrix4(t.matrixWorld),this.expandByPoint(pi)}else i.boundingBox===null&&i.computeBoundingBox(),Tn.copy(i.boundingBox),Tn.applyMatrix4(t.matrixWorld),this.union(Tn);let r=t.children;for(let n=0,a=r.length;n<a;n++)this.expandByObject(r[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,pi),pi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ys),hr.subVectors(this.max,ys),Ri.subVectors(t.a,ys),Ci.subVectors(t.b,ys),Ni.subVectors(t.c,ys),We.subVectors(Ci,Ri),qe.subVectors(Ni,Ci),di.subVectors(Ri,Ni);let e=[0,-We.z,We.y,0,-qe.z,qe.y,0,-di.z,di.y,We.z,0,-We.x,qe.z,0,-qe.x,di.z,0,-di.x,-We.y,We.x,0,-qe.y,qe.x,0,-di.y,di.x,0];return!En(e,Ri,Ci,Ni,hr)||(e=[1,0,0,0,1,0,0,0,1],!En(e,Ri,Ci,Ni,hr))?!1:(cr.crossVectors(We,qe),e=[cr.x,cr.y,cr.z],En(e,Ri,Ci,Ni,hr))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return pi.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(pi).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Ne[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ne[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ne[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ne[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ne[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ne[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ne[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ne[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ne),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};Jt.prototype.isBox3=!0;var Ne=[new _,new _,new _,new _,new _,new _,new _,new _],pi=new _,Tn=new Jt,Ri=new _,Ci=new _,Ni=new _,We=new _,qe=new _,di=new _,ys=new _,hr=new _,cr=new _,fi=new _;function En(m,t,e,i,r){for(let n=0,a=m.length-3;n<=a;n+=3){fi.fromArray(m,n);let h=r.x*Math.abs(fi.x)+r.y*Math.abs(fi.y)+r.z*Math.abs(fi.z),c=t.dot(fi),u=e.dot(fi),p=i.dot(fi);if(Math.max(-Math.max(c,u,p),Math.min(c,u,p))>h)return!1}return!0}var jh=new Jt,la=new _,lr=new _,Sn=new _,Ht=class{constructor(t=new _,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;e!==void 0?i.copy(e):jh.setFromPoints(t).getCenter(i);let r=0;for(let n=0,a=t.length;n<a;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Sn.subVectors(t,this.center);let e=Sn.lengthSq();if(e>this.radius*this.radius){let i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.add(Sn.multiplyScalar(r/i)),this.radius+=r}return this}union(t){return this.center.equals(t.center)===!0?lr.set(0,0,1).multiplyScalar(t.radius):lr.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(la.copy(t.center).add(lr)),this.expandByPoint(la.copy(t.center).sub(lr)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}};var Ie=new _,_n=new _,ur=new _,Xe=new _,kn=new _,pr=new _,Rn=new _,Ye=class{constructor(t=new _,e=new _(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ie)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=Ie.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ie.copy(this.direction).multiplyScalar(e).add(this.origin),Ie.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){_n.copy(t).add(e).multiplyScalar(.5),ur.copy(e).sub(t).normalize(),Xe.copy(this.origin).sub(_n);let n=t.distanceTo(e)*.5,a=-this.direction.dot(ur),h=Xe.dot(this.direction),c=-Xe.dot(ur),u=Xe.lengthSq(),p=Math.abs(1-a*a),d,y,x,M;if(p>0)if(d=a*c-h,y=a*h-c,M=n*p,d>=0)if(y>=-M)if(y<=M){let A=1/p;d*=A,y*=A,x=d*(d+a*y+2*h)+y*(a*d+y+2*c)+u}else y=n,d=Math.max(0,-(a*y+h)),x=-d*d+y*(y+2*c)+u;else y=-n,d=Math.max(0,-(a*y+h)),x=-d*d+y*(y+2*c)+u;else y<=-M?(d=Math.max(0,-(-a*n+h)),y=d>0?-n:Math.min(Math.max(-n,-c),n),x=-d*d+y*(y+2*c)+u):y<=M?(d=0,y=Math.min(Math.max(-n,-c),n),x=y*(y+2*c)+u):(d=Math.max(0,-(a*n+h)),y=d>0?n:Math.min(Math.max(-n,-c),n),x=-d*d+y*(y+2*c)+u);else y=a>0?-n:n,d=Math.max(0,-(a*y+h)),x=-d*d+y*(y+2*c)+u;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(ur).multiplyScalar(y).add(_n),x}intersectSphere(t,e){Ie.subVectors(t.center,this.origin);let i=Ie.dot(this.direction),r=Ie.dot(Ie)-i*i,n=t.radius*t.radius;if(r>n)return null;let a=Math.sqrt(n-r),h=i-a,c=i+a;return h<0&&c<0?null:h<0?this.at(c,e):this.at(h,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,a,h,c,u=1/this.direction.x,p=1/this.direction.y,d=1/this.direction.z,y=this.origin;return u>=0?(i=(t.min.x-y.x)*u,r=(t.max.x-y.x)*u):(i=(t.max.x-y.x)*u,r=(t.min.x-y.x)*u),p>=0?(n=(t.min.y-y.y)*p,a=(t.max.y-y.y)*p):(n=(t.max.y-y.y)*p,a=(t.min.y-y.y)*p),i>a||n>r||((n>i||i!==i)&&(i=n),(a<r||r!==r)&&(r=a),d>=0?(h=(t.min.z-y.z)*d,c=(t.max.z-y.z)*d):(h=(t.max.z-y.z)*d,c=(t.min.z-y.z)*d),i>c||h>r)||((h>i||i!==i)&&(i=h),(c<r||r!==r)&&(r=c),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,Ie)!==null}intersectTriangle(t,e,i,r,n){kn.subVectors(e,t),pr.subVectors(i,t),Rn.crossVectors(kn,pr);let a=this.direction.dot(Rn),h;if(a>0){if(r)return null;h=1}else if(a<0)h=-1,a=-a;else return null;Xe.subVectors(this.origin,t);let c=h*this.direction.dot(pr.crossVectors(Xe,pr));if(c<0)return null;let u=h*this.direction.dot(kn.cross(Xe));if(u<0||c+u>a)return null;let p=-h*Xe.dot(Rn);return p<0?null:this.at(p/a,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};var X=class m{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,r,n,a,h,c,u,p,d,y,x,M,A,R){let T=this.elements;return T[0]=t,T[4]=e,T[8]=i,T[12]=r,T[1]=n,T[5]=a,T[9]=h,T[13]=c,T[2]=u,T[6]=p,T[10]=d,T[14]=y,T[3]=x,T[7]=M,T[11]=A,T[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new m().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,r=1/Ii.setFromMatrixColumn(t,0).length(),n=1/Ii.setFromMatrixColumn(t,1).length(),a=1/Ii.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let e=this.elements,i=t.x,r=t.y,n=t.z,a=Math.cos(i),h=Math.sin(i),c=Math.cos(r),u=Math.sin(r),p=Math.cos(n),d=Math.sin(n);if(t.order==="XYZ"){let y=a*p,x=a*d,M=h*p,A=h*d;e[0]=c*p,e[4]=-c*d,e[8]=u,e[1]=x+M*u,e[5]=y-A*u,e[9]=-h*c,e[2]=A-y*u,e[6]=M+x*u,e[10]=a*c}else if(t.order==="YXZ"){let y=c*p,x=c*d,M=u*p,A=u*d;e[0]=y+A*h,e[4]=M*h-x,e[8]=a*u,e[1]=a*d,e[5]=a*p,e[9]=-h,e[2]=x*h-M,e[6]=A+y*h,e[10]=a*c}else if(t.order==="ZXY"){let y=c*p,x=c*d,M=u*p,A=u*d;e[0]=y-A*h,e[4]=-a*d,e[8]=M+x*h,e[1]=x+M*h,e[5]=a*p,e[9]=A-y*h,e[2]=-a*u,e[6]=h,e[10]=a*c}else if(t.order==="ZYX"){let y=a*p,x=a*d,M=h*p,A=h*d;e[0]=c*p,e[4]=M*u-x,e[8]=y*u+A,e[1]=c*d,e[5]=A*u+y,e[9]=x*u-M,e[2]=-u,e[6]=h*c,e[10]=a*c}else if(t.order==="YZX"){let y=a*c,x=a*u,M=h*c,A=h*u;e[0]=c*p,e[4]=A-y*d,e[8]=M*d+x,e[1]=d,e[5]=a*p,e[9]=-h*p,e[2]=-u*p,e[6]=x*d+M,e[10]=y-A*d}else if(t.order==="XZY"){let y=a*c,x=a*u,M=h*c,A=h*u;e[0]=c*p,e[4]=-d,e[8]=u*p,e[1]=y*d+A,e[5]=a*p,e[9]=x*d-M,e[2]=M*d-x,e[6]=h*p,e[10]=A*d+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Wh,t,qh)}lookAt(t,e,i){let r=this.elements;return $t.subVectors(t,e),$t.lengthSq()===0&&($t.z=1),$t.normalize(),Ze.crossVectors(i,$t),Ze.lengthSq()===0&&(Math.abs(i.z)===1?$t.x+=1e-4:$t.z+=1e-4,$t.normalize(),Ze.crossVectors(i,$t)),Ze.normalize(),dr.crossVectors($t,Ze),r[0]=Ze.x,r[4]=dr.x,r[8]=$t.x,r[1]=Ze.y,r[5]=dr.y,r[9]=$t.y,r[2]=Ze.z,r[6]=dr.z,r[10]=$t.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,a=i[0],h=i[4],c=i[8],u=i[12],p=i[1],d=i[5],y=i[9],x=i[13],M=i[2],A=i[6],R=i[10],T=i[14],P=i[3],z=i[7],B=i[11],F=i[15],H=r[0],V=r[4],W=r[8],dt=r[12],J=r[1],Q=r[5],ct=r[9],ot=r[13],Vt=r[2],it=r[6],gt=r[10],I=r[14],G=r[3],O=r[7],Y=r[11],tt=r[15];return n[0]=a*H+h*J+c*Vt+u*G,n[4]=a*V+h*Q+c*it+u*O,n[8]=a*W+h*ct+c*gt+u*Y,n[12]=a*dt+h*ot+c*I+u*tt,n[1]=p*H+d*J+y*Vt+x*G,n[5]=p*V+d*Q+y*it+x*O,n[9]=p*W+d*ct+y*gt+x*Y,n[13]=p*dt+d*ot+y*I+x*tt,n[2]=M*H+A*J+R*Vt+T*G,n[6]=M*V+A*Q+R*it+T*O,n[10]=M*W+A*ct+R*gt+T*Y,n[14]=M*dt+A*ot+R*I+T*tt,n[3]=P*H+z*J+B*Vt+F*G,n[7]=P*V+z*Q+B*it+F*O,n[11]=P*W+z*ct+B*gt+F*Y,n[15]=P*dt+z*ot+B*I+F*tt,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],a=t[1],h=t[5],c=t[9],u=t[13],p=t[2],d=t[6],y=t[10],x=t[14],M=t[3],A=t[7],R=t[11],T=t[15];return M*(+n*c*d-r*u*d-n*h*y+i*u*y+r*h*x-i*c*x)+A*(+e*c*x-e*u*y+n*a*y-r*a*x+r*u*p-n*c*p)+R*(+e*u*d-e*h*x-n*a*d+i*a*x+n*h*p-i*u*p)+T*(-r*h*p-e*c*d+e*h*y+r*a*d-i*a*y+i*c*p)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],h=t[5],c=t[6],u=t[7],p=t[8],d=t[9],y=t[10],x=t[11],M=t[12],A=t[13],R=t[14],T=t[15],P=d*R*u-A*y*u+A*c*x-h*R*x-d*c*T+h*y*T,z=M*y*u-p*R*u-M*c*x+a*R*x+p*c*T-a*y*T,B=p*A*u-M*d*u+M*h*x-a*A*x-p*h*T+a*d*T,F=M*d*c-p*A*c-M*h*y+a*A*y+p*h*R-a*d*R,H=e*P+i*z+r*B+n*F;if(H===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let V=1/H;return t[0]=P*V,t[1]=(A*y*n-d*R*n-A*r*x+i*R*x+d*r*T-i*y*T)*V,t[2]=(h*R*n-A*c*n+A*r*u-i*R*u-h*r*T+i*c*T)*V,t[3]=(d*c*n-h*y*n-d*r*u+i*y*u+h*r*x-i*c*x)*V,t[4]=z*V,t[5]=(p*R*n-M*y*n+M*r*x-e*R*x-p*r*T+e*y*T)*V,t[6]=(M*c*n-a*R*n-M*r*u+e*R*u+a*r*T-e*c*T)*V,t[7]=(a*y*n-p*c*n+p*r*u-e*y*u-a*r*x+e*c*x)*V,t[8]=B*V,t[9]=(M*d*n-p*A*n-M*i*x+e*A*x+p*i*T-e*d*T)*V,t[10]=(a*A*n-M*h*n+M*i*u-e*A*u-a*i*T+e*h*T)*V,t[11]=(p*h*n-a*d*n-p*i*u+e*d*u+a*i*x-e*h*x)*V,t[12]=F*V,t[13]=(p*A*r-M*d*r+M*i*y-e*A*y-p*i*R+e*d*R)*V,t[14]=(M*h*r-a*A*r-M*i*c+e*A*c+a*i*R-e*h*R)*V,t[15]=(a*d*r-p*h*r+p*i*c-e*d*c-a*i*y+e*h*y)*V,this}scale(t){let e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),r=Math.sin(e),n=1-i,a=t.x,h=t.y,c=t.z,u=n*a,p=n*h;return this.set(u*a+i,u*h-r*c,u*c+r*h,0,u*h+r*c,p*h+i,p*c-r*a,0,u*c-r*h,p*c+r*a,n*c*c+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,a){return this.set(1,i,n,0,t,1,a,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){let r=this.elements,n=e._x,a=e._y,h=e._z,c=e._w,u=n+n,p=a+a,d=h+h,y=n*u,x=n*p,M=n*d,A=a*p,R=a*d,T=h*d,P=c*u,z=c*p,B=c*d,F=i.x,H=i.y,V=i.z;return r[0]=(1-(A+T))*F,r[1]=(x+B)*F,r[2]=(M-z)*F,r[3]=0,r[4]=(x-B)*H,r[5]=(1-(y+T))*H,r[6]=(R+P)*H,r[7]=0,r[8]=(M+z)*V,r[9]=(R-P)*V,r[10]=(1-(y+A))*V,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){let r=this.elements,n=Ii.set(r[0],r[1],r[2]).length(),a=Ii.set(r[4],r[5],r[6]).length(),h=Ii.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],ce.copy(this);let u=1/n,p=1/a,d=1/h;return ce.elements[0]*=u,ce.elements[1]*=u,ce.elements[2]*=u,ce.elements[4]*=p,ce.elements[5]*=p,ce.elements[6]*=p,ce.elements[8]*=d,ce.elements[9]*=d,ce.elements[10]*=d,e.setFromRotationMatrix(ce),i.x=n,i.y=a,i.z=h,this}makePerspective(t,e,i,r,n,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let h=this.elements,c=2*n/(e-t),u=2*n/(i-r),p=(e+t)/(e-t),d=(i+r)/(i-r),y=-(a+n)/(a-n),x=-2*a*n/(a-n);return h[0]=c,h[4]=0,h[8]=p,h[12]=0,h[1]=0,h[5]=u,h[9]=d,h[13]=0,h[2]=0,h[6]=0,h[10]=y,h[14]=x,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,r,n,a){let h=this.elements,c=1/(e-t),u=1/(i-r),p=1/(a-n),d=(e+t)*c,y=(i+r)*u,x=(a+n)*p;return h[0]=2*c,h[4]=0,h[8]=0,h[12]=-d,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-y,h[2]=0,h[6]=0,h[10]=-2*p,h[14]=-x,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}};X.prototype.isMatrix4=!0;var Ii=new _,ce=new X,Wh=new _(0,0,0),qh=new _(1,1,1),Ze=new _,dr=new _,$t=new _;var ua=new X,pa=new _t,mi=class m{constructor(t=0,e=0,i=0,r=m.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let r=t.elements,n=r[0],a=r[4],h=r[8],c=r[1],u=r[5],p=r[9],d=r[2],y=r[6],x=r[10];switch(e){case"XYZ":this._y=Math.asin(St(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-p,x),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(y,u),this._z=0);break;case"YXZ":this._x=Math.asin(-St(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(h,x),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-d,n),this._z=0);break;case"ZXY":this._x=Math.asin(St(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-d,x),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,n));break;case"ZYX":this._y=Math.asin(-St(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(y,x),this._z=Math.atan2(c,n)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(St(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,u),this._y=Math.atan2(-d,n)):(this._x=0,this._y=Math.atan2(h,x));break;case"XZY":this._z=Math.asin(-St(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(y,u),this._y=Math.atan2(h,n)):(this._x=Math.atan2(-p,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ua.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ua,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return pa.setFromEuler(this),this.setFromQuaternion(pa,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};mi.prototype.isEuler=!0;mi.DefaultOrder="XYZ";mi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var fr=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}};var Xh=0,da=new _,zi=new _t,ze=new X,mr=new _,xs=new _,Yh=new _,Zh=new _t,fa=new _(1,0,0),ma=new _(0,1,0),ga=new _(0,0,1),Jh={type:"added"},ya={type:"removed"},at=class m extends ge{constructor(){super(),Object.defineProperty(this,"id",{value:Xh++}),this.uuid=Ct(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=m.DefaultUp.clone();let t=new _,e=new mi,i=new _t,r=new _(1,1,1);function n(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new X},normalMatrix:{value:new ae}}),this.matrix=new X,this.matrixWorld=new X,this.matrixAutoUpdate=m.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return zi.setFromAxisAngle(t,e),this.quaternion.multiply(zi),this}rotateOnWorldAxis(t,e){return zi.setFromAxisAngle(t,e),this.quaternion.premultiply(zi),this}rotateX(t){return this.rotateOnAxis(fa,t)}rotateY(t){return this.rotateOnAxis(ma,t)}rotateZ(t){return this.rotateOnAxis(ga,t)}translateOnAxis(t,e){return da.copy(t).applyQuaternion(this.quaternion),this.position.add(da.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(fa,t)}translateY(t){return this.translateOnAxis(ma,t)}translateZ(t){return this.translateOnAxis(ga,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ze.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?mr.copy(t):mr.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),xs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ze.lookAt(xs,mr,this.up):ze.lookAt(mr,xs,this.up),this.quaternion.setFromRotationMatrix(ze),r&&(ze.extractRotation(r.matrixWorld),zi.setFromRotationMatrix(ze),this.quaternion.premultiply(zi.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Jh)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ya)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(ya)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ze.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ze.multiply(t.parent.matrixWorld)),t.applyMatrix4(ze),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,t,Yh),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,Zh,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let n=0,a=r.length;n<a;n++)r[n].updateWorldMatrix(!1,!0)}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(h,c){return h[c.uuid]===void 0&&(h[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);let h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){let c=h.shapes;if(Array.isArray(c))for(let u=0,p=c.length;u<p;u++){let d=c[u];n(t.shapes,d)}else n(t.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let h=[];for(let c=0,u=this.material.length;c<u;c++)h.push(n(t.materials,this.material[c]));r.material=h}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let h=0;h<this.children.length;h++)r.children.push(this.children[h].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let h=0;h<this.animations.length;h++){let c=this.animations[h];r.animations.push(n(t.animations,c))}}if(e){let h=a(t.geometries),c=a(t.materials),u=a(t.textures),p=a(t.images),d=a(t.shapes),y=a(t.skeletons),x=a(t.animations),M=a(t.nodes);h.length>0&&(i.geometries=h),c.length>0&&(i.materials=c),u.length>0&&(i.textures=u),p.length>0&&(i.images=p),d.length>0&&(i.shapes=d),y.length>0&&(i.skeletons=y),x.length>0&&(i.animations=x),M.length>0&&(i.nodes=M)}return i.object=r,i;function a(h){let c=[];for(let u in h){let p=h[u];delete p.metadata,c.push(p)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};at.DefaultUp=new _(0,1,0);at.DefaultMatrixAutoUpdate=!0;at.prototype.isObject3D=!0;var le=new _,Pe=new _,Cn=new _,Be=new _,Pi=new _,Bi=new _,xa=new _,Nn=new _,In=new _,zn=new _,Fi=class m{constructor(t=new _,e=new _,i=new _){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),le.subVectors(t,e),r.cross(le);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){le.subVectors(r,e),Pe.subVectors(i,e),Cn.subVectors(t,e);let a=le.dot(le),h=le.dot(Pe),c=le.dot(Cn),u=Pe.dot(Pe),p=Pe.dot(Cn),d=a*u-h*h;if(d===0)return n.set(-2,-1,-1);let y=1/d,x=(u*c-h*p)*y,M=(a*p-h*c)*y;return n.set(1-x-M,M,x)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,Be),Be.x>=0&&Be.y>=0&&Be.x+Be.y<=1}static getUV(t,e,i,r,n,a,h,c){return this.getBarycoord(t,e,i,r,Be),c.set(0,0),c.addScaledVector(n,Be.x),c.addScaledVector(a,Be.y),c.addScaledVector(h,Be.z),c}static isFrontFacing(t,e,i,r){return le.subVectors(i,e),Pe.subVectors(t,e),le.cross(Pe).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return le.subVectors(this.c,this.b),Pe.subVectors(this.a,this.b),le.cross(Pe).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return m.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return m.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,n){return m.getUV(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return m.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return m.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i=this.a,r=this.b,n=this.c,a,h;Pi.subVectors(r,i),Bi.subVectors(n,i),Nn.subVectors(t,i);let c=Pi.dot(Nn),u=Bi.dot(Nn);if(c<=0&&u<=0)return e.copy(i);In.subVectors(t,r);let p=Pi.dot(In),d=Bi.dot(In);if(p>=0&&d<=p)return e.copy(r);let y=c*d-p*u;if(y<=0&&c>=0&&p<=0)return a=c/(c-p),e.copy(i).addScaledVector(Pi,a);zn.subVectors(t,n);let x=Pi.dot(zn),M=Bi.dot(zn);if(M>=0&&x<=M)return e.copy(n);let A=x*u-c*M;if(A<=0&&u>=0&&M<=0)return h=u/(u-M),e.copy(i).addScaledVector(Bi,h);let R=p*M-x*d;if(R<=0&&d-p>=0&&x-M>=0)return xa.subVectors(n,r),h=(d-p)/(d-p+(x-M)),e.copy(r).addScaledVector(xa,h);let T=1/(R+A+y);return a=A*T,h=y*T,e.copy(i).addScaledVector(Pi,a).addScaledVector(Bi,h)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};var $h=0,et=class extends ge{constructor(){super(),Object.defineProperty(this,"id",{value:$h++}),this.uuid=Ct(),this.name="",this.type="Material",this.fog=!0,this.blending=fn,this.side=hs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Wo,this.blendDst=qo,this.blendEquation=jo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Xo,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=na,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sr,this.stencilZFail=sr,this.stencilZPass=sr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===Go;continue}let r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==fn&&(i.blending=this.blending),this.side!==hs&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(n){let a=[];for(let h in n){let c=n[h];delete c.metadata,a.push(c)}return a}if(e){let n=r(t.textures),a=r(t.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(e!==null){let r=e.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}};et.prototype.isMaterial=!0;et.fromType=function(){return null};var Ut=class extends et{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new U(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ti,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};Ut.prototype.isMeshBasicMaterial=!0;var kt=new _,gr=new K,It=class{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i===!0,this.usage=ds,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new U),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this}copyVector2sArray(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new K),e[i++]=a.x,e[i++]=a.y}return this}copyVector3sArray(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new _),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this}copyVector4sArray(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Pt),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)gr.fromBufferAttribute(this,e),gr.applyMatrix3(t),this.setXY(e,gr.x,gr.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)kt.fromBufferAttribute(this,e),kt.applyMatrix3(t),this.setXYZ(e,kt.x,kt.y,kt.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)kt.fromBufferAttribute(this,e),kt.applyMatrix4(t),this.setXYZ(e,kt.x,kt.y,kt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)kt.fromBufferAttribute(this,e),kt.applyNormalMatrix(t),this.setXYZ(e,kt.x,kt.y,kt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)kt.fromBufferAttribute(this,e),kt.transformDirection(t),this.setXYZ(e,kt.x,kt.y,kt.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==ds&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}};It.prototype.isBufferAttribute=!0;var yr=class extends It{constructor(t,e,i){super(new Uint16Array(t),e,i)}};var xr=class extends It{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Pn=class extends It{constructor(t,e,i){super(new Uint16Array(t),e,i)}};Pn.prototype.isFloat16BufferAttribute=!0;var Je=class extends It{constructor(t,e,i){super(new Float32Array(t),e,i)}};var Kh=0,ie=new X,Bn=new at,Li=new _,Kt=new Jt,bs=new Jt,Bt=new _,se=class m extends ge{constructor(){super(),Object.defineProperty(this,"id",{value:Kh++}),this.uuid=Ct(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(aa(t)?xr:yr)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new ae().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ie.makeRotationFromQuaternion(t),this.applyMatrix4(ie),this}rotateX(t){return ie.makeRotationX(t),this.applyMatrix4(ie),this}rotateY(t){return ie.makeRotationY(t),this.applyMatrix4(ie),this}rotateZ(t){return ie.makeRotationZ(t),this.applyMatrix4(ie),this}translate(t,e,i){return ie.makeTranslation(t,e,i),this.applyMatrix4(ie),this}scale(t,e,i){return ie.makeScale(t,e,i),this.applyMatrix4(ie),this}lookAt(t){return Bn.lookAt(t),Bn.updateMatrix(),this.applyMatrix4(Bn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Li).negate(),this.translate(Li.x,Li.y,Li.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Je(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jt);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new _(-1/0,-1/0,-1/0),new _(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let n=e[i];Kt.setFromBufferAttribute(n),this.morphTargetsRelative?(Bt.addVectors(this.boundingBox.min,Kt.min),this.boundingBox.expandByPoint(Bt),Bt.addVectors(this.boundingBox.max,Kt.max),this.boundingBox.expandByPoint(Bt)):(this.boundingBox.expandByPoint(Kt.min),this.boundingBox.expandByPoint(Kt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ht);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new _,1/0);return}if(t){let i=this.boundingSphere.center;if(Kt.setFromBufferAttribute(t),e)for(let n=0,a=e.length;n<a;n++){let h=e[n];bs.setFromBufferAttribute(h),this.morphTargetsRelative?(Bt.addVectors(Kt.min,bs.min),Kt.expandByPoint(Bt),Bt.addVectors(Kt.max,bs.max),Kt.expandByPoint(Bt)):(Kt.expandByPoint(bs.min),Kt.expandByPoint(bs.max))}Kt.getCenter(i);let r=0;for(let n=0,a=t.count;n<a;n++)Bt.fromBufferAttribute(t,n),r=Math.max(r,i.distanceToSquared(Bt));if(e)for(let n=0,a=e.length;n<a;n++){let h=e[n],c=this.morphTargetsRelative;for(let u=0,p=h.count;u<p;u++)Bt.fromBufferAttribute(h,u),c&&(Li.fromBufferAttribute(t,u),Bt.add(Li)),r=Math.max(r,i.distanceToSquared(Bt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,n=e.normal.array,a=e.uv.array,h=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new It(new Float32Array(4*h),4));let c=this.getAttribute("tangent").array,u=[],p=[];for(let J=0;J<h;J++)u[J]=new _,p[J]=new _;let d=new _,y=new _,x=new _,M=new K,A=new K,R=new K,T=new _,P=new _;function z(J,Q,ct){d.fromArray(r,J*3),y.fromArray(r,Q*3),x.fromArray(r,ct*3),M.fromArray(a,J*2),A.fromArray(a,Q*2),R.fromArray(a,ct*2),y.sub(d),x.sub(d),A.sub(M),R.sub(M);let ot=1/(A.x*R.y-R.x*A.y);isFinite(ot)&&(T.copy(y).multiplyScalar(R.y).addScaledVector(x,-A.y).multiplyScalar(ot),P.copy(x).multiplyScalar(A.x).addScaledVector(y,-R.x).multiplyScalar(ot),u[J].add(T),u[Q].add(T),u[ct].add(T),p[J].add(P),p[Q].add(P),p[ct].add(P))}let B=this.groups;B.length===0&&(B=[{start:0,count:i.length}]);for(let J=0,Q=B.length;J<Q;++J){let ct=B[J],ot=ct.start,Vt=ct.count;for(let it=ot,gt=ot+Vt;it<gt;it+=3)z(i[it+0],i[it+1],i[it+2])}let F=new _,H=new _,V=new _,W=new _;function dt(J){V.fromArray(n,J*3),W.copy(V);let Q=u[J];F.copy(Q),F.sub(V.multiplyScalar(V.dot(Q))).normalize(),H.crossVectors(W,Q);let ot=H.dot(p[J])<0?-1:1;c[J*4]=F.x,c[J*4+1]=F.y,c[J*4+2]=F.z,c[J*4+3]=ot}for(let J=0,Q=B.length;J<Q;++J){let ct=B[J],ot=ct.start,Vt=ct.count;for(let it=ot,gt=ot+Vt;it<gt;it+=3)dt(i[it+0]),dt(i[it+1]),dt(i[it+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new It(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let y=0,x=i.count;y<x;y++)i.setXYZ(y,0,0,0);let r=new _,n=new _,a=new _,h=new _,c=new _,u=new _,p=new _,d=new _;if(t)for(let y=0,x=t.count;y<x;y+=3){let M=t.getX(y+0),A=t.getX(y+1),R=t.getX(y+2);r.fromBufferAttribute(e,M),n.fromBufferAttribute(e,A),a.fromBufferAttribute(e,R),p.subVectors(a,n),d.subVectors(r,n),p.cross(d),h.fromBufferAttribute(i,M),c.fromBufferAttribute(i,A),u.fromBufferAttribute(i,R),h.add(p),c.add(p),u.add(p),i.setXYZ(M,h.x,h.y,h.z),i.setXYZ(A,c.x,c.y,c.z),i.setXYZ(R,u.x,u.y,u.z)}else for(let y=0,x=e.count;y<x;y+=3)r.fromBufferAttribute(e,y+0),n.fromBufferAttribute(e,y+1),a.fromBufferAttribute(e,y+2),p.subVectors(a,n),d.subVectors(r,n),p.cross(d),i.setXYZ(y+0,p.x,p.y,p.z),i.setXYZ(y+1,p.x,p.y,p.z),i.setXYZ(y+2,p.x,p.y,p.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let i=this.attributes;for(let r in i){if(t.attributes[r]===void 0)continue;let a=i[r].array,h=t.attributes[r],c=h.array,u=h.itemSize*e,p=Math.min(c.length,a.length-u);for(let d=0,y=u;d<p;d++,y++)a[y]=c[d]}return this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Bt.fromBufferAttribute(t,e),Bt.normalize(),t.setXYZ(e,Bt.x,Bt.y,Bt.z)}toNonIndexed(){function t(h,c){let u=h.array,p=h.itemSize,d=h.normalized,y=new u.constructor(c.length*p),x=0,M=0;for(let A=0,R=c.length;A<R;A++){h.isInterleavedBufferAttribute?x=c[A]*h.data.stride+h.offset:x=c[A]*p;for(let T=0;T<p;T++)y[M++]=u[x++]}return new It(y,p,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new m,i=this.index.array,r=this.attributes;for(let h in r){let c=r[h],u=t(c,i);e.setAttribute(h,u)}let n=this.morphAttributes;for(let h in n){let c=[],u=n[h];for(let p=0,d=u.length;p<d;p++){let y=u[p],x=t(y,i);c.push(x)}e.morphAttributes[h]=c}e.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let h=0,c=a.length;h<c;h++){let u=a[h];e.addGroup(u.start,u.count,u.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let c=this.parameters;for(let u in c)c[u]!==void 0&&(t[u]=c[u]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let c in i){let u=i[c];t.data.attributes[c]=u.toJSON(t.data)}let r={},n=!1;for(let c in this.morphAttributes){let u=this.morphAttributes[c],p=[];for(let d=0,y=u.length;d<y;d++){let x=u[d];p.push(x.toJSON(t.data))}p.length>0&&(r[c]=p,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let h=this.boundingSphere;return h!==null&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let u in r){let p=r[u];this.setAttribute(u,p.clone(e))}let n=t.morphAttributes;for(let u in n){let p=[],d=n[u];for(let y=0,x=d.length;y<x;y++)p.push(d[y].clone(e));this.morphAttributes[u]=p}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let u=0,p=a.length;u<p;u++){let d=a[u];this.addGroup(d.start,d.count,d.materialIndex)}let h=t.boundingBox;h!==null&&(this.boundingBox=h.clone());let c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};se.prototype.isBufferGeometry=!0;var ba=new X,Di=new Ye,Fn=new Ht,$e=new _,Ke=new _,Qe=new _,Ln=new _,Dn=new _,On=new _,br=new _,wr=new _,vr=new _,Mr=new K,Ar=new K,Tr=new K,Vn=new _,Er=new _,ue=class extends at{constructor(t=new se,e=new Ut){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,i=Object.keys(e);if(i.length>0){let r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=r.length;n<a;n++){let h=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=n}}}}else{let e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),Fn.copy(i.boundingSphere),Fn.applyMatrix4(n),t.ray.intersectsSphere(Fn)===!1)||(ba.copy(n).invert(),Di.copy(t.ray).applyMatrix4(ba),i.boundingBox!==null&&Di.intersectsBox(i.boundingBox)===!1))return;let a;if(i.isBufferGeometry){let h=i.index,c=i.attributes.position,u=i.morphAttributes.position,p=i.morphTargetsRelative,d=i.attributes.uv,y=i.attributes.uv2,x=i.groups,M=i.drawRange;if(h!==null)if(Array.isArray(r))for(let A=0,R=x.length;A<R;A++){let T=x[A],P=r[T.materialIndex],z=Math.max(T.start,M.start),B=Math.min(h.count,Math.min(T.start+T.count,M.start+M.count));for(let F=z,H=B;F<H;F+=3){let V=h.getX(F),W=h.getX(F+1),dt=h.getX(F+2);a=Sr(this,P,t,Di,c,u,p,d,y,V,W,dt),a&&(a.faceIndex=Math.floor(F/3),a.face.materialIndex=T.materialIndex,e.push(a))}}else{let A=Math.max(0,M.start),R=Math.min(h.count,M.start+M.count);for(let T=A,P=R;T<P;T+=3){let z=h.getX(T),B=h.getX(T+1),F=h.getX(T+2);a=Sr(this,r,t,Di,c,u,p,d,y,z,B,F),a&&(a.faceIndex=Math.floor(T/3),e.push(a))}}else if(c!==void 0)if(Array.isArray(r))for(let A=0,R=x.length;A<R;A++){let T=x[A],P=r[T.materialIndex],z=Math.max(T.start,M.start),B=Math.min(c.count,Math.min(T.start+T.count,M.start+M.count));for(let F=z,H=B;F<H;F+=3){let V=F,W=F+1,dt=F+2;a=Sr(this,P,t,Di,c,u,p,d,y,V,W,dt),a&&(a.faceIndex=Math.floor(F/3),a.face.materialIndex=T.materialIndex,e.push(a))}}else{let A=Math.max(0,M.start),R=Math.min(c.count,M.start+M.count);for(let T=A,P=R;T<P;T+=3){let z=T,B=T+1,F=T+2;a=Sr(this,r,t,Di,c,u,p,d,y,z,B,F),a&&(a.faceIndex=Math.floor(T/3),e.push(a))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};ue.prototype.isMesh=!0;function Qh(m,t,e,i,r,n,a,h){let c;if(t.side===Uo?c=i.intersectTriangle(a,n,r,!0,h):c=i.intersectTriangle(r,n,a,t.side!==Ai,h),c===null)return null;Er.copy(h),Er.applyMatrix4(m.matrixWorld);let u=e.ray.origin.distanceTo(Er);return u<e.near||u>e.far?null:{distance:u,point:Er.clone(),object:m}}function Sr(m,t,e,i,r,n,a,h,c,u,p,d){$e.fromBufferAttribute(r,u),Ke.fromBufferAttribute(r,p),Qe.fromBufferAttribute(r,d);let y=m.morphTargetInfluences;if(n&&y){br.set(0,0,0),wr.set(0,0,0),vr.set(0,0,0);for(let M=0,A=n.length;M<A;M++){let R=y[M],T=n[M];R!==0&&(Ln.fromBufferAttribute(T,u),Dn.fromBufferAttribute(T,p),On.fromBufferAttribute(T,d),a?(br.addScaledVector(Ln,R),wr.addScaledVector(Dn,R),vr.addScaledVector(On,R)):(br.addScaledVector(Ln.sub($e),R),wr.addScaledVector(Dn.sub(Ke),R),vr.addScaledVector(On.sub(Qe),R)))}$e.add(br),Ke.add(wr),Qe.add(vr)}m.isSkinnedMesh&&(m.boneTransform(u,$e),m.boneTransform(p,Ke),m.boneTransform(d,Qe));let x=Qh(m,t,e,i,$e,Ke,Qe,Vn);if(x){h&&(Mr.fromBufferAttribute(h,u),Ar.fromBufferAttribute(h,p),Tr.fromBufferAttribute(h,d),x.uv=Fi.getUV(Vn,$e,Ke,Qe,Mr,Ar,Tr,new K)),c&&(Mr.fromBufferAttribute(c,u),Ar.fromBufferAttribute(c,p),Tr.fromBufferAttribute(c,d),x.uv2=Fi.getUV(Vn,$e,Ke,Qe,Mr,Ar,Tr,new K));let M={a:u,b:p,c:d,normal:new _,materialIndex:0};Fi.getNormal($e,Ke,Qe,M.normal),x.face=M}return x}function wa(m){let t={};for(let e in m){t[e]={};for(let i in m[e]){let r=m[e][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[e][i]=r.clone():Array.isArray(r)?t[e][i]=r.slice():t[e][i]=r}}return t}var va=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`;var Ma=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;var gi=class extends et{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=va,this.fragmentShader=Ma,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=wa(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let a=this.uniforms[r].value;a&&a.isTexture?e.uniforms[r]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[r]={type:"m4",value:a.toArray()}:e.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}};gi.prototype.isShaderMaterial=!0;var yi=class extends at{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new X,this.projectionMatrix=new X,this.projectionMatrixInverse=new X}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};yi.prototype.isCamera=!0;var ye=class extends yi{constructor(t=50,e=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=ui*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(Si*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return ui*2*Math.atan(Math.tan(Si*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,n,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(Si*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,a=this.view;if(this.view!==null&&this.view.enabled){let c=a.fullWidth,u=a.fullHeight;n+=a.offsetX*r/c,e-=a.offsetY*i/u,r*=a.width/c,i*=a.height/u}let h=this.filmOffset;h!==0&&(n+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};ye.prototype.isPerspectiveCamera=!0;var Hn=new _,tc=new _,ec=new ae,xe=class{constructor(t=new _(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let r=Hn.subVectors(i,e).cross(tc.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(Hn),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(i).multiplyScalar(n).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||ec.getNormalMatrix(t),r=this.coplanarPoint(Hn).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}};xe.prototype.isPlane=!0;var Oi=new Ht,_r=new _,kr=class{constructor(t=new xe,e=new xe,i=new xe,r=new xe,n=new xe,a=new xe){this.planes=[t,e,i,r,n,a]}set(t,e,i,r,n,a){let h=this.planes;return h[0].copy(t),h[1].copy(e),h[2].copy(i),h[3].copy(r),h[4].copy(n),h[5].copy(a),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,r=i[0],n=i[1],a=i[2],h=i[3],c=i[4],u=i[5],p=i[6],d=i[7],y=i[8],x=i[9],M=i[10],A=i[11],R=i[12],T=i[13],P=i[14],z=i[15];return e[0].setComponents(h-r,d-c,A-y,z-R).normalize(),e[1].setComponents(h+r,d+c,A+y,z+R).normalize(),e[2].setComponents(h+n,d+u,A+x,z+T).normalize(),e[3].setComponents(h-n,d-u,A-x,z-T).normalize(),e[4].setComponents(h-a,d-p,A-M,z-P).normalize(),e[5].setComponents(h+a,d+p,A+M,z+P).normalize(),this}intersectsObject(t){let e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Oi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Oi)}intersectsSprite(t){return Oi.center.set(0,0,0),Oi.radius=.7071067811865476,Oi.applyMatrix4(t.matrixWorld),this.intersectsSphere(Oi)}intersectsSphere(t){let e=this.planes,i=t.center,r=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let r=e[i];if(_r.x=r.normal.x>0?t.max.x:t.min.x,_r.y=r.normal.y>0?t.max.y:t.min.y,_r.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(_r)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};var ti=class extends yi{constructor(t=-1,e=1,i=1,r=-1,n=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t,a=i+t,h=r+e,c=r-e;if(this.view!==null&&this.view.enabled){let u=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=u*this.view.offsetX,a=n+u*this.view.width,h-=p*this.view.offsetY,c=h-p*this.view.height}this.projectionMatrix.makeOrthographic(n,a,h,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};ti.prototype.isOrthographicCamera=!0;var ws=class extends et{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=ra,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}};ws.prototype.isMeshDepthMaterial=!0;var vs=class extends et{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new _,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}};vs.prototype.isMeshDistanceMaterial=!0;var ei=class extends at{constructor(){super(),this.type="Group"}};ei.prototype.isGroup=!0;var Vi=class{constructor(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=ds,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ct()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ct()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ct()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};Vi.prototype.isInterleavedBuffer=!0;var Gt=new _,Hi=class m{constructor(t,e,i,r=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Gt.fromBufferAttribute(this,e),Gt.applyMatrix4(t),this.setXYZ(e,Gt.x,Gt.y,Gt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Gt.fromBufferAttribute(this,e),Gt.applyNormalMatrix(t),this.setXYZ(e,Gt.x,Gt.y,Gt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Gt.fromBufferAttribute(this,e),Gt.transformDirection(t),this.setXYZ(e,Gt.x,Gt.y,Gt.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return new It(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new m(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};Hi.prototype.isInterleavedBufferAttribute=!0;var Ms=class extends et{constructor(t){super(),this.type="SpriteMaterial",this.color=new U(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}};Ms.prototype.isSpriteMaterial=!0;var Aa=new _,Ta=new Pt,Ea=new Pt,ic=new _,Sa=new X,Ui=class extends ue{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new X,this.bindMatrixInverse=new X}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let t=new Pt,e=this.geometry.attributes.skinWeight;for(let i=0,r=e.count;i<r;i++){t.fromBufferAttribute(e,i);let n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){let i=this.skeleton,r=this.geometry;Ta.fromBufferAttribute(r.attributes.skinIndex,t),Ea.fromBufferAttribute(r.attributes.skinWeight,t),Aa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){let a=Ea.getComponent(n);if(a!==0){let h=Ta.getComponent(n);Sa.multiplyMatrices(i.bones[h].matrixWorld,i.boneInverses[h]),e.addScaledVector(ic.copy(Aa).applyMatrix4(Sa),a)}}return e.applyMatrix4(this.bindMatrixInverse)}};Ui.prototype.isSkinnedMesh=!0;var ii=class extends at{constructor(){super(),this.type="Bone"}};ii.prototype.isBone=!0;var As=class extends Zt{constructor(t=null,e=1,i=1,r,n,a,h,c,u=ls,p=ls,d,y){super(null,a,h,c,u,p,r,n,d,y),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};As.prototype.isDataTexture=!0;var _a=new X,sc=new X,Ts=class m{constructor(t=[],e=[]){this.uuid=Ct(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new X)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let i=new X;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,a=t.length;n<a;n++){let h=t[n]?t[n].matrixWorld:sc;_a.multiplyMatrices(h,e[n]),_a.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new m(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=bn(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new As(e,t,t,er,Ko);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){let n=t.bones[i],a=e[n];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),a=new ii),this.bones.push(a),this.boneInverses.push(new X().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){let a=e[r];t.bones.push(a.uuid);let h=i[r];t.boneInverses.push(h.toArray())}return t}};var Gi=class extends It{constructor(t,e,i,r=1){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}};Gi.prototype.isInstancedBufferAttribute=!0;var ka=new X,Ra=new X,Rr=[],Es=new ue,ji=class extends ue{constructor(t,e,i){super(t,e),this.instanceMatrix=new Gi(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){let i=this.matrixWorld,r=this.count;if(Es.geometry=this.geometry,Es.material=this.material,Es.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,ka),Ra.multiplyMatrices(i,ka),Es.matrixWorld=Ra,Es.raycast(t,Rr);for(let a=0,h=Rr.length;a<h;a++){let c=Rr[a];c.instanceId=n,c.object=this,e.push(c)}Rr.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Gi(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};ji.prototype.isInstancedMesh=!0;var pe=class extends et{constructor(t){super(),this.type="LineBasicMaterial",this.color=new U(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}};pe.prototype.isLineBasicMaterial=!0;var Ca=new _,Na=new _,Ia=new X,Un=new Ye,Cr=new Ht,be=class extends at{constructor(t=new se,e=new pe){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(t.index===null){let e=t.attributes.position,i=[0];for(let r=1,n=e.count;r<n;r++)Ca.fromBufferAttribute(e,r-1),Na.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=Ca.distanceTo(Na);t.setAttribute("lineDistance",new Je(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Cr.copy(i.boundingSphere),Cr.applyMatrix4(r),Cr.radius+=n,t.ray.intersectsSphere(Cr)===!1)return;Ia.copy(r).invert(),Un.copy(t.ray).applyMatrix4(Ia);let h=n/((this.scale.x+this.scale.y+this.scale.z)/3),c=h*h,u=new _,p=new _,d=new _,y=new _,x=this.isLineSegments?2:1;if(i.isBufferGeometry){let M=i.index,R=i.attributes.position;if(M!==null){let T=Math.max(0,a.start),P=Math.min(M.count,a.start+a.count);for(let z=T,B=P-1;z<B;z+=x){let F=M.getX(z),H=M.getX(z+1);if(u.fromBufferAttribute(R,F),p.fromBufferAttribute(R,H),Un.distanceSqToSegment(u,p,y,d)>c)continue;y.applyMatrix4(this.matrixWorld);let W=t.ray.origin.distanceTo(y);W<t.near||W>t.far||e.push({distance:W,point:d.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}else{let T=Math.max(0,a.start),P=Math.min(R.count,a.start+a.count);for(let z=T,B=P-1;z<B;z+=x){if(u.fromBufferAttribute(R,z),p.fromBufferAttribute(R,z+1),Un.distanceSqToSegment(u,p,y,d)>c)continue;y.applyMatrix4(this.matrixWorld);let H=t.ray.origin.distanceTo(y);H<t.near||H>t.far||e.push({distance:H,point:d.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,i=Object.keys(e);if(i.length>0){let r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=r.length;n<a;n++){let h=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=n}}}}else{let e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};be.prototype.isLine=!0;var za=new _,Pa=new _,Wi=class extends be{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(t.index===null){let e=t.attributes.position,i=[];for(let r=0,n=e.count;r<n;r+=2)za.fromBufferAttribute(e,r),Pa.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+za.distanceTo(Pa);t.setAttribute("lineDistance",new Je(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};Wi.prototype.isLineSegments=!0;var qi=class extends be{constructor(t,e){super(t,e),this.type="LineLoop"}};qi.prototype.isLineLoop=!0;var Fe=class extends et{constructor(t){super(),this.type="PointsMaterial",this.color=new U(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}};Fe.prototype.isPointsMaterial=!0;var Ba=new X,Gn=new Ye,Nr=new Ht,Ir=new _,Xi=class extends at{constructor(t=new se,e=new Fe){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,n=t.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Nr.copy(i.boundingSphere),Nr.applyMatrix4(r),Nr.radius+=n,t.ray.intersectsSphere(Nr)===!1)return;Ba.copy(r).invert(),Gn.copy(t.ray).applyMatrix4(Ba);let h=n/((this.scale.x+this.scale.y+this.scale.z)/3),c=h*h;if(i.isBufferGeometry){let u=i.index,d=i.attributes.position;if(u!==null){let y=Math.max(0,a.start),x=Math.min(u.count,a.start+a.count);for(let M=y,A=x;M<A;M++){let R=u.getX(M);Ir.fromBufferAttribute(d,R),Fa(Ir,R,c,r,t,e,this)}}else{let y=Math.max(0,a.start),x=Math.min(d.count,a.start+a.count);for(let M=y,A=x;M<A;M++)Ir.fromBufferAttribute(d,M),Fa(Ir,M,c,r,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,i=Object.keys(e);if(i.length>0){let r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=r.length;n<a;n++){let h=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=n}}}}else{let e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Xi.prototype.isPoints=!0;function Fa(m,t,e,i,r,n,a){let h=Gn.distanceSqToPoint(m);if(h<e){let c=new _;Gn.closestPointToPoint(m,c),c.applyMatrix4(i);let u=r.ray.origin.distanceTo(c);if(u<r.near||u>r.far)return;n.push({distance:u,distanceToRay:Math.sqrt(h),point:c,index:t,face:null,object:a})}}var Ss=class extends et{constructor(t){super(),this.type="ShadowMaterial",this.color=new U(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}};Ss.prototype.isShadowMaterial=!0;var _s=class extends gi{constructor(t){super(t),this.type="RawShaderMaterial"}};_s.prototype.isRawShaderMaterial=!0;var we=class extends et{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new U(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new U(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=me,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};we.prototype.isMeshStandardMaterial=!0;var Qt=class extends we{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new K(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return St(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new U(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new U(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new U(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}};Qt.prototype.isMeshPhysicalMaterial=!0;var ks=class extends et{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new U(16777215),this.specular=new U(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new U(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=me,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ti,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};ks.prototype.isMeshPhongMaterial=!0;var Rs=class extends et{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new U(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new U(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=me,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};Rs.prototype.isMeshToonMaterial=!0;var Cs=class extends et{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=me,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}};Cs.prototype.isMeshNormalMaterial=!0;var Ns=class extends et{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new U(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new U(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ti,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};Ns.prototype.isMeshLambertMaterial=!0;var Is=class extends et{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new U(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=me,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}};Is.prototype.isMeshMatcapMaterial=!0;var zs=class extends pe{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}};zs.prototype.isLineDashedMaterial=!0;var rc={ShadowMaterial:Ss,SpriteMaterial:Ms,RawShaderMaterial:_s,ShaderMaterial:gi,PointsMaterial:Fe,MeshPhysicalMaterial:Qt,MeshStandardMaterial:we,MeshPhongMaterial:ks,MeshToonMaterial:Rs,MeshNormalMaterial:Cs,MeshLambertMaterial:Ns,MeshDepthMaterial:ws,MeshDistanceMaterial:vs,MeshBasicMaterial:Ut,MeshMatcapMaterial:Is,LineDashedMaterial:zs,LineBasicMaterial:pe,Material:et};et.fromType=function(m){return new rc[m]};var mt={arraySlice:function(m,t,e){return mt.isTypedArray(m)?new m.constructor(m.subarray(t,e!==void 0?e:m.length)):m.slice(t,e)},convertArray:function(m,t,e){return!m||!e&&m.constructor===t?m:typeof t.BYTES_PER_ELEMENT=="number"?new t(m):Array.prototype.slice.call(m)},isTypedArray:function(m){return ArrayBuffer.isView(m)&&!(m instanceof DataView)},getKeyframeOrder:function(m){function t(r,n){return m[r]-m[n]}let e=m.length,i=new Array(e);for(let r=0;r!==e;++r)i[r]=r;return i.sort(t),i},sortedArray:function(m,t,e){let i=m.length,r=new m.constructor(i);for(let n=0,a=0;a!==i;++n){let h=e[n]*t;for(let c=0;c!==t;++c)r[a++]=m[h+c]}return r},flattenJSON:function(m,t,e,i){let r=1,n=m[0];for(;n!==void 0&&n[i]===void 0;)n=m[r++];if(n===void 0)return;let a=n[i];if(a!==void 0)if(Array.isArray(a))do a=n[i],a!==void 0&&(t.push(n.time),e.push.apply(e,a)),n=m[r++];while(n!==void 0);else if(a.toArray!==void 0)do a=n[i],a!==void 0&&(t.push(n.time),a.toArray(e,e.length)),n=m[r++];while(n!==void 0);else do a=n[i],a!==void 0&&(t.push(n.time),e.push(a)),n=m[r++];while(n!==void 0)},subclip:function(m,t,e,i,r=30){let n=m.clone();n.name=t;let a=[];for(let c=0;c<n.tracks.length;++c){let u=n.tracks[c],p=u.getValueSize(),d=[],y=[];for(let x=0;x<u.times.length;++x){let M=u.times[x]*r;if(!(M<e||M>=i)){d.push(u.times[x]);for(let A=0;A<p;++A)y.push(u.values[x*p+A])}}d.length!==0&&(u.times=mt.convertArray(d,u.times.constructor),u.values=mt.convertArray(y,u.values.constructor),a.push(u))}n.tracks=a;let h=1/0;for(let c=0;c<n.tracks.length;++c)h>n.tracks[c].times[0]&&(h=n.tracks[c].times[0]);for(let c=0;c<n.tracks.length;++c)n.tracks[c].shift(-1*h);return n.resetDuration(),n},makeClipAdditive:function(m,t=0,e=m,i=30){i<=0&&(i=30);let r=e.tracks.length,n=t/i;for(let a=0;a<r;++a){let h=e.tracks[a],c=h.ValueTypeName;if(c==="bool"||c==="string")continue;let u=m.tracks.find(function(T){return T.name===h.name&&T.ValueTypeName===c});if(u===void 0)continue;let p=0,d=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=d/3);let y=0,x=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(y=x/3);let M=h.times.length-1,A;if(n<=h.times[0]){let T=p,P=d-p;A=mt.arraySlice(h.values,T,P)}else if(n>=h.times[M]){let T=M*d+p,P=T+d-p;A=mt.arraySlice(h.values,T,P)}else{let T=h.createInterpolant(),P=p,z=d-p;T.evaluate(n),A=mt.arraySlice(T.resultBuffer,P,z)}c==="quaternion"&&new _t().fromArray(A).normalize().conjugate().toArray(A);let R=u.times.length;for(let T=0;T<R;++T){let P=T*x+y;if(c==="quaternion")_t.multiplyQuaternionsFlat(u.values,P,A,0,u.values,P);else{let z=x-y*2;for(let B=0;B<z;++B)u.values[P+B]-=A[B]}}}return m.blendMode=ta,m}};var Ot=class{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,r=e[i],n=e[i-1];i:{t:{let a;e:{s:if(!(t<r)){for(let h=i+2;;){if(r===void 0){if(t<n)break s;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,n)}if(i===h)break;if(n=r,r=e[++i],t<r)break t}a=e.length;break e}if(!(t>=n)){let h=e[1];t<h&&(i=2,n=h);for(let c=i-2;;){if(n===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(i===c)break;if(r=n,n=e[--i-1],t>=n)break t}a=i,i=0;break e}break i}for(;i<a;){let h=i+a>>>1;t<e[h]?a=h:i=h+1}if(r=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(r===void 0)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,n,t)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let a=0;a!==r;++a)e[a]=i[n+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};Ot.prototype.beforeStart_=Ot.prototype.copySampleValue_;Ot.prototype.afterEnd_=Ot.prototype.copySampleValue_;var zr=class extends Ot{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:gn,endingEnd:gn}}intervalChanged_(t,e,i){let r=this.parameterPositions,n=t-2,a=t+1,h=r[n],c=r[a];if(h===void 0)switch(this.getSettings_().endingStart){case yn:n=t,h=2*e-i;break;case xn:n=r.length-2,h=e+r[n]-r[n+1];break;default:n=t,h=i}if(c===void 0)switch(this.getSettings_().endingEnd){case yn:a=t,c=2*i-e;break;case xn:a=1,c=i+r[1]-r[0];break;default:a=t-1,c=e}let u=(i-e)*.5,p=this.valueSize;this._weightPrev=u/(e-h),this._weightNext=u/(c-i),this._offsetPrev=n*p,this._offsetNext=a*p}interpolate_(t,e,i,r){let n=this.resultBuffer,a=this.sampleValues,h=this.valueSize,c=t*h,u=c-h,p=this._offsetPrev,d=this._offsetNext,y=this._weightPrev,x=this._weightNext,M=(i-e)/(r-e),A=M*M,R=A*M,T=-y*R+2*y*A-y*M,P=(1+y)*R+(-1.5-2*y)*A+(-.5+y)*M+1,z=(-1-x)*R+(1.5+x)*A+.5*M,B=x*R-x*A;for(let F=0;F!==h;++F)n[F]=T*a[p+F]+P*a[u+F]+z*a[c+F]+B*a[d+F];return n}};var Pr=class extends Ot{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,a=this.sampleValues,h=this.valueSize,c=t*h,u=c-h,p=(i-e)/(r-e),d=1-p;for(let y=0;y!==h;++y)n[y]=a[u+y]*d+a[c+y]*p;return n}};var Br=class extends Ot{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}};var zt=class{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=mt.convertArray(e,this.TimeBufferType),this.values=mt.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:mt.convertArray(t.times,Array),values:mt.convertArray(t.values,Array)};let r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Br(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Pr(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new zr(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case _e:e=this.InterpolantFactoryMethodDiscrete;break;case ke:e=this.InterpolantFactoryMethodLinear;break;case ir:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _e;case this.InterpolantFactoryMethodLinear:return ke;case this.InterpolantFactoryMethodSmooth:return ir}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){let i=this.times,r=i.length,n=0,a=r-1;for(;n!==r&&i[n]<t;)++n;for(;a!==-1&&i[a]>e;)--a;if(++a,n!==0||a!==r){n>=a&&(a=Math.max(a,1),n=a-1);let h=this.getValueSize();this.times=mt.arraySlice(i,n,a),this.values=mt.arraySlice(this.values,n*h,a*h)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let h=0;h!==n;h++){let c=i[h];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,h,c),t=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,h,c,a),t=!1;break}a=c}if(r!==void 0&&mt.isTypedArray(r))for(let h=0,c=r.length;h!==c;++h){let u=r[h];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,h,u),t=!1;break}}return t}optimize(){let t=mt.arraySlice(this.times),e=mt.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===ir,n=t.length-1,a=1;for(let h=1;h<n;++h){let c=!1,u=t[h],p=t[h+1];if(u!==p&&(h!==1||u!==t[0]))if(r)c=!0;else{let d=h*i,y=d-i,x=d+i;for(let M=0;M!==i;++M){let A=e[d+M];if(A!==e[y+M]||A!==e[x+M]){c=!0;break}}}if(c){if(h!==a){t[a]=t[h];let d=h*i,y=a*i;for(let x=0;x!==i;++x)e[y+x]=e[d+x]}++a}}if(n>0){t[a]=t[n];for(let h=n*i,c=a*i,u=0;u!==i;++u)e[c+u]=e[h+u];++a}return a!==t.length?(this.times=mt.arraySlice(t,0,a),this.values=mt.arraySlice(e,0,a*i)):(this.times=t,this.values=e),this}clone(){let t=mt.arraySlice(this.times,0),e=mt.arraySlice(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}};zt.prototype.TimeBufferType=Float32Array;zt.prototype.ValueBufferType=Float32Array;zt.prototype.DefaultInterpolation=ke;var Le=class extends zt{};Le.prototype.ValueTypeName="bool";Le.prototype.ValueBufferType=Array;Le.prototype.DefaultInterpolation=_e;Le.prototype.InterpolantFactoryMethodLinear=void 0;Le.prototype.InterpolantFactoryMethodSmooth=void 0;var Ps=class extends zt{};Ps.prototype.ValueTypeName="color";var ve=class extends zt{};ve.prototype.ValueTypeName="number";var Fr=class extends Ot{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,a=this.sampleValues,h=this.valueSize,c=(i-e)/(r-e),u=t*h;for(let p=u+h;u!==p;u+=4)_t.slerpFlat(n,0,a,u-h,a,u,c);return n}};var re=class extends zt{InterpolantFactoryMethodLinear(t){return new Fr(this.times,this.values,this.getValueSize(),t)}};re.prototype.ValueTypeName="quaternion";re.prototype.DefaultInterpolation=ke;re.prototype.InterpolantFactoryMethodSmooth=void 0;var De=class extends zt{};De.prototype.ValueTypeName="string";De.prototype.ValueBufferType=Array;De.prototype.DefaultInterpolation=_e;De.prototype.InterpolantFactoryMethodLinear=void 0;De.prototype.InterpolantFactoryMethodSmooth=void 0;var Me=class extends zt{};Me.prototype.ValueTypeName="vector";var Bs=class{constructor(t,e=-1,i,r=Qo){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=Ct(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,r=1/(t.fps||1);for(let a=0,h=i.length;a!==h;++a)e.push(oc(i[a]).scale(r));let n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){let e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let n=0,a=i.length;n!==a;++n)e.push(zt.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(t,e,i,r){let n=e.length,a=[];for(let h=0;h<n;h++){let c=[],u=[];c.push((h+n-1)%n,h,(h+1)%n),u.push(0,1,0);let p=mt.getKeyframeOrder(c);c=mt.sortedArray(c,1,p),u=mt.sortedArray(u,1,p),!r&&c[0]===0&&(c.push(n),u.push(u[0])),a.push(new ve(".morphTargetInfluences["+e[h].name+"]",c,u).scale(1/i))}return new this(t,-1,a)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let h=0,c=t.length;h<c;h++){let u=t[h],p=u.name.match(n);if(p&&p.length>1){let d=p[1],y=r[d];y||(r[d]=y=[]),y.push(u)}}let a=[];for(let h in r)a.push(this.CreateFromMorphTargetSequence(h,r[h],e,i));return a}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(d,y,x,M,A){if(x.length!==0){let R=[],T=[];mt.flattenJSON(x,R,T,M),R.length!==0&&A.push(new d(y,R,T))}},r=[],n=t.name||"default",a=t.fps||30,h=t.blendMode,c=t.length||-1,u=t.hierarchy||[];for(let d=0;d<u.length;d++){let y=u[d].keys;if(!(!y||y.length===0))if(y[0].morphTargets){let x={},M;for(M=0;M<y.length;M++)if(y[M].morphTargets)for(let A=0;A<y[M].morphTargets.length;A++)x[y[M].morphTargets[A]]=-1;for(let A in x){let R=[],T=[];for(let P=0;P!==y[M].morphTargets.length;++P){let z=y[M];R.push(z.time),T.push(z.morphTarget===A?1:0)}r.push(new ve(".morphTargetInfluence["+A+"]",R,T))}c=x.length*a}else{let x=".bones["+e[d].name+"]";i(Me,x+".position",y,"pos",r),i(re,x+".quaternion",y,"rot",r),i(Me,x+".scale",y,"scl",r)}}return r.length===0?null:new this(n,c,r,h)}resetDuration(){let t=this.tracks,e=0;for(let i=0,r=t.length;i!==r;++i){let n=this.tracks[i];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function nc(m){switch(m.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ve;case"vector":case"vector2":case"vector3":case"vector4":return Me;case"color":return Ps;case"quaternion":return re;case"bool":case"boolean":return Le;case"string":return De}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+m)}function oc(m){if(m.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=nc(m.type);if(m.times===void 0){let e=[],i=[];mt.flattenJSON(m.keys,e,i,"value"),m.times=e,m.values=i}return t.parse!==void 0?t.parse(m):new t(m.name,m.times,m.values,m.interpolation)}var Oe={enabled:!1,files:{},add:function(m,t){this.enabled!==!1&&(this.files[m]=t)},get:function(m){if(this.enabled!==!1)return this.files[m]},remove:function(m){delete this.files[m]},clear:function(){this.files={}}};var jn=class{constructor(t,e,i){let r=this,n=!1,a=0,h=0,c,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(p){h++,n===!1&&r.onStart!==void 0&&r.onStart(p,a,h),n=!0},this.itemEnd=function(p){a++,r.onProgress!==void 0&&r.onProgress(p,a,h),a===h&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(p){r.onError!==void 0&&r.onError(p)},this.resolveURL=function(p){return c?c(p):p},this.setURLModifier=function(p){return c=p,this},this.addHandler=function(p,d){return u.push(p,d),this},this.removeHandler=function(p){let d=u.indexOf(p);return d!==-1&&u.splice(d,2),this},this.getHandler=function(p){for(let d=0,y=u.length;d<y;d+=2){let x=u[d],M=u[d+1];if(x.global&&(x.lastIndex=0),x.test(p))return M}return null}}},La=new jn;var te=class{constructor(t){this.manager=t!==void 0?t:La,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise(function(r,n){i.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};var Ve={},Yi=class extends te{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=Oe.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Ve[t]!==void 0){Ve[t].push({onLoad:e,onProgress:i,onError:r});return}Ve[t]=[],Ve[t].push({onLoad:e,onProgress:i,onError:r});let a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),h=this.mimeType,c=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;let p=Ve[t],d=u.body.getReader(),y=u.headers.get("Content-Length"),x=y?parseInt(y):0,M=x!==0,A=0,R=new ReadableStream({start(T){P();function P(){d.read().then(({done:z,value:B})=>{if(z)T.close();else{A+=B.byteLength;let F=new ProgressEvent("progress",{lengthComputable:M,loaded:A,total:x});for(let H=0,V=p.length;H<V;H++){let W=p[H];W.onProgress&&W.onProgress(F)}T.enqueue(B),P()}})}}});return new Response(R)}else throw Error(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(p=>new DOMParser().parseFromString(p,h));case"json":return u.json();default:if(h===void 0)return u.text();{let d=/charset="?([^;"\s]*)"?/i.exec(h),y=d&&d[1]?d[1].toLowerCase():void 0,x=new TextDecoder(y);return u.arrayBuffer().then(M=>x.decode(M))}}}).then(u=>{Oe.add(t,u);let p=Ve[t];delete Ve[t];for(let d=0,y=p.length;d<y;d++){let x=p[d];x.onLoad&&x.onLoad(u)}}).catch(u=>{let p=Ve[t];if(p===void 0)throw this.manager.itemError(t),u;delete Ve[t];for(let d=0,y=p.length;d<y;d++){let x=p[d];x.onError&&x.onError(u)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}};var Lr=class extends te{constructor(t){super(t)}load(t,e,i,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,a=Oe.get(t);if(a!==void 0)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;let h=fs("img");function c(){p(),Oe.add(t,this),e&&e(this),n.manager.itemEnd(t)}function u(d){p(),r&&r(d),n.manager.itemError(t),n.manager.itemEnd(t)}function p(){h.removeEventListener("load",c,!1),h.removeEventListener("error",u,!1)}return h.addEventListener("load",c,!1),h.addEventListener("error",u,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(h.crossOrigin=this.crossOrigin),n.manager.itemStart(t),h.src=t,h}};var Fs=class extends te{constructor(t){super(t)}load(t,e,i,r){let n=new Zt,a=new Lr(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(h){n.image=h,n.needsUpdate=!0,e!==void 0&&e(n)},i,r),n}};var He=class extends at{constructor(t,e=1){super(),this.type="Light",this.color=new U(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};He.prototype.isLight=!0;var Da=new X,Oa=new _,Va=new _,si=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new K(512,512),this.map=null,this.mapPass=null,this.matrix=new X,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new kr,this._frameExtents=new K(1,1),this._viewportCount=1,this._viewports=[new Pt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;Oa.setFromMatrixPosition(t.matrixWorld),e.position.copy(Oa),Va.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Va),e.updateMatrixWorld(),Da.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Da),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}};var Ls=class extends si{constructor(){super(new ye(50,1,.5,500)),this.focus=1}updateMatrices(t){let e=this.camera,i=ui*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(i!==e.fov||r!==e.aspect||n!==e.far)&&(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}};Ls.prototype.isSpotLightShadow=!0;var Zi=class extends He{constructor(t,e,i=0,r=Math.PI/3,n=0,a=1){super(t,e),this.type="SpotLight",this.position.copy(at.DefaultUp),this.updateMatrix(),this.target=new at,this.distance=i,this.angle=r,this.penumbra=n,this.decay=a,this.shadow=new Ls}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};Zi.prototype.isSpotLight=!0;var Ha=new X,Ds=new _,Wn=new _,Os=class extends si{constructor(){super(new ye(90,1,.5,500)),this._frameExtents=new K(4,2),this._viewportCount=6,this._viewports=[new Pt(2,1,1,1),new Pt(0,1,1,1),new Pt(3,1,1,1),new Pt(1,1,1,1),new Pt(3,0,1,1),new Pt(1,0,1,1)],this._cubeDirections=[new _(1,0,0),new _(-1,0,0),new _(0,0,1),new _(0,0,-1),new _(0,1,0),new _(0,-1,0)],this._cubeUps=[new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,0,1),new _(0,0,-1)]}updateMatrices(t,e=0){let i=this.camera,r=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Ds.setFromMatrixPosition(t.matrixWorld),i.position.copy(Ds),Wn.copy(i.position),Wn.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Wn),i.updateMatrixWorld(),r.makeTranslation(-Ds.x,-Ds.y,-Ds.z),Ha.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ha)}};Os.prototype.isPointLightShadow=!0;var Ji=class extends He{constructor(t,e,i=0,r=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Os}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}};Ji.prototype.isPointLight=!0;var Vs=class extends si{constructor(){super(new ti(-5,5,5,-5,.5,500))}};Vs.prototype.isDirectionalLightShadow=!0;var $i=class extends He{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(at.DefaultUp),this.updateMatrix(),this.target=new at,this.shadow=new Vs}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};$i.prototype.isDirectionalLight=!0;var xi=class{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){let e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}};var Ki=class extends te{constructor(t){super(t),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,a=Oe.get(t);if(a!==void 0)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;let h={};h.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",h.headers=this.requestHeader,fetch(t,h).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(c){Oe.add(t,c),e&&e(c),n.manager.itemEnd(t)}).catch(function(c){r&&r(c),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)}};Ki.prototype.isImageBitmapLoader=!0;var Xn="\\[\\]\\.:\\/",ac=new RegExp("["+Xn+"]","g"),Yn="[^"+Xn+"]",hc="[^"+Xn.replace("\\.","")+"]",cc=/((?:WC+[\/:])*)/.source.replace("WC",Yn),lc=/(WCOD+)?/.source.replace("WCOD",hc),uc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yn),pc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yn),dc=new RegExp("^"+cc+lc+uc+pc+"$"),fc=["material","materials","bones"],qn=class{constructor(t,e,i){let r=i||pt.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},pt=class m{constructor(t,e,i){this.path=e,this.parsedPath=i||m.parseTrackName(e),this.node=m.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new m.Composite(t,e,i):new m(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(ac,"")}static parseTrackName(t){let e=dc.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);fc.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){let i=function(n){for(let a=0;a<n.length;a++){let h=n[a];if(h.name===e||h.uuid===e)return h;let c=i(h.children);if(c)return c}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(t=m.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let u=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let p=0;p<t.length;p++)if(t[p].name===u){u=p;break}break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(u!==void 0){if(t[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[u]}}let a=t[r];if(a===void 0){let u=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",t);return}let h=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?h=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(h=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][h]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};pt.Composite=qn;pt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};pt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};pt.prototype.GetterByBindingType=[pt.prototype._getValue_direct,pt.prototype._getValue_array,pt.prototype._getValue_arrayElement,pt.prototype._getValue_toArray];pt.prototype.SetterByBindingTypeAndVersioning=[[pt.prototype._setValue_direct,pt.prototype._setValue_direct_setNeedsUpdate,pt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pt.prototype._setValue_array,pt.prototype._setValue_array_setNeedsUpdate,pt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pt.prototype._setValue_arrayElement,pt.prototype._setValue_arrayElement_setNeedsUpdate,pt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pt.prototype._setValue_fromArray,pt.prototype._setValue_fromArray_setNeedsUpdate,pt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dn}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dn);var Wt=require("three");function Zn(m,t){if(t===Wt.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),m;if(t===Wt.TriangleFanDrawMode||t===Wt.TriangleStripDrawMode){let e=m.getIndex();if(e===null){let a=[],h=m.getAttribute("position");if(h!==void 0){for(let c=0;c<h.count;c++)a.push(c);m.setIndex(a),e=m.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),m}let i=e.count-2,r=[];if(t===Wt.TriangleFanDrawMode)for(let a=1;a<=i;a++)r.push(e.getX(0)),r.push(e.getX(a)),r.push(e.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(r.push(e.getX(a)),r.push(e.getX(a+1)),r.push(e.getX(a+2))):(r.push(e.getX(a+2)),r.push(e.getX(a+1)),r.push(e.getX(a)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let n=m.clone();return n.setIndex(r),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),m}var Dr=class extends te{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new eo(e)}),this.register(function(e){return new ho(e)}),this.register(function(e){return new co(e)}),this.register(function(e){return new lo(e)}),this.register(function(e){return new so(e)}),this.register(function(e){return new ro(e)}),this.register(function(e){return new no(e)}),this.register(function(e){return new oo(e)}),this.register(function(e){return new to(e)}),this.register(function(e){return new ao(e)}),this.register(function(e){return new io(e)}),this.register(function(e){return new Kn(e)}),this.register(function(e){return new uo(e)}),this.register(function(e){return new po(e)})}load(t,e,i,r){let n=this,a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=xi.extractUrlBase(t),this.manager.itemStart(t);let h=function(u){r?r(u):console.error(u),n.manager.itemError(t),n.manager.itemEnd(t)},c=new Yi(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(u){try{n.parse(u,a,function(p){e(p),n.manager.itemEnd(t)},h)}catch(p){h(p)}},i,h)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,r){let n,a={},h={},c=new TextDecoder;if(typeof t=="string")n=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===Xa){try{a[nt.KHR_BINARY_GLTF]=new fo(t)}catch(d){r&&r(d);return}n=JSON.parse(a[nt.KHR_BINARY_GLTF].content)}else n=JSON.parse(c.decode(t));else n=t;if(n.asset===void 0||n.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let u=new vo(n,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){let d=this.pluginCallbacks[p](u);h[d.name]=d,a[d.name]=!0}if(n.extensionsUsed)for(let p=0;p<n.extensionsUsed.length;++p){let d=n.extensionsUsed[p],y=n.extensionsRequired||[];switch(d){case nt.KHR_MATERIALS_UNLIT:a[d]=new Qn;break;case nt.KHR_DRACO_MESH_COMPRESSION:a[d]=new mo(n,this.dracoLoader);break;case nt.KHR_TEXTURE_TRANSFORM:a[d]=new go;break;case nt.KHR_MESH_QUANTIZATION:a[d]=new yo;break;default:y.indexOf(d)>=0&&h[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}u.setExtensions(a),u.setPlugins(h),u.parse(i,r)}parseAsync(t,e){let i=this;return new Promise(function(r,n){i.parse(t,e,r,n)})}};function mc(){let m={};return{get:function(t){return m[t]},add:function(t,e){m[t]=e},remove:function(t){delete m[t]},removeAll:function(){m={}}}}var nt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Kn=class{constructor(t){this.parser=t,this.name=nt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){let e=this.parser,i="light:"+t,r=e.cache.get(i);if(r)return r;let n=e.json,c=((n.extensions&&n.extensions[this.name]||{}).lights||[])[t],u,p=new U(16777215);c.color!==void 0&&p.fromArray(c.color);let d=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new $i(p),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Ji(p),u.distance=d;break;case"spot":u=new Zi(p),u.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,ni(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=e.createUniqueName(c.name||"light_"+t),r=Promise.resolve(u),e.cache.add(i,r),r}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){let e=this,i=this.parser,n=i.json.nodes[t],h=(n.extensions&&n.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(c){return i._getNodeRef(e.cache,h,c)})}},Qn=class{constructor(){this.name=nt.KHR_MATERIALS_UNLIT}getMaterialType(){return Ut}extendParams(t,e,i){let r=[];t.color=new U(1,1,1),t.opacity=1;let n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let a=n.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}n.baseColorTexture!==void 0&&r.push(i.assignTexture(t,"map",n.baseColorTexture,Ei))}return Promise.all(r)}},to=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){let r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name].emissiveStrength;return n!==void 0&&(e.emissiveIntensity=n),Promise.resolve()}},eo=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(e.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(n.push(i.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){let h=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new K(h,h)}return Promise.all(n)}},io=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(e.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(e.iridescenceIOR=a.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}},so=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_SHEEN}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[];e.sheenColor=new U(0,0,0),e.sheenRoughness=0,e.sheen=1;let a=r.extensions[this.name];return a.sheenColorFactor!==void 0&&e.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&n.push(i.assignTexture(e,"sheenColorMap",a.sheenColorTexture,Ei)),a.sheenRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}},ro=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(e.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&n.push(i.assignTexture(e,"transmissionMap",a.transmissionTexture)),Promise.all(n)}},no=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_VOLUME}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],a=r.extensions[this.name];e.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&n.push(i.assignTexture(e,"thicknessMap",a.thicknessTexture)),e.attenuationDistance=a.attenuationDistance||1/0;let h=a.attenuationColor||[1,1,1];return e.attenuationColor=new U(h[0],h[1],h[2]),Promise.all(n)}},oo=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_IOR}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name];return e.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}},ao=class{constructor(t){this.parser=t,this.name=nt.KHR_MATERIALS_SPECULAR}getMaterialType(t){let i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Qt}extendMaterialParams(t,e){let i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],a=r.extensions[this.name];e.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&n.push(i.assignTexture(e,"specularIntensityMap",a.specularTexture));let h=a.specularColorFactor||[1,1,1];return e.specularColor=new U(h[0],h[1],h[2]),a.specularColorTexture!==void 0&&n.push(i.assignTexture(e,"specularColorMap",a.specularColorTexture,Ei)),Promise.all(n)}},ho=class{constructor(t){this.parser=t,this.name=nt.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,i=e.json,r=i.textures[t];if(!r.extensions||!r.extensions[this.name])return null;let n=r.extensions[this.name],a=e.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,n.source,a)}},co=class{constructor(t){this.parser=t,this.name=nt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,i=this.parser,r=i.json,n=r.textures[t];if(!n.extensions||!n.extensions[e])return null;let a=n.extensions[e],h=r.images[a.source],c=i.textureLoader;if(h.uri){let u=i.options.manager.getHandler(h.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(t,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},lo=class{constructor(t){this.parser=t,this.name=nt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let e=this.name,i=this.parser,r=i.json,n=r.textures[t];if(!n.extensions||!n.extensions[e])return null;let a=n.extensions[e],h=r.images[a.source],c=i.textureLoader;if(h.uri){let u=i.options.manager.getHandler(h.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(t,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},uo=class{constructor(t){this.name=nt.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){let r=i.extensions[this.name],n=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(h){let c=r.byteOffset||0,u=r.byteLength||0,p=r.count,d=r.byteStride,y=new Uint8Array(h,c,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(p,d,y,r.mode,r.filter).then(function(x){return x.buffer}):a.ready.then(function(){let x=new ArrayBuffer(p*d);return a.decodeGltfBuffer(new Uint8Array(x),p,d,y,r.mode,r.filter),x})})}else return null}},po=class{constructor(t){this.name=nt.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){let e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;let r=e.meshes[i.mesh];for(let u of r.primitives)if(u.mode!==ne.TRIANGLES&&u.mode!==ne.TRIANGLE_STRIP&&u.mode!==ne.TRIANGLE_FAN&&u.mode!==void 0)return null;let a=i.extensions[this.name].attributes,h=[],c={};for(let u in a)h.push(this.parser.getDependency("accessor",a[u]).then(p=>(c[u]=p,c[u])));return h.length<1?null:(h.push(this.parser.createNodeMesh(t)),Promise.all(h).then(u=>{let p=u.pop(),d=p.isGroup?p.children:[p],y=u[0].count,x=[];for(let M of d){let A=new X,R=new _,T=new _t,P=new _(1,1,1),z=new ji(M.geometry,M.material,y);for(let B=0;B<y;B++)c.TRANSLATION&&R.fromBufferAttribute(c.TRANSLATION,B),c.ROTATION&&T.fromBufferAttribute(c.ROTATION,B),c.SCALE&&P.fromBufferAttribute(c.SCALE,B),z.setMatrixAt(B,A.compose(R,T,P));for(let B in c)B!=="TRANSLATION"&&B!=="ROTATION"&&B!=="SCALE"&&M.geometry.setAttribute(B,c[B]);at.prototype.copy.call(z,M),this.parser.assignFinalMaterial(z),x.push(z)}return p.isGroup?(p.clear(),p.add(...x),p):x[0]}))}},Xa="glTF",Hs=12,Ua={JSON:1313821514,BIN:5130562},fo=class{constructor(t){this.name=nt.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,Hs),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Xa)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-Hs,n=new DataView(t,Hs),a=0;for(;a<r;){let h=n.getUint32(a,!0);a+=4;let c=n.getUint32(a,!0);if(a+=4,c===Ua.JSON){let u=new Uint8Array(t,Hs+a,h);this.content=i.decode(u)}else if(c===Ua.BIN){let u=Hs+a;this.body=t.slice(u,u+h)}a+=h}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},mo=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=nt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let i=this.json,r=this.dracoLoader,n=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,h={},c={},u={};for(let p in a){let d=bo[p]||p.toLowerCase();h[d]=a[p]}for(let p in t.attributes){let d=bo[p]||p.toLowerCase();if(a[p]!==void 0){let y=i.accessors[t.attributes[p]],x=Qi[y.componentType];u[d]=x.name,c[d]=y.normalized===!0}}return e.getDependency("bufferView",n).then(function(p){return new Promise(function(d){r.decodeDracoFile(p,function(y){for(let x in y.attributes){let M=y.attributes[x],A=c[x];A!==void 0&&(M.normalized=A)}d(y)},h,u)})})}},go=class{constructor(){this.name=nt.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},yo=class{constructor(){this.name=nt.KHR_MESH_QUANTIZATION}},Or=class extends Ot{constructor(t,e,i,r){super(t,e,i,r)}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r*3+r;for(let a=0;a!==r;a++)e[a]=i[n+a];return e}interpolate_(t,e,i,r){let n=this.resultBuffer,a=this.sampleValues,h=this.valueSize,c=h*2,u=h*3,p=r-e,d=(i-e)/p,y=d*d,x=y*d,M=t*u,A=M-u,R=-2*x+3*y,T=x-y,P=1-R,z=T-y+d;for(let B=0;B!==h;B++){let F=a[A+B+h],H=a[A+B+c]*p,V=a[M+B+h],W=a[M+B]*p;n[B]=P*F+z*H+R*V+T*W}return n}},gc=new _t,xo=class extends Or{interpolate_(t,e,i,r){let n=super.interpolate_(t,e,i,r);return gc.fromArray(n).normalize().toArray(n),n}},ne={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Qi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ga={9728:ls,9729:us,9984:Yo,9985:Jo,9986:Zo,9987:ps},ja={33071:li,33648:cs,10497:ci},Jn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ri={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},yc={CUBICSPLINE:void 0,LINEAR:ke,STEP:_e},$n={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function xc(m){return m.DefaultMaterial===void 0&&(m.DefaultMaterial=new we({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:hs})),m.DefaultMaterial}function Us(m,t,e){for(let i in e.extensions)m[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function ni(m,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(m.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function bc(m,t,e){let i=!1,r=!1,n=!1;for(let u=0,p=t.length;u<p;u++){let d=t[u];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(n=!0),i&&r&&n)break}if(!i&&!r&&!n)return Promise.resolve(m);let a=[],h=[],c=[];for(let u=0,p=t.length;u<p;u++){let d=t[u];if(i){let y=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):m.attributes.position;a.push(y)}if(r){let y=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):m.attributes.normal;h.push(y)}if(n){let y=d.COLOR_0!==void 0?e.getDependency("accessor",d.COLOR_0):m.attributes.color;c.push(y)}}return Promise.all([Promise.all(a),Promise.all(h),Promise.all(c)]).then(function(u){let p=u[0],d=u[1],y=u[2];return i&&(m.morphAttributes.position=p),r&&(m.morphAttributes.normal=d),n&&(m.morphAttributes.color=y),m.morphTargetsRelative=!0,m})}function wc(m,t){if(m.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)m.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(m.morphTargetInfluences.length===e.length){m.morphTargetDictionary={};for(let i=0,r=e.length;i<r;i++)m.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vc(m){let t=m.extensions&&m.extensions[nt.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Wa(t.attributes):e=m.indices+":"+Wa(m.attributes)+":"+m.mode,e}function Wa(m){let t="",e=Object.keys(m).sort();for(let i=0,r=e.length;i<r;i++)t+=e[i]+":"+m[e[i]]+";";return t}function wo(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Mc(m){return m.search(/\.jpe?g($|\?)/i)>0||m.search(/^data\:image\/jpeg/)===0?"image/jpeg":m.search(/\.webp($|\?)/i)>0||m.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var Ac=new X,vo=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new mc,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,n=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,n=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&n<98?this.textureLoader=new Fs(this.options.manager):this.textureLoader=new Ki(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Yi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){let h={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:i,userData:{}};Us(n,h,r),ni(h,r),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(h)})).then(function(){t(h)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let r=0,n=e.length;r<n;r++){let a=e[r].joints;for(let h=0,c=a.length;h<c;h++)t[a[h]].isBone=!0}for(let r=0,n=t.length;r<n;r++){let a=t[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;let r=i.clone(),n=(a,h)=>{let c=this.associations.get(a);c!=null&&this.associations.set(h,c);for(let[u,p]of a.children.entries())n(p,h.children[u])};return n(i,r),r.name+="_instance_"+t.uses[e]++,r}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){let r=t(e[i]);if(r)return r}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let i=[];for(let r=0;r<e.length;r++){let n=t(e[r]);n&&i.push(n)}return i}getDependency(t,e){let i=t+":"+e,r=this.cache.get(i);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne(function(n){return n.loadNode&&n.loadNode(e)});break;case"mesh":r=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(e)});break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(e)});break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(e)});break;case"texture":r=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(e)});break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(e)});break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)}),!r)throw new Error("Unknown type: "+t);break}this.cache.add(i,r)}return r}getDependencies(t){let e=this.cache.get(t);if(!e){let i=this,r=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(n,a){return i.getDependency(t,a)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[nt.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(n,a){i.load(xi.resolveURL(e.uri,r.path),n,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){let r=e.byteLength||0,n=e.byteOffset||0;return i.slice(n,n+r)})}loadAccessor(t){let e=this,i=this.json,r=this.json.accessors[t];if(r.bufferView===void 0&&r.sparse===void 0){let a=Jn[r.type],h=Qi[r.componentType],c=r.normalized===!0,u=new h(r.count*a);return Promise.resolve(new It(u,a,c))}let n=[];return r.bufferView!==void 0?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),r.sparse!==void 0&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then(function(a){let h=a[0],c=Jn[r.type],u=Qi[r.componentType],p=u.BYTES_PER_ELEMENT,d=p*c,y=r.byteOffset||0,x=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,M=r.normalized===!0,A,R;if(x&&x!==d){let T=Math.floor(y/x),P="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+T+":"+r.count,z=e.cache.get(P);z||(A=new u(h,T*x,r.count*x/p),z=new Vi(A,x/p),e.cache.add(P,z)),R=new Hi(z,c,y%x/p,M)}else h===null?A=new u(r.count*c):A=new u(h,y,r.count*c),R=new It(A,c,M);if(r.sparse!==void 0){let T=Jn.SCALAR,P=Qi[r.sparse.indices.componentType],z=r.sparse.indices.byteOffset||0,B=r.sparse.values.byteOffset||0,F=new P(a[1],z,r.sparse.count*T),H=new u(a[2],B,r.sparse.count*c);h!==null&&(R=new It(R.array.slice(),R.itemSize,R.normalized));for(let V=0,W=F.length;V<W;V++){let dt=F[V];if(R.setX(dt,H[V*c]),c>=2&&R.setY(dt,H[V*c+1]),c>=3&&R.setZ(dt,H[V*c+2]),c>=4&&R.setW(dt,H[V*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return R})}loadTexture(t){let e=this.json,i=this.options,n=e.textures[t].source,a=e.images[n],h=this.textureLoader;if(a.uri){let c=i.manager.getHandler(a.uri);c!==null&&(h=c)}return this.loadTextureImage(t,n,h)}loadTextureImage(t,e,i){let r=this,n=this.json,a=n.textures[t],h=n.images[e],c=(h.uri||h.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];let u=this.loadImageSource(e,i).then(function(p){p.flipY=!1,p.name=a.name||h.name||"",p.name===""&&typeof h.uri=="string"&&h.uri.startsWith("data:image/")===!1&&(p.name=h.uri);let y=(n.samplers||{})[a.sampler]||{};return p.magFilter=Ga[y.magFilter]||us,p.minFilter=Ga[y.minFilter]||ps,p.wrapS=ja[y.wrapS]||ci,p.wrapT=ja[y.wrapT]||ci,r.associations.set(p,{textures:t}),p}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(t,e){let i=this,r=this.json,n=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());let a=r.images[t],h=self.URL||self.webkitURL,c=a.uri||"",u=!1;if(a.bufferView!==void 0)c=i.getDependency("bufferView",a.bufferView).then(function(d){u=!0;let y=new Blob([d],{type:a.mimeType});return c=h.createObjectURL(y),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let p=Promise.resolve(c).then(function(d){return new Promise(function(y,x){let M=y;e.isImageBitmapLoader===!0&&(M=function(A){let R=new Zt(A);R.needsUpdate=!0,y(R)}),e.load(xi.resolveURL(d,n.path),M,void 0,x)})}).then(function(d){return u===!0&&h.revokeObjectURL(c),d.userData.mimeType=a.mimeType||Mc(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[t]=p,p}assignTexture(t,e,i,r){let n=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord!=0&&!(e==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),n.extensions[nt.KHR_TEXTURE_TRANSFORM]){let h=i.extensions!==void 0?i.extensions[nt.KHR_TEXTURE_TRANSFORM]:void 0;if(h){let c=n.associations.get(a);a=n.extensions[nt.KHR_TEXTURE_TRANSFORM].extendTexture(a,h),n.associations.set(a,c)}}return r!==void 0&&(a.encoding=r),t[e]=a,a})}assignFinalMaterial(t){let e=t.geometry,i=t.material,r=e.attributes.tangent===void 0,n=e.attributes.color!==void 0,a=e.attributes.normal===void 0;if(t.isPoints){let h="PointsMaterial:"+i.uuid,c=this.cache.get(h);c||(c=new Fe,et.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(h,c)),i=c}else if(t.isLine){let h="LineBasicMaterial:"+i.uuid,c=this.cache.get(h);c||(c=new pe,et.prototype.copy.call(c,i),c.color.copy(i.color),this.cache.add(h,c)),i=c}if(r||n||a){let h="ClonedMaterial:"+i.uuid+":";r&&(h+="derivative-tangents:"),n&&(h+="vertex-colors:"),a&&(h+="flat-shading:");let c=this.cache.get(h);c||(c=i.clone(),n&&(c.vertexColors=!0),a&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(h,c),this.associations.set(c,this.associations.get(i))),i=c}i.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=i}getMaterialType(){return we}loadMaterial(t){let e=this,i=this.json,r=this.extensions,n=i.materials[t],a,h={},c=n.extensions||{},u=[];if(c[nt.KHR_MATERIALS_UNLIT]){let d=r[nt.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),u.push(d.extendParams(h,n,e))}else{let d=n.pbrMetallicRoughness||{};if(h.color=new U(1,1,1),h.opacity=1,Array.isArray(d.baseColorFactor)){let y=d.baseColorFactor;h.color.fromArray(y),h.opacity=y[3]}d.baseColorTexture!==void 0&&u.push(e.assignTexture(h,"map",d.baseColorTexture,Ei)),h.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,h.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(e.assignTexture(h,"metalnessMap",d.metallicRoughnessTexture)),u.push(e.assignTexture(h,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(y){return y.getMaterialType&&y.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(y){return y.extendMaterialParams&&y.extendMaterialParams(t,h)})))}n.doubleSided===!0&&(h.side=Ai);let p=n.alphaMode||$n.OPAQUE;if(p===$n.BLEND?(h.transparent=!0,h.depthWrite=!1):(h.transparent=!1,p===$n.MASK&&(h.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&a!==Ut&&(u.push(e.assignTexture(h,"normalMap",n.normalTexture)),h.normalScale=new K(1,1),n.normalTexture.scale!==void 0)){let d=n.normalTexture.scale;h.normalScale.set(d,d)}return n.occlusionTexture!==void 0&&a!==Ut&&(u.push(e.assignTexture(h,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(h.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&a!==Ut&&(h.emissive=new U().fromArray(n.emissiveFactor)),n.emissiveTexture!==void 0&&a!==Ut&&u.push(e.assignTexture(h,"emissiveMap",n.emissiveTexture,Ei)),Promise.all(u).then(function(){let d=new a(h);return n.name&&(d.name=n.name),ni(d,n),e.associations.set(d,{materials:t}),n.extensions&&Us(r,d,n),d})}createUniqueName(t){let e=pt.sanitizeNodeName(t||""),i=e;for(let r=1;this.nodeNamesUsed[i];++r)i=e+"_"+r;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){let e=this,i=this.extensions,r=this.primitiveCache;function n(h){return i[nt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(h,e).then(function(c){return qa(c,h,e)})}let a=[];for(let h=0,c=t.length;h<c;h++){let u=t[h],p=vc(u),d=r[p];if(d)a.push(d.promise);else{let y;u.extensions&&u.extensions[nt.KHR_DRACO_MESH_COMPRESSION]?y=n(u):y=qa(new se,u,e),r[p]={primitive:u,promise:y},a.push(y)}}return Promise.all(a)}loadMesh(t){let e=this,i=this.json,r=this.extensions,n=i.meshes[t],a=n.primitives,h=[];for(let c=0,u=a.length;c<u;c++){let p=a[c].material===void 0?xc(this.cache):this.getDependency("material",a[c].material);h.push(p)}return h.push(e.loadGeometries(a)),Promise.all(h).then(function(c){let u=c.slice(0,c.length-1),p=c[c.length-1],d=[];for(let x=0,M=p.length;x<M;x++){let A=p[x],R=a[x],T,P=u[x];if(R.mode===ne.TRIANGLES||R.mode===ne.TRIANGLE_STRIP||R.mode===ne.TRIANGLE_FAN||R.mode===void 0)T=n.isSkinnedMesh===!0?new Ui(A,P):new ue(A,P),T.isSkinnedMesh===!0&&T.normalizeSkinWeights(),R.mode===ne.TRIANGLE_STRIP?T.geometry=Zn(T.geometry,ea):R.mode===ne.TRIANGLE_FAN&&(T.geometry=Zn(T.geometry,ia));else if(R.mode===ne.LINES)T=new Wi(A,P);else if(R.mode===ne.LINE_STRIP)T=new be(A,P);else if(R.mode===ne.LINE_LOOP)T=new qi(A,P);else if(R.mode===ne.POINTS)T=new Xi(A,P);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);Object.keys(T.geometry.morphAttributes).length>0&&wc(T,n),T.name=e.createUniqueName(n.name||"mesh_"+t),ni(T,n),R.extensions&&Us(r,T,R),e.assignFinalMaterial(T),d.push(T)}for(let x=0,M=d.length;x<M;x++)e.associations.set(d[x],{meshes:t,primitives:x});if(d.length===1)return d[0];let y=new ei;e.associations.set(y,{meshes:t});for(let x=0,M=d.length;x<M;x++)y.add(d[x]);return y})}loadCamera(t){let e,i=this.json.cameras[t],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new ye(Dt.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(e=new ti(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),ni(e,i),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],i=[];for(let r=0,n=e.joints.length;r<n;r++)i.push(this._loadNodeShallow(e.joints[r]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){let n=r.pop(),a=r,h=[],c=[];for(let u=0,p=a.length;u<p;u++){let d=a[u];if(d){h.push(d);let y=new X;n!==null&&y.fromArray(n.array,u*16),c.push(y)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[u])}return new Ts(h,c)})}loadAnimation(t){let i=this.json.animations[t],r=[],n=[],a=[],h=[],c=[];for(let u=0,p=i.channels.length;u<p;u++){let d=i.channels[u],y=i.samplers[d.sampler],x=d.target,M=x.node,A=i.parameters!==void 0?i.parameters[y.input]:y.input,R=i.parameters!==void 0?i.parameters[y.output]:y.output;r.push(this.getDependency("node",M)),n.push(this.getDependency("accessor",A)),a.push(this.getDependency("accessor",R)),h.push(y),c.push(x)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(a),Promise.all(h),Promise.all(c)]).then(function(u){let p=u[0],d=u[1],y=u[2],x=u[3],M=u[4],A=[];for(let T=0,P=p.length;T<P;T++){let z=p[T],B=d[T],F=y[T],H=x[T],V=M[T];if(z===void 0)continue;z.updateMatrix();let W;switch(ri[V.path]){case ri.weights:W=ve;break;case ri.rotation:W=re;break;case ri.position:case ri.scale:default:W=Me;break}let dt=z.name?z.name:z.uuid,J=H.interpolation!==void 0?yc[H.interpolation]:ke,Q=[];ri[V.path]===ri.weights?z.traverse(function(ot){ot.morphTargetInfluences&&Q.push(ot.name?ot.name:ot.uuid)}):Q.push(dt);let ct=F.array;if(F.normalized){let ot=wo(ct.constructor),Vt=new Float32Array(ct.length);for(let it=0,gt=ct.length;it<gt;it++)Vt[it]=ct[it]*ot;ct=Vt}for(let ot=0,Vt=Q.length;ot<Vt;ot++){let it=new W(Q[ot]+"."+ri[V.path],B.array,ct,J);H.interpolation==="CUBICSPLINE"&&(it.createInterpolant=function(I){let G=this instanceof re?xo:Or;return new G(this.times,this.values,this.getValueSize()/3,I)},it.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(it)}}let R=i.name?i.name:"animation_"+t;return new Bs(R,void 0,A)})}createNodeMesh(t){let e=this.json,i=this,r=e.nodes[t];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(n){let a=i._getNodeRef(i.meshCache,r.mesh,n);return r.weights!==void 0&&a.traverse(function(h){if(h.isMesh)for(let c=0,u=r.weights.length;c<u;c++)h.morphTargetInfluences[c]=r.weights[c]}),a})}loadNode(t){let e=this.json,i=this,r=e.nodes[t],n=i._loadNodeShallow(t),a=[],h=r.children||[];for(let u=0,p=h.length;u<p;u++)a.push(i.getDependency("node",h[u]));let c=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([n,Promise.all(a),c]).then(function(u){let p=u[0],d=u[1],y=u[2];y!==null&&p.traverse(function(x){x.isSkinnedMesh&&x.bind(y,Ac)});for(let x=0,M=d.length;x<M;x++)p.add(d[x]);return p})}_loadNodeShallow(t){let e=this.json,i=this.extensions,r=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];let n=e.nodes[t],a=n.name?r.createUniqueName(n.name):"",h=[],c=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return c&&h.push(c),n.camera!==void 0&&h.push(r.getDependency("camera",n.camera).then(function(u){return r._getNodeRef(r.cameraCache,n.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){h.push(u)}),this.nodeCache[t]=Promise.all(h).then(function(u){let p;if(n.isBone===!0?p=new ii:u.length>1?p=new ei:u.length===1?p=u[0]:p=new at,p!==u[0])for(let d=0,y=u.length;d<y;d++)p.add(u[d]);if(n.name&&(p.userData.name=n.name,p.name=a),ni(p,n),n.extensions&&Us(i,p,n),n.matrix!==void 0){let d=new X;d.fromArray(n.matrix),p.applyMatrix4(d)}else n.translation!==void 0&&p.position.fromArray(n.translation),n.rotation!==void 0&&p.quaternion.fromArray(n.rotation),n.scale!==void 0&&p.scale.fromArray(n.scale);return r.associations.has(p)||r.associations.set(p,{}),r.associations.get(p).nodes=t,p}),this.nodeCache[t]}loadScene(t){let e=this.extensions,i=this.json.scenes[t],r=this,n=new ei;i.name&&(n.name=r.createUniqueName(i.name)),ni(n,i),i.extensions&&Us(e,n,i);let a=i.nodes||[],h=[];for(let c=0,u=a.length;c<u;c++)h.push(r.getDependency("node",a[c]));return Promise.all(h).then(function(c){for(let p=0,d=c.length;p<d;p++)n.add(c[p]);let u=p=>{let d=new Map;for(let[y,x]of r.associations)(y instanceof et||y instanceof Zt)&&d.set(y,x);return p.traverse(y=>{let x=r.associations.get(y);x!=null&&d.set(y,x)}),d};return r.associations=u(n),n})}};function Tc(m,t,e){let i=t.attributes,r=new Jt;if(i.POSITION!==void 0){let h=e.json.accessors[i.POSITION],c=h.min,u=h.max;if(c!==void 0&&u!==void 0){if(r.set(new _(c[0],c[1],c[2]),new _(u[0],u[1],u[2])),h.normalized){let p=wo(Qi[h.componentType]);r.min.multiplyScalar(p),r.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let n=t.targets;if(n!==void 0){let h=new _,c=new _;for(let u=0,p=n.length;u<p;u++){let d=n[u];if(d.POSITION!==void 0){let y=e.json.accessors[d.POSITION],x=y.min,M=y.max;if(x!==void 0&&M!==void 0){if(c.setX(Math.max(Math.abs(x[0]),Math.abs(M[0]))),c.setY(Math.max(Math.abs(x[1]),Math.abs(M[1]))),c.setZ(Math.max(Math.abs(x[2]),Math.abs(M[2]))),y.normalized){let A=wo(Qi[y.componentType]);c.multiplyScalar(A)}h.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(h)}m.boundingBox=r;let a=new Ht;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,m.boundingSphere=a}function qa(m,t,e){let i=t.attributes,r=[];function n(a,h){return e.getDependency("accessor",a).then(function(c){m.setAttribute(h,c)})}for(let a in i){let h=bo[a]||a.toLowerCase();h in m.attributes||r.push(n(i[a],h))}if(t.indices!==void 0&&!m.index){let a=e.getDependency("accessor",t.indices).then(function(h){m.setIndex(h)});r.push(a)}return ni(m,t),Tc(m,t,e),Promise.all(r).then(function(){return t.targets!==void 0?bc(m,t.targets,e):m})}var Vr=class{parse(t,e,i={}){if(i=Object.assign({version:"1.4.1",author:null,textureDirectory:"",upAxis:"Y_UP",unitName:null,unitMeter:null},i),i.upAxis.match(/^[XYZ]_UP$/)===null)return console.error("ColladaExporter: Invalid upAxis: valid values are X_UP, Y_UP or Z_UP."),null;if(i.unitName!==null&&i.unitMeter===null)return console.error("ColladaExporter: unitMeter needs to be specified if unitName is specified."),null;if(i.unitMeter!==null&&i.unitName===null)return console.error("ColladaExporter: unitName needs to be specified if unitMeter is specified."),null;i.textureDirectory!==""&&(i.textureDirectory=`${i.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));let r=i.version;if(r!=="1.4.1"&&r!=="1.5.0")return console.warn(`ColladaExporter : Version ${r} not supported for export. Only 1.4.1 and 1.5.0.`),null;function n(I){let G=/^<\//,O=/(\?>$)|(\/>$)/,Y=/<[^>]+>[^<]*<\/[^<]+>/,tt=(yt,ht)=>ht>0?yt+tt(yt,ht-1):"",vt=0;return I.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(yt=>{!Y.test(yt)&&!O.test(yt)&&G.test(yt)&&vt--;let ht=`${tt("  ",vt)}${yt}`;return!Y.test(yt)&&!O.test(yt)&&!G.test(yt)&&vt++,ht}).join(`
`)}function a(I){let G=atob(I),O=new Uint8Array(G.length);for(let Y=0,tt=O.length;Y<tt;Y++)O[Y]=G.charCodeAt(Y);return O}let h,c;function u(I,G){h=h||document.createElement("canvas"),c=c||h.getContext("2d"),h.width=I.width,h.height=I.height,c.drawImage(I,0,0);let O=h.toDataURL(`image/${G}`,1).replace(/^data:image\/(png|jpg);base64,/,"");return a(O)}let p=["getX","getY","getZ","getW"],d=new U;function y(I,G=!1){if(G){let O=new Float32Array(I.count*3);for(let Y=0,tt=I.count;Y<tt;Y++)d.fromBufferAttribute(I,Y).convertLinearToSRGB(),O[3*Y+0]=d.r,O[3*Y+1]=d.g,O[3*Y+2]=d.b;return O}else if(I.isInterleavedBufferAttribute){let O=new I.array.constructor(I.count*I.itemSize),Y=I.itemSize;for(let tt=0,vt=I.count;tt<vt;tt++)for(let yt=0;yt<Y;yt++)O[tt*Y+yt]=I[p[yt]](tt);return O}else return I.array}function x(I,G,O){return Array.isArray(I)?I.slice(G,G+O):new I.constructor(I.buffer,G*I.BYTES_PER_ELEMENT,O)}function M(I,G,O,Y,tt=!1){let vt=y(I,tt);return`<source id="${G}"><float_array id="${G}-array" count="${vt.length}">`+vt.join(" ")+`</float_array><technique_common><accessor source="#${G}-array" count="${Math.floor(vt.length/I.itemSize)}" stride="${I.itemSize}">`+O.map(ht=>`<param name="${ht}" type="${Y}" />`).join("")+"</accessor></technique_common></source>"}let A;function R(I){return I.updateMatrix(),A=A||new X,A.copy(I.matrix),A.transpose(),`<matrix>${A.toArray().join(" ")}</matrix>`}function T(I){let G=F.get(I);if(!G){let O=I;if(O.isBufferGeometry!==!0)throw new Error("THREE.ColladaExporter: Geometry is not of type THREE.BufferGeometry.");let Y=`Mesh${J.length+1}`,tt=O.index?O.index.count*O.index.itemSize:O.attributes.position.count,vt=O.groups!=null&&O.groups.length!==0?O.groups:[{start:0,count:tt,materialIndex:0}],yt=I.name?` name="${I.name}"`:"",ht=`<geometry id="${Y}"${yt}><mesh>`,jt=`${Y}-position`,Ae=`${Y}-vertices`;ht+=M(O.attributes.position,jt,["X","Y","Z"],"float"),ht+=`<vertices id="${Ae}"><input semantic="POSITION" source="#${jt}" /></vertices>`;let qt=`<input semantic="VERTEX" source="#${Ae}" offset="0" />`;if("normal"in O.attributes){let xt=`${Y}-normal`;ht+=M(O.attributes.normal,xt,["X","Y","Z"],"float"),qt+=`<input semantic="NORMAL" source="#${xt}" offset="0" />`}if("uv"in O.attributes){let xt=`${Y}-texcoord`;ht+=M(O.attributes.uv,xt,["S","T"],"float"),qt+=`<input semantic="TEXCOORD" source="#${xt}" offset="0" set="0" />`}if("uv2"in O.attributes){let xt=`${Y}-texcoord2`;ht+=M(O.attributes.uv2,xt,["S","T"],"float"),qt+=`<input semantic="TEXCOORD" source="#${xt}" offset="0" set="1" />`}if("color"in O.attributes){let xt=`${Y}-color`;ht+=M(O.attributes.color,xt,["R","G","B"],"float",!0),qt+=`<input semantic="COLOR" source="#${xt}" offset="0" />`}let de=null;if(O.index)de=y(O.index);else{de=new Array(tt);for(let xt=0,bi=de.length;xt<bi;xt++)de[xt]=xt}for(let xt=0,bi=vt.length;xt<bi;xt++){let js=vt[xt],Ws=x(de,js.start,js.count),Zr=Ws.length/3;ht+=`<triangles material="MESH_MATERIAL_${js.materialIndex}" count="${Zr}">`,ht+=qt,ht+=`<p>${Ws.join(" ")}</p>`,ht+="</triangles>"}ht+="</mesh></geometry>",J.push(ht),G={meshid:Y,bufferGeometry:O},F.set(I,G)}return G}function P(I){let G=V.get(I);if(G==null){G=`image-${dt.length+1}`;let O="png",Y=I.name||G,tt=`<image id="${G}" name="${Y}">`;r==="1.5.0"?tt+=`<init_from><ref>${i.textureDirectory}${Y}.${O}</ref></init_from>`:tt+=`<init_from>${i.textureDirectory}${Y}.${O}</init_from>`,tt+="</image>",dt.push(tt),V.set(I,G),W.push({directory:i.textureDirectory,name:Y,ext:O,data:u(I.image,O),original:I})}return G}function z(I){let G=H.get(I);if(G==null){G=`Mat${Q.length+1}`;let O="phong";I.isMeshLambertMaterial===!0?O="lambert":I.isMeshBasicMaterial===!0&&(O="constant",I.map!==null&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));let Y=I.emissive?I.emissive:new U(0,0,0),tt=I.color?I.color:new U(0,0,0),vt=I.specular?I.specular:new U(1,1,1),yt=I.shininess||0,ht=I.reflectivity||0;Y.convertLinearToSRGB(),vt.convertLinearToSRGB(),tt.convertLinearToSRGB();let jt="";I.transparent===!0&&(jt+="<transparent>"+(I.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",I.opacity<1&&(jt+=`<transparency><float>${I.opacity}</float></transparency>`));let Ae=`<technique sid="common"><${O}><emission>`+(I.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${Y.r} ${Y.g} ${Y.b} 1</color>`)+"</emission>"+(O!=="constant"?"<diffuse>"+(I.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${tt.r} ${tt.g} ${tt.b} 1</color>`)+"</diffuse>":"")+(O!=="constant"?"<bump>"+(I.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':"")+"</bump>":"")+(O==="phong"?`<specular><color sid="specular">${vt.r} ${vt.g} ${vt.b} 1</color></specular><shininess>`+(I.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${yt}</float>`)+"</shininess>":"")+`<reflective><color>${tt.r} ${tt.g} ${tt.b} 1</color></reflective><reflectivity><float>${ht}</float></reflectivity>`+jt+`</${O}></technique>`,qt=`<effect id="${G}-effect"><profile_COMMON>`+(I.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${P(I.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:"")+(I.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${P(I.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:"")+(I.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${P(I.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:"")+(I.normalMap?`<newparam sid="bump-surface"><surface type="2D"><init_from>${P(I.normalMap)}</init_from></surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>`:"")+Ae+(I.side===Ai?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",de=I.name?` name="${I.name}"`:"",xt=`<material id="${G}"${de}><instance_effect url="#${G}-effect" /></material>`;ct.push(xt),Q.push(qt),H.set(I,G)}return G}function B(I){let G=`<node name="${I.name}">`;if(G+=R(I),I.isMesh===!0&&I.geometry!==null){let O=T(I.geometry),Y=O.meshid,tt=O.bufferGeometry,vt=null,yt,ht=I.material||new Ut,jt=Array.isArray(ht)?ht:[ht];tt.groups.length>jt.length?yt=new Array(tt.groups.length):yt=new Array(jt.length),vt=yt.fill().map((Ae,qt)=>z(jt[qt%jt.length])),G+=`<instance_geometry url="#${Y}">`+(vt.length>0?"<bind_material><technique_common>"+vt.map((Ae,qt)=>`<instance_material symbol="MESH_MATERIAL_${qt}" target="#${Ae}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return I.children.forEach(O=>G+=B(O)),G+="</node>",G}let F=new WeakMap,H=new WeakMap,V=new WeakMap,W=[],dt=[],J=[],Q=[],ct=[],ot=B(t),it=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${r==="1.4.1"?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${r}"><asset>`+("<contributor><authoring_tool>three.js Collada Exporter</authoring_tool>"+(i.author!==null?`<author>${i.author}</author>`:"")+`</contributor><created>${new Date().toISOString()}</created><modified>${new Date().toISOString()}</modified>`+(i.unitName!==null?`<unit name="${i.unitName}" meter="${i.unitMeter}" />`:"")+`<up_axis>${i.upAxis}</up_axis>`)+"</asset>";it+=`<library_images>${dt.join("")}</library_images>`,it+=`<library_effects>${Q.join("")}</library_effects>`,it+=`<library_materials>${ct.join("")}</library_materials>`,it+=`<library_geometries>${J.join("")}</library_geometries>`,it+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${ot}</visual_scene></library_visual_scenes>`,it+='<scene><instance_visual_scene url="#Scene"/></scene>',it+="</COLLADA>";let gt={data:n(it),textures:W};return typeof e=="function"&&requestAnimationFrame(()=>e(gt)),gt}};var Ya=function(){var m=null,t=null,e,i,r=null,n={},a={},h={},c={},u={},p={},d={},y={},x={},M,A,R,T,P,z,B,F,H=!0,V=THREE.SmoothShading,W={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},dt=1,J="Y",Q=null;function ct(l,f,g,b){r=f;var k=new DOMParser,E=k.parseFromString(l,"application/xml");ot(E,void 0,l)}function ot(l,f,g){if(m=l,f=f||r,g!==void 0){var b=g.split("/");b.pop(),P=(b.length<1?".":b.join("/"))+"/"}it(),mh(),a=gt("library_images image",Jr,"image"),p=gt("library_materials material",_o,"material"),d=gt("library_effects effect",Ue,"effect"),u=gt("library_geometries geometry",To,"geometry"),y=gt("library_cameras camera",rn,"camera"),x=gt("library_lights light",$s,"light"),c=gt("library_controllers controller",Ao,"controller"),h=gt("library_animations animation",sn,"animation"),R=gt("library_visual_scenes visual_scene",Xs,"visual_scene"),T=gt("library_kinematics_models kinematics_model",nn,"kinematics_model"),z=[],B=[],e=I(),t=new THREE.Group;for(var k=0;k<e.nodes.length;k++)t.add(bi(e.nodes[k]));t.scale.multiplyScalar(dt),O(),i=G(),xt();var E={scene:t,morphs:z,skins:B,animations:M,kinematics:A,dae:{images:a,materials:p,cameras:y,lights:x,effects:d,geometries:u,controllers:c,animations:h,visualScenes:R,visualScene:e,scene:e,kinematicsModels:T,kinematicsModel:i}};return f&&f(E),E}function Vt(l){V=l}function it(){var l=m.querySelectorAll("asset"),f=l[0];if(f&&f.childNodes)for(var g=0;g<f.childNodes.length;g++){var b=f.childNodes[g];switch(b.nodeName){case"unit":var k=b.getAttribute("meter");k&&(dt=parseFloat(k));break;case"up_axis":J=b.textContent.charAt(0);break}}}function gt(l,f,g){for(var b=m.querySelectorAll(l),k={},E=0,S=b.length,N=0;N<S;N++){var L=b[N],C=new f().parse(L);(!C.id||C.id.length===0)&&(C.id=g+E++),k[C.id]=C}return k}function I(){var l=m.querySelectorAll("scene instance_visual_scene")[0];if(l){var f=l.getAttribute("url").replace(/^#/,"");return R[f.length>0?f:"visual_scene0"]}else return null}function G(){var l=m.querySelectorAll("instance_kinematics_model")[0];if(l){var f=l.getAttribute("url").replace(/^#/,"");return T[f.length>0?f:"kinematics_model0"]}else return null}function O(){M=[],Y(t)}function Y(l){var f=e.getChildById(l.colladaId,!0),g=null;if(f&&f.keys){g={fps:60,hierarchy:[{node:f,keys:f.keys,sids:f.sids}],node:l,name:"animation_"+l.name,length:0},M.push(g);for(var b=0,k=f.keys.length;b<k;b++)g.length=Math.max(g.length,f.keys[b].time)}else g={hierarchy:[{keys:[],sids:[]}]};for(var b=0,k=l.children.length;b<k;b++)for(var E=Y(l.children[b]),S=0,N=E.hierarchy.length;S<N;S++)g.hierarchy.push({keys:[],sids:[]});return g}function tt(){var l=1e6,f=-l,g=0,b;for(var k in h){var E=h[k];b=b||E.id;for(var S=0;S<E.sampler.length;S++){var N=E.sampler[S];N.create(),l=Math.min(l,N.startTime),f=Math.max(f,N.endTime),g=Math.max(g,N.input.length)}}return{start:l,end:f,frames:g,ID:b}}function vt(l,f){var g=f instanceof Kr?c[f.url]:f;if(!g||!g.morph){console.log("could not find morph controller!");return}for(var b=g.morph,k=0;k<b.targets.length;k++){var E=b.targets[k],S=u[E];if(!(!S.mesh||!S.mesh.primitives||!S.mesh.primitives.length)){var N=S.mesh.primitives[0].geometry;N.vertices.length===l.vertices.length&&l.morphTargets.push({name:"target_1",vertices:N.vertices})}}l.morphTargets.push({name:"target_Z",vertices:l.vertices})}function yt(l,f,g){var b=c[f.url];if(!b||!b.skin){console.log("could not find skin controller!");return}if(!f.skeleton||!f.skeleton.length){console.log("could not find the skeleton for the skin!");return}var k=b.skin,E=e.getChildById(f.skeleton[0]),S=[];g=g!==void 0?g:!0;var N=[];if(l.skinWeights=[],l.skinIndices=[],g)for(var L=0;L<l.vertices.length;L++)l.vertices[L].applyMatrix4(k.bindShapeMatrix)}function ht(l,f,g,b){if(l.world=l.world||new THREE.Matrix4,l.localworld=l.localworld||new THREE.Matrix4,l.world.copy(l.matrix),l.localworld.copy(l.matrix),l.channels&&l.channels.length){var k=l.channels[0],E=k.sampler.output[g];E instanceof THREE.Matrix4&&(l.world.copy(E),l.localworld.copy(E),g===0&&l.matrix.copy(E))}b&&l.world.multiplyMatrices(b,l.world),f.push(l);for(var S=0;S<l.nodes.length;S++)ht(l.nodes[S],f,g,l.world)}function jt(l,f){for(var g=0;g<l.length;g++){var b=l[g],k=-1;if(b.type=="JOINT"){for(var E=0;E<f.joints.length;E++)if(b.sid===f.joints[E]){k=E;break}if(k>=0){var S=f.invBindMatrices[k];b.invBindMatrix=S,b.skinningMatrix=new THREE.Matrix4,b.skinningMatrix.multiplyMatrices(b.world,S),b.animatrix=new THREE.Matrix4,b.animatrix.copy(b.localworld),b.weights=[];for(var E=0;E<f.weights.length;E++)for(var N=0;N<f.weights[E].length;N++){var L=f.weights[E][N];L.joint===k&&b.weights.push(L)}}else console.warn("ColladaLoader: Could not find joint '"+b.sid+"'."),b.skinningMatrix=new THREE.Matrix4,b.weights=[]}}}function Ae(l){var f=[],g=function(b,k,E){var S={};S.name=k.sid,S.parent=b,S.matrix=k.matrix;var N=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];S.matrix.decompose(N[0],N[1],N[2]),S.pos=[N[0].x,N[0].y,N[0].z],S.scl=[N[2].x,N[2].y,N[2].z],S.rotq=[N[1].x,N[1].y,N[1].z,N[1].w],E.push(S);for(var L in k.nodes)g(k.sid,k.nodes[L],E)};return g(-1,l,f),f}function qt(l,f,g){var b=[];ht(f,b,-1),jt(b,g.skin),v=new THREE.Vector3;for(var k=[],E=0;E<l.vertices.length;E++)k.push(new THREE.Vector3);for(E=0;E<b.length;E++)if(b[E].type=="JOINT")for(j=0;j<b[E].weights.length;j++)w=b[E].weights[j],vidx=w.index,weight=w.weight,o=l.vertices[vidx],s=k[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(b[E].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var E=0;E<l.vertices.length;E++)l.vertices[E]=k[E]}function de(l,f,g){var b=c[f.url];if(g=g!==void 0?g:40,!b||!b.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!f.skeleton||!f.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}for(var k=tt(),E=e.getChildById(f.skeleton[0],!0)||e.getChildBySid(f.skeleton[0],!0),S=Ae(E),N=b.skin.joints,L=[],C=0;C<N.length;C++)for(var D=0;D<S.length;D++)S[D].name===N[C]&&(L[C]=S[D]);for(var C=0;C<L.length;C++)for(var D=0;D<L.length;D++)L[C].parent===L[D].name&&(L[C].parent=D);var C,D,q,$,rt,lt=new THREE.Vector3,At,Yt;for(C=0;C<l.vertices.length;C++)l.vertices[C].applyMatrix4(b.skin.bindShapeMatrix);for(var Tt=[],Et=[],Z=b.skin.weights,C=0;C<Z.length;C++){var Mt=new THREE.Vector4(Z[C][0]?Z[C][0].joint:0,Z[C][1]?Z[C][1].joint:0,Z[C][2]?Z[C][2].joint:0,Z[C][3]?Z[C][3].joint:0),rt=new THREE.Vector4(Z[C][0]?Z[C][0].weight:0,Z[C][1]?Z[C][1].weight:0,Z[C][2]?Z[C][2].weight:0,Z[C][3]?Z[C][3].weight:0);Tt.push(Mt),Et.push(rt)}l.skinIndices=Tt,l.skinWeights=Et,l.bones=L;for(var st={name:k.ID,fps:30,length:k.frames/30,hierarchy:[]},D=0;D<L.length;D++)st.hierarchy.push({parent:L[D].parent,name:L[D].name,keys:[]});for(console.log("ColladaLoader:",k.ID+" has "+L.length+" bones."),qt(l,E,b),g=0;g<k.frames;g++){var ft=[],ut=[];ht(E,ft,g),jt(ft,b.skin);for(var C=0;C<ft.length;C++)for(var D=0;D<st.hierarchy.length;D++)if(st.hierarchy[D].name===ft[C].sid){var Rt={};Rt.time=g/30,Rt.matrix=ft[C].animatrix,g===0&&(ft[C].matrix=Rt.matrix);var bt=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];Rt.matrix.decompose(bt[0],bt[1],bt[2]),Rt.pos=[bt[0].x,bt[0].y,bt[0].z],Rt.scl=[bt[2].x,bt[2].y,bt[2].z],Rt.rot=bt[1],st.hierarchy[D].keys.push(Rt)}l.animation=st}}function xt(){if(i&&i.joints.length===0){A=void 0;return}var l={},f=function(D,q){var $=q.getAttribute("id"),rt=e.getChildById($,!0),lt=i.joints[D];t.traverse(function(At){At.colladaId==$&&(l[D]={node:At,transforms:rt.transforms,joint:lt,position:lt.zeroPosition})})};A={joints:i&&i.joints,getJointValue:function(D){var q=l[D];if(q)return q.position;console.log("getJointValue: joint "+D+" doesn't exist")},setJointValue:function(D,q){var $=l[D];if($){var rt=$.joint;if(q>rt.limits.max||q<rt.limits.min)console.log("setJointValue: joint "+D+" value "+q+" outside of limits (min: "+rt.limits.min+", max: "+rt.limits.max+")");else if(rt.static)console.log("setJointValue: joint "+D+" is static");else{var lt=$.node,At=rt.axis,Yt=$.transforms,Tt=new THREE.Matrix4;for(b=0;b<Yt.length;b++){var Et=Yt[b];if(Et.sid&&Et.sid.indexOf("joint"+D)!==-1)switch(rt.type){case"revolute":Tt.multiply(Z.makeRotationAxis(At,THREE.Math.degToRad(q)));break;case"prismatic":Tt.multiply(Z.makeTranslation(At.x*q,At.y*q,At.z*q));break;default:console.warn("setJointValue: unknown joint type: "+rt.type);break}else{var Z=new THREE.Matrix4;switch(Et.type){case"matrix":Tt.multiply(Et.obj);break;case"translate":Tt.multiply(Z.makeTranslation(Et.obj.x,Et.obj.y,Et.obj.z));break;case"rotate":Tt.multiply(Z.makeRotationAxis(Et.obj,Et.angle));break}}}var Mt=Tt.elements,st=Array.prototype.slice.call(Mt),ft=[st[0],st[4],st[8],st[12],st[1],st[5],st[9],st[13],st[2],st[6],st[10],st[14],st[3],st[7],st[11],st[15]];lt.matrix.set.apply(lt.matrix,ft),lt.matrix.decompose(lt.position,lt.quaternion,lt.scale)}}else console.log("setJointValue: joint "+D+" doesn't exist")}};var g=m.querySelector("scene instance_kinematics_scene");if(g)for(var b=0;b<g.childNodes.length;b++){var k=g.childNodes[b];if(k.nodeType==1)switch(k.nodeName){case"bind_joint_axis":var E=k.getAttribute("target").split("/").pop(),S=k.querySelector("axis param").textContent,N=parseInt(S.split("joint").pop().split(".")[0]),L=m.querySelector('[sid="'+E+'"]');if(L){var C=L.parentElement;f(N,C)}break;default:break}}}function bi(l,f){var g=new THREE.Object3D,b=!1,k,E,S,N;for(S=0;S<l.controllers.length;S++){var L=c[l.controllers[S].url];switch(L.type){case"skin":if(u[L.skin.source]){var C=new is;C.url=L.skin.source,C.instance_material=l.controllers[S].instance_material,l.geometries.push(C),b=!0,k=l.controllers[S]}else if(c[L.skin.source]){var D=c[L.skin.source];if(E=D,D.morph&&u[D.morph.source]){var C=new is;C.url=D.morph.source,C.instance_material=l.controllers[S].instance_material,l.geometries.push(C)}}break;case"morph":if(u[L.morph.source]){var C=new is;C.url=L.morph.source,C.instance_material=l.controllers[S].instance_material,l.geometries.push(C),E=l.controllers[S]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var q={};for(S=0;S<l.geometries.length;S++){var $=l.geometries[S],rt=$.instance_material,lt=u[$.url],At={},Yt=[],Tt=0,Et;if(lt){if(!lt.mesh||!lt.mesh.primitives)continue;if(g.name.length===0&&(g.name=lt.id),rt)for(N=0;N<rt.length;N++){var Z=rt[N],Mt=p[Z.target],st=Mt.instance_effect.url,ft=d[st].shader,ut=ft.material;if(lt.doubleSided){if(!(Z.symbol in q)){var Rt=ut.clone();Rt.side=THREE.DoubleSide,q[Z.symbol]=Rt}ut=q[Z.symbol]}ut.opacity=ut.opacity?ut.opacity:1,At[Z.symbol]=Tt,Yt.push(ut),Et=ut,Et.name=Mt.name===null||Mt.name===""?Mt.id:Mt.name,Tt++}var bt,Ft=Et||new THREE.MeshLambertMaterial({color:14540253,side:lt.doubleSided?THREE.DoubleSide:THREE.FrontSide}),wt=lt.mesh.geometry3js;if(Tt>1)for(Ft=new THREE.MeshFaceMaterial(Yt),N=0;N<wt.faces.length;N++){var Ge=wt.faces[N];Ge.materialIndex=At[Ge.daeMaterial]}k!==void 0?(de(wt,k),wt.morphTargets.length>0?(Ft.morphTargets=!0,Ft.skinning=!1):(Ft.morphTargets=!1,Ft.skinning=!0),bt=new THREE.SkinnedMesh(wt,Ft,!1),bt.name="skin_"+B.length,B.push(bt)):E!==void 0?(vt(wt,E),Ft.morphTargets=!0,bt=new THREE.Mesh(wt,Ft),bt.name="morph_"+z.length,z.push(bt)):wt.isLineStrip===!0?bt=new THREE.Line(wt):bt=new THREE.Mesh(wt,Ft),g.add(bt)}}for(S=0;S<l.cameras.length;S++){var hn=l.cameras[S],os=y[hn.url],Do=new THREE.PerspectiveCamera(os.yfov,parseFloat(os.aspect_ratio),parseFloat(os.znear),parseFloat(os.zfar));g.add(Do)}for(S=0;S<l.lights.length;S++){var Se=null,Oo=l.lights[S],je=x[Oo.url];if(je&&je.technique){var as=je.color.getHex(),cn=je.intensity,ln=je.distance,xh=je.falloff_angle,bh;switch(je.technique){case"directional":Se=new THREE.DirectionalLight(as,cn,ln),Se.position.set(0,0,1);break;case"point":Se=new THREE.PointLight(as,cn,ln);break;case"spot":Se=new THREE.SpotLight(as,cn,ln,xh,bh),Se.position.set(0,0,1);break;case"ambient":Se=new THREE.AmbientLight(as);break}}Se&&g.add(Se)}if(g.name=l.name||l.id||"",g.colladaId=l.id||"",g.layer=l.layer||"",g.matrix=l.matrix,g.matrix.decompose(g.position,g.quaternion,g.scale),W.centerGeometry&&g.geometry){var un=g.geometry.center();un.multiply(g.scale),un.applyQuaternion(g.quaternion),g.position.sub(un)}for(S=0;S<l.nodes.length;S++)g.add(bi(l.nodes[S],l));return g}function js(l,f){for(var g=0;g<l.joints.length;g++)if(l.joints[g]===f)return g}function Ws(l){for(var f=m.querySelectorAll("library_nodes node"),g=0;g<f.length;g++){var b=f[g].attributes.getNamedItem("id");if(b&&b.value===l)return f[g]}}function Zr(l){var f=[],g=1e6,b=-1e6;for(var k in h)for(var E=h[k],S=0;S<E.channel.length;S++){var N=E.channel[S],L=E.sampler[S],k=N.target.split("/")[0];k==l.id&&(L.create(),N.sampler=L,g=Math.min(g,L.startTime),b=Math.max(b,L.endTime),f.push(N))}return f.length&&(l.startTime=g,l.endTime=b),f}function _c(l){for(var f=1e7,g=0;g<l.channels.length;g++)for(var b=l.channels[g].sampler,k=0;k<b.input.length-1;k++){var E=b.input[k],S=b.input[k+1];f=Math.min(f,S-E)}return f}function kc(l,f){var g={},b,k;for(b=0;b<l.channels.length;b++){var E=l.channels[b];g[E.sid]=E}var S=new THREE.Matrix4;for(b=0;b<l.transforms.length;b++){var N=l.transforms[b],E=g[N.sid];if(E!==void 0){var L=E.sampler,C;for(k=0;k<L.input.length-1;k++)if(L.input[k+1]>f){C=L.output[k];break}C!==void 0&&C instanceof THREE.Matrix4?S.multiplyMatrices(S,C):S.multiplyMatrices(S,N.matrix)}else S.multiplyMatrices(S,N.matrix)}return S}function nh(l){if(l.channels&&l.channels.length){for(var f=[],g=[],b=0,k=l.channels.length;b<k;b++){var E=l.channels[b],S=E.fullSid,N=E.sampler,L=N.input,C=l.getTransformBySid(E.sid),D;if(E.arrIndices){D=[];for(var q=0,$=E.arrIndices.length;q<$;q++)D[q]=yh(E.arrIndices[q])}else D=Lo(E.member);if(C){g.indexOf(S)===-1&&g.push(S);for(var q=0,$=L.length;q<$;q++){var rt=L[q],lt=N.getData(C.type,q,D),At=oh(f,rt);if(!At){At=new vi(rt);var Yt=ah(f,rt);f.splice(Yt===-1?f.length:Yt,0,At)}At.addTarget(S,C,D,lt)}}else console.log('Could not find transform "'+E.sid+'" in node '+l.id)}for(var b=0;b<g.length;b++)for(var Tt=g[b],q=0;q<f.length;q++){var At=f[q];At.hasTarget(Tt)||hh(f,At,q,Tt)}l.keys=f,l.sids=g}}function oh(l,f){for(var g=null,b=0,k=l.length;b<k&&g===null;b++){var E=l[b];if(E.time===f)g=E;else if(E.time>f)break}return g}function ah(l,f){for(var g=-1,b=0,k=l.length;b<k&&g===-1;b++){var E=l[b];E.time>=f&&(g=b)}return g}function hh(l,f,g,b){var k=lh(l,b,g?g-1:0),E=ch(l,b,g+1);if(k&&E){var S=(f.time-k.time)/(E.time-k.time),N=k.getTarget(b),L=E.getTarget(b).data,C=N.data,D;if(N.type==="matrix")D=C;else if(C.length){D=[];for(var q=0;q<C.length;++q)D[q]=C[q]+(L[q]-C[q])*S}else D=C+(L-C)*S;f.addTarget(b,N.transform,N.member,D)}}function ch(l,f,g){for(;g<l.length;g++){var b=l[g];if(b.hasTarget(f))return b}return null}function lh(l,f,g){for(g=g>=0?g:g+l.length;g>=0;g--){var b=l[g];if(b.hasTarget(f))return b}return null}function Jr(){this.id="",this.init_from=""}Jr.prototype.parse=function(l){this.id=l.getAttribute("id");for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];g.nodeName==="init_from"&&(this.init_from=g.textContent)}return this};function Ao(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}Ao.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name"),this.type="none";for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"skin":this.skin=new qs().parse(g),this.type=g.nodeName;break;case"morph":this.morph=new $r().parse(g),this.type=g.nodeName;break;default:break}}return this};function $r(){this.method=null,this.source=null,this.targets=null,this.weights=null}$r.prototype.parse=function(l){var f={},g=[],b;for(this.method=l.getAttribute("method"),this.source=l.getAttribute("source").replace(/^#/,""),b=0;b<l.childNodes.length;b++){var k=l.childNodes[b];if(k.nodeType==1)switch(k.nodeName){case"source":var E=new wi().parse(k);f[E.id]=E;break;case"targets":g=this.parseInputs(k);break;default:console.log(k.nodeName);break}}for(b=0;b<g.length;b++){var S=g[b],E=f[S.source];switch(S.semantic){case"MORPH_TARGET":this.targets=E.read();break;case"MORPH_WEIGHT":this.weights=E.read();break;default:break}}return this},$r.prototype.parseInputs=function(l){for(var f=[],g=0;g<l.childNodes.length;g++){var b=l.childNodes[g];if(b.nodeType==1)switch(b.nodeName){case"input":f.push(new hi().parse(b));break;default:break}}return f};function qs(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}qs.prototype.parse=function(l){var f={},g,b;this.source=l.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var k=0;k<l.childNodes.length;k++){var E=l.childNodes[k];if(E.nodeType==1)switch(E.nodeName){case"bind_shape_matrix":var S=Mi(E.textContent);this.bindShapeMatrix=an(S);break;case"source":var N=new wi().parse(E);f[N.id]=N;break;case"joints":g=E;break;case"vertex_weights":b=E;break;default:console.log(E.nodeName);break}}return this.parseJoints(g,f),this.parseWeights(b,f),this},qs.prototype.parseJoints=function(l,f){for(var g=0;g<l.childNodes.length;g++){var b=l.childNodes[g];if(b.nodeType==1)switch(b.nodeName){case"input":var k=new hi().parse(b),E=f[k.source];k.semantic==="JOINT"?this.joints=E.read():k.semantic==="INV_BIND_MATRIX"&&(this.invBindMatrices=E.read());break;default:break}}},qs.prototype.parseWeights=function(l,f){for(var g,b,k=[],E=0;E<l.childNodes.length;E++){var S=l.childNodes[E];if(S.nodeType==1)switch(S.nodeName){case"input":k.push(new hi().parse(S));break;case"v":g=rs(S.textContent);break;case"vcount":b=rs(S.textContent);break;default:break}}for(var N=0,E=0;E<b.length;E++){for(var L=b[E],C=[],D=0;D<L;D++){for(var q={},$=0;$<k.length;$++){var rt=k[$],lt=g[N+rt.offset];switch(rt.semantic){case"JOINT":q.joint=lt;break;case"WEIGHT":q.weight=f[rt.source].data[lt];break;default:break}}C.push(q),N+=k.length}for(var D=0;D<C.length;D++)C[D].index=E;this.weights.push(C)}};function Xs(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}Xs.prototype.getChildById=function(l,f){for(var g=0;g<this.nodes.length;g++){var b=this.nodes[g].getChildById(l,f);if(b)return b}return null},Xs.prototype.getChildBySid=function(l,f){for(var g=0;g<this.nodes.length;g++){var b=this.nodes[g].getChildBySid(l,f);if(b)return b}return null},Xs.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name"),this.nodes=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"node":this.nodes.push(new Te().parse(g));break;default:break}}return this};function Te(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}Te.prototype.getChannelForTransform=function(l){for(var f=0;f<this.channels.length;f++){var g=this.channels[f],b=g.target.split("/"),k=b.shift(),E=b.shift(),S=E.indexOf(".")>=0,N=E.indexOf("(")>=0,L,C;if(S)b=E.split("."),E=b.shift(),C=b.shift();else if(N){L=E.split("("),E=L.shift();for(var D=0;D<L.length;D++)L[D]=parseInt(L[D].replace(/\)/,""))}if(E===l)return g.info={sid:E,dotSyntax:S,arrSyntax:N,arrIndices:L},g}return null},Te.prototype.getChildById=function(l,f){if(this.id===l)return this;if(f)for(var g=0;g<this.nodes.length;g++){var b=this.nodes[g].getChildById(l,f);if(b)return b}return null},Te.prototype.getChildBySid=function(l,f){if(this.sid===l)return this;if(f)for(var g=0;g<this.nodes.length;g++){var b=this.nodes[g].getChildBySid(l,f);if(b)return b}return null},Te.prototype.getTransformBySid=function(l){for(var f=0;f<this.transforms.length;f++)if(this.transforms[f].sid===l)return this.transforms[f];return null},Te.prototype.parse=function(l){var f;this.id=l.getAttribute("id"),this.sid=l.getAttribute("sid"),this.name=l.getAttribute("name"),this.type=l.getAttribute("type"),this.layer=l.getAttribute("layer"),this.type=this.type==="JOINT"?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var g=0;g<l.childNodes.length;g++){var b=l.childNodes[g];if(b.nodeType==1)switch(b.nodeName){case"node":this.nodes.push(new Te().parse(b));break;case"instance_camera":this.cameras.push(new Io().parse(b));break;case"instance_controller":this.controllers.push(new Kr().parse(b));break;case"instance_geometry":this.geometries.push(new is().parse(b));break;case"instance_light":this.lights.push(new zo().parse(b));break;case"instance_node":f=b.getAttribute("url").replace(/^#/,"");var k=Ws(f);k&&this.nodes.push(new Te().parse(k));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push(new ai().parse(b));break;case"extra":break;default:console.log(b.nodeName);break}}return this.channels=Zr(this),nh(this),this.updateMatrix(),this},Te.prototype.updateMatrix=function(){this.matrix.identity();for(var l=0;l<this.transforms.length;l++)this.transforms[l].apply(this.matrix)};function ai(){this.sid="",this.type="",this.data=[],this.obj=null}ai.prototype.parse=function(l){return this.sid=l.getAttribute("sid"),this.type=l.nodeName,this.data=Mi(l.textContent),this.convert(),this},ai.prototype.convert=function(){switch(this.type){case"matrix":this.obj=an(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":Xt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Xt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}},ai.prototype.apply=function(){var l=new THREE.Matrix4;return function(f){switch(this.type){case"matrix":f.multiply(this.obj);break;case"translate":f.multiply(l.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":f.multiply(l.makeRotationAxis(this.obj,this.angle));break;case"scale":f.scale(this.obj);break}}}(),ai.prototype.update=function(l,f){var g=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!f)this.obj.copy(l);else if(f.length===1)switch(f[0]){case 0:this.obj.n11=l[0],this.obj.n21=l[1],this.obj.n31=l[2],this.obj.n41=l[3];break;case 1:this.obj.n12=l[0],this.obj.n22=l[1],this.obj.n32=l[2],this.obj.n42=l[3];break;case 2:this.obj.n13=l[0],this.obj.n23=l[1],this.obj.n33=l[2],this.obj.n43=l[3];break;case 3:this.obj.n14=l[0],this.obj.n24=l[1],this.obj.n34=l[2],this.obj.n44=l[3];break}else if(f.length===2){var b="n"+(f[0]+1)+(f[1]+1);this.obj[b]=l}else console.log("Incorrect addressing of matrix in transform.");break;case"translate":case"scale":switch(Object.prototype.toString.call(f)==="[object Array]"&&(f=g[f[0]]),f){case"X":this.obj.x=l;break;case"Y":this.obj.y=l;break;case"Z":this.obj.z=l;break;default:this.obj.x=l[0],this.obj.y=l[1],this.obj.z=l[2];break}break;case"rotate":switch(Object.prototype.toString.call(f)==="[object Array]"&&(f=g[f[0]]),f){case"X":this.obj.x=l;break;case"Y":this.obj.y=l;break;case"Z":this.obj.z=l;break;case"ANGLE":this.angle=THREE.Math.degToRad(l);break;default:this.obj.x=l[0],this.obj.y=l[1],this.obj.z=l[2],this.angle=THREE.Math.degToRad(l[3]);break}break}};function Kr(){this.url="",this.skeleton=[],this.instance_material=[]}Kr.prototype.parse=function(l){this.url=l.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType===1)switch(g.nodeName){case"skeleton":this.skeleton.push(g.textContent.replace(/^#/,""));break;case"bind_material":for(var b=g.querySelectorAll("instance_material"),k=0;k<b.length;k++){var E=b[k];this.instance_material.push(new Qr().parse(E))}break;case"extra":break;default:break}}return this};function Qr(){this.symbol="",this.target=""}Qr.prototype.parse=function(l){return this.symbol=l.getAttribute("symbol"),this.target=l.getAttribute("target").replace(/^#/,""),this};function is(){this.url="",this.instance_material=[]}is.prototype.parse=function(l){this.url=l.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1&&g.nodeName==="bind_material"){for(var b=g.querySelectorAll("instance_material"),k=0;k<b.length;k++){var E=b[k];this.instance_material.push(new Qr().parse(E))}break}}return this};function To(){this.id="",this.mesh=null}To.prototype.parse=function(l){this.id=l.getAttribute("id"),Fo(this,l);for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"mesh":this.mesh=new tn(this).parse(g);break;case"extra":break;default:break}}return this};function tn(l){this.geometry=l.id,this.primitives=[],this.vertices=null,this.geometry3js=null}tn.prototype.parse=function(l){this.primitives=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"source":uh(g);break;case"vertices":this.vertices=new So().parse(g);break;case"linestrips":this.primitives.push(new ss().parse(g));break;case"triangles":this.primitives.push(new Zs().parse(g));break;case"polygons":this.primitives.push(new Ee().parse(g));break;case"polylist":this.primitives.push(new Ys().parse(g));break;default:break}}if(this.geometry3js=new THREE.Geometry,this.vertices===null)return this;for(var b=n[this.vertices.input.POSITION.source].data,f=0;f<b.length;f+=3)this.geometry3js.vertices.push(Qs(b,f).clone());for(var f=0;f<this.primitives.length;f++){var k=this.primitives[f];k.setVertices(this.vertices),this.handlePrimitive(k,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},tn.prototype.handlePrimitive=function(l,f){if(l instanceof ss){f.isLineStrip=!0;return}var g,b,k=l.p,E=l.inputs,S,N,L,C,D,q=0,$=3,rt=0,lt=[];for(g=0;g<E.length;g++){S=E[g];var At=S.offset+1;switch(rt=rt<At?At:rt,S.semantic){case"TEXCOORD":lt.push(S.set);break}}for(var Yt=0;Yt<k.length;++Yt)for(var Tt=k[Yt],Et=0;Et<Tt.length;){var Z=[],Mt=[],st=null,ft=[];for(l.vcount?$=l.vcount.length?l.vcount[q++]:l.vcount:$=Tt.length/rt,g=0;g<$;g++)for(b=0;b<E.length;b++)switch(S=E[b],C=n[S.source],N=Tt[Et+g*rt+S.offset],D=C.accessor.params.length,L=N*D,S.semantic){case"VERTEX":Z.push(N);break;case"NORMAL":Mt.push(Qs(C.data,L));break;case"TEXCOORD":st=st||{},st[S.set]===void 0&&(st[S.set]=[]),st[S.set].push(new THREE.Vector2(C.data[L],C.data[L+1]));break;case"COLOR":ft.push(new THREE.Color().setRGB(C.data[L],C.data[L+1],C.data[L+2]));break;default:break}if(Mt.length===0)if(S=this.vertices.input.NORMAL,S){C=n[S.source],D=C.accessor.params.length;for(var ut=0,Rt=Z.length;ut<Rt;ut++)Mt.push(Qs(C.data,Z[ut]*D))}else f.calcNormals=!0;if(!st&&(st={},S=this.vertices.input.TEXCOORD,S)){lt.push(S.set),C=n[S.source],D=C.accessor.params.length;for(var ut=0,Rt=Z.length;ut<Rt;ut++)L=Z[ut]*D,st[S.set]===void 0&&(st[S.set]=[]),st[S.set].push(new THREE.Vector2(C.data[L],1-C.data[L+1]))}if(ft.length===0&&(S=this.vertices.input.COLOR,S)){C=n[S.source],D=C.accessor.params.length;for(var ut=0,Rt=Z.length;ut<Rt;ut++)L=Z[ut]*D,ft.push(new THREE.Color().setRGB(C.data[L],C.data[L+1],C.data[L+2]))}var bt=null,Ft=[],wt,Ge;if($===3)Ft.push(new THREE.Face3(Z[0],Z[1],Z[2],Mt,ft.length?ft:new THREE.Color));else if($===4)Ft.push(new THREE.Face3(Z[0],Z[1],Z[3],[Mt[0].clone(),Mt[1].clone(),Mt[3].clone()],ft.length?[ft[0],ft[1],ft[3]]:new THREE.Color)),Ft.push(new THREE.Face3(Z[1],Z[2],Z[3],[Mt[1].clone(),Mt[2].clone(),Mt[3].clone()],ft.length?[ft[1],ft[2],ft[3]]:new THREE.Color));else if($>4&&W.subdivideFaces){var hn=ft.length?ft:new THREE.Color,os,Do,Se,Oo,je,as;for(b=1;b<$-1;)Ft.push(new THREE.Face3(Z[0],Z[b],Z[b+1],[Mt[0].clone(),Mt[b++].clone(),Mt[b].clone()],hn))}if(Ft.length)for(var ut=0,Rt=Ft.length;ut<Rt;ut++)for(bt=Ft[ut],bt.daeMaterial=l.material,f.faces.push(bt),b=0;b<lt.length;b++)wt=st[lt[b]],$>4?Ge=[wt[0],wt[ut+1],wt[ut+2]]:$===4?ut===0?Ge=[wt[0],wt[1],wt[3]]:Ge=[wt[1].clone(),wt[2],wt[3].clone()]:Ge=[wt[0],wt[1],wt[2]],f.faceVertexUvs[b]===void 0&&(f.faceVertexUvs[b]=[]),f.faceVertexUvs[b].push(Ge);else console.log("dropped face with vcount "+$+" for geometry with id: "+f.id);Et+=rt*$}};function Ee(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}Ee.prototype.setVertices=function(l){for(var f=0;f<this.inputs.length;f++)this.inputs[f].source===l.id&&(this.inputs[f].source=l.input.POSITION.source)},Ee.prototype.parse=function(l){this.material=l.getAttribute("material"),this.count=ns(l,"count",0);for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"input":this.inputs.push(new hi().parse(l.childNodes[f]));break;case"vcount":this.vcount=rs(g.textContent);break;case"p":this.p.push(rs(g.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function Ys(){Ee.call(this),this.vcount=[]}Ys.prototype=Object.create(Ee.prototype),Ys.prototype.constructor=Ys;function ss(){Ee.call(this),this.vcount=1}ss.prototype=Object.create(Ee.prototype),ss.prototype.constructor=ss;function Zs(){Ee.call(this),this.vcount=3}Zs.prototype=Object.create(Ee.prototype),Zs.prototype.constructor=Zs;function Eo(){this.source="",this.count=0,this.stride=0,this.params=[]}Eo.prototype.parse=function(l){this.params=[],this.source=l.getAttribute("source"),this.count=ns(l,"count",0),this.stride=ns(l,"stride",0);for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeName==="param"){var b={};b.name=g.getAttribute("name"),b.type=g.getAttribute("type"),this.params.push(b)}}return this};function So(){this.input={}}So.prototype.parse=function(l){this.id=l.getAttribute("id");for(var f=0;f<l.childNodes.length;f++)if(l.childNodes[f].nodeName==="input"){var g=new hi().parse(l.childNodes[f]);this.input[g.semantic]=g}return this};function hi(){this.semantic="",this.offset=0,this.source="",this.set=0}hi.prototype.parse=function(l){return this.semantic=l.getAttribute("semantic"),this.source=l.getAttribute("source").replace(/^#/,""),this.set=ns(l,"set",-1),this.offset=ns(l,"offset",0),this.semantic==="TEXCOORD"&&this.set<0&&(this.set=0),this};function wi(l){this.id=l,this.type=null}wi.prototype.parse=function(l){this.id=l.getAttribute("id");for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"bool_array":this.data=ph(g.textContent),this.type=g.nodeName;break;case"float_array":this.data=Mi(g.textContent),this.type=g.nodeName;break;case"int_array":this.data=rs(g.textContent),this.type=g.nodeName;break;case"IDREF_array":case"Name_array":this.data=Ks(g.textContent),this.type=g.nodeName;break;case"technique_common":for(var b=0;b<g.childNodes.length;b++)if(g.childNodes[b].nodeName==="accessor"){this.accessor=new Eo().parse(g.childNodes[b]);break}break;default:break}}return this},wi.prototype.read=function(){var l=[],f=this.accessor.params[0];switch(f.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var g=0;g<this.data.length;g+=16){var b=this.data.slice(g,g+16),k=an(b);l.push(k)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+f.type+".");break}return l};function _o(){this.id="",this.name="",this.instance_effect=null}_o.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name");for(var f=0;f<l.childNodes.length;f++)if(l.childNodes[f].nodeName==="instance_effect"){this.instance_effect=new Co().parse(l.childNodes[f]);break}return this};function fe(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}fe.prototype.isColor=function(){return this.texture===null},fe.prototype.isTexture=function(){return this.texture!=null},fe.prototype.parse=function(l){l.nodeName==="transparent"&&(this.opaque=l.getAttribute("opaque"));for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"color":var b=Mi(g.textContent);this.color=new THREE.Color,this.color.setRGB(b[0],b[1],b[2]),this.color.a=b[3];break;case"texture":this.texture=g.getAttribute("texture"),this.texcoord=g.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(g);break;default:break}}return this},fe.prototype.parseTexture=function(l){if(!l.childNodes)return this;l.childNodes[1]&&l.childNodes[1].nodeName==="extra"&&(l=l.childNodes[1],l.childNodes[1]&&l.childNodes[1].nodeName==="technique"&&(l=l.childNodes[1]));for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[g.nodeName]=parseFloat(g.textContent);break;case"wrapU":case"wrapV":g.textContent.toUpperCase()==="TRUE"?this.texOpts[g.nodeName]=1:this.texOpts[g.nodeName]=parseInt(g.textContent);break;default:this.texOpts[g.nodeName]=g.textContent;break}}return this};function en(l,f){this.type=l,this.effect=f,this.material=null}en.prototype.parse=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[g.nodeName]=new fe().parse(g);break;case"bump":var b=g.getAttribute("bumptype");b?b.toLowerCase()==="heightfield"?this.bump=new fe().parse(g):b.toLowerCase()==="normalmap"?this.normal=new fe().parse(g):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+b+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=new fe().parse(g)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=new fe().parse(g));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var k=g.querySelectorAll("float");k.length>0&&(this[g.nodeName]=parseFloat(k[0].textContent));break;default:break}}return this.create(),this},en.prototype.create=function(){var l={},f=!1;if(this.transparency!==void 0&&this.transparent!==void 0){var g=this.transparent,b=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;b>0&&(f=!0,l.transparent=!0,l.opacity=1-b)}var k={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var E in this)switch(E){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var S=this[E];if(S instanceof fe)if(S.isTexture()){var N=S.texture,L=this.effect.sampler[N];if(L!==void 0&&L.source!==void 0){var C=this.effect.surface[L.source];if(C!==void 0){var D=a[C.init_from];if(D){var q=P+D.init_from,$,rt=THREE.Loader.Handlers.get(q);rt!==null?$=rt.load(q):($=new THREE.Texture,fh($,q)),$.wrapS=S.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,$.wrapT=S.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,$.offset.x=S.texOpts.offsetU,$.offset.y=S.texOpts.offsetV,$.repeat.x=S.texOpts.repeatU,$.repeat.y=S.texOpts.repeatV,l[k[E]]=$,E==="emission"&&(l.emissive=16777215)}}}}else(E==="diffuse"||!f)&&(E==="emission"?l.emissive=S.color.getHex():l[E]=S.color.getHex());break;case"shininess":l[E]=this[E];break;case"reflectivity":l[E]=this[E],l[E]>0&&(l.envMap=W.defaultEnvMap),l.combine=THREE.MixOperation;break;case"index_of_refraction":l.refractionRatio=this[E],this[E]!==1&&(l.envMap=W.defaultEnvMap);break;case"transparency":break;default:break}switch(l.shading=V,l.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":l.emissive!=null&&(l.color=l.emissive),this.material=new THREE.MeshBasicMaterial(l);break;case"phong":case"blinn":l.diffuse!=null&&(l.color=l.diffuse),this.material=new THREE.MeshPhongMaterial(l);break;case"lambert":default:l.diffuse!=null&&(l.color=l.diffuse),this.material=new THREE.MeshLambertMaterial(l);break}return this.material};function ko(l){this.effect=l,this.init_from=null,this.format=null}ko.prototype.parse=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"init_from":this.init_from=g.textContent;break;case"format":this.format=g.textContent;break;default:console.log("unhandled Surface prop: "+g.nodeName);break}}return this};function Ro(l){this.effect=l,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}Ro.prototype.parse=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"source":this.source=g.textContent;break;case"minfilter":this.minfilter=g.textContent;break;case"magfilter":this.magfilter=g.textContent;break;case"mipfilter":this.mipfilter=g.textContent;break;case"wrap_s":this.wrap_s=g.textContent;break;case"wrap_t":this.wrap_t=g.textContent;break;default:console.log("unhandled Sampler2D prop: "+g.nodeName);break}}return this};function Ue(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}Ue.prototype.create=function(){if(this.shader===null)return null},Ue.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name"),Fo(this,l),this.shader=null;for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(g));break;default:break}}return this},Ue.prototype.parseNewparam=function(l){for(var f=l.getAttribute("sid"),g=0;g<l.childNodes.length;g++){var b=l.childNodes[g];if(b.nodeType==1)switch(b.nodeName){case"surface":this.surface[f]=new ko(this).parse(b);break;case"sampler2D":this.sampler[f]=new Ro(this).parse(b);break;case"extra":break;default:console.log(b.nodeName);break}}},Ue.prototype.parseProfileCOMMON=function(l){for(var f,g=0;g<l.childNodes.length;g++){var b=l.childNodes[g];if(b.nodeType==1)switch(b.nodeName){case"profile_COMMON":this.parseProfileCOMMON(b);break;case"technique":f=b;break;case"newparam":this.parseNewparam(b);break;case"image":var k=new Jr().parse(b);a[k.id]=k;break;case"extra":break;default:console.log(b.nodeName);break}}return f},Ue.prototype.parseTechnique=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new en(g.nodeName,this).parse(g);break;case"extra":this.parseExtra(g);break;default:break}}},Ue.prototype.parseExtra=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"technique":this.parseExtraTechnique(g);break;default:break}}},Ue.prototype.parseExtraTechnique=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"bump":this.shader.parse(l);break;default:break}}};function Co(){this.url=""}Co.prototype.parse=function(l){return this.url=l.getAttribute("url").replace(/^#/,""),this};function sn(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}sn.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name"),this.source={};for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"animation":var b=new sn().parse(g);for(var E in b.source)this.source[E]=b.source[E];for(var k=0;k<b.channel.length;k++)this.channel.push(b.channel[k]),this.sampler.push(b.sampler[k]);break;case"source":var E=new wi().parse(g);this.source[E.id]=E;break;case"sampler":this.sampler.push(new Js(this).parse(g));break;case"channel":this.channel.push(new No(this).parse(g));break;default:break}}return this};function No(l){this.animation=l,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}No.prototype.parse=function(l){this.source=l.getAttribute("source").replace(/^#/,""),this.target=l.getAttribute("target");var f=this.target.split("/"),g=f.shift(),b=f.shift(),k=b.indexOf(".")>=0,E=b.indexOf("(")>=0;if(k)f=b.split("."),this.sid=f.shift(),this.member=f.shift();else if(E){var S=b.split("(");this.sid=S.shift();for(var N=0;N<S.length;N++)S[N]=parseInt(S[N].replace(/\)/,""));this.arrIndices=S}else this.sid=b;return this.fullSid=b,this.dotSyntax=k,this.arrSyntax=E,this};function Js(l){this.id="",this.animation=l,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}Js.prototype.parse=function(l){this.id=l.getAttribute("id"),this.inputs=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"input":this.inputs.push(new hi().parse(g));break;default:break}}return this},Js.prototype.create=function(){for(var l=0;l<this.inputs.length;l++){var f=this.inputs[l],g=this.animation.source[f.source];switch(f.semantic){case"INPUT":this.input=g.read();break;case"OUTPUT":this.output=g.read(),this.strideOut=g.accessor.stride;break;case"INTERPOLATION":this.interpolation=g.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(f.semantic);break}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var l=0;l<this.input.length;l++)this.startTime=Math.min(this.startTime,this.input[l]),this.endTime=Math.max(this.endTime,this.input[l]);this.duration=this.endTime-this.startTime}},Js.prototype.getData=function(l,f,g){var b;if(l==="matrix"&&this.strideOut===16)b=this.output[f];else if(this.strideOut>1){b=[],f*=this.strideOut;for(var k=0;k<this.strideOut;++k)b[k]=this.output[f+k];if(this.strideOut===3)switch(l){case"rotate":case"translate":Xt(b,-1);break;case"scale":Xt(b,1);break}else this.strideOut===4&&l==="matrix"&&Xt(b,-1)}else b=this.output[f],g&&l==="translate"&&(b=gh(g,b));return b};function vi(l){this.targets=[],this.time=l}vi.prototype.addTarget=function(l,f,g,b){this.targets.push({sid:l,member:g,transform:f,data:b})},vi.prototype.apply=function(l){for(var f=0;f<this.targets.length;++f){var g=this.targets[f];(!l||g.sid===l)&&g.transform.update(g.data,g.member)}},vi.prototype.getTarget=function(l){for(var f=0;f<this.targets.length;++f)if(this.targets[f].sid===l)return this.targets[f];return null},vi.prototype.hasTarget=function(l){for(var f=0;f<this.targets.length;++f)if(this.targets[f].sid===l)return!0;return!1},vi.prototype.interpolate=function(l,f){for(var g=0,b=this.targets.length;g<b;g++){var k=this.targets[g],E=l.getTarget(k.sid),S;if(k.transform.type!=="matrix"&&E){var N=(f-this.time)/(l.time-this.time),L=E.data,C=k.data;if(N<0&&(N=0),N>1&&(N=1),C.length){S=[];for(var D=0;D<C.length;++D)S[D]=C[D]+(L[D]-C[D])*N}else S=C+(L-C)*N}else S=k.data;k.transform.update(S,k.member)}};function rn(){this.id="",this.name="",this.technique=""}rn.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name");for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"optics":this.parseOptics(g);break;default:break}}return this},rn.prototype.parseOptics=function(l){for(var f=0;f<l.childNodes.length;f++)if(l.childNodes[f].nodeName==="technique_common"){for(var g=l.childNodes[f],b=0;b<g.childNodes.length;b++)if(this.technique=g.childNodes[b].nodeName,this.technique==="perspective")for(var k=g.childNodes[b],E=0;E<k.childNodes.length;E++){var S=k.childNodes[E];switch(S.nodeName){case"yfov":this.yfov=S.textContent;break;case"xfov":this.xfov=S.textContent;break;case"znear":this.znear=S.textContent;break;case"zfar":this.zfar=S.textContent;break;case"aspect_ratio":this.aspect_ratio=S.textContent;break}}else if(this.technique==="orthographic")for(var N=g.childNodes[b],E=0;E<N.childNodes.length;E++){var S=N.childNodes[E];switch(S.nodeName){case"xmag":this.xmag=S.textContent;break;case"ymag":this.ymag=S.textContent;break;case"znear":this.znear=S.textContent;break;case"zfar":this.zfar=S.textContent;break;case"aspect_ratio":this.aspect_ratio=S.textContent;break}}}return this};function Io(){this.url=""}Io.prototype.parse=function(l){return this.url=l.getAttribute("url").replace(/^#/,""),this};function $s(){this.id="",this.name="",this.technique=""}$s.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name");for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"technique_common":this.parseCommon(g);break;case"technique":this.parseTechnique(g);break;default:break}}return this},$s.prototype.parseCommon=function(l){for(var f=0;f<l.childNodes.length;f++)switch(l.childNodes[f].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=l.childNodes[f].nodeName;for(var g=l.childNodes[f],b=0;b<g.childNodes.length;b++){var k=g.childNodes[b];switch(k.nodeName){case"color":var E=Mi(k.textContent);this.color=new THREE.Color(0),this.color.setRGB(E[0],E[1],E[2]),this.color.a=E[3];break;case"falloff_angle":this.falloff_angle=parseFloat(k.textContent);break;case"quadratic_attenuation":var S=parseFloat(k.textContent);this.distance=S?Math.sqrt(1/S):0}}}return this},$s.prototype.parseTechnique=function(l){this.profile=l.getAttribute("profile");for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];switch(g.nodeName){case"intensity":this.intensity=parseFloat(g.textContent);break}}return this};function zo(){this.url=""}zo.prototype.parse=function(l){return this.url=l.getAttribute("url").replace(/^#/,""),this};function nn(){this.id="",this.name="",this.joints=[],this.links=[]}nn.prototype.parse=function(l){this.id=l.getAttribute("id"),this.name=l.getAttribute("name"),this.joints=[],this.links=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"technique_common":this.parseCommon(g);break;default:break}}return this},nn.prototype.parseCommon=function(l){for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(l.childNodes[f].nodeName){case"joint":this.joints.push(new Po().parse(g));break;case"link":this.links.push(new on().parse(g));break;default:break}}return this};function Po(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}Po.prototype.parse=function(l){this.sid=l.getAttribute("sid"),this.name=l.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var f=l.querySelector("axis"),g=Mi(f.textContent);this.axis=Qs(g,0);var b=l.querySelector("limits min")?parseFloat(l.querySelector("limits min").textContent):-360,k=l.querySelector("limits max")?parseFloat(l.querySelector("limits max").textContent):360;this.limits={min:b,max:k};for(var E=["prismatic","revolute"],S=0;S<E.length;S++){var N=E[S],L=l.querySelector(N);L&&(this.type=N)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this};function on(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}on.prototype.parse=function(l){this.sid=l.getAttribute("sid"),this.name=l.getAttribute("name"),this.transforms=[],this.attachments=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"attachment_full":this.attachments.push(new Bo().parse(g));break;case"rotate":case"translate":case"matrix":this.transforms.push(new ai().parse(g));break;default:break}}return this};function Bo(){this.joint="",this.transforms=[],this.links=[]}Bo.prototype.parse=function(l){this.joint=l.getAttribute("joint").split("/").pop(),this.links=[];for(var f=0;f<l.childNodes.length;f++){var g=l.childNodes[f];if(g.nodeType==1)switch(g.nodeName){case"link":this.links.push(new on().parse(g));break;case"rotate":case"translate":case"matrix":this.transforms.push(new ai().parse(g));break;default:break}}return this};function uh(l){var f=l.getAttribute("id");return n[f]!=null||(n[f]=new wi(f).parse(l)),n[f]}function Rc(l){return l==="dae"?"http://www.collada.org/2005/11/COLLADASchema":null}function ph(l){for(var f=Ks(l),g=[],b=0,k=f.length;b<k;b++)g.push(f[b]==="true"||f[b]==="1");return g}function Mi(l){for(var f=Ks(l),g=[],b=0,k=f.length;b<k;b++)g.push(parseFloat(f[b]));return g}function rs(l){for(var f=Ks(l),g=[],b=0,k=f.length;b<k;b++)g.push(parseInt(f[b],10));return g}function Ks(l){return l.length>0?dh(l).split(/\s+/):[]}function dh(l){return l.replace(/^\s+/,"").replace(/\s+$/,"")}function Cc(l,f,g){return l.hasAttribute(f)?parseFloat(l.getAttribute(f)):g}function ns(l,f,g){return l.hasAttribute(f)?parseInt(l.getAttribute(f),10):g}function Nc(l,f,g){return l.hasAttribute(f)?l.getAttribute(f):g}function Ic(l,f){if(l===void 0){for(var g="0.";g.length<f+2;)g+="0";return g}f=f||2;var b=l.toString().split(".");for(b[1]=b.length>1?b[1].substr(0,f):"0";b[1].length<f;)b[1]+="0";return b.join(".")}function fh(l,f){F=new THREE.ImageLoader,F.load(f,function(g){l.image=g,l.needsUpdate=!0})}function Fo(l,f){l.doubleSided=!1;var g=f.querySelectorAll("extra double_sided")[0];g&&g&&parseInt(g.textContent,10)===1&&(l.doubleSided=!0)}function mh(){if(W.convertUpAxis!==!0||J===W.upAxis)Q=null;else switch(J){case"X":Q=W.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":Q=W.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":Q=W.upAxis==="X"?"ZtoX":"ZtoY";break}}function Xt(l,f){if(!(W.convertUpAxis!==!0||J===W.upAxis))switch(Q){case"XtoY":var g=l[0];l[0]=f*l[1],l[1]=g;break;case"XtoZ":var g=l[2];l[2]=l[1],l[1]=l[0],l[0]=g;break;case"YtoX":var g=l[0];l[0]=l[1],l[1]=f*g;break;case"YtoZ":var g=l[1];l[1]=f*l[2],l[2]=g;break;case"ZtoX":var g=l[0];l[0]=l[1],l[1]=l[2],l[2]=g;break;case"ZtoY":var g=l[1];l[1]=l[2],l[2]=f*g;break}}function gh(l,f){if(W.convertUpAxis!==!0||J===W.upAxis)return f;switch(l){case"X":f=Q==="XtoY"?f*-1:f;break;case"Y":f=Q==="YtoZ"||Q==="YtoX"?f*-1:f;break;case"Z":f=Q==="ZtoY"?f*-1:f;break;default:break}return f}function Qs(l,f){var g=[l[f],l[f+1],l[f+2]];return Xt(g,-1),new THREE.Vector3(g[0],g[1],g[2])}function an(l){if(W.convertUpAxis){var f=[l[0],l[4],l[8]];Xt(f,-1),l[0]=f[0],l[4]=f[1],l[8]=f[2],f=[l[1],l[5],l[9]],Xt(f,-1),l[1]=f[0],l[5]=f[1],l[9]=f[2],f=[l[2],l[6],l[10]],Xt(f,-1),l[2]=f[0],l[6]=f[1],l[10]=f[2],f=[l[0],l[1],l[2]],Xt(f,-1),l[0]=f[0],l[1]=f[1],l[2]=f[2],f=[l[4],l[5],l[6]],Xt(f,-1),l[4]=f[0],l[5]=f[1],l[6]=f[2],f=[l[8],l[9],l[10]],Xt(f,-1),l[8]=f[0],l[9]=f[1],l[10]=f[2],f=[l[3],l[7],l[11]],Xt(f,-1),l[3]=f[0],l[7]=f[1],l[11]=f[2]}return new THREE.Matrix4().set(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15])}function yh(l){if(l>-1&&l<3){var f=["X","Y","Z"],g={X:0,Y:1,Z:2};l=Lo(f[l]),l=g[l]}return l}function Lo(l){if(W.convertUpAxis)switch(l){case"X":switch(Q){case"XtoY":case"XtoZ":case"YtoX":l="Y";break;case"ZtoX":l="Z";break}break;case"Y":switch(Q){case"XtoY":case"YtoX":case"ZtoX":l="X";break;case"XtoZ":case"YtoZ":case"ZtoY":l="Z";break}break;case"Z":switch(Q){case"XtoZ":l="X";break;case"YtoZ":case"ZtoX":case"ZtoY":l="Y";break}break}return l}return{load:ct,parse:ot,setPreferredShading:Vt,applySkin:de,geometries:u,options:W}};var Za=(m,t,e,i)=>new Promise((r,n)=>{let a=new m.Object3D,h=new m.Group,c=p=>{let d=p.textures[0].data,y=new m.Texture,x=new Blob([d],{type:"image/png"});createImageBitmap(x).then(function(A){y.image=A,y.needsUpdate=!0}),new Ya().load(p.data,A=>{var P,z,B,F;let R=(z=(P=A.scene.children[0].children[0])==null?void 0:P.children[1])==null?void 0:z.children[0];if(R){R.rotation.set(0,3.14,0);let H=R.material;H.map=y}let T=(F=(B=A.scene.children[0].children[0])==null?void 0:B.children[2])==null?void 0:F.children[0];if(T){T.rotation.set(0,3.14,0);let H=T.material;if(!H)return;H.map=y,H.transparent=!0}h.add(A.scene),h.scale.set(e,e,e),h.position.set(0,i,0),a.add(h),r(a)})};new Vr().parse(t,c,{upAxis:"Y_UP",unitName:"meter",unitMeter:1})});var Hr=class{constructor(t,e,i){this.target=new oi.Vector3(0,0,0);this.position=new oi.Vector3(0,0,0);this.curPosition=new oi.Vector3(0,0,0);this.quaternion=new oi.Quaternion(0,0,0,0);this.load=async function(){let t=new Dr;return new Promise((e,i)=>{t.load(this.url,async r=>{if(this.model=await Za(THREE,r.scene,this.scale,this.height),!this.model)throw new Error("error creating avatar in forge");e(this.model)},void 0,r=>{console.error("An error happened loading the avatar",r),i(r)})})};this.url=t,this.scale=e,this.height=i,this.clock=new oi.Clock,this.clock.start(),this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this))}setPosition(t){!t||t.x===0&&t.y===0&&t.z===0||this.position.set(t.x,t.y,t.z)}setQuaternion(t){t&&this.quaternion.set(t._x,t._y,t._z,t._w)}destroy(){cancelAnimationFrame(this.lerpAnimationFrame),this.model.parent.remove(this.model)}animate(){if(this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)),!this.model||!this.position||!this.quaternion)return;let i=2*this.clock.getDelta();this.curPosition.lerp(this.position,i),this.model.position.set(this.curPosition.x,this.curPosition.y,this.curPosition.z);let r=this.model.quaternion.clone();r.slerp(this.quaternion,i),this.model.quaternion.set(r.x,r.y,r.z,r.w)}};var Ja=require("three"),Ur=class{constructor(t,e,i,r){this.load=async()=>new Promise(t=>{let e=document.createElement("script");window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},e.setAttribute("src","https://production.storage.superviz.com/static/fonts/OpenSans.js"),e.onload=async()=>{let i=await this.createTextGeometry(this.name,this.textColor);i.position.set(0,this.height,0),this.mesh=i,this.renderFrame=requestAnimationFrame(this.render.bind(this)),t(i)},document.body.appendChild(e)});this.createTextGeometry=async(t,e)=>{let i=new THREE.TextGeometry(t,{font:"open sans",size:.08,height:0,curveSegments:3});i.computeBoundingBox();let r=new THREE.MeshBasicMaterial({color:e}),n=new THREE.Mesh(i,r);return n.geometry.center(),this.createBackground(n,this.backgroundColor),n};this.createBackground=async(t,e)=>{let i=new THREE.Box3().setFromObject(t),r=new THREE.Vector3(0,0,0);i.getSize(r);let{x:n,y:a}=r,h=.12,c=.06,u=-(n/2+h/2),p=-(a/2+c/2)-.002,d=n+h,y=a+c,x=.078,M=new Ja.Shape;M.moveTo(u,p+x),M.lineTo(u,p+y-x),M.quadraticCurveTo(u,p+y,u+x,p+y),M.lineTo(u+d-x,p+y),M.quadraticCurveTo(u+d,p+y,u+d,p+y-x),M.lineTo(u+d,p+x),M.quadraticCurveTo(u+d,p,u+d-x,p),M.lineTo(u+x,p),M.quadraticCurveTo(u,p,u,p+x);let A=new THREE.ShapeGeometry(M),R=new THREE.MeshBasicMaterial({color:e,side:THREE.DoubleSide}),T=new THREE.Mesh(A,R);t.add(T),T.position.set(0,0,-.01)};if(this.name=t,this.viewer=r,e)this.backgroundColor=e.color,this.textColor=e.textColor;else{let n="#878291";this.textColor="#fff",this.backgroundColor=n}this.height=i,this.slot=e}render(){if(this.renderFrame=requestAnimationFrame(this.render.bind(this)),this.viewer&&this.mesh){let t=this.viewer.getCamera();this.curQuaternion=this.mesh.parent.quaternion.clone().invert().multiply(t.quaternion.clone()),this.mesh.setRotationFromQuaternion(this.curQuaternion)}}destroy(){cancelAnimationFrame(this.renderFrame)}};var $a=require("three"),Gr=class{constructor(t,e,i){this.position=new THREE.Vector3(0,0,0);this.quaternion=new THREE.Quaternion(0,0,0,0);this.mousePosition=new THREE.Vector3(0,0,0);this.lerpedMousePosition=new THREE.Vector3(0,0,0);this.slot=null;this.material=new THREE.MeshBasicMaterial;this.viewer=t,this.laserOrigin=i,this.clock=new $a.Clock,this.clock.start(),this.isDestroyed=!1,this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)),this.generateMaterial(e)}destroy(){this.isDestroyed=!0,cancelAnimationFrame(this.lerpAnimationFrame),this.mesh&&(this.viewer.overlays.removeMesh(this.mesh,"avatars-scene"),this.mesh.geometry.dispose(),this.mesh=null)}setAvatar(t){t&&(this.avatar=t)}setMousePosition(t){t&&this.mousePosition.set(t.x,t.y,t.z)}setColorIndex(t){t!==this.slot&&t!==void 0&&(this.generateMaterial(t),this.slot=t)}animate(){let e=this.clock.getDelta();if(setTimeout(()=>{this.isDestroyed||(this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)))},1e3/20),!this.avatar||(this.mesh&&(this.mesh.geometry.dispose(),this.viewer.overlays.removeMesh(this.mesh,"avatars-scene")),this.position=this.avatar.model.position,this.quaternion=this.avatar.model.quaternion,!this.position||!this.mousePosition||!this.quaternion||!this.material))return;let i=new THREE.Vector3(this.position.x,this.position.y,this.position.z),r=new THREE.Vector3(this.laserOrigin.x,this.laserOrigin.y,this.laserOrigin.z).applyQuaternion(new THREE.Quaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w));i.add(r.multiplyScalar(1)),this.lerpedMousePosition.lerp(this.mousePosition,e/1e3*1e3);let a=new THREE.LineCurve3(i,new THREE.Vector3(this.lerpedMousePosition.x,this.lerpedMousePosition.y,this.lerpedMousePosition.z)),h=.005,c=new THREE.TubeGeometry(a,3,h,4,!1);this.mesh=new THREE.Mesh(c,this.material),this.viewer.overlays.hasScene("avatars-scene")&&this.viewer.overlays.addMesh(this.mesh,"avatars-scene")}createTextureCanvas(){let t=document.createElement("canvas"),e=t.getContext("2d");t.width=1,t.height=64;let i=e.createLinearGradient(0,0,t.width,t.height);return i.addColorStop(0,"rgba(  0,  0,  0,0.2)"),i.addColorStop(.1,"rgba(160,160,160,0.5)"),i.addColorStop(.5,"rgba(255,255,255,0.8)"),i.addColorStop(.9,"rgba(160,160,160,0.5)"),i.addColorStop(1,"rgba(  0,  0,  0,0.2)"),e.fillStyle=i,e.fillRect(0,0,t.width,t.height),t}generateMaterial(t){let e=(t==null?void 0:t.color)??"#878291",i=this.createTextureCanvas(),r=new THREE.Texture(i);r.needsUpdate=!0,this.material=new THREE.MeshBasicMaterial({map:r,blending:THREE.AdditiveBlending,color:e,side:THREE.DoubleSide,depthWrite:!1,transparent:!1})}};var Qa=require("three"),Ka=(m,t)=>{let e=m.x-t.x,i=m.y-t.y,r=m.z-t.z;return Math.sqrt(e*e+i*i+r*r)},jr=class{constructor(t,e){this.destPos=new THREE.Vector3(0,0,0);this.curScreenPos=new THREE.Vector2(0,0);this.slot=null;this.update=(t,e)=>{e!==void 0&&(this.slot=e),!(!t||t.x===0&&t.y===0&&t.z===0)&&(this.destPos.x=t.x,this.destPos.y=t.y,this.destPos.z=t.z)};this.clock=new Qa.Clock,this.viewer=t,this.userId=e,this.renderFrame=requestAnimationFrame(this.render.bind(this)),this.renderDivWrapper()}async load(t,e){if(!(!t||e===void 0))return new Promise(()=>{let i=`https://production.cdn.superviz.com/static/mouse-pointers/${e.colorName}.svg`,r=document.createElement("div");r.setAttribute("id",`mouse_${this.userId}`),r.setAttribute("style",`background-image:url('${i}')`),r.style.position="absolute",r.style.zIndex="3",r.style.width="15px",r.style.height="15px",r.style.pointerEvents="none",r.style.transition="all 75ms ease",r.style.top="-100px",r.style.left="-100px",this.mousesWrapper.appendChild(r);let n=document.createElement("div");if(!t.trim().length)return;let a=(e==null?void 0:e.color)??"#878291";n.setAttribute("style",`background-color:${a}`),n.style.borderRadius="30px",n.style.fontSize="14px",n.style.fontWeight="700",n.style.zIndex="3",n.style.fontWeight="600",n.style.fontFamily="Open Sans",n.style.width="fit-content",n.style.whiteSpace="nowrap",n.innerHTML+=t,n.style.marginLeft="12px",n.style.marginTop="9px",n.style.pointerEvents="none",n.style.color=(e==null?void 0:e.textColor)??"#fff",n.style.padding="2px 8px 2px 8px",r.appendChild(n)})}destroy(){cancelAnimationFrame(this.renderFrame),document.getElementById(`mouse_${this.userId}`).remove()}async render(){if(this.renderDivWrapper(),this.renderFrame=requestAnimationFrame(this.render.bind(this)),this.destPos.x===0&&this.destPos.y===0)return;let t=this.clock.getDelta(),e=2e3,i=this.viewer.worldToClient(this.destPos),r=1,n=this.viewer.utilities.getHitPoint(i.x/this.mousesWrapper.clientWidth,i.y/this.mousesWrapper.clientHeight);if(n){let a=this.viewer.navigation.getPosition(),h=Ka(n,a),c=Ka(this.destPos,a);Math.abs(c-h)>1&&(r=.2)}if(i){this.curScreenPos.lerp(i,t/100*e);let a=this.curScreenPos.y,h=this.curScreenPos.x;a===0&&h===0&&(r=0);let c=document.getElementById(`mouse_${this.userId}`);c?(c.style.top=`${a}px`,c.style.left=`${h}px`,c.style.opacity=`${r}`):console.warn("no mouse element")}}renderDivWrapper(){let t=this.viewer.canvas.getBoundingClientRect(),e=document.getElementById("superviz-autodesk-mouse-wrapper");e||(e=document.createElement("div"),e.id="superviz-autodesk-mouse-wrapper"),e.style.position="absolute",e.style.top=`${this.viewer.canvas.offsetTop}px`,e.style.left=`${this.viewer.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",this.viewer.canvas.parentElement.style.position==="static"&&(this.viewer.canvas.parentElement.style.position="relative"),document.getElementById("superviz-autodesk-mouse-wrapper")||this.viewer.canvas.parentElement.appendChild(e),this.mousesWrapper=e}};var Mo=require("three");var th=pn(require("debug")),ts=class{constructor(t){this.debug=(0,th.default)(t)}log(t,...e){this.debug(t,...e)}};var eh=pn(require("lodash/throttle"));var Wr=class{constructor(t={}){this.subscribe=t=>{this.callbacks.push(t)};this.unsubscribe=t=>{this.callbacks=this.callbacks.filter(e=>e!==t)};this.publish=(...t)=>{this.callbacks&&this.callbacks.forEach(e=>{this.callListener(e,t).catch(i=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${e}
            Event: ${JSON.stringify(t)}
            Error: ${i}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(t,e)=>new Promise((i,r)=>{try{let n=t(...e);i(n)}catch(n){r(n)}});let{logger:e,throttleTime:i}=t;this.logger=e??new ts("@superviz/sdk/observer-helper"),this.throttle=i,this.callbacks=[],this.throttle&&(this.publish=(0,eh.default)(this.publish,this.throttle))}};var Ec,Gs=class{constructor(t){this.isPinsVisible=!0;this.commentsSide="left";this.localParticipant={};this.isDragging=!1;this.hasLayerSelected=!1;this.animate=()=>{this.positionWrapper(),this.renderFrame=requestAnimationFrame(this.animate)};this.setCommentsMetadata=t=>{this.commentsSide=t};this.onAggregateSelectionChanged=t=>{this.hasLayerSelected=!!t.selections.length,this.renderAnnotationsPins()};this.onCameraMove=()=>{!this.isActive&&!this.isPinsVisible||this.renderAnnotationsPins()};this.annotationSelected=({detail:t})=>{var c;let{uuid:e,haltGoToPin:i,newPin:r}=t;if(!e)return;r&&this.pins.get(e).setAttribute("newPin","");let n=JSON.parse(((c=this.selectedPin)==null?void 0:c.getAttribute("annotation"))??"{}");if(this.resetPins(),(n==null?void 0:n.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(e);if(!a)return;a.setAttribute("active",""),this.selectedPin=a;let{position:h}=this.annotations.find(u=>u.uuid===e);if(h&&!i){let u=JSON.parse(h);this.onClickedPin(u)}};this.hideTemporaryPin=t=>{var i;let e=t.target;this.viewer.canvas.contains(e)||(i=this.pins.get("temporary-pin"))!=null&&i.contains(e)||this.removeAnnotationPin("temporary-pin")};this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.renderDivWrapper=()=>{let t=this.viewer.canvas.getBoundingClientRect(),e=this.divWrapper;e||(e=document.createElement("div"),e.id="superviz-autodesk-pins-wrapper"),e.style.position="fixed",e.style.top=`${this.viewer.canvas.offsetTop}px`,e.style.left=`${this.viewer.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",e.style.zIndex="1",document.getElementById("superviz-autodesk-pins-wrapper")||document.body.appendChild(e),this.divWrapper=e};this.distanceBetween=(t,e)=>{let i=t.x-e.x,r=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+r*r+n*n)};this.onMouseUp=t=>{if(this.isDragging)return;let i=this.viewer.clientToWorld(t.offsetX,t.offsetY,!1).point;if(i){let r={x:i.x,y:i.y,z:i.z,type:"autodesk"},n=this.viewer.navigation.getCamera();n.updateMatrixWorld();let a=new Mo.Vector3(0,0,0);n.getWorldPosition(a);let h={position:r,camera:a};this.resetSelectedPin(),this.onPinFixedObserver.publish(h),this.createTemporaryPin(r)}};this.onMouseDown=t=>{this.isDragging=!1};this.onMouseMove=t=>{this.isDragging=!0;let{x:e,y:i}=t;this.mouseElement||(this.mouseElement=this.createMouseElement());let r=i-this.pinHeight;this.mouseElement.setAttribute("position",JSON.stringify({x:e,y:r}))};this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.viewer.canvas.style.cursor="default"};this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.pins.forEach(i=>{i.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};Ec=this,this.viewer=t,this.logger=new ts("@superviz/sdk/comments-component/autodesk-adapter"),this.isActive=!1,this.pins=new Map,this.pinHeight=32,this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraMove),this.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.style.position="relative",this.onPinFixedObserver=new Wr,this.annotations=[],this.renderAnnotationsPins(),this.showcaseSides=this.viewer.canvas.getBoundingClientRect(),this.renderDivWrapper(),this.renderFrame=requestAnimationFrame(this.animate)}destroy(){this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraMove),this.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),this.removeAnnotationsPins(),this.removeListeners(),cancelAnimationFrame(this.renderFrame),this.mouseElement=null}setActive(t){if(this.isActive=t,this.isActive){this.addListeners();return}this.removeListeners()}setPinsVisibility(t){if(this.isPinsVisible=t,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}positionWrapper(){let t=this.viewer.canvas.getBoundingClientRect();this.divWrapper.style.position="fixed",this.divWrapper.style.top=`${t.top}px`,this.divWrapper.style.left=`${t.left}px`,this.divWrapper.style.width=`${t.width}px`,this.divWrapper.style.height=`${t.height}px`}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),this.annotations=this.annotations.filter(i=>i.uuid!==t))}createTemporaryPin(t){let e=document.getElementById("superviz-temporary-pin");this.temporaryPinCoordinates=t,e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.showcaseSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("localAvatar",this.localParticipant.avatar??""),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("localName",this.localParticipant.name??""),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttributeNode(document.createAttribute("active")),e.style.pointerEvents="auto");let i=this.position3DToScreen(t,0,this.pinHeight),r={x:i.left,y:i.top,type:t.type};e.setAttribute("position",JSON.stringify(r)),this.divWrapper.appendChild(e),this.pins.set("temporary-pin",e),this.renderAnnotationsPins()}addListeners(){this.viewer.canvas.addEventListener("mouseup",this.onMouseUp),this.viewer.canvas.addEventListener("mousedown",this.onMouseDown),this.viewer.canvas.addEventListener("mousemove",this.onMouseMove),this.viewer.canvas.addEventListener("mouseout",this.onMouseLeave),this.viewer.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.viewer.canvas.removeEventListener("mouseup",this.onMouseUp),this.viewer.canvas.removeEventListener("mousedown",this.onMouseDown),this.viewer.canvas.removeEventListener("mousemove",this.onMouseMove),this.viewer.canvas.removeEventListener("mouseout",this.onMouseLeave),this.viewer.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}async renderAnnotationsPins(){if(this.annotations.forEach(async t=>{let i=JSON.parse(t.position).position;if((i==null?void 0:i.type)!=="autodesk"||t.resolved)return;if(!this.pins.has(t.uuid)){this.createPin(t,i);return}let r=this.position3DToScreen(i,0,this.pinHeight),n=await this.checkIsVisible(r,i),a=this.pins.get(t.uuid);n?(a.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:r.left,y:r.top}))):a.setAttribute("style","opacity: 0")}),this.pins.get("temporary-pin")){let t=this.position3DToScreen(this.temporaryPinCoordinates,0,this.pinHeight),e=await this.checkIsVisible(t,this.temporaryPinCoordinates),i=this.pins.get("temporary-pin");e?(i.setAttribute("style","opacity: 1"),i.setAttribute("position",JSON.stringify({x:t.left,y:t.top}))):i.setAttribute("style","opacity: 0")}}createPin(t,e){let i=this.position3DToScreen(e,0,this.pinHeight),r=document.createElement("superviz-comments-annotation-pin");this.divWrapper.appendChild(r),r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(t)),r.setAttribute("position",JSON.stringify({x:i.left,y:i.top})),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.style.pointerEvents="auto",this.pins.set(t.uuid,r)}onClickedPin(t){let e=t.position,i=this.viewer.navigation.getCamera();i.updateMatrixWorld();let r=new Mo.Vector3(t.camera.x,t.camera.y,t.camera.z),n=new THREE.Vector3(e.x,e.y,e.z),a;n.distanceTo(r)>5?a=r.lerp(n,.6):a=r,this.onPinFixedObserver.publish({x:t.position.x,y:t.position.y,z:t.position.z,type:"autodesk"}),this.viewer.utilities.setPivotPoint(n,!1,!1),this.viewer.utilities.transitionView(a,n,i.fov,i.up,i.worldup,!0,n)}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}set participantsList(t){this.participants=t}position3DToScreen(t,e,i){let r=this.viewer.worldToClient(t);return{top:r.y-i,left:r.x-e}}async checkIsVisible(t,e){let i=!0,r=this.viewer.clientToWorld(t.left,t.top+this.pinHeight,!1);if(r){let n=r.point,a=this.distanceBetween(n,e),h=Math.abs(a),c=this.hasLayerSelected?8:3;h>c&&(i=!1)}return i}createMouseElement(){let t=document.createElement("superviz-comments-annotation-pin");return t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(t),this.viewer.canvas.style.cursor="none",t}};var ih=pn(require("debug")),qr=class{constructor(t){this.debug=(0,ih.default)(t)}log(t,...e){this.debug(t,...e)}};var sh={model3DUrl:"https://production.storage.superviz.com/readyplayerme/1.glb",imageUrl:"https://production.cdn.superviz.com/static/default-avatars/1.png"},Xr={GLOBAL:"global-store",PRESENCE_3D:"presence-3d-store"},Yr=class{constructor(t,e){this.participants=[];this.isAttached=!1;this.avatars={};this.lasers={};this.names={};this.mouses={};this.positionInfos={};this.renderSilentInterval=null;this.lastSyncedData={};this.unsubscribeFrom=[];this.roomParticipants={};this.hasJoinedRoom=!1;this.hasJoined3D=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let p="autodesk-viewer component @ attach - params are required";throw this.logger.log(p),new Error(p)}this.logger.log("attached");let{eventBus:e,useStore:i,ioc:r,Presence3DManagerService:n}=t;this.useStore=i.bind(this),this.room=r.createRoom(this.name),this.presence3DManager=new n(this.room,this.useStore);let{localParticipant:a,hasJoinedRoom:h}=this.useStore(Xr.GLOBAL);a.subscribe(),h.subscribe();let{hasJoined3D:c,participants:u}=this.useStore(Xr.PRESENCE_3D);c.subscribe(),u.subscribe(this.onParticipantsUpdated),this.isAttached=!0,this.eventBus=e,this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log("autodesk-viewer component @ detach - component is not attached}");return}this.logger.log("detached"),this.destroy(),this.unsubscribeFrom.forEach(t=>t(this)),this.localParticipant=void 0,this.isAttached=!1};this.destroy=()=>{this.unsubscribeToRealtimeEvents(),this.unsubscribeToEventBusEvents(),this.room.disconnect(),this.room=void 0,this.participants.forEach(t=>{this.presence3DManager.unsubscribeFromUpdates(t.id,this.onParticipantUpdated)}),this.presence3DManager=void 0,this.useStore(Xr.PRESENCE_3D).destroy(),this.useStore=void 0,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.canvas.removeEventListener("mousemove",this.onMouseMove),clearInterval(this.renderSilentInterval),this.participants.forEach(t=>{this.removeParticipant(t,!0)}),this.avatars={},this.lasers={},this.mouses={},this.positionInfos={},this.viewer.overlays.clearScene("avatars-scene"),this.viewer.overlays.removeScene("avatars-scene")};this.start=()=>{if(!this.hasJoinedRoom||!this.hasJoined3D){this.logger.log("matterport component @ start - not joined yet"),setTimeout(()=>{this.logger.log("matterport component @ start - retrying"),this.start()},1e3);return}this.subscribeToRealtimeEvents(),this.subscribeToEventBusEvents(),this.createParticipantList(),this.renderSilentInterval=setInterval(this.renderSilent,1),this.sync()};this.subscribeToRealtimeEvents=()=>{this.logger.log("autodesk-viewer component @ subscribeToRealtimeEvents"),this.room.on("participant-joined",this.onParticipantJoined),this.room.presence.on("presence.leave",this.onParticipantLeave),this.room.on("gather",this.onGatherUpdate),this.room.on("follow-me",this.onFollowParticipantUpdate)};this.unsubscribeToRealtimeEvents=()=>{this.logger.log("autodesk-viewer component @ unsubscribeToRealtimeEvents"),this.room.presence.off("presence.leave"),this.room.off("participant-joined",this.onParticipantJoined),this.room.off("gather",this.onGatherUpdate),this.room.off("follow-me",this.onFollowParticipantUpdate)};this.subscribeToEventBusEvents=()=>{this.logger.log("autodesk-viewer component @ subscribeToEventBusEvents"),this.eventBus.subscribe("realtime.go-to-participant",this.goTo),this.eventBus.subscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.subscribe("realtime.follow-participant",this.follow),this.eventBus.subscribe("realtime.private-mode",this.setPrivate)};this.unsubscribeToEventBusEvents=()=>{this.logger.log("autodesk-viewer component @ unsubscribeToEventBusEvents"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goTo),this.eventBus.unsubscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.unsubscribe("realtime.follow-participant",this.follow),this.eventBus.unsubscribe("realtime.private-mode",this.setPrivate)};this.onParticipantJoined=t=>{if(!t.data)return;this.logger.log("autodesk-viewer component @ onParticipantJoined",t);let{id:e,name:i,avatar:r,avatarConfig:n,type:a,slot:h}=t.data;if(e===this.localFollowParticipantId){this.onLocalParticipantJoined(t.data);return}this.addParticipant({id:e,name:i,avatar:r,avatarConfig:n,type:a,slot:h,isPrivate:!1})};this.onLocalParticipantJoined=t=>{var e,i,r,n;this.config.avatarConfig&&this.presence3DManager.setParticipantData({avatarConfig:this.config.avatarConfig}),(e=t.avatar)!=null&&e.model3DUrl&&this.presence3DManager.setParticipantData({avatar:{model3DUrl:t==null?void 0:t.avatar.model3DUrl,imageUrl:(i=t==null?void 0:t.avatar)==null?void 0:i.imageUrl}}),(r=t.avatar)!=null&&r.model3DUrl||this.presence3DManager.setParticipantData({avatar:{model3DUrl:sh.model3DUrl,imageUrl:(n=t==null?void 0:t.avatar)==null?void 0:n.imageUrl}})};this.onParticipantLeave=t=>{this.logger.log("autodesk-viewer component @ onParticipantLeave",t);let e=this.participants.find(i=>i.id===t.id);delete this.roomParticipants[t.id],e&&this.removeParticipant(e,!0)};this.onParticipantUpdated=t=>{this.logger.log("autodesk-viewer component @ onParticipantUpdated",t);let{id:e,name:i,avatar:r,avatarConfig:n,position:a,rotation:h,type:c,slot:u}=t;this.updateParticipant({position:a,rotation:h,id:e,name:i,avatar:r,avatarConfig:n,type:c,slot:u}),(this.localFollowParticipantId||this.followParticipantId)&&this.moveToAnotherParticipant(this.localFollowParticipantId??this.followParticipantId)};this.updateParticipant=t=>{var i,r;if(!this.participants||this.participants.length===0||!t||!t.id)return;let e=this.participants.find(n=>n.id===t.id);if(!e){this.addParticipant(t);return}if(((i=e.avatar)==null?void 0:i.model3DUrl)!==((r=t.avatar)==null?void 0:r.model3DUrl)||!(0,rh.isEqual)(e.avatarConfig,t.avatarConfig)||e.name!==t.name)this.removeParticipant(t,!0),this.addParticipant(t);else{let n=this.participants.findIndex(a=>a.id===t.id);n!==-1&&(this.participants[n]=t)}this.logger.log("autodesk-viewer component @ updateParticipant",{participant:t,participants:this.participants})};this.onFollowParticipantUpdate=t=>{t.data.id!==this.localParticipantId&&(this.logger.log("three js component @ onFollowParticipantUpdate",t.data.id),this.followParticipantId=t.data.id,this.moveToAnotherParticipant(t.data.id))};this.onGatherUpdate=t=>{this.logger.log("three js component @ onGatherUpdate",t.data.id),t.data.id!==this.localParticipantId&&this.eventBus.publish("realtime.go-to-participant",t.data.id)};this.createParticipantList=()=>{let t=this.useStore(Xr.PRESENCE_3D).participants.value;Object.values(t).forEach(e=>{e.isPrivate||this.addParticipant(e)}),this.logger.log("autodesk-viewer component @ createParticipantList",this.participants)};this.createParticipantOn3D=({id:t,name:e,avatar:i,avatarConfig:r,type:n,isPrivate:a,slot:h})=>{let c={id:t,name:e,avatar:i,isPrivate:a,isAudience:n==="audience",avatarConfig:t===this.localParticipantId?this.config.avatarConfig:r,position:{x:0,y:0,z:0},rotation:{x:0,y:0},slot:h};return this.logger.log("autodesk-viewer component @ createParticipantOn3D",c),c};this.removeParticipant=(t,e)=>{var i;this.logger.log("autodesk-viewer component @ removeParticipant",{participant:t,unsubscribe:e}),this.participants=this.participants.filter(r=>r.id!==t.id),this.destroyAvatar(t),this.destroyLaser(t),this.destroyMouse(t),e&&((i=this.presence3DManager)==null||i.unsubscribeFromUpdates(t.id,this.onParticipantUpdated))};this.addParticipant=async t=>{if(!t||!t.id||t.type==="audience")return;let e=this.createParticipantOn3D(t);if(this.participants.find(i=>i.id===e.id)){this.logger.log("autodesk-viewer component @ addParticipant - participant already exists"),this.onParticipantUpdated(t);return}this.roomParticipants[t.id]=t,this.participants.push(e),this.logger.log("autodesk-viewer component @ addParticipant",{participant:t,participantOn3D:e,participants:this.participants}),this.presence3DManager.subscribeToUpdates(e.id,this.onParticipantUpdated),this.create3dPresence(e)};this.goTo=t=>{this.logger.log("autodesk-viewer component @ goTo",t),this.moveToAnotherParticipant(t)};this.gather=()=>{this.logger.log("autodesk-viewer component @ gather"),this.room.emit("gather",{id:this.localParticipant.id})};this.setPrivate=t=>{this.logger.log("autodesk-viewer component @ private mode"),this.presence3DManager.updatePresence3D({id:this.localParticipantId,isPrivate:!!t}),this.isPrivate=!!t};this.follow=t=>{this.logger.log("autodesk-viewer component @ follow"),this.room.emit("follow-me",{id:t})};this.localFollow=t=>{this.localFollowParticipantId=t};this.onCameraChanged=()=>{this.isAttached&&(this.viewer.impl.overlayScenes["avatars-scene"]&&this.viewer.impl.requestSilentRender(),this.sync())};this.renderSilent=()=>{if(this.viewer.impl.overlayScenes["avatars-scene"]){this.viewer.impl.requestSilentRender();let t=!1,e=[];Object.values(this.avatars).forEach(i=>{i!=null&&i.model&&this.lastSyncedData.position.distanceTo(i.model.position)<1&&(t=!0,e.push(i))}),t?e.forEach(i=>{i!=null&&i.model&&(i.model.visible=!1)}):Object.values(this.avatars).forEach(i=>{i!=null&&i.model&&(i.model.visible=!0)})}};this.onParticipantsUpdated=t=>{Object.values(t).forEach(e=>{if(!this.isAttached||e.id===this.localParticipantId)return;this.roomParticipants={},t.forEach(x=>{this.roomParticipants[x.id]=x});let i=e.id,r=this.avatars[i],n=this.lasers[i],a=this.mouses[i],h=e.slot,{position:c,quaternion:u,target:p,mouse:d,isPrivate:y}=e;this.positionInfos[e.id]={position:c,quaternion:u,target:p},y&&this.avatars[i]&&this.removeParticipant(e,!0),!y&&!this.avatars[i]&&this.addParticipant(e),r&&(r.setPosition(c),r.setQuaternion(u),r.target=p),n&&(n.setAvatar(r),n.setMousePosition(d),n.setColorIndex(h)),a&&this.mouses[i].update(d,h)})};this.onMouseMove=t=>{var i;if(!this.viewer||!THREE)return;let e=this.viewer.clientToWorld(t.offsetX,t.offsetY,!1);e!==null&&(this.lastSyncedData.mouse=e.point,(i=this.presence3DManager)==null||i.updatePresence3D({id:this.localParticipantId,...this.lastSyncedData}))};if(typeof window>"u")throw new Error("[SuperViz] Presence3D cannot be initialized in a non-browser environment. Window is not defined");if(!t)throw new Error("autodesk viewer instance is required");this.name="presence3dAutodesk",this.logger=new qr("@superviz/sdk/autodesk-viewer-component"),this.logger.log("autodesk-viewer component @ constructor",{viewer:t,options:e}),this.config={isAvatarsEnabled:(e==null?void 0:e.isAvatarsEnabled)??!0,isLaserEnabled:(e==null?void 0:e.isLaserEnabled)??!0,isNameEnabled:(e==null?void 0:e.isNameEnabled)??!0,isMouseEnabled:(e==null?void 0:e.isMouseEnabled)??!0,avatarConfig:e==null?void 0:e.avatarConfig},this.logger.log("autodesk-viewer component @ constructor - config",this.config),this.viewer=t,this.viewer.canvas.addEventListener("mousemove",this.onMouseMove),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged)}get localParticipantId(){var t;return(t=this.localParticipant)==null?void 0:t.id}async create3dPresence(t){if(t.id!==this.localParticipantId){if(this.config.isAvatarsEnabled){let e=await this.createAvatar(t);this.config.isNameEnabled&&this.createName(t,e)}this.config.isMouseEnabled&&this.createMouse(t),this.config.isLaserEnabled&&this.createLaser(t)}}async createAvatar(t){var h,c,u;if(this.logger.log("autodesk-viewer component @ createAvatar",t),!this.isAttached||t.id===this.localParticipantId)return;this.avatars[t.id]&&this.avatars[t.id].destroy();let e=((h=t.avatarConfig)==null?void 0:h.scale)||1,i=((c=t.avatarConfig)==null?void 0:c.height)||0,r=((u=t.avatar)==null?void 0:u.model3DUrl)??sh.model3DUrl,n=new Hr(r,e,i),a=await n.load();return this.viewer.overlays.hasScene("avatars-scene")||this.viewer.overlays.addScene("avatars-scene"),this.viewer.overlays.addMesh(a,"avatars-scene"),this.avatars[t.id]=n,a}async destroyAvatar(t){this.avatars[t.id]&&(this.names[t.id]&&(this.names[t.id].destroy(),this.names[t.id]=null),this.avatars[t.id].destroy(),delete this.avatars[t.id],this.avatars[t.id]=null)}createLaser(t){var r;if(!this.isAttached)return;let e=new es.Vector3(0,0,0);(r=t.avatarConfig)!=null&&r.laserOrigin&&(e=new es.Vector3(t.avatarConfig.laserOrigin.x,t.avatarConfig.laserOrigin.y,t.avatarConfig.laserOrigin.z));let i=this.roomParticipants[t.id].slot;this.lasers[t.id]=new Gr(this.viewer,i,e)}async destroyLaser(t){this.lasers[t.id]&&(this.lasers[t.id].destroy(),delete this.lasers[t.id],this.lasers[t.id]=null)}async createName(t,e){if(this.logger.log("autodesk-viewer component @ createName",t),!t.name.trim().length)return;let i=new THREE.Box3().setFromObject(e),r=new es.Vector3(0,0,0);i.getSize(r);let n=t.slot??this.roomParticipants[t.id].slot,a=i.min.y+r.y*1.25,h=new Ur(t.name,n,a,this.viewer),c=await h.load();e.add(c),this.names[t.id]=h}async createMouse(t){if(!this.isAttached)return;let e=this.roomParticipants[t.id].slot,i=new jr(this.viewer,t.id);this.mouses[t.id]=i,i.load(t.name,e)}async destroyMouse(t){this.mouses[t.id]&&(this.mouses[t.id].destroy(),delete this.mouses[t.id])}moveToAnotherParticipant(t){if(!this.positionInfos[t]||!this.isAttached)return;let{position:e,target:i}=this.positionInfos[t];if(!i||!e)return;let r=new es.Vector3(e.x,e.y,e.z),n=new es.Vector3(i.x,i.y,i.z),a=this.viewer.navigation.getCamera();this.viewer.navigation.setRequestTransition(!0,r,n,a.fov,!0,a.pivot)}sync(){var a,h,c,u,p,d;if(!this.viewer||!this.isAttached)return;let t=(h=(a=this.viewer)==null?void 0:a.navigation)==null?void 0:h.getPosition(),e=(u=(c=this.viewer)==null?void 0:c.navigation)==null?void 0:u.getTarget(),i=(d=(p=this.viewer)==null?void 0:p.navigation)==null?void 0:d.getCamera(),{quaternion:r}=i;if(this.lastSyncedData.position=t,this.lastSyncedData.target=e,this.lastSyncedData.quaternion=r,this.isPrivate)return;let n=this.participants.find(y=>y.id===this.localParticipantId);if(n!=null&&n.position){let y=Math.abs(n.position.x-t.x)<.1,x=Math.abs(n.position.y-t.y)<.1,M=Math.abs(n.position.z-t.z)<.1;if(y&&x&&M)return}this.presence3DManager.updatePresence3D({id:this.localParticipantId,...this.lastSyncedData})}};typeof window<"u"&&(window.Presence3D=Yr,window.AutodeskPin=Gs);0&&(module.exports={AutodeskPin,Presence3D});
//# sourceMappingURL=index.cjs.js.map
