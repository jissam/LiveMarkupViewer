{
  "version": 3,
  "sources": ["../../src/web-components/comments/components/content.ts"],
  "sourcesContent": ["import { CSSResultGroup, LitElement, html } from 'lit';\n\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport { ParticipantByGroupApi } from '../../../common/types/participant.types';\nimport { Annotation } from '../../../components/comments/types';\nimport { WebComponentsBase } from '../../base';\nimport { contentStyle } from '../css';\n\nimport { AnnotationFilter, PinMode } from './types';\nimport { CreateElement } from '../../global/decorators/create-element.decorator';\n\nconst WebComponentsBaseElement = WebComponentsBase(LitElement);\nconst styles: CSSResultGroup[] = [WebComponentsBaseElement.styles, contentStyle];\n\n@CreateElement('superviz-comments-content')\nexport class CommentsContent extends WebComponentsBaseElement {\n  static styles = styles;\n\n  declare annotations: Annotation[];\n  declare participantsList: ParticipantByGroupApi[];\n  declare selectedAnnotation: string;\n  declare annotationFilter: AnnotationFilter;\n  private lastCommentId: string;\n\n  static properties = {\n    annotations: { type: Object },\n    selectedAnnotation: { type: String },\n    annotationFilter: { type: String },\n    participantsList: { type: Object },\n  };\n\n  constructor() {\n    super();\n    this.annotations = [];\n    this.participantsList = [];\n  }\n\n  private unselectAnnotation = () => {\n    this.selectedAnnotation = null;\n  };\n\n  private unselectAnnotationEsc = (event?: KeyboardEvent) => {\n    if (event && event?.key !== 'Escape') return;\n    this.selectedAnnotation = null;\n  };\n\n  private selectAnnotation = ({ detail }: CustomEvent) => {\n    const { uuid } = detail;\n\n    if (this.selectedAnnotation === uuid) {\n      this.selectedAnnotation = null;\n      return;\n    }\n\n    this.selectedAnnotation = uuid;\n  };\n\n  updated(changedProperties) {\n    super.updated(changedProperties);\n    this.updateComplete.then(() => {\n      const selectedAnnotation = this.shadowRoot.querySelector(\n        `[uuid='${this.selectedAnnotation}']`,\n      );\n      if (!selectedAnnotation) return;\n\n      const isLastComment = this.lastCommentId === this.selectedAnnotation;\n      const offset = !isLastComment ? -150 : 0;\n\n      const clientRects = selectedAnnotation.getClientRects()[0];\n\n      if (!clientRects) return;\n\n      this.scrollBy(0, clientRects.y + offset);\n\n      // \"Add Comment\" is not yet rendered in screen\n      // so we need an extra scroll to show it\n      if (isLastComment) {\n        setTimeout(() => {\n          this.scrollBy(0, clientRects.y + offset);\n        }, 200);\n      }\n    });\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    window.document.body.addEventListener('select-annotation', this.selectAnnotation);\n    window.document.body.addEventListener('keyup', this.unselectAnnotationEsc);\n    window.document.body.addEventListener('unselect-annotation', this.unselectAnnotation);\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n\n    window.document.body.removeEventListener('select-annotation', this.selectAnnotation);\n    window.document.body.removeEventListener('keyup', this.unselectAnnotationEsc);\n    window.document.body.removeEventListener('unselect-annotation', this.unselectAnnotation);\n  }\n\n  private checkLastAnnotation = (uuid: string): boolean => {\n    const resolvedList = this.annotations.filter((annotation) => annotation.resolved);\n    const unresolvedList = this.annotations.filter((annotation) => !annotation.resolved);\n\n    if (this.annotationFilter === AnnotationFilter.ALL) {\n      return uuid === resolvedList[resolvedList.length - 1]?.uuid;\n    }\n\n    return uuid === unresolvedList[unresolvedList.length - 1]?.uuid;\n  };\n\n  protected render() {\n    return html` ${repeat(\n      this.annotations.filter((annotation) => annotation.comments?.length),\n      (annotation: Annotation) => annotation.uuid,\n      (annotation: Annotation) => html`\n        <superviz-comments-annotation-item\n          annotation=${JSON.stringify(annotation)}\n          selected=\"${this.selectedAnnotation}\"\n          annotationFilter=${this.annotationFilter}\n          uuid=${annotation.uuid}\n          ?resolved=${annotation.resolved}\n          isLastComment=${this.checkLastAnnotation(annotation.uuid)}\n          participantsList=${JSON.stringify(this.participantsList)}\n        >\n        </superviz-comments-annotation-item>\n      `,\n    )}`;\n  }\n}\n"],
  "mappings": "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",
  "names": ["init_define_process_env", "WebComponentsBaseElement", "WebComponentsBase", "s", "styles", "contentStyle", "CommentsContent", "event", "detail", "uuid", "_a", "_b", "resolvedList", "annotation", "unresolvedList", "changedProperties", "selectedAnnotation", "isLastComment", "offset", "clientRects", "x", "c", "__decorateClass", "CreateElement"]
}
