import{h as g}from"./chunk-AY5577XS.js";import"./chunk-UMKOLOIY.js";import{a as c}from"./chunk-XDQDK5AN.js";import"./chunk-RSMB47NK.js";import{a as f}from"./chunk-6U6BYUHV.js";import{a as y}from"./chunk-MLLFZOUT.js";import{a as o,e as v,f as S}from"./chunk-WH4S5YLH.js";import"./chunk-OQBMJDJ3.js";import{b as p,c as d,g as u,i as h}from"./chunk-3ZCZGH34.js";h();var w=y(v),_=[w.styles,g],a=class extends w{constructor(){super();this.focusInput=()=>{var t,e;this.inputElement||(this.inputElement=(e=(t=this.shadowRoot)==null?void 0:t.querySelector("superviz-comments-comment-input"))==null?void 0:e.shadowRoot.querySelector("textarea")),this.inputElement.focus()};this.setInputSide=()=>{let i=this.commentsSide==="right"?320:0,s=this.annotationSides.right+293,r=this.containerSides.right-i;if(s<r){this.horizontalSide="right";return}i=this.commentsSide==="left"?320:0;let l=this.annotationSides.left-293,m=this.containerSides.left+i;if(l>m){this.horizontalSide="left";return}this.horizontalSide=m-l>s-r?"right":"left"};this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:d(p({},t),{position:d(p({},this.originalPosition),{type:"canvas"})})})),this.annotation=null};this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null};this.avatar=()=>{if(this.type==="add"&&!this.showInput)return o`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?o`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:o`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`};this.input=()=>{if(!(!this.showInput||this.annotationSent))return o`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`};this.position={x:0,y:0},setTimeout(()=>{this.firstLoad=!1},800)}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var e;super.firstUpdated(t),f.call(this,["comments"]),this.showInput&&(this.originalPosition=p({},this.position),this.pinAnnotation=(e=this.shadowRoot)==null?void 0:e.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){if(super.connectedCallback(),this.type!=="add")return;let{localParticipant:t}=this.useStore("global-store");t.subscribe(e=>{var n;this.localAvatar=(n=e==null?void 0:e.avatar)==null?void 0:n.imageUrl,this.localName=e==null?void 0:e.name}),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",e=>{e.key==="Escape"&&this.cancelTemporaryAnnotationEsc(e)})}disconnectedCallback(){super.disconnectedCallback(),this.type==="add"&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,e,n,i;return((i=(n=(e=(t=this.annotation)==null?void 0:t.comments)==null?void 0:e.at(0))==null?void 0:n.participant)==null?void 0:i.avatar)||this.localAvatar}get userInitial(){var e,n,i,s,r;return(((r=(s=(i=(n=(e=this.annotation)==null?void 0:e.comments)==null?void 0:n.at(0))==null?void 0:i.participant)==null?void 0:s.name)!=null?r:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:(t=this.annotation)==null?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:this.firstLoad===void 0,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":this.type==="add"&&!this.showInput,"comments__annotation-pin--add":this.type==="add"&&this.showInput,[this.horizontalSide]:!0},e={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},n=this.keepPositionRatio?"%":"px",i=`top: ${this.position.y}${n}; left: ${this.position.x}${n};`;return this.type==="add"?o`
        <div class=${c(t)} style=${i}>${this.avatar()} ${this.input()}</div>
      `:o`<div class=${c(e)} style=${i}>
      <div @click=${this.emitClick} class=${c(t)}>${this.avatar()}</div>
    </div> `}};a.styles=_,a.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},a=u([S("superviz-comments-annotation-pin")],a);export{a as CommentsAnnotationPin};
//# sourceMappingURL=annotation-pin-4IOE4CUH.js.map
