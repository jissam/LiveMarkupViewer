import{a as jt,b as Vt,c as Ht,d as Le,e as Vi,f as Hi,g as zt,h as Xr,i as zi,j as rt,k as $i,l as nn,m as ie,n as on}from"./chunks/chunk-HLDC3GQS.js";import{a as Zi,b as sn}from"./chunks/chunk-3ONINIVE.js";import{a as $t}from"./chunks/chunk-UMKOLOIY.js";import{a as it,b as O,c as ee,d as Qr,e as en,f as tn,g as nt,h as rn,i as K}from"./chunks/chunk-OQBMJDJ3.js";import{b as y,c as R,d as ji,e as X,f as he,h as M,i as m,j as E}from"./chunks/chunk-3ZCZGH34.js";var cn=X((nu,an)=>{m();var Be=1e3,Ue=Be*60,Ge=Ue*60,Re=Ge*24,mo=Re*7,fo=Re*365.25;an.exports=function(r,t){t=t||{};var e=typeof r;if(e==="string"&&r.length>0)return go(r);if(e==="number"&&isFinite(r))return t.long?bo(r):vo(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function go(r){if(r=String(r),!(r.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(t){var e=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return e*fo;case"weeks":case"week":case"w":return e*mo;case"days":case"day":case"d":return e*Re;case"hours":case"hour":case"hrs":case"hr":case"h":return e*Ge;case"minutes":case"minute":case"mins":case"min":case"m":return e*Ue;case"seconds":case"second":case"secs":case"sec":case"s":return e*Be;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function vo(r){var t=Math.abs(r);return t>=Re?Math.round(r/Re)+"d":t>=Ge?Math.round(r/Ge)+"h":t>=Ue?Math.round(r/Ue)+"m":t>=Be?Math.round(r/Be)+"s":r+"ms"}function bo(r){var t=Math.abs(r);return t>=Re?Zt(r,t,Re,"day"):t>=Ge?Zt(r,t,Ge,"hour"):t>=Ue?Zt(r,t,Ue,"minute"):t>=Be?Zt(r,t,Be,"second"):r+" ms"}function Zt(r,t,e,i){var n=t>=e*1.5;return Math.round(r/e)+" "+i+(n?"s":"")}});var un=X((ou,ln)=>{m();function yo(r){e.debug=e,e.default=e,e.coerce=c,e.disable=s,e.enable=n,e.enabled=a,e.humanize=cn(),e.destroy=l,Object.keys(r).forEach(u=>{e[u]=r[u]}),e.names=[],e.skips=[],e.formatters={};function t(u){let p=0;for(let d=0;d<u.length;d++)p=(p<<5)-p+u.charCodeAt(d),p|=0;return e.colors[Math.abs(p)%e.colors.length]}e.selectColor=t;function e(u){let p,d=null,h,f;function v(...S){if(!v.enabled)return;let w=v,j=Number(new Date),V=j-(p||j);w.diff=V,w.prev=p,w.curr=j,p=j,S[0]=e.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let H=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(D,G)=>{if(D==="%%")return"%";H++;let $=e.formatters[G];if(typeof $=="function"){let Z=S[H];D=$.call(w,Z),S.splice(H,1),H--}return D}),e.formatArgs.call(w,S),(w.log||e.log).apply(w,S)}return v.namespace=u,v.useColors=e.useColors(),v.color=e.selectColor(u),v.extend=i,v.destroy=e.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==e.namespaces&&(h=e.namespaces,f=e.enabled(u)),f),set:S=>{d=S}}),typeof e.init=="function"&&e.init(v),v}function i(u,p){let d=e(this.namespace+(typeof p=="undefined"?":":p)+u);return d.log=this.log,d}function n(u){e.save(u),e.namespaces=u,e.names=[],e.skips=[];let p,d=(typeof u=="string"?u:"").split(/[\s,]+/),h=d.length;for(p=0;p<h;p++)d[p]&&(u=d[p].replace(/\*/g,".*?"),u[0]==="-"?e.skips.push(new RegExp("^"+u.slice(1)+"$")):e.names.push(new RegExp("^"+u+"$")))}function s(){let u=[...e.names.map(o),...e.skips.map(o).map(p=>"-"+p)].join(",");return e.enable(""),u}function a(u){if(u[u.length-1]==="*")return!0;let p,d;for(p=0,d=e.skips.length;p<d;p++)if(e.skips[p].test(u))return!1;for(p=0,d=e.names.length;p<d;p++)if(e.names[p].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}ln.exports=yo});var Ji=X((ne,Jt)=>{m();ne.formatArgs=Po;ne.save=Co;ne.load=wo;ne.useColors=Eo;ne.storage=To();ne.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ne.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Eo(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Po(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Jt.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;r.splice(1,0,t,"color: inherit");let e=0,i=0;r[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(e++,n==="%c"&&(i=e))}),r.splice(i,0,t)}ne.log=console.debug||console.log||(()=>{});function Co(r){try{r?ne.storage.setItem("debug",r):ne.storage.removeItem("debug")}catch(t){}}function wo(){let r;try{r=ne.storage.getItem("debug")}catch(t){}return!r&&typeof process!="undefined"&&"env"in process&&(r=E.DEBUG),r}function To(){try{return localStorage}catch(r){}}Jt.exports=un()(ne);var{formatters:_o}=Jt.exports;_o.j=function(r){try{return JSON.stringify(r)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var qt=X((bu,pn)=>{m();function Ao(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}pn.exports=Ao});var mn=X((Eu,hn)=>{m();var Oo=typeof window=="object"&&window&&window.Object===Object&&window;hn.exports=Oo});var Ki=X((Cu,fn)=>{m();var So=mn(),Mo=typeof self=="object"&&self&&self.Object===Object&&self,Lo=So||Mo||Function("return this")();fn.exports=Lo});var vn=X((Tu,gn)=>{m();var Ro=Ki(),ko=function(){return Ro.Date.now()};gn.exports=ko});var yn=X((Au,bn)=>{m();var Io=/\s/;function xo(r){for(var t=r.length;t--&&Io.test(r.charAt(t)););return t}bn.exports=xo});var Pn=X((Su,En)=>{m();var No=yn(),Fo=/^\s+/;function Do(r){return r&&r.slice(0,No(r)+1).replace(Fo,"")}En.exports=Do});var Yi=X((Lu,Cn)=>{m();var Bo=Ki(),Uo=Bo.Symbol;Cn.exports=Uo});var An=X((ku,_n)=>{m();var wn=Yi(),Tn=Object.prototype,Go=Tn.hasOwnProperty,Wo=Tn.toString,st=wn?wn.toStringTag:void 0;function jo(r){var t=Go.call(r,st),e=r[st];try{r[st]=void 0;var i=!0}catch(s){}var n=Wo.call(r);return i&&(t?r[st]=e:delete r[st]),n}_n.exports=jo});var Sn=X((xu,On)=>{m();var Vo=Object.prototype,Ho=Vo.toString;function zo(r){return Ho.call(r)}On.exports=zo});var kn=X((Fu,Rn)=>{m();var Mn=Yi(),$o=An(),Zo=Sn(),Jo="[object Null]",qo="[object Undefined]",Ln=Mn?Mn.toStringTag:void 0;function Ko(r){return r==null?r===void 0?qo:Jo:Ln&&Ln in Object(r)?$o(r):Zo(r)}Rn.exports=Ko});var xn=X((Bu,In)=>{m();function Yo(r){return r!=null&&typeof r=="object"}In.exports=Yo});var Fn=X((Gu,Nn)=>{m();var Xo=kn(),Qo=xn(),ea="[object Symbol]";function ta(r){return typeof r=="symbol"||Qo(r)&&Xo(r)==ea}Nn.exports=ta});var Gn=X((ju,Un)=>{m();var ia=Pn(),Dn=qt(),ra=Fn(),Bn=NaN,na=/^[-+]0x[0-9a-f]+$/i,sa=/^0b[01]+$/i,oa=/^0o[0-7]+$/i,aa=parseInt;function ca(r){if(typeof r=="number")return r;if(ra(r))return Bn;if(Dn(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=Dn(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=ia(r);var e=sa.test(r);return e||oa.test(r)?aa(r.slice(2),e?2:8):na.test(r)?Bn:+r}Un.exports=ca});var Vn=X((Hu,jn)=>{m();var la=qt(),Xi=vn(),Wn=Gn(),ua="Expected a function",da=Math.max,pa=Math.min;function ha(r,t,e){var i,n,s,a,o,c,l=0,u=!1,p=!1,d=!0;if(typeof r!="function")throw new TypeError(ua);t=Wn(t)||0,la(e)&&(u=!!e.leading,p="maxWait"in e,s=p?da(Wn(e.maxWait)||0,t):s,d="trailing"in e?!!e.trailing:d);function h(D){var G=i,$=n;return i=n=void 0,l=D,a=r.apply($,G),a}function f(D){return l=D,o=setTimeout(w,t),u?h(D):a}function v(D){var G=D-c,$=D-l,Z=t-G;return p?pa(Z,s-$):Z}function S(D){var G=D-c,$=D-l;return c===void 0||G>=t||G<0||p&&$>=s}function w(){var D=Xi();if(S(D))return j(D);o=setTimeout(w,v(D))}function j(D){return o=void 0,d&&i?h(D):(i=n=void 0,a)}function V(){o!==void 0&&clearTimeout(o),l=0,i=c=n=o=void 0}function H(){return o===void 0?a:j(Xi())}function q(){var D=Xi(),G=S(D);if(i=arguments,n=this,c=D,G){if(o===void 0)return f(c);if(p)return clearTimeout(o),o=setTimeout(w,t),h(c)}return o===void 0&&(o=setTimeout(w,t)),a}return q.cancel=V,q.flush=H,q}jn.exports=ha});var Qi=X(($u,Hn)=>{m();var ma=Vn(),fa=qt(),ga="Expected a function";function va(r,t,e){var i=!0,n=!0;if(typeof r!="function")throw new TypeError(ga);return fa(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),ma(r,t,{leading:i,maxWait:t,trailing:n})}Hn.exports=va});var co=X((It,jr)=>{m();(function(r,t){typeof It=="object"&&typeof jr=="object"?jr.exports=t():typeof define=="function"&&define.amd?define([],t):typeof It=="object"?It.bowser=t():r.bowser=t()})(It,function(){return function(r){var t={};function e(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return r[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=r,e.c=t,e.d=function(i,n,s){e.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:s})},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,n){if(1&n&&(i=e(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var a in i)e.d(s,a,function(o){return i[o]}.bind(null,a));return s},e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,"a",n),n},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.p="",e(e.s=90)}({17:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i=e(18),n=function(){function s(){}return s.getFirstMatch=function(a,o){var c=o.match(a);return c&&c.length>0&&c[1]||""},s.getSecondMatch=function(a,o){var c=o.match(a);return c&&c.length>1&&c[2]||""},s.matchAndReturnConst=function(a,o,c){if(a.test(o))return c},s.getWindowsVersionName=function(a){switch(a){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},s.getMacOSVersionName=function(a){var o=a.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),o[0]===10)switch(o[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},s.getAndroidVersionName=function(a){var o=a.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),!(o[0]===1&&o[1]<5))return o[0]===1&&o[1]<6?"Cupcake":o[0]===1&&o[1]>=6?"Donut":o[0]===2&&o[1]<2?"Eclair":o[0]===2&&o[1]===2?"Froyo":o[0]===2&&o[1]>2?"Gingerbread":o[0]===3?"Honeycomb":o[0]===4&&o[1]<1?"Ice Cream Sandwich":o[0]===4&&o[1]<4?"Jelly Bean":o[0]===4&&o[1]>=4?"KitKat":o[0]===5?"Lollipop":o[0]===6?"Marshmallow":o[0]===7?"Nougat":o[0]===8?"Oreo":o[0]===9?"Pie":void 0},s.getVersionPrecision=function(a){return a.split(".").length},s.compareVersions=function(a,o,c){c===void 0&&(c=!1);var l=s.getVersionPrecision(a),u=s.getVersionPrecision(o),p=Math.max(l,u),d=0,h=s.map([a,o],function(f){var v=p-s.getVersionPrecision(f),S=f+new Array(v+1).join(".0");return s.map(S.split("."),function(w){return new Array(20-w.length).join("0")+w}).reverse()});for(c&&(d=p-Math.min(l,u)),p-=1;p>=d;){if(h[0][p]>h[1][p])return 1;if(h[0][p]===h[1][p]){if(p===d)return 0;p-=1}else if(h[0][p]<h[1][p])return-1}},s.map=function(a,o){var c,l=[];if(Array.prototype.map)return Array.prototype.map.call(a,o);for(c=0;c<a.length;c+=1)l.push(o(a[c]));return l},s.find=function(a,o){var c,l;if(Array.prototype.find)return Array.prototype.find.call(a,o);for(c=0,l=a.length;c<l;c+=1){var u=a[c];if(o(u,c))return u}},s.assign=function(a){for(var o,c,l=a,u=arguments.length,p=new Array(u>1?u-1:0),d=1;d<u;d++)p[d-1]=arguments[d];if(Object.assign)return Object.assign.apply(Object,[a].concat(p));var h=function(){var f=p[o];typeof f=="object"&&f!==null&&Object.keys(f).forEach(function(v){l[v]=f[v]})};for(o=0,c=p.length;o<c;o+=1)h();return a},s.getBrowserAlias=function(a){return i.BROWSER_ALIASES_MAP[a]},s.getBrowserTypeByAlias=function(a){return i.BROWSER_MAP[a]||""},s}();t.default=n,r.exports=t.default},18:function(r,t,e){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=e(91))&&i.__esModule?i:{default:i},s=e(18);function a(c,l){for(var u=0;u<l.length;u++){var p=l[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(c,p.key,p)}}var o=function(){function c(){}var l,u,p;return c.getParser=function(d,h){if(h===void 0&&(h=!1),typeof d!="string")throw new Error("UserAgent should be a string");return new n.default(d,h)},c.parse=function(d){return new n.default(d).getResult()},l=c,p=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],(u=null)&&a(l.prototype,u),p&&a(l,p),c}();t.default=o,r.exports=t.default},91:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i=c(e(92)),n=c(e(93)),s=c(e(94)),a=c(e(95)),o=c(e(17));function c(u){return u&&u.__esModule?u:{default:u}}var l=function(){function u(d,h){if(h===void 0&&(h=!1),d==null||d==="")throw new Error("UserAgent parameter can't be empty");this._ua=d,this.parsedResult={},h!==!0&&this.parse()}var p=u.prototype;return p.getUA=function(){return this._ua},p.test=function(d){return d.test(this._ua)},p.parseBrowser=function(){var d=this;this.parsedResult.browser={};var h=o.default.find(i.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.browser=h.describe(this.getUA())),this.parsedResult.browser},p.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},p.getBrowserName=function(d){return d?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},p.getBrowserVersion=function(){return this.getBrowser().version},p.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},p.parseOS=function(){var d=this;this.parsedResult.os={};var h=o.default.find(n.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.os=h.describe(this.getUA())),this.parsedResult.os},p.getOSName=function(d){var h=this.getOS().name;return d?String(h).toLowerCase()||"":h||""},p.getOSVersion=function(){return this.getOS().version},p.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},p.getPlatformType=function(d){d===void 0&&(d=!1);var h=this.getPlatform().type;return d?String(h).toLowerCase()||"":h||""},p.parsePlatform=function(){var d=this;this.parsedResult.platform={};var h=o.default.find(s.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.platform=h.describe(this.getUA())),this.parsedResult.platform},p.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},p.getEngineName=function(d){return d?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},p.parseEngine=function(){var d=this;this.parsedResult.engine={};var h=o.default.find(a.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.engine=h.describe(this.getUA())),this.parsedResult.engine},p.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},p.getResult=function(){return o.default.assign({},this.parsedResult)},p.satisfies=function(d){var h=this,f={},v=0,S={},w=0;if(Object.keys(d).forEach(function(Z){var se=d[Z];typeof se=="string"?(S[Z]=se,w+=1):typeof se=="object"&&(f[Z]=se,v+=1)}),v>0){var j=Object.keys(f),V=o.default.find(j,function(Z){return h.isOS(Z)});if(V){var H=this.satisfies(f[V]);if(H!==void 0)return H}var q=o.default.find(j,function(Z){return h.isPlatform(Z)});if(q){var D=this.satisfies(f[q]);if(D!==void 0)return D}}if(w>0){var G=Object.keys(S),$=o.default.find(G,function(Z){return h.isBrowser(Z,!0)});if($!==void 0)return this.compareVersion(S[$])}},p.isBrowser=function(d,h){h===void 0&&(h=!1);var f=this.getBrowserName().toLowerCase(),v=d.toLowerCase(),S=o.default.getBrowserTypeByAlias(v);return h&&S&&(v=S.toLowerCase()),v===f},p.compareVersion=function(d){var h=[0],f=d,v=!1,S=this.getBrowserVersion();if(typeof S=="string")return d[0]===">"||d[0]==="<"?(f=d.substr(1),d[1]==="="?(v=!0,f=d.substr(2)):h=[],d[0]===">"?h.push(1):h.push(-1)):d[0]==="="?f=d.substr(1):d[0]==="~"&&(v=!0,f=d.substr(1)),h.indexOf(o.default.compareVersions(S,f,v))>-1},p.isOS=function(d){return this.getOSName(!0)===String(d).toLowerCase()},p.isPlatform=function(d){return this.getPlatformType(!0)===String(d).toLowerCase()},p.isEngine=function(d){return this.getEngineName(!0)===String(d).toLowerCase()},p.is=function(d,h){return h===void 0&&(h=!1),this.isBrowser(d,h)||this.isOS(d)||this.isPlatform(d)},p.some=function(d){var h=this;return d===void 0&&(d=[]),d.some(function(f){return h.is(f)})},u}();t.default=l,r.exports=t.default},92:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=e(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(o){var c={name:"Googlebot"},l=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/opera/i],describe:function(o){var c={name:"Opera"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/opr\/|opios/i],describe:function(o){var c={name:"Opera"},l=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/SamsungBrowser/i],describe:function(o){var c={name:"Samsung Internet for Android"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/Whale/i],describe:function(o){var c={name:"NAVER Whale Browser"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/MZBrowser/i],describe:function(o){var c={name:"MZ Browser"},l=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/focus/i],describe:function(o){var c={name:"Focus"},l=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/swing/i],describe:function(o){var c={name:"Swing"},l=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/coast/i],describe:function(o){var c={name:"Opera Coast"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(o){var c={name:"Opera Touch"},l=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/yabrowser/i],describe:function(o){var c={name:"Yandex Browser"},l=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/ucbrowser/i],describe:function(o){var c={name:"UC Browser"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/Maxthon|mxios/i],describe:function(o){var c={name:"Maxthon"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/epiphany/i],describe:function(o){var c={name:"Epiphany"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/puffin/i],describe:function(o){var c={name:"Puffin"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/sleipnir/i],describe:function(o){var c={name:"Sleipnir"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/k-meleon/i],describe:function(o){var c={name:"K-Meleon"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/micromessenger/i],describe:function(o){var c={name:"WeChat"},l=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/qqbrowser/i],describe:function(o){var c={name:/qqbrowserlite/i.test(o)?"QQ Browser Lite":"QQ Browser"},l=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/msie|trident/i],describe:function(o){var c={name:"Internet Explorer"},l=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/\sedg\//i],describe:function(o){var c={name:"Microsoft Edge"},l=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/edg([ea]|ios)/i],describe:function(o){var c={name:"Microsoft Edge"},l=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/vivaldi/i],describe:function(o){var c={name:"Vivaldi"},l=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/seamonkey/i],describe:function(o){var c={name:"SeaMonkey"},l=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/sailfish/i],describe:function(o){var c={name:"Sailfish"},l=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,o);return l&&(c.version=l),c}},{test:[/silk/i],describe:function(o){var c={name:"Amazon Silk"},l=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/phantom/i],describe:function(o){var c={name:"PhantomJS"},l=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/slimerjs/i],describe:function(o){var c={name:"SlimerJS"},l=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c={name:"BlackBerry"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c={name:"WebOS Browser"},l=n.default.getFirstMatch(s,o)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/bada/i],describe:function(o){var c={name:"Bada"},l=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/tizen/i],describe:function(o){var c={name:"Tizen"},l=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/qupzilla/i],describe:function(o){var c={name:"QupZilla"},l=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/firefox|iceweasel|fxios/i],describe:function(o){var c={name:"Firefox"},l=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/electron/i],describe:function(o){var c={name:"Electron"},l=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/MiuiBrowser/i],describe:function(o){var c={name:"Miui"},l=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/chromium/i],describe:function(o){var c={name:"Chromium"},l=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,o)||n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/chrome|crios|crmo/i],describe:function(o){var c={name:"Chrome"},l=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/GSA/i],describe:function(o){var c={name:"Google Search"},l=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:function(o){var c=!o.test(/like android/i),l=o.test(/android/i);return c&&l},describe:function(o){var c={name:"Android Browser"},l=n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/playstation 4/i],describe:function(o){var c={name:"PlayStation 4"},l=n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/safari|applewebkit/i],describe:function(o){var c={name:"Safari"},l=n.default.getFirstMatch(s,o);return l&&(c.version=l),c}},{test:[/.*/i],describe:function(o){var c=o.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(c,o),version:n.default.getSecondMatch(c,o)}}}];t.default=a,r.exports=t.default},93:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=e(17))&&i.__esModule?i:{default:i},s=e(18),a=[{test:[/Roku\/DVP/],describe:function(o){var c=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,o);return{name:s.OS_MAP.Roku,version:c}}},{test:[/windows phone/i],describe:function(o){var c=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,o);return{name:s.OS_MAP.WindowsPhone,version:c}}},{test:[/windows /i],describe:function(o){var c=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,o),l=n.default.getWindowsVersionName(c);return{name:s.OS_MAP.Windows,version:c,versionName:l}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(o){var c={name:s.OS_MAP.iOS},l=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,o);return l&&(c.version=l),c}},{test:[/macintosh/i],describe:function(o){var c=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,o).replace(/[_\s]/g,"."),l=n.default.getMacOSVersionName(c),u={name:s.OS_MAP.MacOS,version:c};return l&&(u.versionName=l),u}},{test:[/(ipod|iphone|ipad)/i],describe:function(o){var c=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,o).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:c}}},{test:function(o){var c=!o.test(/like android/i),l=o.test(/android/i);return c&&l},describe:function(o){var c=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,o),l=n.default.getAndroidVersionName(c),u={name:s.OS_MAP.Android,version:c};return l&&(u.versionName=l),u}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,o),l={name:s.OS_MAP.WebOS};return c&&c.length&&(l.version=c),l}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,o)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,o)||n.default.getFirstMatch(/\bbb(\d+)/i,o);return{name:s.OS_MAP.BlackBerry,version:c}}},{test:[/bada/i],describe:function(o){var c=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,o);return{name:s.OS_MAP.Bada,version:c}}},{test:[/tizen/i],describe:function(o){var c=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,o);return{name:s.OS_MAP.Tizen,version:c}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(o){var c=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,o);return{name:s.OS_MAP.PlayStation4,version:c}}}];t.default=a,r.exports=t.default},94:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=e(17))&&i.__esModule?i:{default:i},s=e(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(o){var c=n.default.getFirstMatch(/(can-l01)/i,o)&&"Nova",l={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return c&&(l.model=c),l}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(o){var c=o.test(/ipod|iphone/i),l=o.test(/like (ipod|iphone)/i);return c&&!l},describe:function(o){var c=n.default.getFirstMatch(/(ipod|iphone)/i,o);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:c}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName(!0)==="blackberry"},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(o){return o.getBrowserName(!0)==="bada"},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName()==="windows phone"},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(o){var c=Number(String(o.getOSVersion()).split(".")[0]);return o.getOSName(!0)==="android"&&c>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(o){return o.getOSName(!0)==="android"},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getOSName(!0)==="macos"},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(o){return o.getOSName(!0)==="windows"},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="linux"},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="playstation 4"},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(o){return o.getOSName(!0)==="roku"},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=a,r.exports=t.default},95:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=e(17))&&i.__esModule?i:{default:i},s=e(18),a=[{test:function(o){return o.getBrowserName(!0)==="microsoft edge"},describe:function(o){if(/\sedg\//i.test(o))return{name:s.ENGINE_MAP.Blink};var c=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,o);return{name:s.ENGINE_MAP.EdgeHTML,version:c}}},{test:[/trident/i],describe:function(o){var c={name:s.ENGINE_MAP.Trident},l=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:function(o){return o.test(/presto/i)},describe:function(o){var c={name:s.ENGINE_MAP.Presto},l=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:function(o){var c=o.test(/gecko/i),l=o.test(/like gecko/i);return c&&!l},describe:function(o){var c={name:s.ENGINE_MAP.Gecko},l=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(o){var c={name:s.ENGINE_MAP.WebKit},l=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,o);return l&&(c.version=l),c}}];t.default=a,r.exports=t.default}})})});m();m();var Gr=he(Ji());m();var qi=(w=>(w.svPrimary="sv-primary",w.svPrimary900="sv-primary-900",w.svPrimary200="sv-primary-200",w.svSecondary="sv-secondary",w.svGray="sv-gray",w.svSuccess="sv-success",w.svDanger="sv-danger",w.svBlack="sv-black",w.svWhite="sv-white",w.svGray100="sv-gray-100",w.svGray200="sv-gray-200",w.svGray300="sv-gray-300",w.svGray400="sv-gray-400",w.svGray500="sv-gray-500",w.svGray600="sv-gray-600",w.svGray700="sv-gray-700",w.svGray800="sv-gray-800",w))(qi||{});m();m();m();m();var J=(n,s,a,...o)=>M(void 0,[n,s,a,...o],function*(r,t,e,i={}){let c=yield fetch(r,{method:t,headers:y({"Content-Type":"application/json"},i),body:e?JSON.stringify(e):null});if(!c.ok)throw c;try{return yield c.json()}catch(l){return c.ok}});m();var dn=he(Ji()),F=class{constructor(t){this.debug=(0,dn.default)(t)}log(t,...e){this.debug(t,...e)}};m();m();var zn=he(Qi());var W=class{constructor(t={}){this.subscribe=t=>{this.callbacks.push(t)};this.unsubscribe=t=>{this.callbacks=this.callbacks.filter(e=>e!==t)};this.publish=(...t)=>{this.callbacks&&this.callbacks.forEach(e=>{this.callListener(e,t).catch(i=>{var n;(n=this.logger)==null||n.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${e.name}
            Event: ${JSON.stringify(t)}
            Error: ${i}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(t,e)=>new Promise((i,n)=>{try{let s=t(...e);i(s)}catch(s){n(s)}});let{logger:e,throttleTime:i}=t;this.logger=e||new F("@superviz/sdk/observer-helper"),this.throttle=i,this.callbacks=[],this.throttle&&(this.publish=(0,zn.default)(this.publish,this.throttle))}};var ye=class{constructor(){this.observers={};this.subscribe=(t,e)=>{this.logger.log(`subscribed to ${t} event`),this.observers[t]||(this.observers[t]=new W({logger:this.logger})),this.observers[t].subscribe(e)};this.unsubscribe=(t,e)=>{if(this.logger.log(`unsubscribed from ${t} event`),!!this.observers[t]){if(!e){this.observers[t].destroy(),delete this.observers[t];return}this.observers[t].unsubscribe(e)}};this.publish=(t,e)=>{t in this.observers&&this.observers[t].publish(e)}}};m();var z=class{static createUrl(t,e,i={}){let n=new URL(e,t);return Object.keys(i).forEach(s=>n.searchParams.append(s,i[s])),n.toString()}static validateApiKey(t,e){let n=this.createUrl(t,"/user/checkapikey");return J(n,"POST",{apiKey:e})}static fetchConfig(t,e){let n=this.createUrl(t,"/immersive-config");return J(n,"POST",{apiKey:e})}static fetchLimits(t,e){return M(this,null,function*(){let n=this.createUrl(t,"/user/check_limits_v2");return(yield J(n,"GET","",{apikey:e})).limits})}static fetchWaterMark(t,e){return M(this,null,function*(){let n=this.createUrl(t,"/user/watermark"),{message:s}=yield J(n,"POST",{apiKey:e});return s})}static createAnnotations(t,e,i){return M(this,null,function*(){let s=this.createUrl(t,"/annotations");return J(s,"POST",y({},i),{apikey:e})})}static updateComment(t,e,i,n){return M(this,null,function*(){let s=`/comments/${i}`,a=this.createUrl(t,s);return J(a,"PUT",{text:n},{apikey:e})})}static createComment(t,e,i){return M(this,null,function*(){let s=this.createUrl(t,"/comments");return J(s,"POST",y({},i),{apikey:e})})}static fetchAnnotation(t,e,i){return M(this,null,function*(){let s=this.createUrl(t,"/annotations",{roomId:i.roomId,url:i.url});return J(s,"GET",void 0,{apikey:e})})}static resolveAnnotation(t,e,i){return M(this,null,function*(){let n=`/annotations/resolve/${i}`,s=this.createUrl(t,n);return J(s,"POST",{},{apikey:e})})}static deleteComment(t,e,i){return M(this,null,function*(){let n=`/comments/${i}`,s=this.createUrl(t,n);return J(s,"DELETE",{},{apikey:e})})}static deleteAnnotation(t,e,i){return M(this,null,function*(){let n=`/annotations/${i}`,s=this.createUrl(t,n);return J(s,"DELETE",{},{apikey:e})})}static createParticipant(t){return M(this,null,function*(){let e=O.get("apiUrl"),n=this.createUrl(e,"/participants");return J(n,"POST",y({},t),{apikey:O.get("apiKey")})})}static fetchParticipant(t){return M(this,null,function*(){let e=O.get("apiUrl"),i=`/participants/${t}`,n=this.createUrl(e,i);return J(n,"GET",void 0,{apikey:O.get("apiKey")})})}static sendActivity(t,e,i,n){return M(this,null,function*(){let s="/activity",a=O.get("apiUrl"),o=O.get("roomId"),c=O.get("apiKey"),l=this.createUrl(a,s);return J(l,"POST",{groupId:e,groupName:i,meetingId:o,product:n,userId:t},{apikey:c})})}static fetchParticipantsByGroup(t){return M(this,null,function*(){let e=`/groups/participants/${t}`,i=O.get("apiUrl"),n=this.createUrl(i,e,{take:1e4});return J(n,"GET",void 0,{apikey:O.get("apiKey")})})}static createMentions(t){return M(this,null,function*(){let e="/mentions",i=O.get("apiUrl"),n=this.createUrl(i,e);return J(n,"POST",t,{apikey:O.get("apiKey")})})}};m();function ba(r,t){return M(this,null,function*(){try{return(yield z.validateApiKey(r,t))===!0}catch(e){if(e.status===404)return!1;throw new Error("Unable to validate API key")}})}var $n=ba;m();var ke=class{static getRemoteConfig(){return M(this,arguments,function*(t="prod"){let{version:e}=yield import("./chunks/.version-YP4EHPN3.js");if(t==="local")return(yield import("./chunks/.remote-config-MNGYO4D2.js")).default.remoteConfig;let i={version:e,environment:t},n=this.createUrl(i);return J(n,"GET",null)})}static getFeatures(t){return M(this,null,function*(){return J(`${this.REMOTE_CONFIG_BASE_URL}/features/${t}`,"GET",void 0)})}static createUrl({version:t,environment:e}){return`${this.REMOTE_CONFIG_BASE_URL}/sdk/${t}?env=${e}`}};ke.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com";m();m();var Ea=Object.create,Ei=Object.defineProperty,Pa=Object.defineProperties,Ca=Object.getOwnPropertyDescriptor,wa=Object.getOwnPropertyDescriptors,Ta=Object.getOwnPropertyNames,Zn=Object.getOwnPropertySymbols,_a=Object.getPrototypeOf,ps=Object.prototype.hasOwnProperty,Aa=Object.prototype.propertyIsEnumerable,Jn=(r,t,e)=>t in r?Ei(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,g=(r,t)=>{for(var e in t||(t={}))ps.call(t,e)&&Jn(r,e,t[e]);if(Zn)for(var e of Zn(t))Aa.call(t,e)&&Jn(r,e,t[e]);return r},k=(r,t)=>Pa(r,wa(t)),Oa=(r,t)=>()=>(r&&(t=r(r=0)),t),Ar=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Sa=(r,t)=>{for(var e in t)Ei(r,e,{get:t[e],enumerable:!0})},Ma=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ta(t))!ps.call(r,n)&&n!==e&&Ei(r,n,{get:()=>t[n],enumerable:!(i=Ca(t,n))||i.enumerable});return r},La=(r,t,e)=>(e=r!=null?Ea(_a(r)):{},Ma(t||!r||!r.__esModule?Ei(e,"default",{value:r,enumerable:!0}):e,r)),Pe=(r,t,e)=>new Promise((i,n)=>{var s=c=>{try{o(e.next(c))}catch(l){n(l)}},a=c=>{try{o(e.throw(c))}catch(l){n(l)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);o((e=e.apply(r,t)).next())}),hs,T=Oa(()=>{hs={}}),Ra=Ar((r,t)=>{T();var e=1e3,i=e*60,n=i*60,s=n*24,a=s*7,o=s*365.25;t.exports=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return c(d);if(f==="number"&&isFinite(d))return h.long?u(d):l(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function c(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),v=(h[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return f*o;case"weeks":case"week":case"w":return f*a;case"days":case"day":case"d":return f*s;case"hours":case"hour":case"hrs":case"hr":case"h":return f*n;case"minutes":case"minute":case"mins":case"min":case"m":return f*i;case"seconds":case"second":case"secs":case"sec":case"s":return f*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function l(d){var h=Math.abs(d);return h>=s?Math.round(d/s)+"d":h>=n?Math.round(d/n)+"h":h>=i?Math.round(d/i)+"m":h>=e?Math.round(d/e)+"s":d+"ms"}function u(d){var h=Math.abs(d);return h>=s?p(d,h,s,"day"):h>=n?p(d,h,n,"hour"):h>=i?p(d,h,i,"minute"):h>=e?p(d,h,e,"second"):d+" ms"}function p(d,h,f,v){var S=h>=f*1.5;return Math.round(d/f)+" "+v+(S?"s":"")}}),ka=Ar((r,t)=>{T();function e(i){s.debug=s,s.default=s,s.coerce=p,s.disable=c,s.enable=o,s.enabled=l,s.humanize=Ra(),s.destroy=d,Object.keys(i).forEach(h=>{s[h]=i[h]}),s.names=[],s.skips=[],s.formatters={};function n(h){let f=0;for(let v=0;v<h.length;v++)f=(f<<5)-f+h.charCodeAt(v),f|=0;return s.colors[Math.abs(f)%s.colors.length]}s.selectColor=n;function s(h){let f,v=null,S,w;function j(...V){if(!j.enabled)return;let H=j,q=Number(new Date),D=q-(f||q);H.diff=D,H.prev=f,H.curr=q,f=q,V[0]=s.coerce(V[0]),typeof V[0]!="string"&&V.unshift("%O");let G=0;V[0]=V[0].replace(/%([a-zA-Z%])/g,($,Z)=>{if($==="%%")return"%";G++;let se=s.formatters[Z];if(typeof se=="function"){let we=V[G];$=se.call(H,we),V.splice(G,1),G--}return $}),s.formatArgs.call(H,V),(H.log||s.log).apply(H,V)}return j.namespace=h,j.useColors=s.useColors(),j.color=s.selectColor(h),j.extend=a,j.destroy=s.destroy,Object.defineProperty(j,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(S!==s.namespaces&&(S=s.namespaces,w=s.enabled(h)),w),set:V=>{v=V}}),typeof s.init=="function"&&s.init(j),j}function a(h,f){let v=s(this.namespace+(typeof f=="undefined"?":":f)+h);return v.log=this.log,v}function o(h){s.save(h),s.namespaces=h,s.names=[],s.skips=[];let f,v=(typeof h=="string"?h:"").split(/[\s,]+/),S=v.length;for(f=0;f<S;f++)v[f]&&(h=v[f].replace(/\*/g,".*?"),h[0]==="-"?s.skips.push(new RegExp("^"+h.slice(1)+"$")):s.names.push(new RegExp("^"+h+"$")))}function c(){let h=[...s.names.map(u),...s.skips.map(u).map(f=>"-"+f)].join(",");return s.enable(""),h}function l(h){if(h[h.length-1]==="*")return!0;let f,v;for(f=0,v=s.skips.length;f<v;f++)if(s.skips[f].test(h))return!1;for(f=0,v=s.names.length;f<v;f++)if(s.names[f].test(h))return!0;return!1}function u(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function p(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}t.exports=e}),Ia=Ar((r,t)=>{T(),r.formatArgs=i,r.save=n,r.load=s,r.useColors=e,r.storage=a(),r.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let l="color: "+this.color;c.splice(1,0,l,"color: inherit");let u=0,p=0;c[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(u++,d==="%c"&&(p=u))}),c.splice(p,0,l)}r.log=console.debug||console.log||(()=>{});function n(c){try{c?r.storage.setItem("debug",c):r.storage.removeItem("debug")}catch(l){}}function s(){let c;try{c=r.storage.getItem("debug")}catch(l){}return!c&&typeof process!="undefined"&&"env"in process&&(c=hs.DEBUG),c}function a(){try{return localStorage}catch(c){}}t.exports=ka()(r);var{formatters:o}=t.exports;o.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}});T();T();var xa=(r=>(r.JOIN_ROOM="room.join",r.JOINED_ROOM="room.joined",r.LEAVE_ROOM="room.leave",r.UPDATE="room.update",r.ERROR="room.error",r))(xa||{}),A=(r=>(r.JOINED_ROOM="presence.joined-room",r.LEAVE="presence.leave",r.ERROR="presence.error",r.UPDATE="presence.update",r))(A||{});T();T();var Or=(r=>(r.CONNECTED="CONNECTED",r.CONNECTING="CONNECTING",r.DISCONNECTED="DISCONNECTED",r.CONNECTION_ERROR="CONNECTION_ERROR",r.RECONNECTING="RECONNECTING",r.RECONNECT_ERROR="RECONNECT_ERROR",r))(Or||{});T();T();T();T();T();var cr=function(r,t){return cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},cr(r,t)};function Pi(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");cr(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function lr(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ai(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,s=[],a;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(o){a={error:o}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return s}function ci(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,s;i<n;i++)(s||!(i in t))&&(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return r.concat(s||Array.prototype.slice.call(t))}T();function Ee(r){return typeof r=="function"}T();T();T();function ms(r){var t=function(i){Error.call(i),i.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var er=ms(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,i){return i+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});T();function ur(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var Ci=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,i,n,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=lr(a),c=o.next();!c.done;c=o.next()){var l=c.value;l.remove(this)}}catch(v){t={error:v}}finally{try{c&&!c.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else a.remove(this);var u=this.initialTeardown;if(Ee(u))try{u()}catch(v){s=v instanceof er?v.errors:[v]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var d=lr(p),h=d.next();!h.done;h=d.next()){var f=h.value;try{qn(f)}catch(v){s=s!=null?s:[],v instanceof er?s=ci(ci([],ai(s)),ai(v.errors)):s.push(v)}}}catch(v){i={error:v}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}}if(s)throw new er(s)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)qn(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&ur(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&ur(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}(),fs=Ci.EMPTY;function gs(r){return r instanceof Ci||r&&"closed"in r&&Ee(r.remove)&&Ee(r.add)&&Ee(r.unsubscribe)}function qn(r){Ee(r)?r():r.unsubscribe()}T();var Fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};T();T();var li={setTimeout:function(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];var n=li.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,ci([r,t],ai(e))):setTimeout.apply(void 0,ci([r,t],ai(e)))},clearTimeout:function(r){var t=li.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Na(r){li.setTimeout(function(){var t=Fe.onUnhandledError;if(t)t(r);else throw r})}T();function Kn(){}T();var Fa=function(){return Sr("C",void 0,void 0)}();function Da(r){return Sr("E",void 0,r)}function Ba(r){return Sr("N",r,void 0)}function Sr(r,t,e){return{kind:r,value:t,error:e}}T();var Ie=null;function ti(r){if(Fe.useDeprecatedSynchronousErrorHandling){var t=!Ie;if(t&&(Ie={errorThrown:!1,error:null}),r(),t){var e=Ie,i=e.errorThrown,n=e.error;if(Ie=null,i)throw n}}else r()}function Ua(r){Fe.useDeprecatedSynchronousErrorHandling&&Ie&&(Ie.errorThrown=!0,Ie.error=r)}var vs=function(r){Pi(t,r);function t(e){var i=r.call(this)||this;return i.isStopped=!1,e?(i.destination=e,gs(e)&&e.add(i)):i.destination=Va,i}return t.create=function(e,i,n){return new dr(e,i,n)},t.prototype.next=function(e){this.isStopped?ir(Ba(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?ir(Da(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?ir(Fa,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ci),Ga=Function.prototype.bind;function tr(r,t){return Ga.call(r,t)}var Wa=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){Kt(i)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){Kt(i)}else Kt(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Kt(e)}},r}(),dr=function(r){Pi(t,r);function t(e,i,n){var s=r.call(this)||this,a;if(Ee(e)||!e)a={next:e!=null?e:void 0,error:i!=null?i:void 0,complete:n!=null?n:void 0};else{var o;s&&Fe.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=function(){return s.unsubscribe()},a={next:e.next&&tr(e.next,o),error:e.error&&tr(e.error,o),complete:e.complete&&tr(e.complete,o)}):a=e}return s.destination=new Wa(a),s}return t}(vs);function Kt(r){Fe.useDeprecatedSynchronousErrorHandling?Ua(r):Na(r)}function ja(r){throw r}function ir(r,t){var e=Fe.onStoppedNotification;e&&li.setTimeout(function(){return e(r,t)})}var Va={closed:!0,next:Kn,error:ja,complete:Kn};T();var Ha=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();T();T();function za(r){return r}function $a(r){return r.length===0?za:r.length===1?r[0]:function(t){return r.reduce(function(e,i){return i(e)},t)}}var Yn=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var n=this,s=Ja(t)?t:new dr(t,e,i);return ti(function(){var a=n,o=a.operator,c=a.source;s.add(o?o.call(s,c):c?n._subscribe(s):n._trySubscribe(s))}),s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var i=this;return e=Xn(e),new e(function(n,s){var a=new dr({next:function(o){try{t(o)}catch(c){s(c),a.unsubscribe()}},error:s,complete:n});i.subscribe(a)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Ha]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return $a(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Xn(t),new t(function(i,n){var s;e.subscribe(function(a){return s=a},function(a){return n(a)},function(){return i(s)})})},r.create=function(t){return new r(t)},r}();function Xn(r){var t;return(t=r!=null?r:Fe.Promise)!==null&&t!==void 0?t:Promise}function Za(r){return r&&Ee(r.next)&&Ee(r.error)&&Ee(r.complete)}function Ja(r){return r&&r instanceof vs||Za(r)&&gs(r)}T();T();var qa=ms(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),me=function(r){Pi(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new Qn(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new qa},t.prototype.next=function(e){var i=this;ti(function(){var n,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var a=lr(i.currentObservers),o=a.next();!o.done;o=a.next()){var c=o.value;c.next(e)}}catch(l){n={error:l}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var i=this;ti(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var n=i.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;ti(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,n=this,s=n.hasError,a=n.isStopped,o=n.observers;return s||a?fs:(this.currentObservers=null,o.push(e),new Ci(function(){i.currentObservers=null,ur(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,n=i.hasError,s=i.thrownError,a=i.isStopped;n?e.error(s):a&&e.complete()},t.prototype.asObservable=function(){var e=new Yn;return e.source=this,e},t.create=function(e,i){return new Qn(e,i)},t}(Yn),Qn=function(r){Pi(t,r);function t(e,i){var n=r.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,e)},t.prototype.error=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&n!==void 0?n:fs},t}(me);T();T();var es=La(Ia()),Mr=class{constructor(r){this.debug=(0,es.default)(r),es.default.enable("*")}log(r,...t){this.debug(r,...t)}},Ka=class bs{constructor(t,e,i){this.io=t,this.presence=e,this.roomId=i,this.presences=new Set,this.observers=new Map,this.onPresenceJoin=n=>{(n==null?void 0:n.roomId)===this.roomId&&(this.logger.log("presence room @ presence join",n),this.presences.add(n),this.observers.get("presence.joined-room").next({connectionId:n.connectionId,data:n.data,id:n.id,name:n.name,timestamp:n.timestamp}))},this.onPresenceLeave=n=>{(n==null?void 0:n.roomId)===this.roomId&&(this.logger.log("presence room @ presence leave",n),this.presences.delete(n),this.observers.get("presence.leave").next(n))},this.onPresenceUpdate=n=>{(n==null?void 0:n.roomId)===this.roomId&&(this.logger.log("presence room @ presence update",n),this.observers.get("presence.update").next({connectionId:n.connectionId,data:n.data,id:n.id,name:n.name,roomId:n==null?void 0:n.roomId,timestamp:n.timestamp}))},this.logger=new Mr("@superviz/socket-client/presence"),this.registerSubjects(),this.subscribeToPresenceEvents()}static register(t,e,i){return new bs(t,e,i)}get(t,e){let i=new me;i.subscribe({next:t,error:e});let n=s=>{let a=s.presences.map(o=>({connectionId:o.connectionId,data:o.data,id:o.id,name:o.name,timestamp:o.timestamp}));this.logger.log("presence room @ get",s),this.io.off("presence.get",n),i.next(a),i.complete()};this.io.on("presence.get",n),this.io.emit("presence.get",this.roomId)}update(t){let e={connectionId:this.io.id,data:t,id:this.presence.id,name:this.presence.name,timestamp:Date.now()};this.io.emit("presence.update",this.roomId,e),this.logger.log("presence room @ update",this.roomId,e)}destroy(){this.io.off("presence.joined-room",this.onPresenceJoin),this.io.off("presence.leave",this.onPresenceLeave),this.io.off("presence.update",this.onPresenceUpdate),this.observers.forEach(t=>t.unsubscribe()),this.observers.clear()}registerSubjects(){this.observers.set("presence.joined-room",new me),this.observers.set("presence.leave",new me),this.observers.set("presence.update",new me)}on(t,e,i){this.observers.get(t).subscribe({error:i,next:e})}off(t){this.observers.get(t).unsubscribe(),this.observers.delete(t),this.observers.set(t,new me)}subscribeToPresenceEvents(){this.io.on("presence.joined-room",this.onPresenceJoin),this.io.on("presence.leave",this.onPresenceLeave),this.io.on("presence.update",this.onPresenceUpdate)}};T();T();T();T();T();T();T();T();T();T();T();T();var ge=Object.create(null);ge.open="0";ge.close="1";ge.ping="2";ge.pong="3";ge.message="4";ge.upgrade="5";ge.noop="6";var ii=Object.create(null);Object.keys(ge).forEach(r=>{ii[ge[r]]=r});var pr={type:"error",data:"parser error"},ys=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Es=typeof ArrayBuffer=="function",Ps=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Lr=({type:r,data:t},e,i)=>ys&&t instanceof Blob?e?i(t):ts(t,i):Es&&(t instanceof ArrayBuffer||Ps(t))?e?i(t):ts(new Blob([t]),i):i(ge[r]+(t||"")),ts=(r,t)=>{let e=new FileReader;return e.onload=function(){let i=e.result.split(",")[1];t("b"+(i||""))},e.readAsDataURL(r)};function is(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}var rr;function Ya(r,t){if(ys&&r.data instanceof Blob)return r.data.arrayBuffer().then(is).then(t);if(Es&&(r.data instanceof ArrayBuffer||Ps(r.data)))return t(is(r.data));Lr(r,!1,e=>{rr||(rr=new TextEncoder),t(rr.encode(e))})}T();T();var rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<rs.length;r++)at[rs.charCodeAt(r)]=r;var Xa=r=>{let t=r.length*.75,e=r.length,i,n=0,s,a,o,c;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);let l=new ArrayBuffer(t),u=new Uint8Array(l);for(i=0;i<e;i+=4)s=at[r.charCodeAt(i)],a=at[r.charCodeAt(i+1)],o=at[r.charCodeAt(i+2)],c=at[r.charCodeAt(i+3)],u[n++]=s<<2|a>>4,u[n++]=(a&15)<<4|o>>2,u[n++]=(o&3)<<6|c&63;return l},Qa=typeof ArrayBuffer=="function",Rr=(r,t)=>{if(typeof r!="string")return{type:"message",data:Cs(r,t)};let e=r.charAt(0);return e==="b"?{type:"message",data:ec(r.substring(1),t)}:ii[e]?r.length>1?{type:ii[e],data:r.substring(1)}:{type:ii[e]}:pr},ec=(r,t)=>{if(Qa){let e=Xa(r);return Cs(e,t)}else return{base64:!0,data:r}},Cs=(r,t)=>{switch(t){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},ws="",tc=(r,t)=>{let e=r.length,i=new Array(e),n=0;r.forEach((s,a)=>{Lr(s,!1,o=>{i[a]=o,++n===e&&t(i.join(ws))})})},ic=(r,t)=>{let e=r.split(ws),i=[];for(let n=0;n<e.length;n++){let s=Rr(e[n],t);if(i.push(s),s.type==="error")break}return i};function rc(){return new TransformStream({transform(r,t){Ya(r,e=>{let i=e.length,n;if(i<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,i);else if(i<65536){n=new Uint8Array(3);let s=new DataView(n.buffer);s.setUint8(0,126),s.setUint16(1,i)}else{n=new Uint8Array(9);let s=new DataView(n.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(i))}r.data&&typeof r.data!="string"&&(n[0]|=128),t.enqueue(n),t.enqueue(e)})}})}var nr;function Yt(r){return r.reduce((t,e)=>t+e.length,0)}function Xt(r,t){if(r[0].length===t)return r.shift();let e=new Uint8Array(t),i=0;for(let n=0;n<t;n++)e[n]=r[0][i++],i===r[0].length&&(r.shift(),i=0);return r.length&&i<r[0].length&&(r[0]=r[0].slice(i)),e}function nc(r,t){nr||(nr=new TextDecoder);let e=[],i=0,n=-1,s=!1;return new TransformStream({transform(a,o){for(e.push(a);;){if(i===0){if(Yt(e)<1)break;let c=Xt(e,1);s=(c[0]&128)===128,n=c[0]&127,n<126?i=3:n===126?i=1:i=2}else if(i===1){if(Yt(e)<2)break;let c=Xt(e,2);n=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(Yt(e)<8)break;let c=Xt(e,8),l=new DataView(c.buffer,c.byteOffset,c.length),u=l.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(pr);break}n=u*Math.pow(2,32)+l.getUint32(4),i=3}else{if(Yt(e)<n)break;let c=Xt(e,n);o.enqueue(Rr(s?c:nr.decode(c),t)),i=0}if(n===0||n>r){o.enqueue(pr);break}}}})}var Ts=4;T();function Y(r){if(r)return sc(r)}function sc(r){for(var t in Y.prototype)r[t]=Y.prototype[t];return r}Y.prototype.on=Y.prototype.addEventListener=function(r,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(t),this};Y.prototype.once=function(r,t){function e(){this.off(r,e),t.apply(this,arguments)}return e.fn=t,this.on(r,e),this};Y.prototype.off=Y.prototype.removeListener=Y.prototype.removeAllListeners=Y.prototype.removeEventListener=function(r,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+r];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var i,n=0;n<e.length;n++)if(i=e[n],i===t||i.fn===t){e.splice(n,1);break}return e.length===0&&delete this._callbacks["$"+r],this};Y.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+r],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(e){e=e.slice(0);for(var i=0,n=e.length;i<n;++i)e[i].apply(this,t)}return this};Y.prototype.emitReserved=Y.prototype.emit;Y.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Y.prototype.hasListeners=function(r){return!!this.listeners(r).length};T();T();var oe=typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")();function _s(r,...t){return t.reduce((e,i)=>(r.hasOwnProperty(i)&&(e[i]=r[i]),e),{})}var oc=oe.setTimeout,ac=oe.clearTimeout;function wi(r,t){t.useNativeTimers?(r.setTimeoutFn=oc.bind(oe),r.clearTimeoutFn=ac.bind(oe)):(r.setTimeoutFn=oe.setTimeout.bind(oe),r.clearTimeoutFn=oe.clearTimeout.bind(oe))}var cc=1.33;function lc(r){return typeof r=="string"?uc(r):Math.ceil((r.byteLength||r.size)*cc)}function uc(r){let t=0,e=0;for(let i=0,n=r.length;i<n;i++)t=r.charCodeAt(i),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(i++,e+=4);return e}T();function dc(r){let t="";for(let e in r)r.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e]));return t}function pc(r){let t={},e=r.split("&");for(let i=0,n=e.length;i<n;i++){let s=e[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}var hc=class extends Error{constructor(r,t,e){super(r),this.description=t,this.context=e,this.type="TransportError"}},kr=class extends Y{constructor(r){super(),this.writable=!1,wi(this,r),this.opts=r,this.query=r.query,this.socket=r.socket}onError(r,t,e){return super.emitReserved("error",new hc(r,t,e)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(r){this.readyState==="open"&&this.write(r)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(r){let t=Rr(r,this.socket.binaryType);this.onPacket(t)}onPacket(r){super.emitReserved("packet",r)}onClose(r){this.readyState="closed",super.emitReserved("close",r)}pause(r){}createUri(r,t={}){return r+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let r=this.opts.hostname;return r.indexOf(":")===-1?r:"["+r+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(r){let t=dc(r);return t.length?"?"+t:""}};T();var As="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),hr=64,mc={},ns=0,Qt=0,ss;function os(r){let t="";do t=As[r%hr]+t,r=Math.floor(r/hr);while(r>0);return t}function Os(){let r=os(+new Date);return r!==ss?(ns=0,ss=r):r+"."+os(ns++)}for(;Qt<hr;Qt++)mc[As[Qt]]=Qt;T();T();var Ss=!1;try{Ss=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}var fc=Ss;function Ms(r){let t=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!t||fc))return new XMLHttpRequest}catch(e){}if(!t)try{return new oe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function gc(){}var vc=function(){return new Ms({xdomain:!1}).responseType!=null}(),bc=class extends kr{constructor(r){if(super(r),this.polling=!1,typeof location!="undefined"){let e=location.protocol==="https:",i=location.port;i||(i=e?"443":"80"),this.xd=typeof location!="undefined"&&r.hostname!==location.hostname||i!==r.port}let t=r&&r.forceBase64;this.supportsBinary=vc&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(r){this.readyState="pausing";let t=()=>{this.readyState="paused",r()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(r){let t=e=>{if(this.readyState==="opening"&&e.type==="open"&&this.onOpen(),e.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};ic(r,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let r=()=>{this.write([{type:"close"}])};this.readyState==="open"?r():this.once("open",r)}write(r){this.writable=!1,tc(r,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let r=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Os()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(r,t)}request(r={}){return Object.assign(r,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Ve(this.uri(),r)}doWrite(r,t){let e=this.request({method:"POST",data:r});e.on("success",t),e.on("error",(i,n)=>{this.onError("xhr post error",i,n)})}doPoll(){let r=this.request();r.on("data",this.onData.bind(this)),r.on("error",(t,e)=>{this.onError("xhr poll error",t,e)}),this.pollXhr=r}},Ve=class ri extends Y{constructor(t,e){super(),wi(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=e.data!==void 0?e.data:null,this.create()}create(){var t;let e=_s(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;let i=this.xhr=new Ms(e);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&i.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{i.setRequestHeader("Accept","*/*")}catch(n){}(t=this.opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var n;i.readyState===3&&((n=this.opts.cookieJar)===null||n===void 0||n.parseCookies(i)),i.readyState===4&&(i.status===200||i.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof i.status=="number"?i.status:0)},0))},i.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=ri.requestsCount++,ri.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=gc,t)try{this.xhr.abort()}catch(e){}typeof document!="undefined"&&delete ri.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Ve.requestsCount=0;Ve.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",as);else if(typeof addEventListener=="function"){let r="onpagehide"in oe?"pagehide":"unload";addEventListener(r,as,!1)}}function as(){for(let r in Ve.requests)Ve.requests.hasOwnProperty(r)&&Ve.requests[r].abort()}T();T();var Ir=typeof Promise=="function"&&typeof Promise.resolve=="function"?r=>Promise.resolve().then(r):(r,t)=>t(r,0),ei=oe.WebSocket||oe.MozWebSocket,sr=!0,yc="arraybuffer",cs=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Ec=class extends kr{constructor(r){super(r),this.supportsBinary=!r.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let r=this.uri(),t=this.opts.protocols,e=cs?{}:_s(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(e.headers=this.opts.extraHeaders);try{this.ws=sr&&!cs?t?new ei(r,t):new ei(r):new ei(r,t,e)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=r=>this.onClose({description:"websocket connection closed",context:r}),this.ws.onmessage=r=>this.onData(r.data),this.ws.onerror=r=>this.onError("websocket error",r)}write(r){this.writable=!1;for(let t=0;t<r.length;t++){let e=r[t],i=t===r.length-1;Lr(e,this.supportsBinary,n=>{let s={};sr||(e.options&&(s.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof n=="string"?Buffer.byteLength(n):n.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1));try{sr?this.ws.send(n):this.ws.send(n,s)}catch(a){}i&&Ir(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let r=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Os()),this.supportsBinary||(t.b64=1),this.createUri(r,t)}check(){return!!ei}};T();var Pc=class extends kr{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(r=>{this.onError("webtransport error",r)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(r=>{let t=nc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),e=r.readable.pipeThrough(t).getReader(),i=rc();i.readable.pipeTo(r.writable),this.writer=i.writable.getWriter();let n=()=>{e.read().then(({done:a,value:o})=>{a||(this.onPacket(o),n())}).catch(a=>{})};n();let s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then(()=>this.onOpen())})}))}write(r){this.writable=!1;for(let t=0;t<r.length;t++){let e=r[t],i=t===r.length-1;this.writer.write(e).then(()=>{i&&Ir(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var r;(r=this.transport)===null||r===void 0||r.close()}},Cc={websocket:Ec,webtransport:Pc,polling:bc};T();var wc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Tc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function mr(r){if(r.length>2e3)throw"URI too long";let t=r,e=r.indexOf("["),i=r.indexOf("]");e!=-1&&i!=-1&&(r=r.substring(0,e)+r.substring(e,i).replace(/:/g,";")+r.substring(i,r.length));let n=wc.exec(r||""),s={},a=14;for(;a--;)s[Tc[a]]=n[a]||"";return e!=-1&&i!=-1&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=_c(s,s.path),s.queryKey=Ac(s,s.query),s}function _c(r,t){let e=/\/{2,9}/g,i=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function Ac(r,t){let e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,n,s){n&&(e[n]=s)}),e}var xr=class We extends Y{constructor(t,e={}){super(),this.binaryType=yc,this.writeBuffer=[],t&&typeof t=="object"&&(e=t,t=null),t?(t=mr(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=mr(e.host).host),wi(this,e),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=pc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let e=Object.assign({},this.opts.query);e.EIO=Ts,e.transport=t,this.id&&(e.sid=this.id);let i=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new Cc[t](i)}open(){let t;if(this.opts.rememberUpgrade&&We.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(e){this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(t){let e=this.createTransport(t),i=!1;We.priorWebsocketSuccess=!1;let n=()=>{i||(e.send([{type:"ping",data:"probe"}]),e.once("packet",p=>{if(!i)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;We.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{let d=new Error("probe error");d.transport=e.name,this.emitReserved("upgradeError",d)}}))};function s(){i||(i=!0,u(),e.close(),e=null)}let a=p=>{let d=new Error("probe error: "+p);d.transport=e.name,s(),this.emitReserved("upgradeError",d)};function o(){a("transport closed")}function c(){a("socket closed")}function l(p){e&&p.name!==e.name&&s()}let u=()=>{e.removeListener("open",n),e.removeListener("error",a),e.removeListener("close",o),this.off("close",c),this.off("upgrading",l)};e.once("open",n),e.once("error",a),e.once("close",o),this.once("close",c),this.once("upgrading",l),this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||e.open()},200):e.open()}onOpen(){if(this.readyState="open",We.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0,e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){let i=this.writeBuffer[e].data;if(i&&(t+=lc(i)),e>0&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(t,e,i){return this.sendPacket("message",t,e,i),this}send(t,e,i){return this.sendPacket("message",t,e,i),this}sendPacket(t,e,i,n){if(typeof e=="function"&&(n=e,e=void 0),typeof i=="function"&&(n=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let s={type:t,data:e,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},i=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}onError(t){We.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let e=[],i=0,n=t.length;for(;i<n;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}};xr.protocol=Ts;var Td=xr.protocol;function Oc(r,t="",e){let i=r;e=e||typeof location!="undefined"&&location,r==null&&(r=e.protocol+"//"+e.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=e.protocol+r:r=e.host+r),/^(https?|wss?):\/\//.test(r)||(typeof e!="undefined"?r=e.protocol+"//"+r:r="https://"+r),i=mr(r)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";let n=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+n+":"+i.port+t,i.href=i.protocol+"://"+n+(e&&e.port===i.port?"":":"+i.port),i}T();T();var Ls={};Sa(Ls,{Decoder:()=>Dc,Encoder:()=>Fc,PacketType:()=>B,protocol:()=>Nc});T();T();T();var Sc=typeof ArrayBuffer=="function",Mc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Rs=Object.prototype.toString,Lc=typeof Blob=="function"||typeof Blob!="undefined"&&Rs.call(Blob)==="[object BlobConstructor]",Rc=typeof File=="function"||typeof File!="undefined"&&Rs.call(File)==="[object FileConstructor]";function Nr(r){return Sc&&(r instanceof ArrayBuffer||Mc(r))||Lc&&r instanceof Blob||Rc&&r instanceof File}function ni(r,t){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let e=0,i=r.length;e<i;e++)if(ni(r[e]))return!0;return!1}if(Nr(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return ni(r.toJSON(),!0);for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e)&&ni(r[e]))return!0;return!1}function kc(r){let t=[],e=r.data,i=r;return i.data=fr(e,t),i.attachments=t.length,{packet:i,buffers:t}}function fr(r,t){if(!r)return r;if(Nr(r)){let e={_placeholder:!0,num:t.length};return t.push(r),e}else if(Array.isArray(r)){let e=new Array(r.length);for(let i=0;i<r.length;i++)e[i]=fr(r[i],t);return e}else if(typeof r=="object"&&!(r instanceof Date)){let e={};for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=fr(r[i],t));return e}return r}function Ic(r,t){return r.data=gr(r.data,t),delete r.attachments,r}function gr(r,t){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<t.length)return t[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let e=0;e<r.length;e++)r[e]=gr(r[e],t);else if(typeof r=="object")for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&(r[e]=gr(r[e],t));return r}var xc=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Nc=5,B;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(B||(B={}));var Fc=class{constructor(r){this.replacer=r}encode(r){return(r.type===B.EVENT||r.type===B.ACK)&&ni(r)?this.encodeAsBinary({type:r.type===B.EVENT?B.BINARY_EVENT:B.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let t=""+r.type;return(r.type===B.BINARY_EVENT||r.type===B.BINARY_ACK)&&(t+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(t+=r.nsp+","),r.id!=null&&(t+=r.id),r.data!=null&&(t+=JSON.stringify(r.data,this.replacer)),t}encodeAsBinary(r){let t=kc(r),e=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(e),i}};function ls(r){return Object.prototype.toString.call(r)==="[object Object]"}var Dc=class ks extends Y{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let i=e.type===B.BINARY_EVENT;i||e.type===B.BINARY_ACK?(e.type=i?B.EVENT:B.ACK,this.reconstructor=new Bc(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(Nr(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0,i={type:Number(t.charAt(0))};if(B[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===B.BINARY_EVENT||i.type===B.BINARY_ACK){let s=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);let a=t.substring(s,e);if(a!=Number(a)||t.charAt(e)!=="-")throw new Error("Illegal attachments");i.attachments=Number(a)}if(t.charAt(e+1)==="/"){let s=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););i.nsp=t.substring(s,e)}else i.nsp="/";let n=t.charAt(e+1);if(n!==""&&Number(n)==n){let s=e+1;for(;++e;){let a=t.charAt(e);if(a==null||Number(a)!=a){--e;break}if(e===t.length)break}i.id=Number(t.substring(s,e+1))}if(t.charAt(++e)){let s=this.tryParse(t.substr(e));if(ks.isPayloadValid(i.type,s))i.data=s;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case B.CONNECT:return ls(e);case B.DISCONNECT:return e===void 0;case B.CONNECT_ERROR:return typeof e=="string"||ls(e);case B.EVENT:case B.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&xc.indexOf(e[0])===-1);case B.ACK:case B.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Bc=class{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){let t=Ic(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};T();function ue(r,t,e){return r.on(t,e),function(){r.off(t,e)}}var Uc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Is=class extends Y{constructor(r,t,e){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=r,this.nsp=t,e&&e.auth&&(this.auth=e.auth),this._opts=Object.assign({},e),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let r=this.io;this.subs=[ue(r,"open",this.onopen.bind(this)),ue(r,"packet",this.onpacket.bind(this)),ue(r,"error",this.onerror.bind(this)),ue(r,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...r){return r.unshift("message"),this.emit.apply(this,r),this}emit(r,...t){if(Uc.hasOwnProperty(r))throw new Error('"'+r.toString()+'" is a reserved event name');if(t.unshift(r),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let e={type:B.EVENT,data:t};if(e.options={},e.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let n=this.ids++,s=t.pop();this._registerAckCallback(n,s),e.id=n}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(e),this.packet(e)):this.sendBuffer.push(e)),this.flags={},this}_registerAckCallback(r,t){var e;let i=(e=this.flags.timeout)!==null&&e!==void 0?e:this._opts.ackTimeout;if(i===void 0){this.acks[r]=t;return}let n=this.io.setTimeoutFn(()=>{delete this.acks[r];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===r&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),s=(...a)=>{this.io.clearTimeoutFn(n),t.apply(this,a)};s.withError=!0,this.acks[r]=s}emitWithAck(r,...t){return new Promise((e,i)=>{let n=(s,a)=>s?i(s):e(a);n.withError=!0,t.push(n),this.emit(r,...t)})}_addToQueue(r){let t;typeof r[r.length-1]=="function"&&(t=r.pop());let e={id:this._queueSeq++,tryCount:0,pending:!1,args:r,flags:Object.assign({fromQueue:!0},this.flags)};r.push((i,...n)=>e!==this._queue[0]?void 0:(i!==null?e.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...n)),e.pending=!1,this._drainQueue())),this._queue.push(e),this._drainQueue()}_drainQueue(r=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!r||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(r){r.nsp=this.nsp,this.io._packet(r)}onopen(){typeof this.auth=="function"?this.auth(r=>{this._sendConnectPacket(r)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(r){this.packet({type:B.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},r):r})}onerror(r){this.connected||this.emitReserved("connect_error",r)}onclose(r,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",r,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(r=>{if(!this.sendBuffer.some(t=>String(t.id)===r)){let t=this.acks[r];delete this.acks[r],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(r){if(r.nsp===this.nsp)switch(r.type){case B.CONNECT:r.data&&r.data.sid?this.onconnect(r.data.sid,r.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case B.EVENT:case B.BINARY_EVENT:this.onevent(r);break;case B.ACK:case B.BINARY_ACK:this.onack(r);break;case B.DISCONNECT:this.ondisconnect();break;case B.CONNECT_ERROR:this.destroy();let t=new Error(r.data.message);t.data=r.data.data,this.emitReserved("connect_error",t);break}}onevent(r){let t=r.data||[];r.id!=null&&t.push(this.ack(r.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(r){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let e of t)e.apply(this,r)}super.emit.apply(this,r),this._pid&&r.length&&typeof r[r.length-1]=="string"&&(this._lastOffset=r[r.length-1])}ack(r){let t=this,e=!1;return function(...i){e||(e=!0,t.packet({type:B.ACK,id:r,data:i}))}}onack(r){let t=this.acks[r.id];typeof t=="function"&&(delete this.acks[r.id],t.withError&&r.data.unshift(null),t.apply(this,r.data))}onconnect(r,t){this.id=r,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(r=>this.emitEvent(r)),this.receiveBuffer=[],this.sendBuffer.forEach(r=>{this.notifyOutgoingListeners(r),this.packet(r)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(r=>r()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:B.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(r){return this.flags.compress=r,this}get volatile(){return this.flags.volatile=!0,this}timeout(r){return this.flags.timeout=r,this}onAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(r),this}prependAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(r),this}offAny(r){if(!this._anyListeners)return this;if(r){let t=this._anyListeners;for(let e=0;e<t.length;e++)if(r===t[e])return t.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(r),this}prependAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(r),this}offAnyOutgoing(r){if(!this._anyOutgoingListeners)return this;if(r){let t=this._anyOutgoingListeners;for(let e=0;e<t.length;e++)if(r===t[e])return t.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(r){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let e of t)e.apply(this,r.data)}}};T();function Je(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Je.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*r);r=Math.floor(t*10)&1?r+e:r-e}return Math.min(r,this.max)|0};Je.prototype.reset=function(){this.attempts=0};Je.prototype.setMin=function(r){this.ms=r};Je.prototype.setMax=function(r){this.max=r};Je.prototype.setJitter=function(r){this.jitter=r};var ui=class extends Y{constructor(r,t){var e;super(),this.nsps={},this.subs=[],r&&typeof r=="object"&&(t=r,r=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,wi(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((e=t.randomizationFactor)!==null&&e!==void 0?e:.5),this.backoff=new Je({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=r;let i=t.parser||Ls;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(r){return arguments.length?(this._reconnection=!!r,this):this._reconnection}reconnectionAttempts(r){return r===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=r,this)}reconnectionDelay(r){var t;return r===void 0?this._reconnectionDelay:(this._reconnectionDelay=r,(t=this.backoff)===null||t===void 0||t.setMin(r),this)}randomizationFactor(r){var t;return r===void 0?this._randomizationFactor:(this._randomizationFactor=r,(t=this.backoff)===null||t===void 0||t.setJitter(r),this)}reconnectionDelayMax(r){var t;return r===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=r,(t=this.backoff)===null||t===void 0||t.setMax(r),this)}timeout(r){return arguments.length?(this._timeout=r,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(r){if(~this._readyState.indexOf("open"))return this;this.engine=new xr(this.uri,this.opts);let t=this.engine,e=this;this._readyState="opening",this.skipReconnect=!1;let i=ue(t,"open",function(){e.onopen(),r&&r()}),n=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),r?r(a):this.maybeReconnectOnOpen()},s=ue(t,"error",n);if(this._timeout!==!1){let a=this._timeout,o=this.setTimeoutFn(()=>{i(),n(new Error("timeout")),t.close()},a);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}return this.subs.push(i),this.subs.push(s),this}connect(r){return this.open(r)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let r=this.engine;this.subs.push(ue(r,"ping",this.onping.bind(this)),ue(r,"data",this.ondata.bind(this)),ue(r,"error",this.onerror.bind(this)),ue(r,"close",this.onclose.bind(this)),ue(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(r){try{this.decoder.add(r)}catch(t){this.onclose("parse error",t)}}ondecoded(r){Ir(()=>{this.emitReserved("packet",r)},this.setTimeoutFn)}onerror(r){this.emitReserved("error",r)}socket(r,t){let e=this.nsps[r];return e?this._autoConnect&&!e.active&&e.connect():(e=new Is(this,r,t),this.nsps[r]=e),e}_destroy(r){let t=Object.keys(this.nsps);for(let e of t)if(this.nsps[e].active)return;this._close()}_packet(r){let t=this.encoder.encode(r);for(let e=0;e<t.length;e++)this.engine.write(t[e],r.options)}cleanup(){this.subs.forEach(r=>r()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(r,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",r,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let r=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let e=this.setTimeoutFn(()=>{r.skipReconnect||(this.emitReserved("reconnect_attempt",r.backoff.attempts),!r.skipReconnect&&r.open(i=>{i?(r._reconnecting=!1,r.reconnect(),this.emitReserved("reconnect_error",i)):r.onreconnect()}))},t);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}}onreconnect(){let r=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",r)}},ot={};function or(r,t){typeof r=="object"&&(t=r,r=void 0),t=t||{};let e=Oc(r,t.path||"/socket.io"),i=e.source,n=e.id,s=e.path,a=ot[n]&&s in ot[n].nsps,o=t.forceNew||t["force new connection"]||t.multiplex===!1||a,c;return o?c=new ui(i,t):(ot[n]||(ot[n]=new ui(i,t)),c=ot[n]),e.query&&!t.query&&(t.query=e.queryKey),c.socket(e.path,t)}Object.assign(or,{Manager:ui,Socket:Is,io:or,connect:or});T();T();var U;(function(r){r.assertEqual=n=>n;function t(n){}r.assertIs=t;function e(n){throw new Error}r.assertNever=e,r.arrayToEnum=n=>{let s={};for(let a of n)s[a]=a;return s},r.getValidEnumValues=n=>{let s=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(let o of s)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(s){return n[s]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let s=[];for(let a in n)Object.prototype.hasOwnProperty.call(n,a)&&s.push(a);return s},r.find=(n,s)=>{for(let a of n)if(s(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function i(n,s=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}r.joinValues=i,r.jsonStringifyReplacer=(n,s)=>typeof s=="bigint"?s.toString():s})(U||(U={}));var vr;(function(r){r.mergeShapes=(t,e)=>g(g({},t),e)})(vr||(vr={}));var C=U.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_e=r=>{switch(typeof r){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(r)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(r)?C.array:r===null?C.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?C.promise:typeof Map!="undefined"&&r instanceof Map?C.map:typeof Set!="undefined"&&r instanceof Set?C.set:typeof Date!="undefined"&&r instanceof Date?C.date:C.object;default:return C.unknown}},b=U.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Gc=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),de=class xs extends Error{constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){let e=t||function(s){return s.message},i={_errors:[]},n=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)i._errors.push(e(a));else{let o=i,c=0;for(;c<a.path.length;){let l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(e(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),i}static assert(t){if(!(t instanceof xs))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,U.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){let e={},i=[];for(let n of this.issues)n.path.length>0?(e[n.path[0]]=e[n.path[0]]||[],e[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:e}}get formErrors(){return this.flatten()}};de.create=r=>new de(r);var He=(r,t)=>{let e;switch(r.code){case b.invalid_type:r.received===C.undefined?e="Required":e=`Expected ${r.expected}, received ${r.received}`;break;case b.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(r.expected,U.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:e=`Unrecognized key(s) in object: ${U.joinValues(r.keys,", ")}`;break;case b.invalid_union:e="Invalid input";break;case b.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${U.joinValues(r.options)}`;break;case b.invalid_enum_value:e=`Invalid enum value. Expected ${U.joinValues(r.options)}, received '${r.received}'`;break;case b.invalid_arguments:e="Invalid function arguments";break;case b.invalid_return_type:e="Invalid function return type";break;case b.invalid_date:e="Invalid date";break;case b.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(e=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?e=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?e=`Invalid input: must end with "${r.validation.endsWith}"`:U.assertNever(r.validation):r.validation!=="regex"?e=`Invalid ${r.validation}`:e="Invalid";break;case b.too_small:r.type==="array"?e=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?e=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?e=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?e=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:e="Invalid input";break;case b.too_big:r.type==="array"?e=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?e=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?e=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?e=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?e=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:e="Invalid input";break;case b.custom:e="Invalid input";break;case b.invalid_intersection_types:e="Intersection results could not be merged";break;case b.not_multiple_of:e=`Number must be a multiple of ${r.multipleOf}`;break;case b.not_finite:e="Number must be finite";break;default:e=t.defaultError,U.assertNever(r)}return{message:e}},Ns=He;function Wc(r){Ns=r}function di(){return Ns}var pi=r=>{let{data:t,path:e,errorMaps:i,issueData:n}=r,s=[...e,...n.path||[]],a=k(g({},n),{path:s});if(n.message!==void 0)return k(g({},n),{path:s,message:n.message});let o="",c=i.filter(l=>!!l).slice().reverse();for(let l of c)o=l(a,{data:t,defaultError:o}).message;return k(g({},n),{path:s,message:o})},jc=[];function P(r,t){let e=di(),i=pi({issueData:t,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,e,e===He?void 0:He].filter(n=>!!n)});r.common.issues.push(i)}var re=class Fs{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){let i=[];for(let n of e){if(n.status==="aborted")return I;n.status==="dirty"&&t.dirty(),i.push(n.value)}return{status:t.value,value:i}}static mergeObjectAsync(t,e){return Pe(this,null,function*(){let i=[];for(let n of e){let s=yield n.key,a=yield n.value;i.push({key:s,value:a})}return Fs.mergeObjectSync(t,i)})}static mergeObjectSync(t,e){let i={};for(let n of e){let{key:s,value:a}=n;if(s.status==="aborted"||a.status==="aborted")return I;s.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof a.value!="undefined"||n.alwaysSet)&&(i[s.value]=a.value)}return{status:t.value,value:i}}},I=Object.freeze({status:"aborted"}),hi=r=>({status:"dirty",value:r}),te=r=>({status:"valid",value:r}),br=r=>r.status==="aborted",yr=r=>r.status==="dirty",dt=r=>r.status==="valid",pt=r=>typeof Promise!="undefined"&&r instanceof Promise;function mi(r,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(r):i?i.value:t.get(r)}function Ds(r,t,e,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,e):n?n.value=e:t.set(r,e),e}var _;(function(r){r.errToObj=t=>typeof t=="string"?{message:t}:t||{},r.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(_||(_={}));var ct,lt,ve=class{constructor(r,t,e,i){this._cachedPath=[],this.parent=r,this.data=t,this._path=e,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},us=(r,t)=>{if(dt(t))return{success:!0,data:t.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let e=new de(r.common.issues);return this._error=e,this._error}}};function x(r){if(!r)return{};let{errorMap:t,invalid_type_error:e,required_error:i,description:n}=r;if(t&&(e||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:n}:{errorMap:(s,a)=>{var o,c;let{message:l}=r;return s.code==="invalid_enum_value"?{message:l!=null?l:a.defaultError}:typeof a.data=="undefined"?{message:(o=l!=null?l:i)!==null&&o!==void 0?o:a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:(c=l!=null?l:e)!==null&&c!==void 0?c:a.defaultError}},description:n}}var N=class{constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(r){return _e(r.data)}_getOrReturnCtx(r,t){return t||{common:r.parent.common,data:r.data,parsedType:_e(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new re,ctx:{common:r.parent.common,data:r.data,parsedType:_e(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){let t=this._parse(r);if(pt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(r){let t=this._parse(r);return Promise.resolve(t)}parse(r,t){let e=this.safeParse(r,t);if(e.success)return e.data;throw e.error}safeParse(r,t){var e;let i={common:{issues:[],async:(e=t==null?void 0:t.async)!==null&&e!==void 0?e:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:_e(r)},n=this._parseSync({data:r,path:i.path,parent:i});return us(i,n)}parseAsync(r,t){return Pe(this,null,function*(){let e=yield this.safeParseAsync(r,t);if(e.success)return e.data;throw e.error})}safeParseAsync(r,t){return Pe(this,null,function*(){let e={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:_e(r)},i=this._parse({data:r,path:e.path,parent:e}),n=yield pt(i)?i:Promise.resolve(i);return us(e,n)})}refine(r,t){let e=i=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,n)=>{let s=r(i),a=()=>n.addIssue(g({code:b.custom},e(i)));return typeof Promise!="undefined"&&s instanceof Promise?s.then(o=>o?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(r,t){return this._refinement((e,i)=>r(e)?!0:(i.addIssue(typeof t=="function"?t(e,i):t),!1))}_refinement(r){return new pe({schema:this,typeName:L.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}optional(){return fe.create(this,this._def)}nullable(){return Oe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ne.create(this,this._def)}promise(){return Ze.create(this,this._def)}or(r){return yt.create([this,r],this._def)}and(r){return Et.create(this,r,this._def)}transform(r){return new pe(k(g({},x(this._def)),{schema:this,typeName:L.ZodEffects,effect:{type:"transform",transform:r}}))}default(r){let t=typeof r=="function"?r:()=>r;return new Tt(k(g({},x(this._def)),{innerType:this,defaultValue:t,typeName:L.ZodDefault}))}brand(){return new Fr(g({typeName:L.ZodBranded,type:this},x(this._def)))}catch(r){let t=typeof r=="function"?r:()=>r;return new _t(k(g({},x(this._def)),{innerType:this,catchValue:t,typeName:L.ZodCatch}))}describe(r){let t=this.constructor;return new t(k(g({},this._def),{description:r}))}pipe(r){return Dr.create(this,r)}readonly(){return At.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Vc=/^c[^\s-]{8,}$/i,Hc=/^[0-9a-z]+$/,zc=/^[0-9A-HJKMNP-TV-Z]{26}$/,$c=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Zc=/^[a-z0-9_-]{21}$/i,Jc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Kc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ar,Yc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Xc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Qc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Bs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",el=new RegExp(`^${Bs}$`);function Us(r){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?t=`${t}\\.\\d{${r.precision}}`:r.precision==null&&(t=`${t}(\\.\\d+)?`),t}function tl(r){return new RegExp(`^${Us(r)}$`)}function Gs(r){let t=`${Bs}T${Us(r)}`,e=[];return e.push(r.local?"Z?":"Z"),r.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function il(r,t){return!!((t==="v4"||!t)&&Yc.test(r)||(t==="v6"||!t)&&Xc.test(r))}var ze=class ut extends N{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==C.string){let n=this._getOrReturnCtx(t);return P(n,{code:b.invalid_type,expected:C.string,received:n.parsedType}),I}let e=new re,i;for(let n of this._def.checks)if(n.kind==="min")t.data.length<n.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),e.dirty());else if(n.kind==="max")t.data.length>n.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),e.dirty());else if(n.kind==="length"){let s=t.data.length>n.value,a=t.data.length<n.value;(s||a)&&(i=this._getOrReturnCtx(t,i),s?P(i,{code:b.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&P(i,{code:b.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),e.dirty())}else if(n.kind==="email")qc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"email",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="emoji")ar||(ar=new RegExp(Kc,"u")),ar.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"emoji",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="uuid")$c.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"uuid",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="nanoid")Zc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"nanoid",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="cuid")Vc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"cuid",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="cuid2")Hc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"cuid2",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="ulid")zc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"ulid",code:b.invalid_string,message:n.message}),e.dirty());else if(n.kind==="url")try{new URL(t.data)}catch(s){i=this._getOrReturnCtx(t,i),P(i,{validation:"url",code:b.invalid_string,message:n.message}),e.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"regex",code:b.invalid_string,message:n.message}),e.dirty())):n.kind==="trim"?t.data=t.data.trim():n.kind==="includes"?t.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),e.dirty()):n.kind==="toLowerCase"?t.data=t.data.toLowerCase():n.kind==="toUpperCase"?t.data=t.data.toUpperCase():n.kind==="startsWith"?t.data.startsWith(n.value)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{startsWith:n.value},message:n.message}),e.dirty()):n.kind==="endsWith"?t.data.endsWith(n.value)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{endsWith:n.value},message:n.message}),e.dirty()):n.kind==="datetime"?Gs(n).test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"datetime",message:n.message}),e.dirty()):n.kind==="date"?el.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"date",message:n.message}),e.dirty()):n.kind==="time"?tl(n).test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"time",message:n.message}),e.dirty()):n.kind==="duration"?Jc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"duration",code:b.invalid_string,message:n.message}),e.dirty()):n.kind==="ip"?il(t.data,n.version)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"ip",code:b.invalid_string,message:n.message}),e.dirty()):n.kind==="base64"?Qc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"base64",code:b.invalid_string,message:n.message}),e.dirty()):U.assertNever(n);return{status:e.value,value:t.data}}_regex(t,e,i){return this.refinement(n=>t.test(n),g({validation:e,code:b.invalid_string},_.errToObj(i)))}_addCheck(t){return new ut(k(g({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(g({kind:"email"},_.errToObj(t)))}url(t){return this._addCheck(g({kind:"url"},_.errToObj(t)))}emoji(t){return this._addCheck(g({kind:"emoji"},_.errToObj(t)))}uuid(t){return this._addCheck(g({kind:"uuid"},_.errToObj(t)))}nanoid(t){return this._addCheck(g({kind:"nanoid"},_.errToObj(t)))}cuid(t){return this._addCheck(g({kind:"cuid"},_.errToObj(t)))}cuid2(t){return this._addCheck(g({kind:"cuid2"},_.errToObj(t)))}ulid(t){return this._addCheck(g({kind:"ulid"},_.errToObj(t)))}base64(t){return this._addCheck(g({kind:"base64"},_.errToObj(t)))}ip(t){return this._addCheck(g({kind:"ip"},_.errToObj(t)))}datetime(t){var e,i;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(g({kind:"datetime",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(i=t==null?void 0:t.local)!==null&&i!==void 0?i:!1},_.errToObj(t==null?void 0:t.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(g({kind:"time",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision},_.errToObj(t==null?void 0:t.message)))}duration(t){return this._addCheck(g({kind:"duration"},_.errToObj(t)))}regex(t,e){return this._addCheck(g({kind:"regex",regex:t},_.errToObj(e)))}includes(t,e){return this._addCheck(g({kind:"includes",value:t,position:e==null?void 0:e.position},_.errToObj(e==null?void 0:e.message)))}startsWith(t,e){return this._addCheck(g({kind:"startsWith",value:t},_.errToObj(e)))}endsWith(t,e){return this._addCheck(g({kind:"endsWith",value:t},_.errToObj(e)))}min(t,e){return this._addCheck(g({kind:"min",value:t},_.errToObj(e)))}max(t,e){return this._addCheck(g({kind:"max",value:t},_.errToObj(e)))}length(t,e){return this._addCheck(g({kind:"length",value:t},_.errToObj(e)))}nonempty(t){return this.min(1,_.errToObj(t))}trim(){return new ut(k(g({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new ut(k(g({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new ut(k(g({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}};ze.create=r=>{var t;return new ze(g({checks:[],typeName:L.ZodString,coerce:(t=r==null?void 0:r.coerce)!==null&&t!==void 0?t:!1},x(r)))};function rl(r,t){let e=(r.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=e>i?e:i,s=parseInt(r.toFixed(n).replace(".","")),a=parseInt(t.toFixed(n).replace(".",""));return s%a/Math.pow(10,n)}var ht=class Er extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==C.number){let n=this._getOrReturnCtx(t);return P(n,{code:b.invalid_type,expected:C.number,received:n.parsedType}),I}let e,i=new re;for(let n of this._def.checks)n.kind==="int"?U.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),P(e,{code:b.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="multipleOf"?rl(t.data,n.value)!==0&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):n.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_finite,message:n.message}),i.dirty()):U.assertNever(n);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_.toString(e))}setLimit(t,e,i,n){return new Er(k(g({},this._def),{checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:_.toString(n)}]}))}_addCheck(t){return new Er(k(g({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:_.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:_.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(t)})}get minValue(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&U.isInteger(t.value))}get isFinite(){let t=null,e=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(e===null||i.value>e)&&(e=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(e)&&Number.isFinite(t)}};ht.create=r=>new ht(g({checks:[],typeName:L.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1},x(r)));var mt=class Pr extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==C.bigint){let n=this._getOrReturnCtx(t);return P(n,{code:b.invalid_type,expected:C.bigint,received:n.parsedType}),I}let e,i=new re;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="multipleOf"?t.data%n.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):U.assertNever(n);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,_.toString(e))}gt(t,e){return this.setLimit("min",t,!1,_.toString(e))}lte(t,e){return this.setLimit("max",t,!0,_.toString(e))}lt(t,e){return this.setLimit("max",t,!1,_.toString(e))}setLimit(t,e,i,n){return new Pr(k(g({},this._def),{checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:_.toString(n)}]}))}_addCheck(t){return new Pr(k(g({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:_.toString(e)})}get minValue(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}};mt.create=r=>{var t;return new mt(g({checks:[],typeName:L.ZodBigInt,coerce:(t=r==null?void 0:r.coerce)!==null&&t!==void 0?t:!1},x(r)))};var ft=class extends N{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==C.boolean){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.boolean,received:t.parsedType}),I}return te(r.data)}};ft.create=r=>new ft(g({typeName:L.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1},x(r)));var gt=class Ws extends N{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==C.date){let n=this._getOrReturnCtx(t);return P(n,{code:b.invalid_type,expected:C.date,received:n.parsedType}),I}if(isNaN(t.data.getTime())){let n=this._getOrReturnCtx(t);return P(n,{code:b.invalid_date}),I}let e=new re,i;for(let n of this._def.checks)n.kind==="min"?t.data.getTime()<n.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),e.dirty()):n.kind==="max"?t.data.getTime()>n.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),e.dirty()):U.assertNever(n);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Ws(k(g({},this._def),{checks:[...this._def.checks,t]}))}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:_.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:_.toString(e)})}get minDate(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}};gt.create=r=>new gt(g({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:L.ZodDate},x(r)));var fi=class extends N{_parse(r){if(this._getType(r)!==C.symbol){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.symbol,received:t.parsedType}),I}return te(r.data)}};fi.create=r=>new fi(g({typeName:L.ZodSymbol},x(r)));var vt=class extends N{_parse(r){if(this._getType(r)!==C.undefined){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.undefined,received:t.parsedType}),I}return te(r.data)}};vt.create=r=>new vt(g({typeName:L.ZodUndefined},x(r)));var bt=class extends N{_parse(r){if(this._getType(r)!==C.null){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.null,received:t.parsedType}),I}return te(r.data)}};bt.create=r=>new bt(g({typeName:L.ZodNull},x(r)));var $e=class extends N{constructor(){super(...arguments),this._any=!0}_parse(r){return te(r.data)}};$e.create=r=>new $e(g({typeName:L.ZodAny},x(r)));var xe=class extends N{constructor(){super(...arguments),this._unknown=!0}_parse(r){return te(r.data)}};xe.create=r=>new xe(g({typeName:L.ZodUnknown},x(r)));var Ce=class extends N{_parse(r){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.never,received:t.parsedType}),I}};Ce.create=r=>new Ce(g({typeName:L.ZodNever},x(r)));var gi=class extends N{_parse(r){if(this._getType(r)!==C.undefined){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.void,received:t.parsedType}),I}return te(r.data)}};gi.create=r=>new gi(g({typeName:L.ZodVoid},x(r)));var Ne=class si extends N{_parse(t){let{ctx:e,status:i}=this._processInputParams(t),n=this._def;if(e.parsedType!==C.array)return P(e,{code:b.invalid_type,expected:C.array,received:e.parsedType}),I;if(n.exactLength!==null){let a=e.data.length>n.exactLength.value,o=e.data.length<n.exactLength.value;(a||o)&&(P(e,{code:a?b.too_big:b.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),i.dirty())}if(n.minLength!==null&&e.data.length<n.minLength.value&&(P(e,{code:b.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),i.dirty()),n.maxLength!==null&&e.data.length>n.maxLength.value&&(P(e,{code:b.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),i.dirty()),e.common.async)return Promise.all([...e.data].map((a,o)=>n.type._parseAsync(new ve(e,a,e.path,o)))).then(a=>re.mergeArray(i,a));let s=[...e.data].map((a,o)=>n.type._parseSync(new ve(e,a,e.path,o)));return re.mergeArray(i,s)}get element(){return this._def.type}min(t,e){return new si(k(g({},this._def),{minLength:{value:t,message:_.toString(e)}}))}max(t,e){return new si(k(g({},this._def),{maxLength:{value:t,message:_.toString(e)}}))}length(t,e){return new si(k(g({},this._def),{exactLength:{value:t,message:_.toString(e)}}))}nonempty(t){return this.min(1,t)}};Ne.create=(r,t)=>new Ne(g({type:r,minLength:null,maxLength:null,exactLength:null,typeName:L.ZodArray},x(t)));function je(r){if(r instanceof ae){let t={};for(let e in r.shape){let i=r.shape[e];t[e]=fe.create(je(i))}return new ae(k(g({},r._def),{shape:()=>t}))}else return r instanceof Ne?new Ne(k(g({},r._def),{type:je(r.element)})):r instanceof fe?fe.create(je(r.unwrap())):r instanceof Oe?Oe.create(je(r.unwrap())):r instanceof Ae?Ae.create(r.items.map(t=>je(t))):r}var ae=class ce extends N{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),e=U.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==C.object){let c=this._getOrReturnCtx(t);return P(c,{code:b.invalid_type,expected:C.object,received:c.parsedType}),I}let{status:e,ctx:i}=this._processInputParams(t),{shape:n,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof Ce&&this._def.unknownKeys==="strip"))for(let c in i.data)s.includes(c)||a.push(c);let o=[];for(let c of s){let l=n[c],u=i.data[c];o.push({key:{status:"valid",value:c},value:l._parse(new ve(i,u,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Ce){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of a)o.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")a.length>0&&(P(i,{code:b.unrecognized_keys,keys:a}),e.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of a){let u=i.data[l];o.push({key:{status:"valid",value:l},value:c._parse(new ve(i,u,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(()=>Pe(this,null,function*(){let c=[];for(let l of o){let u=yield l.key,p=yield l.value;c.push({key:u,value:p,alwaysSet:l.alwaysSet})}return c})).then(c=>re.mergeObjectSync(e,c)):re.mergeObjectSync(e,o)}get shape(){return this._def.shape()}strict(t){return _.errToObj,new ce(g(k(g({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(e,i)=>{var n,s,a,o;let c=(a=(s=(n=this._def).errorMap)===null||s===void 0?void 0:s.call(n,e,i).message)!==null&&a!==void 0?a:i.defaultError;return e.code==="unrecognized_keys"?{message:(o=_.errToObj(t).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}))}strip(){return new ce(k(g({},this._def),{unknownKeys:"strip"}))}passthrough(){return new ce(k(g({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new ce(k(g({},this._def),{shape:()=>g(g({},this._def.shape()),t)}))}merge(t){return new ce({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>g(g({},this._def.shape()),t._def.shape()),typeName:L.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new ce(k(g({},this._def),{catchall:t}))}pick(t){let e={};return U.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(e[i]=this.shape[i])}),new ce(k(g({},this._def),{shape:()=>e}))}omit(t){let e={};return U.objectKeys(this.shape).forEach(i=>{t[i]||(e[i]=this.shape[i])}),new ce(k(g({},this._def),{shape:()=>e}))}deepPartial(){return je(this)}partial(t){let e={};return U.objectKeys(this.shape).forEach(i=>{let n=this.shape[i];t&&!t[i]?e[i]=n:e[i]=n.optional()}),new ce(k(g({},this._def),{shape:()=>e}))}required(t){let e={};return U.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])e[i]=this.shape[i];else{let n=this.shape[i];for(;n instanceof fe;)n=n._def.innerType;e[i]=n}}),new ce(k(g({},this._def),{shape:()=>e}))}keyof(){return Zs(U.objectKeys(this.shape))}};ae.create=(r,t)=>new ae(g({shape:()=>r,unknownKeys:"strip",catchall:Ce.create(),typeName:L.ZodObject},x(t)));ae.strictCreate=(r,t)=>new ae(g({shape:()=>r,unknownKeys:"strict",catchall:Ce.create(),typeName:L.ZodObject},x(t)));ae.lazycreate=(r,t)=>new ae(g({shape:r,unknownKeys:"strip",catchall:Ce.create(),typeName:L.ZodObject},x(t)));var yt=class extends N{_parse(r){let{ctx:t}=this._processInputParams(r),e=this._def.options;function i(n){for(let a of n)if(a.result.status==="valid")return a.result;for(let a of n)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let s=n.map(a=>new de(a.ctx.common.issues));return P(t,{code:b.invalid_union,unionErrors:s}),I}if(t.common.async)return Promise.all(e.map(n=>Pe(this,null,function*(){let s=k(g({},t),{common:k(g({},t.common),{issues:[]}),parent:null});return{result:yield n._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}}))).then(i);{let n,s=[];for(let o of e){let c=k(g({},t),{common:k(g({},t.common),{issues:[]}),parent:null}),l=o._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!n&&(n={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(n)return t.common.issues.push(...n.ctx.common.issues),n.result;let a=s.map(o=>new de(o));return P(t,{code:b.invalid_union,unionErrors:a}),I}}get options(){return this._def.options}};yt.create=(r,t)=>new yt(g({options:r,typeName:L.ZodUnion},x(t)));var Te=r=>r instanceof Pt?Te(r.schema):r instanceof pe?Te(r.innerType()):r instanceof Ct?[r.value]:r instanceof Ot?r.options:r instanceof wt?U.objectValues(r.enum):r instanceof Tt?Te(r._def.innerType):r instanceof vt?[void 0]:r instanceof bt?[null]:r instanceof fe?[void 0,...Te(r.unwrap())]:r instanceof Oe?[null,...Te(r.unwrap())]:r instanceof Fr||r instanceof At?Te(r.unwrap()):r instanceof _t?Te(r._def.innerType):[],js=class Vs extends N{_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==C.object)return P(e,{code:b.invalid_type,expected:C.object,received:e.parsedType}),I;let i=this.discriminator,n=e.data[i],s=this.optionsMap.get(n);return s?e.common.async?s._parseAsync({data:e.data,path:e.path,parent:e}):s._parseSync({data:e.data,path:e.path,parent:e}):(P(e,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),I)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,i){let n=new Map;for(let s of e){let a=Te(s.shape[t]);if(!a.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let o of a){if(n.has(o))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(o)}`);n.set(o,s)}}return new Vs(g({typeName:L.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:n},x(i)))}};function Cr(r,t){let e=_e(r),i=_e(t);if(r===t)return{valid:!0,data:r};if(e===C.object&&i===C.object){let n=U.objectKeys(t),s=U.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a=g(g({},r),t);for(let o of s){let c=Cr(r[o],t[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(e===C.array&&i===C.array){if(r.length!==t.length)return{valid:!1};let n=[];for(let s=0;s<r.length;s++){let a=r[s],o=t[s],c=Cr(a,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return e===C.date&&i===C.date&&+r==+t?{valid:!0,data:r}:{valid:!1}}var Et=class extends N{_parse(r){let{status:t,ctx:e}=this._processInputParams(r),i=(n,s)=>{if(br(n)||br(s))return I;let a=Cr(n.value,s.value);return a.valid?((yr(n)||yr(s))&&t.dirty(),{status:t.value,value:a.data}):(P(e,{code:b.invalid_intersection_types}),I)};return e.common.async?Promise.all([this._def.left._parseAsync({data:e.data,path:e.path,parent:e}),this._def.right._parseAsync({data:e.data,path:e.path,parent:e})]).then(([n,s])=>i(n,s)):i(this._def.left._parseSync({data:e.data,path:e.path,parent:e}),this._def.right._parseSync({data:e.data,path:e.path,parent:e}))}};Et.create=(r,t,e)=>new Et(g({left:r,right:t,typeName:L.ZodIntersection},x(e)));var Ae=class Hs extends N{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.array)return P(i,{code:b.invalid_type,expected:C.array,received:i.parsedType}),I;if(i.data.length<this._def.items.length)return P(i,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),I;!this._def.rest&&i.data.length>this._def.items.length&&(P(i,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());let n=[...i.data].map((s,a)=>{let o=this._def.items[a]||this._def.rest;return o?o._parse(new ve(i,s,i.path,a)):null}).filter(s=>!!s);return i.common.async?Promise.all(n).then(s=>re.mergeArray(e,s)):re.mergeArray(e,n)}get items(){return this._def.items}rest(t){return new Hs(k(g({},this._def),{rest:t}))}};Ae.create=(r,t)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ae(g({items:r,typeName:L.ZodTuple,rest:null},x(t)))};var zs=class wr extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.object)return P(i,{code:b.invalid_type,expected:C.object,received:i.parsedType}),I;let n=[],s=this._def.keyType,a=this._def.valueType;for(let o in i.data)n.push({key:s._parse(new ve(i,o,i.path,o)),value:a._parse(new ve(i,i.data[o],i.path,o)),alwaysSet:o in i.data});return i.common.async?re.mergeObjectAsync(e,n):re.mergeObjectSync(e,n)}get element(){return this._def.valueType}static create(t,e,i){return e instanceof N?new wr(g({keyType:t,valueType:e,typeName:L.ZodRecord},x(i))):new wr(g({keyType:ze.create(),valueType:t,typeName:L.ZodRecord},x(e)))}},vi=class extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){let{status:t,ctx:e}=this._processInputParams(r);if(e.parsedType!==C.map)return P(e,{code:b.invalid_type,expected:C.map,received:e.parsedType}),I;let i=this._def.keyType,n=this._def.valueType,s=[...e.data.entries()].map(([a,o],c)=>({key:i._parse(new ve(e,a,e.path,[c,"key"])),value:n._parse(new ve(e,o,e.path,[c,"value"]))}));if(e.common.async){let a=new Map;return Promise.resolve().then(()=>Pe(this,null,function*(){for(let o of s){let c=yield o.key,l=yield o.value;if(c.status==="aborted"||l.status==="aborted")return I;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(c.value,l.value)}return{status:t.value,value:a}}))}else{let a=new Map;for(let o of s){let c=o.key,l=o.value;if(c.status==="aborted"||l.status==="aborted")return I;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(c.value,l.value)}return{status:t.value,value:a}}}};vi.create=(r,t,e)=>new vi(g({valueType:t,keyType:r,typeName:L.ZodMap},x(e)));var bi=class Tr extends N{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.set)return P(i,{code:b.invalid_type,expected:C.set,received:i.parsedType}),I;let n=this._def;n.minSize!==null&&i.data.size<n.minSize.value&&(P(i,{code:b.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),e.dirty()),n.maxSize!==null&&i.data.size>n.maxSize.value&&(P(i,{code:b.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),e.dirty());let s=this._def.valueType;function a(c){let l=new Set;for(let u of c){if(u.status==="aborted")return I;u.status==="dirty"&&e.dirty(),l.add(u.value)}return{status:e.value,value:l}}let o=[...i.data.values()].map((c,l)=>s._parse(new ve(i,c,i.path,l)));return i.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(t,e){return new Tr(k(g({},this._def),{minSize:{value:t,message:_.toString(e)}}))}max(t,e){return new Tr(k(g({},this._def),{maxSize:{value:t,message:_.toString(e)}}))}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}};bi.create=(r,t)=>new bi(g({valueType:r,minSize:null,maxSize:null,typeName:L.ZodSet},x(t)));var $s=class oi extends N{constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==C.function)return P(e,{code:b.invalid_type,expected:C.function,received:e.parsedType}),I;function i(o,c){return pi({data:o,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,di(),He].filter(l=>!!l),issueData:{code:b.invalid_arguments,argumentsError:c}})}function n(o,c){return pi({data:o,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,di(),He].filter(l=>!!l),issueData:{code:b.invalid_return_type,returnTypeError:c}})}let s={errorMap:e.common.contextualErrorMap},a=e.data;if(this._def.returns instanceof Ze){let o=this;return te(function(...c){return Pe(this,null,function*(){let l=new de([]),u=yield o._def.args.parseAsync(c,s).catch(d=>{throw l.addIssue(i(c,d)),l}),p=yield Reflect.apply(a,this,u);return yield o._def.returns._def.type.parseAsync(p,s).catch(d=>{throw l.addIssue(n(p,d)),l})})})}else{let o=this;return te(function(...c){let l=o._def.args.safeParse(c,s);if(!l.success)throw new de([i(c,l.error)]);let u=Reflect.apply(a,this,l.data),p=o._def.returns.safeParse(u,s);if(!p.success)throw new de([n(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new oi(k(g({},this._def),{args:Ae.create(t).rest(xe.create())}))}returns(t){return new oi(k(g({},this._def),{returns:t}))}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,i){return new oi(g({args:t||Ae.create([]).rest(xe.create()),returns:e||xe.create(),typeName:L.ZodFunction},x(i)))}},Pt=class extends N{get schema(){return this._def.getter()}_parse(r){let{ctx:t}=this._processInputParams(r);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Pt.create=(r,t)=>new Pt(g({getter:r,typeName:L.ZodLazy},x(t)));var Ct=class extends N{_parse(r){if(r.data!==this._def.value){let t=this._getOrReturnCtx(r);return P(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),I}return{status:"valid",value:r.data}}get value(){return this._def.value}};Ct.create=(r,t)=>new Ct(g({value:r,typeName:L.ZodLiteral},x(t)));function Zs(r,t){return new Ot(g({values:r,typeName:L.ZodEnum},x(t)))}var Ot=class _r extends N{constructor(){super(...arguments),ct.set(this,void 0)}_parse(t){if(typeof t.data!="string"){let e=this._getOrReturnCtx(t),i=this._def.values;return P(e,{expected:U.joinValues(i),received:e.parsedType,code:b.invalid_type}),I}if(mi(this,ct,"f")||Ds(this,ct,new Set(this._def.values),"f"),!mi(this,ct,"f").has(t.data)){let e=this._getOrReturnCtx(t),i=this._def.values;return P(e,{received:e.data,code:b.invalid_enum_value,options:i}),I}return te(t.data)}get options(){return this._def.values}get enum(){let t={};for(let e of this._def.values)t[e]=e;return t}get Values(){let t={};for(let e of this._def.values)t[e]=e;return t}get Enum(){let t={};for(let e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return _r.create(t,g(g({},this._def),e))}exclude(t,e=this._def){return _r.create(this.options.filter(i=>!t.includes(i)),g(g({},this._def),e))}};ct=new WeakMap;Ot.create=Zs;var wt=class extends N{constructor(){super(...arguments),lt.set(this,void 0)}_parse(r){let t=U.getValidEnumValues(this._def.values),e=this._getOrReturnCtx(r);if(e.parsedType!==C.string&&e.parsedType!==C.number){let i=U.objectValues(t);return P(e,{expected:U.joinValues(i),received:e.parsedType,code:b.invalid_type}),I}if(mi(this,lt,"f")||Ds(this,lt,new Set(U.getValidEnumValues(this._def.values)),"f"),!mi(this,lt,"f").has(r.data)){let i=U.objectValues(t);return P(e,{received:e.data,code:b.invalid_enum_value,options:i}),I}return te(r.data)}get enum(){return this._def.values}};lt=new WeakMap;wt.create=(r,t)=>new wt(g({values:r,typeName:L.ZodNativeEnum},x(t)));var Ze=class extends N{unwrap(){return this._def.type}_parse(r){let{ctx:t}=this._processInputParams(r);if(t.parsedType!==C.promise&&t.common.async===!1)return P(t,{code:b.invalid_type,expected:C.promise,received:t.parsedType}),I;let e=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return te(e.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Ze.create=(r,t)=>new Ze(g({type:r,typeName:L.ZodPromise},x(t)));var pe=class extends N{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===L.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){let{status:t,ctx:e}=this._processInputParams(r),i=this._def.effect||null,n={addIssue:s=>{P(e,s),s.fatal?t.abort():t.dirty()},get path(){return e.path}};if(n.addIssue=n.addIssue.bind(n),i.type==="preprocess"){let s=i.transform(e.data,n);if(e.common.async)return Promise.resolve(s).then(a=>Pe(this,null,function*(){if(t.value==="aborted")return I;let o=yield this._def.schema._parseAsync({data:a,path:e.path,parent:e});return o.status==="aborted"?I:o.status==="dirty"||t.value==="dirty"?hi(o.value):o}));{if(t.value==="aborted")return I;let a=this._def.schema._parseSync({data:s,path:e.path,parent:e});return a.status==="aborted"?I:a.status==="dirty"||t.value==="dirty"?hi(a.value):a}}if(i.type==="refinement"){let s=a=>{let o=i.refinement(a,n);if(e.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(e.common.async===!1){let a=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});return a.status==="aborted"?I:(a.status==="dirty"&&t.dirty(),s(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(a=>a.status==="aborted"?I:(a.status==="dirty"&&t.dirty(),s(a.value).then(()=>({status:t.value,value:a.value}))))}if(i.type==="transform")if(e.common.async===!1){let s=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});if(!dt(s))return s;let a=i.transform(s.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(s=>dt(s)?Promise.resolve(i.transform(s.value,n)).then(a=>({status:t.value,value:a})):s);U.assertNever(i)}};pe.create=(r,t,e)=>new pe(g({schema:r,typeName:L.ZodEffects,effect:t},x(e)));pe.createWithPreprocess=(r,t,e)=>new pe(g({schema:t,effect:{type:"preprocess",transform:r},typeName:L.ZodEffects},x(e)));var fe=class extends N{_parse(r){return this._getType(r)===C.undefined?te(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};fe.create=(r,t)=>new fe(g({innerType:r,typeName:L.ZodOptional},x(t)));var Oe=class extends N{_parse(r){return this._getType(r)===C.null?te(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};Oe.create=(r,t)=>new Oe(g({innerType:r,typeName:L.ZodNullable},x(t)));var Tt=class extends N{_parse(r){let{ctx:t}=this._processInputParams(r),e=t.data;return t.parsedType===C.undefined&&(e=this._def.defaultValue()),this._def.innerType._parse({data:e,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Tt.create=(r,t)=>new Tt(g({innerType:r,typeName:L.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},x(t)));var _t=class extends N{_parse(r){let{ctx:t}=this._processInputParams(r),e=k(g({},t),{common:k(g({},t.common),{issues:[]})}),i=this._def.innerType._parse({data:e.data,path:e.path,parent:g({},e)});return pt(i)?i.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new de(e.common.issues)},input:e.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new de(e.common.issues)},input:e.data})}}removeCatch(){return this._def.innerType}};_t.create=(r,t)=>new _t(g({innerType:r,typeName:L.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},x(t)));var yi=class extends N{_parse(r){if(this._getType(r)!==C.nan){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.nan,received:t.parsedType}),I}return{status:"valid",value:r.data}}};yi.create=r=>new yi(g({typeName:L.ZodNaN},x(r)));var nl=Symbol("zod_brand"),Fr=class extends N{_parse(r){let{ctx:t}=this._processInputParams(r),e=t.data;return this._def.type._parse({data:e,path:t.path,parent:t})}unwrap(){return this._def.type}},Dr=class Js extends N{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.common.async)return Pe(this,null,function*(){let n=yield this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return n.status==="aborted"?I:n.status==="dirty"?(e.dirty(),hi(n.value)):this._def.out._parseAsync({data:n.value,path:i.path,parent:i})});{let n=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return n.status==="aborted"?I:n.status==="dirty"?(e.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:i.path,parent:i})}}static create(t,e){return new Js({in:t,out:e,typeName:L.ZodPipeline})}},At=class extends N{_parse(r){let t=this._def.innerType._parse(r),e=i=>(dt(i)&&(i.value=Object.freeze(i.value)),i);return pt(t)?t.then(i=>e(i)):e(t)}unwrap(){return this._def.innerType}};At.create=(r,t)=>new At(g({innerType:r,typeName:L.ZodReadonly},x(t)));function qs(r,t={},e){return r?$e.create().superRefine((i,n)=>{var s,a;if(!r(i)){let o=typeof t=="function"?t(i):typeof t=="string"?{message:t}:t,c=(a=(s=o.fatal)!==null&&s!==void 0?s:e)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;n.addIssue(k(g({code:"custom"},l),{fatal:c}))}}):$e.create()}var sl={object:ae.lazycreate},L;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(L||(L={}));var ol=(r,t={message:`Input not instance of ${r.name}`})=>qs(e=>e instanceof r,t),Ks=ze.create,Ys=ht.create,al=yi.create,cl=mt.create,Xs=ft.create,ll=gt.create,ul=fi.create,dl=vt.create,pl=bt.create,hl=$e.create,ml=xe.create,fl=Ce.create,gl=gi.create,vl=Ne.create,bl=ae.create,yl=ae.strictCreate,El=yt.create,Pl=js.create,Cl=Et.create,wl=Ae.create,Tl=zs.create,_l=vi.create,Al=bi.create,Ol=$s.create,Sl=Pt.create,Ml=Ct.create,Ll=Ot.create,Rl=wt.create,kl=Ze.create,ds=pe.create,Il=fe.create,xl=Oe.create,Nl=pe.createWithPreprocess,Fl=Dr.create,Dl=()=>Ks().optional(),Bl=()=>Ys().optional(),Ul=()=>Xs().optional(),Gl={string:r=>ze.create(k(g({},r),{coerce:!0})),number:r=>ht.create(k(g({},r),{coerce:!0})),boolean:r=>ft.create(k(g({},r),{coerce:!0})),bigint:r=>mt.create(k(g({},r),{coerce:!0})),date:r=>gt.create(k(g({},r),{coerce:!0}))},Wl=I,le=Object.freeze({__proto__:null,defaultErrorMap:He,setErrorMap:Wc,getErrorMap:di,makeIssue:pi,EMPTY_PATH:jc,addIssueToContext:P,ParseStatus:re,INVALID:I,DIRTY:hi,OK:te,isAborted:br,isDirty:yr,isValid:dt,isAsync:pt,get util(){return U},get objectUtil(){return vr},ZodParsedType:C,getParsedType:_e,ZodType:N,datetimeRegex:Gs,ZodString:ze,ZodNumber:ht,ZodBigInt:mt,ZodBoolean:ft,ZodDate:gt,ZodSymbol:fi,ZodUndefined:vt,ZodNull:bt,ZodAny:$e,ZodUnknown:xe,ZodNever:Ce,ZodVoid:gi,ZodArray:Ne,ZodObject:ae,ZodUnion:yt,ZodDiscriminatedUnion:js,ZodIntersection:Et,ZodTuple:Ae,ZodRecord:zs,ZodMap:vi,ZodSet:bi,ZodFunction:$s,ZodLazy:Pt,ZodLiteral:Ct,ZodEnum:Ot,ZodNativeEnum:wt,ZodPromise:Ze,ZodEffects:pe,ZodTransformer:pe,ZodOptional:fe,ZodNullable:Oe,ZodDefault:Tt,ZodCatch:_t,ZodNaN:yi,BRAND:nl,ZodBranded:Fr,ZodPipeline:Dr,ZodReadonly:At,custom:qs,Schema:N,ZodSchema:N,late:sl,get ZodFirstPartyTypeKind(){return L},coerce:Gl,any:hl,array:vl,bigint:cl,boolean:Xs,date:ll,discriminatedUnion:Pl,effect:ds,enum:Ll,function:Ol,instanceof:ol,intersection:Cl,lazy:Sl,literal:Ml,map:_l,nan:al,nativeEnum:Rl,never:fl,null:pl,nullable:xl,number:Ys,object:bl,oboolean:Ul,onumber:Bl,optional:Il,ostring:Dl,pipeline:Fl,preprocess:Nl,promise:kl,record:Tl,set:Al,strictObject:yl,string:Ks,symbol:ul,transformer:ds,tuple:wl,undefined:dl,union:El,unknown:ml,void:gl,NEVER:Wl,ZodIssueCode:b,quotelessJson:Gc,ZodError:de}),jl=le.object({serverUrl:le.string()}),Vl=jl.parse({serverUrl:"https://io.superviz.com"});T();var Hl=class{constructor(r){this.socket=r,this.onConnect=()=>{this.logger.log("connection @ on connect","Connected to the socket"),this.changeState("CONNECTED")},this.onDisconnect=t=>{this.logger.log("connection @ on disconnect","Disconnected from the socket"),this.changeState("DISCONNECTED",t)},this.onConnectError=t=>{this.logger.log("connection @ on connect error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onConnectionError=t=>{this.logger.log("connection @ on connection error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onReconnect=()=>{this.logger.log("connection @ on reconnect","Reconnected to the socket"),this.changeState("CONNECTED")},this.onReconnectError=t=>{this.logger.log("connection @ on reconnect error","Reconnect error",t),this.changeState("RECONNECT_ERROR",t.message)},this.onReconnectFailed=()=>{this.logger.log("connection @ on reconnect failed","Failed to reconnect to the socket"),this.changeState("RECONNECT_ERROR")},this.onReconnecAttempt=t=>{this.logger.log("connection @ on reconnect attempt",`Reconnect attempt #${t}`),this.changeState("RECONNECTING",`Reconnect attempt #${t}`)},this.onCustomError=t=>{t.needsToDisconnect&&(this.socket.disconnect(),this.changeState("DISCONNECTED",t.errorType));let e=`[SuperViz] 
    - Error: ${t.errorType}
    - Message: ${t.message}
    `;if(t.level==="error"){console.error(e);return}console.warn(e)},this.logger=new Mr("@superviz/socket-client/connection"),this.subscribeToManagerEvents(),this.stateObserver=new me}on(r,t){this.stateObserver.closed&&(this.stateObserver=new me),this.stateObserver.subscribe({next:r,error:t})}off(){this.stateObserver.closed||this.stateObserver.unsubscribe()}subscribeToManagerEvents(){this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("connect_error",this.onConnectError),this.socket.io.on("error",this.onConnectionError),this.socket.io.on("reconnect",this.onReconnect),this.socket.io.on("reconnect_attempt",this.onReconnecAttempt),this.socket.io.on("reconnect_error",this.onReconnectError),this.socket.io.on("reconnect_failed",this.onReconnectFailed),this.socket.on("socket-event.error",this.onCustomError)}changeState(r,t){this.state=r,!this.stateObserver.closed&&this.stateObserver.next({state:r,reason:t})}};T();var zl=class Qs{constructor(t,e,i,n,s=100){this.io=t,this.user=e,this.roomId=i,this.apiKey=n,this.maxConnections=s,this.isJoined=!1,this.subscriptions=new Map,this.observers=new Map,this.onJoinedRoom=o=>{var c;this.roomId===((c=o==null?void 0:o.data)==null?void 0:c.name)&&(this.isJoined=!0,this.io.emit("room.joined",this.roomId,o.data),this.logger.log("room @ joined",o))},this.onHttpEvent=o=>{this.publishEventToClient(o.name,o)},this.logger=new Mr("@superviz/socket-client/room");let a={name:i,user:e,maxConnections:s};this.presence=Ka.register(t,e,i),this.io.emit("room.join",a),this.subscribeToRoomEvents()}static register(t,e,i,n,s){return new Qs(t,e,i,n,s)}on(t,e){this.logger.log("room @ on",t);let i=this.observers.get(t);i||(i=new me,this.observers.set(t,i),this.io.on(t,n=>{this.publishEventToClient(t,n)})),this.subscriptions.set(e,i.subscribe(e))}off(t,e){var i;if(this.logger.log("room @ off",t),!e){this.observers.delete(t),this.io.off(t);return}(i=this.subscriptions.get(e))==null||i.unsubscribe()}emit(t,e){if(!this.isJoined){this.logger.log("Cannot emit event. Not joined to room");return}let i={name:t,roomId:this.roomId,presence:this.user,connectionId:this.io.id,data:e,timestamp:Date.now()};this.io.emit("room.update",this.roomId,i),this.logger.log("room @ emit",t,e)}history(t,e){let i=new me;i.subscribe({next:t,error:e});let n=s=>{this.logger.log("room @ history",s),this.io.off("room.get",n),i.next(s),i.complete(),i.unsubscribe()};this.io.on("room.get",n),this.io.emit("room.get",this.roomId)}disconnect(){this.logger.log("room @ disconnect","Leaving room...",this.roomId),this.io.emit("room.leave",this.roomId),this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions.clear(),this.observers.forEach(t=>t.unsubscribe()),this.observers.clear(),this.presence.destroy()}publishEventToClient(t,e){let i=this.observers.get(t);!i||e.roomId!==this.roomId||i.next(e)}subscribeToRoomEvents(){this.io.on("room.joined",this.onJoinedRoom),this.io.on("room.error",t=>{this.logger.log("Error:",t.data)}),this.io.on(`http:${this.roomId}:${this.apiKey}`,this.onHttpEvent)}},eo=class{constructor(r,t,e){this.apiKey=r,this.environment=t,this.presence=e,this.manager=new ui(Vl.serverUrl,{addTrailingSlash:!1,secure:!0,withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,extraHeaders:{"sv-api-key":this.apiKey}});let{origin:i}=window.location;this.socket=this.manager.socket(`/${t}`,{auth:{apiKey:this.apiKey,origin:i,envirioment:this.environment}}),this.connection=new Hl(this.socket)}get state(){return this.connection.state}connect(r,t){return zl.register(this.socket,this.presence,r,this.apiKey,t)}destroy(){this.socket.disconnect(),this.connection.off()}};T();var _d=le.object({name:le.string(),user:le.object({id:le.string(),name:le.string()}),maxConnections:le.union([le.number(),le.literal("unlimited"),le.undefined()])});var io=he(it());m();var St=class{constructor(){this.observers=new Map;this.subscribe=(t,e)=>{this.logger.log("event bus service @ subscribe",{event:t,callback:e}),this.observers.has(t)||this.observers.set(t,new W),this.observers.get(t).subscribe(e)};this.unsubscribe=(t,e)=>{this.logger.log("event bus service @ unsubscribe",{event:t,callback:e}),this.observers.has(t)&&(this.observers.get(t).reset(),this.observers.delete(t))};this.publish=(t,e)=>{this.logger.log("event bus service @ publish",{event:t,data:e}),this.observers.has(t)&&this.observers.get(t).publish(e)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(t=>{t.reset(),t.destroy()}),this.observers.clear()};this.logger=new F("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};m();m();var Ti=class{constructor(t){this.participant=t;this.stateSubject=new Qr;this.handleConnectionState=t=>{if(t.reason==="Unauthorized connection"){console.error("[Superviz] Unauthorized connection. Please check your API key and if your domain is white listed."),this.state={state:Or.DISCONNECTED,reason:"Unauthorized connection"},this.stateSubject.next("AUTH_ERROR");return}if(t.reason==="user-already-in-room"){this.state=t,this.stateSubject.next("SAME_ACCOUNT_ERROR");return}this.state=t,this.stateSubject.next(t.state)};this.createClient()}destroy(){this.stateSubject.complete(),this.client.destroy()}subscribeToDefaultEvents(){this.client.connection.on(this.handleConnectionState)}createClient(){let t=O.get("environment");t=["dev","prod"].includes(t)?t:"dev",this.client=new eo(O.get("apiKey"),t,{id:this.participant.id,name:this.participant.name}),this.subscribeToDefaultEvents()}createRoom(t,e=50){let i=O.get("roomId");return this.client.connect(`${i}:${t}`,e)}};m();m();var Br=(a=>(a.comments="presence",a.presence3dMatterport="presence",a.presence3dAutodesk="presence",a.presence3dThreejs="presence",a.whoIsOnline="presence",a.formElements="presence",a))(Br||{});var Ke=class{static checkComponentLimit(t){var n,s;let e=O.get("limits"),i=(n=Br[t])!=null?n:t;return(s=e==null?void 0:e[i])!=null?s:{canUse:!1,maxParticipants:50}}};m();var to=he(it());m();var Zl=1e3,_i=class{constructor(t,e){this.participants3DObservers=[];this.initializeParticipantsList=()=>{this.room.presence.get(t=>{t.forEach(e=>{this.unthrottledUpdatePresence3D(e.data)})})};this.onLocalParticipantJoined=t=>{var i;if(!t.slot||((i=t.slot)==null?void 0:i.index)===null){setTimeout(()=>{this.onLocalParticipantJoined(this.localParticipant)},2e3);return}if(!this.room.isJoined){setTimeout(()=>{this.onLocalParticipantJoined(t)},2e3);return}let{hasJoined3D:e}=this.useStore("presence-3d-store");e.publish(!0),this.room.emit("participant-joined",t),this.room.presence.update(t),this.initializeParticipantsList()};this.subscribeToRoomEvents=()=>{this.room.on("participant-joined",this.onJoinedRoom),this.room.presence.on(A.LEAVE,this.onLeaveRoom),this.room.presence.on(A.UPDATE,this.onParticipantUpdate),this.room.presence.on(A.JOINED_ROOM,this.onJoinedPresence)};this.unsubscribeFromRoomEvents=()=>{this.room.off("participant-joined",this.onJoinedRoom),this.room.presence.off(A.LEAVE),this.room.presence.off(A.UPDATE),this.room.presence.off(A.JOINED_ROOM)};this.onJoinedRoom=t=>{let{participants:e}=this.useStore("presence-3d-store"),i=e.value.find(n=>n.id===t.data.id);e.publish([...e.value.filter(n=>n.id!==t.data.id),y(y({},i),t.data)])};this.onLeaveRoom=t=>{if(t.id===this.localParticipant.id){this.unsubscribeFromRoomEvents(),this.useStore("presence-3d-store").destroy();return}let{participants:e}=this.useStore("presence-3d-store"),i=e.value.filter(n=>n.id!==t.id);e.publish(i)};this.unthrottledUpdatePresence3D=t=>{if(!(t!=null&&t.id))return;let{participants:e,hasJoined3D:i}=this.useStore("presence-3d-store"),n=y(y({},e.value.find(s=>s.id===t.id)),t);e.publish([...e.value.filter(s=>s.id!==t.id),n]),!(!i.value||n.id!==this.localParticipant.id)&&this.room.presence.update(n)};this.onJoinedPresence=t=>{t.id===this.localParticipant.id&&(this.logger.log("participant joined 3D room",t.id,this.localParticipant),this.onLocalParticipantJoined(this.localParticipant))};this.updatePresence3D=(0,to.throttle)(t=>{this.unthrottledUpdatePresence3D(t)},Zl);this.onParticipantUpdate=t=>{if(t.id===this.localParticipant.id)return;let{participants:e}=this.useStore("presence-3d-store"),i=y(y({},e.value.filter(s=>s.id===t.id)[0]),t.data),n=e.value.map(s=>s.id===t.id?i:s);e.publish(n),this.participants3DObservers[t.id]&&this.participants3DObservers[t.id].publish(i)};this.setParticipantData=t=>{this.updatePresence3D(t)};this.room=t,this.logger=new F("@superviz/sdk/presence3D-manager"),this.useStore=e,this.subscribeToRoomEvents();let{localParticipant:i}=this.useStore("global-store");i.subscribe(n=>{this.room.presence.update(n);let{participants:s}=this.useStore("presence-3d-store"),a=y(y({},s.value.find(o=>o.id===n.id)),n);s.publish([...s.value.filter(o=>o.id!==n.id),a]),this.localParticipant=a})}subscribeToUpdates(t,e){this.participants3DObservers[t]||(this.participants3DObservers[t]=new W({logger:this.logger})),this.participants3DObservers[t].subscribe(e)}unsubscribeFromUpdates(t,e){this.participants3DObservers[t]&&this.participants3DObservers[t].unsubscribe(e)}get getParticipants(){return this.useStore("presence-3d-store").participants.value}};m();m();var Ye=(i=>(i.HOST="host",i.GUEST="guest",i.AUDIENCE="audience",i))(Ye||{});var Ai=class{constructor(t,e){this.room=t;this.useStore=e;this.isAssigningSlot=!1;this.slot={index:null,color:ie.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()};this.onPresenceUpdate=t=>M(this,null,function*(){var i,n,s;let{localParticipant:e}=this.useStore("global-store");if(t.id===e.value.id){let a=yield this.validateSlotType(t.data);e.publish(R(y({},e.value),{slot:a}));return}if(!(((i=t.data.slot)==null?void 0:i.index)===null||this.slot.index===null)&&((n=t.data.slot)==null?void 0:n.index)===((s=this.slot)==null?void 0:s.index)){let a=yield this.assignSlot();e.publish(R(y({},e.value),{slot:a})),console.debug(`[SuperViz] - Slot reassigned to ${e.value.id}, slot: ${a.colorName}`)}});this.participantNeedsSlot=t=>{var a;let i=["formElements","whoIsOnline","presence","presence3dAutodesk","presence3dMatterport","presence3dThreejs"].some(o=>{var c;return(c=t==null?void 0:t.activeComponents)==null?void 0:c.includes(o)}),n=((a=t==null?void 0:t.activeComponents)==null?void 0:a.includes("videoConference"))&&t.type!=="audience";return i||n};this.validateSlotType=t=>M(this,null,function*(){var i,n;if(this.isAssigningSlot)return this.slot;let e=this.participantNeedsSlot(t);if(((i=t.slot)==null?void 0:i.index)===null&&e){let s=yield this.assignSlot();this.slot=s}return((n=t.slot)==null?void 0:n.index)!==null&&!e&&this.setDefaultSlot(),this.slot});this.room=t,this.room.presence.on(A.UPDATE,this.onPresenceUpdate)}assignSlot(){return M(this,null,function*(){if(this.isAssigningSlot)return this.slot;this.isAssigningSlot=!0;let t=Array.from({length:50},(s,a)=>a),e=Math.floor(Math.random()*50),{localParticipant:i,participants:n}=K("global-store");try{yield new Promise((c,l)=>{this.room.presence.get(u=>{if((!u||!u.length)&&c(!0),u.length>=50){t=[],l(new Error("[SuperViz] - No more slots available"));return}u.forEach(p=>{p.id!==i.value.id&&(t=t.filter(d=>{var h,f;return d!==((f=(h=p.data)==null?void 0:h.slot)==null?void 0:f.index)}))}),c(!0)})}),!t.includes(e)&&(e=t.shift());let a=Object.keys(ie)[e],o={index:e,color:ie[a],textColor:nn.includes(a)?"#fff":"#000",colorName:a,timestamp:Date.now()};return this.slot=o,i.publish(R(y({},i.value),{slot:o})),n.publish(R(y({},n.value),{[i.value.id]:R(y({},n.value[i.value.id]),{slot:o})})),this.room.presence.update({slot:o}),this.isAssigningSlot=!1,o}catch(s){return console.error(s),null}})}setDefaultSlot(){let{localParticipant:t,participants:e}=K("global-store"),i={index:null,color:ie.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()};this.slot=i,t.publish(R(y({},t.value),{slot:i})),e.publish(R(y({},e.value),{[t.value.id]:R(y({},e.value[t.value.id]),{slot:i})})),this.room.presence.update({slot:i})}};m();var Ur=class extends ye{constructor({participant:e,group:i}){super();this.isDestroyed=!1;this.activeComponents=[];this.componentsToAttachAfterJoin=[];this.activeComponentsInstances=[];this.eventBus=new St;this.useStore=K.bind(this);this.addComponent=e=>M(this,null,function*(){if(!this.canAddComponent(e))return;let{hasJoinedRoom:i,group:n,localParticipant:s}=K("global-store");if(!i.value){this.logger.log("launcher service @ addComponent - not joined yet"),this.componentsToAttachAfterJoin.push(e);return}let a=Ke.checkComponentLimit(e.name);e.attach({ioc:this.ioc,config:O.configuration,eventBus:this.eventBus,useStore:K,Presence3DManagerService:_i,connectionLimit:a.maxParticipants}),this.activeComponents.push(e.name),this.activeComponentsInstances.some(o=>o.name===e.name)?this.activeComponentsInstances=this.activeComponentsInstances.map(o=>o.name===e.name?e:o):this.activeComponentsInstances.push(e),s.publish(R(y({},s.value),{activeComponents:this.activeComponents})),this.room.presence.update(R(y({},s.value),{slot:this.slotService.slot,activeComponents:this.activeComponents})),z.sendActivity(this.participant.id,n.value.id,n.value.name,e.name)});this.attachComponentsAfterJoin=()=>{this.logger.log("launcher service @ attachComponentsAfterJoin"),this.componentsToAttachAfterJoin.forEach(e=>{this.logger.log("launcher service @ attachComponentsAfterJoin - attaching component",e.name),this.addComponent(e)}),this.componentsToAttachAfterJoin=[]};this.removeComponent=e=>{if(!this.activeComponents.includes(e.name)){let i=`[SuperViz] Component ${e.name} is not initialized yet.`;this.logger.log(i),console.error(i);return}e.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(i=>i.name!==e.name),this.activeComponents.splice(this.activeComponents.indexOf(e.name),1),this.room.presence.update(R(y({},this.participant),{activeComponents:this.activeComponents}))};this.destroy=()=>{var e,i,n,s,a,o;this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(c=>{this.logger.log("launcher service @ destroy - removing component",c.name),this.removeComponent(c)}),this.activeComponents=[],this.activeComponentsInstances=[],(e=nt())==null||e.destroy(),(i=this.eventBus)==null||i.destroy(),this.eventBus=void 0,(n=this.room)==null||n.presence.off(A.JOINED_ROOM),(s=this.room)==null||s.presence.off(A.LEAVE),(a=this.room)==null||a.presence.off(A.UPDATE),(o=this.ioc)==null||o.destroy(),this.isDestroyed=!0,typeof window!="undefined"&&(window.SUPERVIZ=void 0)};this.canAddComponent=e=>{var o;let i=O.get(`features.${e.name}`),n=Ke.checkComponentLimit(e.name),s=(o=this.activeComponents)==null?void 0:o.includes(e.name),a=[{isValid:i,message:`[SuperViz] Component ${e.name} is not enabled in the room`},{isValid:!this.isDestroyed,message:"[SuperViz] Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:!s,message:`[SuperViz] Component ${e.name} is already active. Please remove it first`},{isValid:n.canUse,message:`[SuperViz] You reached the limit usage of ${e.name}`}];for(let c=0;c<a.length;c++){let{isValid:l,message:u}=a[c];if(!l)return this.logger.log(u),console.error(u),!1}return!0};this.onAuthentication=e=>{e||(this.destroy(),console.error("[SuperViz] Room cannot be initialized because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dashboard.superviz.com/developer"))};this.onLocalParticipantUpdateOnStore=e=>{this.participant=e,this.activeComponents=e.activeComponents||[]};this.onLocalParticipantUpdateOnCore=e=>{this.room&&this.room.presence.update(e)};this.onParticipantsListUpdateOnCore=e=>{let{participants:i}=this.useStore("global-store");i.publish(e)};this.onSameAccount=()=>{this.publish("participant.same-account-error"),this.destroy()};this.startIOC=()=>{this.logger.log("launcher service @ startIOC");let{participants:e}=K("global-store");this.ioc.stateSubject.subscribe(this.onConnectionStateChange),this.room.presence.get(i=>{let n={};i.forEach(s=>{n[s.id]=R(y({},s.data),{name:s.name,id:s.id,timestamp:s.timestamp})}),n[this.participant.id]=y(y({},n[this.participant.id]),this.participant),e.publish(n)}),this.room.presence.on(A.JOINED_ROOM,this.onParticipantJoinedIOC),this.room.presence.on(A.LEAVE,this.onParticipantLeaveIOC),this.room.presence.on(A.UPDATE,this.onParticipantUpdatedIOC)};this.onConnectionStateChange=e=>{if(e==="AUTH_ERROR"){this.onAuthentication(!1);return}if(e==="SAME_ACCOUNT_ERROR"){this.onSameAccount();return}};this.onParticipantJoinedIOC=e=>M(this,null,function*(){if(e.id!==this.participant.id)return;this.room.presence.update(this.participant),this.logger.log("launcher service @ onParticipantJoined - local participant joined");let{hasJoinedRoom:i}=K("global-store");i.publish(!0),this.attachComponentsAfterJoin(),this.publish("participant.local-joined",this.participant),this.publish("participant.joined",this.participant)});this.onParticipantLeaveIOC=e=>{let{participants:i,localParticipant:n}=K("global-store"),s=y({},i.value);delete s[e.id],i.publish(s),e.id===n.value.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",e.data)),this.logger.log("launcher service @ onParticipantLeave - participant left",e.data),this.publish("participant.left",e.data),this.publish("participant.list-updated",Object.values(s))};this.onParticipantUpdatedIOC=e=>{let{localParticipant:i}=K("global-store");i.value&&e.id===i.value.id&&(i.publish(R(y(y({},i.value),e.data),{timestamp:e.timestamp})),this.publish("participant.updated",y(y({},i.value),e.data)),this.logger.log("Publishing ParticipantEvent.UPDATED",e.data));let{participants:n}=K("global-store"),s=y({id:e.id,name:e.name,timestamp:e.timestamp},e.data);n.value[e.id]||this.publish("participant.joined",s);let a=Object.assign({},n.value);if(a[e.id]=s,(0,io.isEqual)(a,n.value))return;n.publish(a);let o=Object.values(n.value);this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n.value),this.publish("participant.list-updated",o)};this.logger=new F("@superviz/sdk/launcher");let{localParticipant:n,group:s,isDomainWhitelisted:a}=this.useStore("global-store"),{localParticipant:o,participants:c}=this.useStore("core-store");n.publish(y({},e)),a.subscribe(this.onAuthentication),n.subscribe(this.onLocalParticipantUpdateOnStore),o.subscribe(this.onLocalParticipantUpdateOnCore),c.subscribe(this.onParticipantsListUpdateOnCore),s.publish(i),this.ioc=new Ti(n.value),this.room=this.ioc.createRoom("launcher","unlimited"),this.slotService=new Ai(this.room,this.useStore),n.publish(R(y({},n.value),{slot:this.slotService.slot,activeComponents:[]})),this.participant=n.value,this.eventBus=new St,this.logger.log("launcher created"),this.startIOC()}},ro=r=>{if(typeof window!="undefined"&&window.SUPERVIZ)return console.warn("[SUPERVIZ] Room already initialized"),{destroy:window.SUPERVIZ.destroy,subscribe:window.SUPERVIZ.subscribe,unsubscribe:window.SUPERVIZ.unsubscribe,addComponent:window.SUPERVIZ.addComponent,removeComponent:window.SUPERVIZ.removeComponent};let t=new Ur(r);return typeof window!="undefined"&&(window.SUPERVIZ=t),{destroy:t.destroy,subscribe:t.subscribe,unsubscribe:t.unsubscribe,addComponent:t.addComponent,removeComponent:t.removeComponent}};function no(r){let t=/^.{2,64}$/,e=/^[-_&@+=,(){}\[\]\/«».:|'"#a-zA-Z0-9À-ÿ\s]*$/;return!(!t.test(r)||!e.test(r))}function Jl(r){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r)}var ql=({group:r,participant:t,roomId:e,customColors:i})=>{if(i&&Kl(i),!r||!r.name||!r.id)throw new Error("[SuperViz] Group fields is required");if(!t||!t.id)throw new Error("[SuperViz] Participant id is required");if(!e)throw new Error("[SuperViz] Room id is required");if(!no(e))throw new Error(`[SuperViz] Room id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xAB\xBB.:|'"`);if(!no(t.id))throw new Error(`[SuperViz] Participant id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xAB\xBB.:|'"`);if(t.email&&!Jl(t.email))throw new Error("[SuperViz] Participant email is invalid")},Kl=r=>{Object.entries(r).forEach(([t,e])=>{if(!Object.values(qi).includes(t))throw new Error(`[SuperViz] Color ${t} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(e))throw new Error(`[SuperViz] Color ${t} is not a valid color variable value. Please check the documentation for more information.`)})},Yl=r=>{r&&Object.entries(r).forEach(([t,e])=>{let i=e.replace(/\s/g,", ");document.documentElement.style.setProperty(`--${t}`,i)})},Xl=(r,t)=>M(void 0,null,function*(){var h,f,v,S,w;if(!(r&&r.trim()))throw new Error("API key is required");if(!t)throw new Error("Options is required");ql(t),t.debug?Gr.debug.enable("*"):Gr.debug.disable();let[{apiUrl:i,conferenceLayerUrl:n},s]=yield Promise.all([ke.getRemoteConfig(t.environment),ke.getFeatures(r)]);if(!(yield $n(i,r)))throw new Error("Failed to validate API key");let[o,c]=yield Promise.all([z.fetchWaterMark(i,r),z.fetchLimits(i,r)]).catch(()=>{throw new Error("[SuperViz] Failed to load configuration from server")}),{participant:l,roomId:u,customColors:p}=t;O.setConfig({apiUrl:i,apiKey:r,conferenceLayerUrl:n,environment:(h=t.environment)!=null?h:"prod",roomId:u,debug:t.debug,limits:c,waterMark:o,colors:p,features:s}),Yl(p);let d=yield z.fetchParticipant(l.id).catch(()=>null);if(!d&&!l.name)throw new Error("[SuperViz] - Participant does not exist, create the user in the API or add the name in the initialization to initialize the SuperViz room.");return d||(yield z.createParticipant({participantId:l.id,name:l==null?void 0:l.name,avatar:(f=l.avatar)==null?void 0:f.imageUrl,email:l==null?void 0:l.email})),ro(R(y({},t),{participant:{id:l.id,name:(v=l.name)!=null?v:d==null?void 0:d.name,avatar:(S=l.avatar)!=null?S:d==null?void 0:d.avatar,email:(w=l.email)!=null?w:d==null?void 0:d.email}}))}),Wr=Xl;m();typeof window!="undefined"&&typeof HTMLElement!="undefined"&&(import("./chunks/icon-YV2P536I.js"),import("./chunks/dropdown-KWVYG5AR.js"),import("./chunks/tooltip-EDGD2Z2I.js"),import("./chunks/modal-PBAZ4I7H.js"),import("./chunks/comments-FBHX5D24.js"),import("./chunks/topbar-THGUUKMY.js"),import("./chunks/content-OJV6GJVT.js"),import("./chunks/comment-item-2TPFDJ3A.js"),import("./chunks/comment-input-C7ZWZUMI.js"),import("./chunks/annotation-pin-4IOE4CUH.js"),import("./chunks/annotation-item-652QAZBW.js"),import("./chunks/delete-comment-modal-LQZ2TDLM.js"),import("./chunks/annotation-resolved-TQJBEVW4.js"),import("./chunks/annotation-filter-VMJNU2J4.js"),import("./chunks/float-button-LC6VIML7.js"),import("./chunks/mention-list-DYNQADKO.js"),import("./chunks/who-is-online-NCV4JJWE.js"),import("./chunks/hello-world-XBPJDRMF.js"));m();m();function so(r){if(typeof document!="undefined"){let t=document.createElement("style");t.id="superviz-style";let e=document.createTextNode(r);t.appendChild(e),document.head.appendChild(t)}}var oo=`@import"https://unpkg.com/@superviz/sv-icons@0.8.13/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";:root{--sv-primary: 98, 16, 204}html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:1000}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:15px;width:16px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg);background-repeat:no-repeat}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:#ff0;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2;transition:all .15s linear,opacity 100s ease-in}
`;so(oo);m();var Mt=(i=>(i.RIGHT="right",i.CENTER="center",i.LEFT="left",i))(Mt||{}),Oi=(e=>(e.GRID="grid",e.LIST="list",e))(Oi||{}),Si=(n=>(n.RIGHT="right",n.LEFT="left",n.TOP="top",n.BOTTOM="bottom",n))(Si||{});m();var Mi=(e=>(e.STARTED="STARTED",e.STOPPED="STOPPED",e))(Mi||{});var Li=(t=>(t.REALTIME_STATE_CHANGED="realtime-component.state-changed",t))(Li||{});m();var Ri=(n=>(n.BLUR="field.blur",n.FOCUS="field.focus",n.CONTENT_CHANGE="field.content-change",n.INTERACTION="field.interaction",n))(Ri||{});m();m();m();var Q=class extends ye{constructor(){super(...arguments);this.isAttached=!1;this.unsubscribeFrom=[];this.useStore=K.bind(this);this.attach=e=>{var c;if(Object.values(e).includes(null)||Object.values(e).includes(void 0)){let l=`${this.name} @ attach - params are required`;throw this.logger.log(l),new Error(l)}let{config:i,eventBus:n,ioc:s}=e,{isDomainWhitelisted:a,hasJoinedRoom:o}=this.useStore("global-store");if(!a.value){let l=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(l);return}if(O.setConfig(i),this.eventBus=n,this.isAttached=!0,this.ioc=s,this.connectionLimit=(c=e.connectionLimit)!=null?c:50,this.room=s.createRoom(this.name,this.connectionLimit),!o.value){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(e)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start(),this.publish("mount")};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached`);return}this.logger.log("detached"),this.publish("unmount"),this.destroy(),this.room.disconnect(),this.room=void 0,this.unsubscribeFrom.forEach(e=>e(this)),Object.values(this.observers).forEach(e=>{e.reset(),e.destroy()}),this.observers=void 0,this.isAttached=!1}}};var Lt=class extends Q{constructor(e,i){var a,o,c;super();this.sidebarOpen=!1;this.layoutOptions={};this.openThreads=()=>{var e;this.sidebarOpen||((e=this.element)==null||e.setAttribute("open",""),this.sidebarOpen=!0,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.closeThreads=()=>{var e;this.sidebarOpen&&((e=this.element)==null||e.removeAttribute("open"),this.sidebarOpen=!1,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.togglePinActive=()=>{if(this.pinActive){this.disable();return}this.enable()};this.onPinFixed=e=>{this.coordinates=e};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=e=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var c,l;this.button=document.createElement("superviz-comments-button");let e=(c=this.layoutOptions)==null?void 0:c.buttonLocation,i=(l=this.layoutOptions)==null?void 0:l.position;if(!e){document.body.appendChild(this.button),this.button.commentsPosition=i;return}let n="",s=Object.values(sn),a=!1,o=!s.includes(e.toLocaleLowerCase());if(o){let u=window.document.body.querySelector(`#${e}`);u?(u.appendChild(this.button),n="position: relative"):(a=!0,e="top-left")}if(!o||a){document.body.appendChild(this.button);let[u,p]=e.split("-");n=`${u}: 20px; ${p}: 20px;`}this.button.positionStyles=n,this.button.commentsPosition=i};this.positionComments=()=>{var n;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left",this.element.offset=this.offset,document.body.appendChild(this.element);let e=(n=this.layoutOptions)==null?void 0:n.position;if(!e)return;let i=e.toUpperCase();Zi[i]&&(this.element.side=Zi[i])};this.createAnnotation=i=>M(this,[i],function*({detail:e}){try{let{text:n,mentions:s}=e,{url:a}=this,o=y({},this.coordinates),c=yield z.createAnnotations(O.get("apiUrl"),O.get("apiKey"),{roomId:O.get("roomId"),position:JSON.stringify(o),url:a,userId:this.localParticipantId}),l=yield this.createComment(c.uuid,n,s);this.addAnnotation(R(y({},c),{comments:[l]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:c.uuid,haltGoToPin:!0,newPin:!0},composed:!0,bubbles:!0}))}catch(n){this.logger.log("error when creating annotation",n)}});this.deleteAnnotation=i=>M(this,[i],function*({detail:e}){try{let{uuid:n}=e;yield z.deleteAnnotation(O.get("apiUrl"),O.get("apiKey"),n);let s=this.annotations.filter(a=>a.uuid!==n);this.updateAnnotationList(s),this.pinAdapter.removeAnnotationPin(n),this.element.updateAnnotations(this.annotations)}catch(n){this.logger.log("error when deleting annotation",n)}});this.updateComment=i=>M(this,[i],function*({detail:e}){try{let{uuid:n,text:s,mentions:a}=e,o=yield z.updateComment(O.get("apiUrl"),O.get("apiKey"),n,s);yield z.createMentions({commentsId:o.uuid,participants:a.map(l=>({id:l.userId}))});let c=this.annotations.map(l=>Object.assign({},l,{comments:l.comments.map(u=>u.uuid===n?Object.assign({},u,{text:s,mentions:a}):u)}));this.updateAnnotationList(c)}catch(n){this.logger.log("error when updating comment",n)}});this.resolveAnnotation=i=>M(this,[i],function*({detail:e}){try{let{uuid:n}=e,{resolved:s}=yield z.resolveAnnotation(O.get("apiUrl"),O.get("apiKey"),n),a=this.annotations.map(o=>o.uuid===n?Object.assign({},o,{resolved:s}):o);if(this.updateAnnotationList(a),s){this.pinAdapter.removeAnnotationPin(n);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(n){this.logger.log("error when resolve annotation",n)}});this.deleteComment=i=>M(this,[i],function*({detail:e}){try{let{uuid:n,annotationId:s}=e;if(!n||!s)return;yield z.deleteComment(O.get("apiUrl"),O.get("apiKey"),n);let a=this.annotations.find(c=>c.uuid===s);a.comments=a.comments.filter(c=>c.uuid!==n);let o=this.annotations.map(c=>c.uuid===s?a:c);this.element.updateAnnotations(o),this.updateAnnotationList(o)}catch(n){this.logger.log("error when deleting comment",n)}});this.onAnnotationListUpdate=e=>{let{data:i,clientId:n}=e;this.localParticipantId!==n&&(this.annotations=i,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new F("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions={buttonLocation:(a=i==null?void 0:i.buttonLocation)!=null?a:"top-left",position:(o=i==null?void 0:i.position)!=null?o:"left"},this.hideDefaultButton=(c=i==null?void 0:i.hideDefaultButton)!=null?c:!1,this.setStyles(i==null?void 0:i.styles),this.offset=i==null?void 0:i.offset,setTimeout(()=>{var l,u;e.setCommentsMetadata((u=(l=this.layoutOptions)==null?void 0:l.position)!=null?u:"left")}),this.pinAdapter=e;let{group:n,localParticipant:s}=this.useStore("global-store");n.subscribe(),s.subscribe(l=>{this.localParticipantId=l.id})}enable(){this.pinAdapter.setActive(!0),this.pinActive=!0,this.publish("pin-mode.active"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!0}}))}disable(){this.pinAdapter.setActive(!1),this.pinActive=!1,this.publish("pin-mode.inactive"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!1}}))}get url(){let e=new URL(this.clientUrl);return e.search="",e.toString()}start(){typeof window!="undefined"&&(this.clientUrl=window.location.href,this.positionComments(),this.hideDefaultButton||this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.participantsList(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0))}destroy(){var e;this.logger.log("comments component @ destroy"),this.destroyListeners(),(e=this.button)==null||e.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){var e;(e=this.button)==null||e.addEventListener("toggle",this.togglePinActive),this.element.addEventListener("close-threads",this.closeThreads),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:i})=>{this.createComment(i.uuid,i.text,i.mentions,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.room.on("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){var e;(e=this.button)==null||e.removeEventListener("toggle",this.togglePinActive),this.element.removeEventListener("close-threads",this.closeThreads),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:i})=>{this.createComment(i.uuid,i.text,i.mentions,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),document.body.removeEventListener("create-annotation",this.createAnnotation),this.room.off("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}setStyles(e=""){if(!e)return;let i=document.createElement("style");i.textContent=e,i.id="superviz-comments-styles",document.head.appendChild(i)}createComment(a,o){return M(this,arguments,function*(e,i,n=[],s=!1){try{let c=yield z.createComment(O.get("apiUrl"),O.get("apiKey"),{annotationId:e,userId:this.localParticipantId,text:i});return yield z.createMentions({commentsId:c.uuid,participants:n.map(l=>({id:l.userId,readed:0}))}),c.mentions=n,s&&this.addComment(e,c),c}catch(c){this.logger.log("error when creating comment",c)}})}addAnnotation(e){let i=[e,...this.annotations];this.element.updateAnnotations(i),this.pinAdapter.updateAnnotations(i),this.updateAnnotationList(i)}updateAnnotationList(e){this.annotations=e,this.room.emit("update-comments",e)}addComment(e,i){let n=this.annotations.find(a=>a.uuid===e);n.comments.push(i);let s=this.annotations.map(a=>a.uuid===e?n:a);this.updateAnnotationList(s),this.element.updateAnnotations(s)}fetchAnnotations(){return M(this,null,function*(){try{let e=yield z.fetchAnnotation(O.get("apiUrl"),O.get("apiKey"),{roomId:O.get("roomId"),url:this.url});this.annotations=e,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(e){this.logger.log("error when fetching annotations",e)}})}waterMarkState(){return M(this,null,function*(){try{let e=yield z.fetchWaterMark(O.get("apiUrl"),O.get("apiKey"));this.element.waterMarkStatus(e)}catch(e){this.logger.log("error when fetching waterMark",e)}})}participantsList(){return M(this,null,function*(){try{let i=(yield z.fetchParticipantsByGroup(this.group.id)).data;this.pinAdapter.participantsList=i,this.element.participantsList=i}catch(e){this.logger.log("error when fetching participantsList",e)}})}};m();var Rt=class{constructor(t,e){this.isPinsVisible=!0;this.selectedPin=null;this.temporaryPinCoordinates=null;this.commentsSide="left";this.setCommentsMetadata=t=>{this.commentsSide=t};this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),this.animateFrame=requestAnimationFrame(this.animate)};this.setMouseDownCoordinates=({x:t,y:e})=>{this.mouseDownCoordinates={x:t,y:e}};this.annotationSelected=({detail:{uuid:t,haltGoToPin:e,newPin:i}})=>{var a,o;if(!t)return;i&&this.pins.get(t).setAttribute("newPin","");let n=JSON.parse((o=(a=this.selectedPin)==null?void 0:a.getAttribute("annotation"))!=null?o:"{}");if(this.resetPins(),(n==null?void 0:n.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let s=this.pins.get(t);s&&(s.setAttribute("active",""),this.selectedPin=s,!e&&this.goToPin(t))};this.onClick=t=>{if(!this.isActive)return;let e=this.canvas.getBoundingClientRect(),{x:i,y:n}=this.mouseDownCoordinates,s=i-e.x,a=n-e.y,o=t.clientX-e.left,c=t.clientY-e.top;if(Math.hypot(o-s,c-a)>10)return;let d=this.canvas.getContext("2d").getTransform().inverse(),h=new DOMPoint(o,c-31).matrixTransform(d);this.onPinFixedObserver.publish({x:h.x,y:h.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:h.x,y:h.y},this.renderTemporaryPin();let f=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,f.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.pins.forEach(i=>{i.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};this.hideTemporaryPin=t=>{var p;let e=t.target,i=e.contains(this.canvas),{x:n,y:s}=t,{left:a,top:o,right:c,bottom:l}=this.canvas.getBoundingClientRect(),u=n>a&&n<c&&s>o&&s<l;this.canvas.contains(e)||(p=this.pins.get("temporary-pin"))!=null&&p.contains(e)||i&&u||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};if(this.logger=new F("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(t),this.isActive=!1,this.pins=new Map,this.goToPinCallback=e==null?void 0:e.onGoToPin,!this.canvas){let i=`Canvas with id ${t} not found`;throw this.logger.log(i),new Error(i)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new W({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins)}destroy(){this.isActive=!1,this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.divWrapper=null,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("keyup",this.resetPins)}setPinsVisibility(t){if(this.isPinsVisible=t,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive){this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.addListeners();return}this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),t!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==t)))}renderTemporaryPin(){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(this.canvasSides)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("participantsList",JSON.stringify(this.participants)),t.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(t));let{x:e,y:i}=this.temporaryPinCoordinates,s=this.canvas.getContext("2d").getTransform(),a=s.e,o=s.f,c=s.a,l=s.d,u=e*c+a,p=i*l+o;t.setAttribute("position",JSON.stringify({x:u,y:p})),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=this.divWrapper;return e||(e=document.createElement("div"),e.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),e.style.position="absolute",e.style.top=`${this.canvas.offsetTop}px`,e.style.left=`${this.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(e),e}renderAnnotationsPins(){if((!this.annotations.length||this.canvas.style.display==="none")&&!this.pins.get("temporary-pin")){this.removeAnnotationsPins();return}this.annotations.forEach(t=>{if(t.resolved)return;let e=JSON.parse(t.position);if((e==null?void 0:e.type)!=="canvas")return;let{x:i,y:n}=e,a=this.canvas.getContext("2d").getTransform(),o=a.e,c=a.f,l=a.a,u=a.d,p=i*l+o,d=n*u+c;if(this.pins.has(t.uuid)){let f=this.pins.get(t.uuid);if(this.divWrapper.clientWidth>p&&this.divWrapper.clientHeight>d){f.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:p,y:d}));return}f.setAttribute("style","opacity: 0");return}let h=document.createElement("superviz-comments-annotation-pin");h.setAttribute("type","show"),h.setAttribute("participantsList",JSON.stringify(this.participants)),h.setAttribute("annotation",JSON.stringify(t)),h.setAttribute("position",JSON.stringify({x:p,y:d})),h.id=t.uuid,this.divWrapper.appendChild(h),this.pins.set(t.uuid,h)})}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}set participantsList(t){this.participants=t}goToPin(t){let e=this.annotations.find(h=>h.uuid===t);if(!e)return;let i=JSON.parse(e.position);if((i==null?void 0:i.type)!=="canvas")return;let n=this.canvas.getBoundingClientRect(),{width:s,height:a}=n,{x:o,y:c}=i,l=s/2,u=a/2,p=l-o,d=u-c;this.goToPinCallback&&this.goToPinCallback({x:p,y:d})}};m();var ao=he(it());var kt=class{constructor(t,e={}){this.isPinsVisible=!0;this.selectedPin=null;this.dataAttribute="data-superviz-id";this.commentsSide="left";this.temporaryPinCoordinates={};this.elementsWithDataId={};this.divWrappers=new Map;this.voidElementsWrappers=new Map;this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","svg","rect","ellipse"];this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))};this.setCommentsMetadata=t=>{this.commentsSide=t};this.hideTemporaryPin=t=>{var a;let e=t.target,i=this.divWrappers.get(this.temporaryPinCoordinates.elementId);if(!i)return;let n=i.contains(e),s=(a=this.pins.get("temporary-pin"))==null?void 0:a.contains(e);n||s||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})};this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.resetHoveredWrapper(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))};this.annotationSelected=({detail:{uuid:t,newPin:e}})=>{if(!t)return;e&&this.pins.get(t).setAttribute("newPin","");let i=this.annotations.find(a=>{var o;return a.uuid===((o=this.selectedPin)==null?void 0:o.id)});if(this.resetPins(),(i==null?void 0:i.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let n=this.pins.get(t);if(!n)return;n.setAttribute("active",""),this.selectedPin=n;let s=this.annotations.find(a=>a.uuid===t);this.selectedPin.setAttribute("elementId",JSON.parse(s.position).elementId)};this.onClick=t=>{if(!this.isActive||t.target===this.pins.get("temporary-pin"))return;let e=t.target,i=t.currentTarget;if(e!==i&&this.pins.has(e.id))return;let n=i.getAttribute("data-wrapper-id"),s=i.getBoundingClientRect(),{x:a,y:o}=this.mouseDownCoordinates,c=t.clientX-s.left,l=t.clientY-s.top,u=a-s.x,p=o-s.y;if(Math.hypot(c-u,l-p)>10)return;let{width:h,height:f}=i.getBoundingClientRect(),v=32,S=i.getBoundingClientRect().width/i.offsetWidth||1;c=c*100/h,l=(l-v*S)*100/f,this.onPinFixedObserver.publish({x:c,y:l,type:"html",elementId:n}),this.resetSelectedPin(),this.temporaryPinCoordinates=R(y({},this.temporaryPinCoordinates),{x:c,y:l}),this.renderTemporaryPin(n);let w=this.pins.get("temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,w.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseDown=({x:t,y:e})=>{this.mouseDownCoordinates={x:t,y:e}};this.handleMutationObserverChanges=t=>{t.forEach(e=>{var l;let{target:i,oldValue:n}=e,s=i.getAttribute(this.dataAttribute);if(!s&&!n||s===n)return;let a=this.dataAttributeValueFilters.some(u=>n.match(u));if(!s&&n&&!a){this.removeAnnotationPin("temporary-pin"),this.clearElement(n),((l=this.selectedPin)==null?void 0:l.getAttribute("elementId"))===n&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null);return}let c=this.dataAttributeValueFilters.some(u=>s.match(u));(n&&this.elementsWithDataId[n]||c)&&this.clearElement(n),!c&&(this.setElementReadyToPin(i,s),this.renderAnnotationsPins())})};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))};this.onMouseEnter=t=>{var s;let e=t.target;if(this.hoveredWrapper=e,!((s=e.getAttribute("data-wrapper-type"))==null?void 0:s.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","1px solid rgb(var(--sv-primary))");return}let n=e.querySelector("ellipse");n.setAttribute("stroke","rgb(var(--sv-primary))"),n.setAttribute("stroke-width","1")};this.onMouseLeave=t=>{var s;let e=t.target;if(this.hoveredWrapper=e,!((s=e.getAttribute("data-wrapper-type"))==null?void 0:s.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","");return}let n=e.querySelector("ellipse");n.removeAttribute("stroke"),n.removeAttribute("stroke-width")};if(this.logger=new F("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(t),!this.container){let s=`Element with id ${t} not found`;throw this.logger.log(s),new Error(s)}if(typeof e!="object")throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:i,dataAttributeValueFilters:n}=e;if(i==="")throw new Error("dataAttributeName must be a non-empty string");if(i===null)throw new Error("dataAttributeName cannot be null");if(i!==void 0&&typeof i!="string")throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=i||this.dataAttribute,this.dataAttributeValueFilters=n||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new W({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){var t;this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach(e=>e.remove()),this.divWrappers.clear(),this.pins.forEach(e=>e.remove()),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],(t=this.svgWrappers)==null||t.remove(),this.svgWrappers=void 0,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(t){this.divWrappers.get(t).addEventListener("click",this.onClick,!0),this.divWrappers.get(t).addEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).addEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).addEventListener("mouseleave",this.onMouseLeave)}removeElementListeners(t){this.divWrappers.get(t).removeEventListener("click",this.onClick,!0),this.divWrappers.get(t).removeEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).removeEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).removeEventListener("mouseleave",this.onMouseLeave)}set participantsList(t){this.participants=t}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){this.divWrappers.forEach((t,e)=>this.addElementListeners(e)),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.divWrappers.forEach((t,e)=>this.removeElementListeners(e)),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach(e=>{let i=e.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some(s=>i.match(s))||this.setElementReadyToPin(e,i)})}addAllCursors(){this.divWrappers.forEach((t,e)=>{this.addCursor(t,e)})}removeAddCursor(){this.divWrappers.forEach((t,e)=>{let i=t,n=t.getAttribute("data-wrapper-type");if(n){let s=n.split("-")[1];i=this.divWrappers.get(e).querySelector(s)}i.style.setProperty("cursor","default"),i.style.setProperty("pointer-events","none")})}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(t){let e=this.pins.get(t);!e&&t==="temporary-pin"||(e&&(e.remove(),this.pins.delete(t)),t!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==t)))}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive){this.addListeners(),this.addAllCursors(),this.prepareElements();return}this.resetPins(),this.removeListeners(),this.removeAddCursor()}}renderTemporaryPin(t){var s,a;(s=this.temporaryPinCoordinates).elementId||(s.elementId=t);let e=this.pins.get("temporary-pin");if(t&&t!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=t,e=null),!e){let o=(a=this.elementsWithDataId[t])==null?void 0:a.getBoundingClientRect();e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(o)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("keepPositionRatio",""),e.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(t,e)}let{x:i,y:n}=this.temporaryPinCoordinates;e.setAttribute("position",JSON.stringify({x:i,y:n})),this.pins.set("temporary-pin",e)}renderAnnotationsPins(){if(!this.annotations.length){this.removeAnnotationsPins();return}this.annotations.forEach(t=>{if(t.resolved)return;let{x:e,y:i,elementId:n,type:s}=JSON.parse(t.position);if(s!=="html"||this.pins.has(t.uuid)||!this.elementsWithDataId[n])return;let o=this.divWrappers.get(n);if(!o)return;let c=this.createPin(t,e,i);o.appendChild(c),this.pins.set(t.uuid,c)})}updatePinsPositions(){this.voidElementsWrappers.forEach((t,e)=>{let i=JSON.stringify(t.getBoundingClientRect()),n=this.elementsWithDataId[e].getBoundingClientRect();this.elementsWithDataId[e].tagName.toLowerCase()==="ellipse"&&(n=this.elementsWithDataId[e].viewportElement.getBoundingClientRect()),!(0,ao.isEqual)(JSON.stringify(n),i)&&(t.style.setProperty("top",`${n.top}px`),t.style.setProperty("left",`${n.left}px`),t.style.setProperty("width",`${n.width}px`),t.style.setProperty("height",`${n.height}px`))})}clearElement(t){if(!this.elementsWithDataId[t])return;let i=this.divWrappers.get(t);if(i){let n=i.children,{length:s}=n;for(let a=0;a<s;++a){let o=n.item(a);this.pins.delete(o.id)}i.remove()}this.voidElementsWrappers.delete(t),this.removeElementListeners(t),this.divWrappers.delete(t),this.elementsWithDataId[t]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}resetHoveredWrapper(){this.hoveredWrapper&&this.onMouseLeave({target:this.hoveredWrapper})}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}setElementReadyToPin(t,e){if(!this.elementsWithDataId[e]){if(this.elementsWithDataId[e]=t,!this.divWrappers.get(e)){let i=this.createWrapper(t,e);this.divWrappers.set(e,i)}!this.isActive||!this.isPinsVisible||(this.addCursor(this.divWrappers.get(e),e),this.addElementListeners(e))}}handleSvgElement(t,e){let i=t.viewportElement;if(i===void 0)return;if(t.tagName.toLowerCase()==="svg"){let w=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return w.setAttribute("height","100%"),w.setAttribute("width","100%"),w.style.setProperty("overflow","visible"),w.appendChild(e),t.appendChild(w),t.style.setProperty("overflow","visible"),e}let a=t.tagName.toLowerCase(),o=a==="ellipse",c=a==="rect";if(!o&&!c)return;let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg",a),p,d,h,f,v,S;if(c){let w=t;p=w.getAttribute("x"),d=w.getAttribute("y"),h=w.getAttribute("width"),f=w.getAttribute("height"),v=w.getAttribute("rx"),S=w.getAttribute("ry"),u.setAttribute("fill","transparent"),u.setAttribute("stroke","transparent"),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("rx",v),u.setAttribute("ry",S)}if(o){let w=t.getAttribute("cx"),j=t.getAttribute("cy");v=t.getAttribute("rx"),S=t.getAttribute("ry"),p=Number(w)-Number(v),d=Number(j)-Number(S);let{width:V,height:H}=i.getBoundingClientRect();h=`${V}px`,f=`${H}px`,u.setAttribute("fill","transparent"),u.setAttribute("stroke","transparent"),u.setAttribute("cx",w),u.setAttribute("cy",j),u.setAttribute("rx",v),u.setAttribute("ry",S)}return u.setAttribute("height",f),u.setAttribute("width",h),l.setAttribute("height",f),l.setAttribute("width",h),l.appendChild(u),e.appendChild(l),t.style.setProperty("overflow","visible"),e.setAttribute("data-wrapper-type",`svg-${a}`),e}addTemporaryPinToElement(t,e){if(!this.elementsWithDataId[t])return;let n=this.divWrappers.get(t);n&&n.appendChild(e)}createPin(t,e,i){let n=document.createElement("superviz-comments-annotation-pin");return n.setAttribute("type","show"),n.setAttribute("annotation",JSON.stringify(t)),n.setAttribute("position",JSON.stringify({x:e,y:i})),n.setAttribute("keepPositionRatio",""),n.setAttribute("participantsList",JSON.stringify(this.participants)),n.id=t.uuid,n}addCursor(t,e){let i=t,n=t.getAttribute("data-wrapper-type");if(n){let s=n.split("-")[1];i=this.divWrappers.get(e).querySelector(s)}i.style.setProperty("cursor",'url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer'),i.style.setProperty("pointer-events","auto")}createWrapper(t,e){var c;let i=`superviz-id-${e}`;if(this.divWrappers.get(e))return;let n=t.getBoundingClientRect(),s=document.createElement("div");s.setAttribute("data-wrapper-id",e),s.id=i,s.style.position="absolute",s.style.pointerEvents="none",s.style.transform="translateX(0) translateY(0) scale(1)",s.style.cursor="default",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none";let a=window.getComputedStyle(t).getPropertyValue("border-radius");if(s.style.borderRadius=a,!this.VOID_ELEMENTS.includes(this.elementsWithDataId[e].tagName.toLowerCase()))return this.elementsWithDataId[e].appendChild(s),this.setPositionNotStatic(this.elementsWithDataId[e]),s;s=(c=this.handleSvgElement(t,s))!=null?c:s,s.style.position="fixed",s.style.top=`${n.top}px`,s.style.left=`${n.left}px`,s.style.width=`${n.width}px`,s.style.height=`${n.height}px`;let o=this.elementsWithDataId[e].parentElement;return(!o||t.viewportElement)&&(o=document.body),this.setPositionNotStatic(o),o.appendChild(s),this.voidElementsWrappers.set(e,s),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),s}setPositionNotStatic(t){let{position:e}=window.getComputedStyle(t);e==="static"&&t.style.setProperty("position","relative")}};m();m();var be=he(co()),ki=class{constructor(){this.browser=be.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(be.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(be.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(be.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(be.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(be.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(be.default.PLATFORMS_MAP.mobile)||this.browser.is(be.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(be.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};m();var Ii=class{constructor(){this.updateMeetingConnectionStatus=t=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=t,this.connectionStatusObserver.publish(t),this.logger.log("CONNECTION STATUS CHANGE",t)};this.onUpdateBrowserOnlineStatus=t=>{let{type:e}=t;if(e==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new F("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new W({logger:this.logger})}addListeners(){typeof window!="undefined"&&(window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus))}removeListeners(){typeof window!="undefined"&&(window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus))}};m();m();var xi=class{constructor(t,e,i){this.myParticipant={};this.localRoomProperties=null;this.drawingData=null;this.state=0;this.MESSAGE_SIZE_LIMIT=6e4;this.useStore=K.bind(this);this.join=()=>{this.room.presence.on(A.LEAVE,this.onParticipantLeave),this.room.presence.on(A.JOINED_ROOM,this.onPresenceEnter),this.enableSync&&(this.room.on("update",this.updateLocalRoomState),this.drawingRoom.presence.on(A.UPDATE,this.updateDrawing))};this.updateMyProperties=t=>{let e=t!=null?t:{};this.isMessageTooBig(e)||this.left||!this.enableSync||this.isSyncFrozen||(e.avatar===void 0&&delete e.avatar,this.myParticipant=y(y({},this.myParticipant),e),this.room.presence.update(this.myParticipant),this.logger.log("REALTIME","updating my properties",this.myParticipant))};this.isMessageTooBig=(t,e=this.MESSAGE_SIZE_LIMIT)=>{let i=JSON.stringify(t);return new TextEncoder().encode(i).length>e?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let e=y(y({},this.localRoomProperties),t);this.localRoomProperties=e,this.room.emit("update",e)};this.updateDrawingProperties=t=>{this.isMessageTooBig(t)||this.isSyncFrozen||this.left||(this.drawingData=y(y({},this.drawingData),t),this.drawingRoom.presence.update(this.drawingData))};this.setHost=t=>{this.updateRoomProperties({hostClientId:t})};this.setKickParticipant=t=>{if(!t)return;let{participants:e}=K("global-store"),i=e.value[t];this.updateRoomProperties({kickParticipant:i})};this.initializeRoomProperties=()=>{let t={isGridModeEnabled:!1,hostClientId:null,followParticipantId:null,gather:!1,transcript:"transcript.stop",kickParticipant:null};this.localRoomProperties=t,this.updateRoomProperties(t)};this.onParticipantLeave=t=>{var i;t.id===this.myParticipant.id&&(this.left=!0),t.id===((i=this.localRoomProperties)==null?void 0:i.followParticipantId)&&this.setFollowParticipant()};this.start=()=>M(this,null,function*(){this.started||(this.started=!0,this.room.isJoined||(this.logger.log("room state service - not joined room yet"),setTimeout(()=>{this.logger.log("room state service - retrying"),this.start()},2e3)),this.localRoomProperties=yield this.fetchRoomProperties(),this.localRoomProperties?this.updateLocalRoomState({data:this.localRoomProperties}):this.initializeRoomProperties(),this.publishStateUpdate(4),this.logger.log("REALTIME","Joined realtime room"))});this.onPresenceEnter=()=>{this.updateMyProperties()};this.updateLocalRoomState=e=>M(this,[e],function*({data:t}){this.logger.log("REALTIME","Room update received",t),this.localRoomProperties=Object.assign({},this.localRoomProperties,t);let{followParticipantId:i,gather:n,hostId:s,isGridModeEnabled:a,transcript:o}=this.useStore("video-store");i.publish(t.followParticipantId),n.publish(t.gather),s.publish(t.hostClientId),a.publish(t.isGridModeEnabled),o.publish(t.transcript),t.kickParticipant&&t.kickParticipant.id===this.myParticipant.id&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.id))});this.updateDrawing=t=>{if(t.id===this.myParticipant.id)return;let{drawing:e}=this.useStore("video-store");e.publish(t.data)};this.freezeSync=t=>{if(this.isSyncFrozen=t,t){this.destroy();return}this.join()};this.room=t,this.drawingRoom=e,this.logger=i,this.kickParticipantObserver=new W({logger:this.logger});let{localParticipant:n,participants:s}=this.useStore("global-store");n.subscribe(a=>{this.enableSync=a.type!=="audience",this.myParticipant=y(y({},this.myParticipant),a)}),s.subscribe(),this.join()}setGridMode(t){this.updateRoomProperties({isGridModeEnabled:t})}setDrawing(t){this.updateDrawingProperties(t)}setTranscript(t){this.updateRoomProperties({transcript:t})}fetchRoomProperties(){return M(this,null,function*(){if((yield new Promise(s=>{this.room.presence.get(a=>{a||s(0),s(a.length)})}))<=1)return null;let e=yield new Promise((s,a)=>{this.room.history(o=>{o||a(o),o.events.length||s(null);let c=o.events.pop();s(c)})}),i=1e3*60*60,n=(e==null?void 0:e.timestamp)<Date.now()-i;return!(e!=null&&e.data)||n?null:e.data})}publishStateUpdate(t){if(this.state===t)return;this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${rn[this.state]}`);let{meetingState:e}=this.useStore("video-store");e.publish(this.state)}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}destroy(){this.room.presence.off(A.LEAVE),this.room.presence.off(A.JOINED_ROOM),this.drawingRoom.presence.off(A.UPDATE),this.room.off("update",this.updateLocalRoomState)}};m();m();var Ni=class{build(t,e,i,n={},s={}){let a=document.querySelector(`#${t}`),o=new URL(e);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(n).forEach(([c,l])=>{o.searchParams.set(c,l)}),Object.entries(s).forEach(([c,l])=>{this.element.setAttribute(c,l)}),this.element.src=o.toString(),this.element.id=i,a.appendChild(this.element),this.wrapperId=t}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let t=document.querySelector(`#${this.wrapperId}`);t&&t.querySelector(`#${this.element.id}`)&&t.removeChild(this.element),this.wrapperId=null,this.element=null}};m();var Fi=class{constructor(t){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(t,e={})=>{this.logger.log("MessageBridge","Posting message to frame",t,e),this.contentWindow.postMessage({type:t,data:e},this.allowedOrigins)};this.listen=(t,e)=>{this.observers[t]||(this.observers[t]=new W({logger:this.logger})),this.observers[t].subscribe(e)};this.onReceiveMessage=t=>{let{type:e,data:i,source:n}=t.data;if(this.sourceBlockList.includes(n)||this.originBlockList.includes(t.origin))return;let s=!!e,a=!this.domains.length||this.domains.includes(t.origin),o=this.observers.hasOwnProperty(e);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${t.type}
        ORIGIN: ${t.origin}
        DATA: ${JSON.stringify(t.data)} `),!s||!a||!o){this.logger.log("MessageBridge","Message discarded");return}this.observers[e].publish(i)};let{contentWindow:e,domains:i=[],allowedOrigins:n="*",sourceBlockList:s=[],logger:a}=t;if(this.logger=a,this.domains=i,this.allowedOrigins=n,this.sourceBlockList.push(...s),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=e,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([t,e])=>{e.reset(),delete this.observers[t]}),typeof window!="undefined"&&window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};var lo="sv-video-frame",xt=class{constructor(t){this.logger=new F("@superviz/sdk/video-conference-manager");this.frameStateObserver=new W({logger:this.logger});this.frameSizeObserver=new W({logger:this.logger});this.waitingForHostObserver=new W({logger:this.logger});this.realtimeEventsObserver=new W({logger:this.logger});this.sameAccountErrorObserver=new W({logger:this.logger});this.devicesObserver=new W({logger:this.logger});this.meetingStateObserver=new W({logger:this.logger});this.meetingConnectionObserver=new W({logger:this.logger});this.participantJoinedObserver=new W({logger:this.logger});this.participantLeftObserver=new W({logger:this.logger});this.participantListObserver=new W({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(t,e)=>{let i=t,n=e,s=["left","right","bottom","top"].includes(n),a=["left","right","center"].includes(i);return s||(n="right"),a||(i="right"),this.browserService.isMobileDevice?(n="bottom",{layoutPosition:i,camerasPosition:n}):(i==="left"&&n==="right"&&(i="right"),i==="right"&&n==="left"&&(i="left"),{layoutPosition:i,camerasPosition:n})};this.onFrameLoad=()=>{this.messageBridge=new Fi({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors(),this.setCallbacks()};this.setFrameOffset=t=>{let e=t!=null?t:{};["top","bottom","left","right"].forEach(i=>{Object.keys(e).includes(i)||(e[i]=0)}),this.frameOffset=e};this.setCustomColors=()=>{this.customColors&&this.messageBridge.publish("frame.color-list-update",this.customColors),this.styles&&this.messageBridge.publish("frame.styles-update",this.styles)};this.setCallbacks=()=>{if(!this.callbacks)return;let t={onToggleMicrophone:!!this.callbacks.onToggleMicrophone,onToggleCam:!!this.callbacks.onToggleCam,onToggleRecording:!!this.callbacks.onToggleRecording,onToggleChat:!!this.callbacks.onToggleChat,onToggleScreenShare:!!this.callbacks.onToggleScreenShare,onClickHangup:!!this.callbacks.onClickHangup,onToggleMeetingSetup:!!this.callbacks.onToggleMeetingSetup};this.messageBridge.listen("callback-called",e=>{var i,n;(n=(i=this.callbacks)[e])==null||n.call(i)}),this.messageBridge.publish("frame.callbacks-update",JSON.stringify(t))};this.setFrameStyle=t=>{let e=document.createElement("style"),{bottom:i,left:n,right:s,top:a}=this.frameOffset;if(e.innerHTML=`
      :root {
        --superviz-offset-top: ${a}px;
        --superviz-offset-right: ${s}px;
        --superviz-offset-left: ${n}px;
        --superviz-offset-bottom: ${i}px;
      }     
    `,document.head.appendChild(e),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${t}`)};this.onFrameDimensionsUpdate=({width:t,height:e})=>{if(typeof window=="undefined")return;let i=document.getElementById(lo),{bottom:n,right:s,left:a,top:o}=this.frameOffset,c=this.isWaterMarkEnabled?40:0,l=`${t}px`,u=`${e+c}px`;(t>=window.innerWidth||this.isHorizontalCameraEnabled)&&(l=`calc(100% - ${s}px - ${a}px)`),e>=window.innerHeight&&(u=`calc(100% - ${o}px - ${n}px)`),i.style.width=l,i.style.height=u,this.frameSizeObserver.publish({width:i.offsetWidth,height:i.offsetHeight})};this.onWindowResize=()=>{let{top:t,bottom:e,right:i,left:n}=this.frameOffset,{innerHeight:s,innerWidth:a}=window,o=s-t-e,c=a-i-n;this.messageBridge&&this.messageBridge.publish("frame.parent-window-size-update",{height:o,width:c})};this.updateFrameLocale=()=>{var s,a;if(!this.frameLocale||!((s=this.frameLocale)!=null&&s.language)&&((a=this.frameLocale)!=null&&a.locales))return;let{language:t,locales:e}=this.frameLocale,n=["en",...e.map(o=>o==null?void 0:o.language)];if(t&&!n.includes(t))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=t=>{this.participantJoinedObserver.publish(t)};this.onParticipantLeft=t=>{this.participantLeftObserver.publish(t)};this.onMeetingHostChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:t})};this.onMeetingKickParticipant=t=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:t})};this.onFollowParticipantDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:t})};this.onGoToDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:t})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:t})};this.onDrawingChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:t})};this.onTranscriptChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:t})};this.onSameAccountError=t=>{this.sameAccountErrorObserver.publish(t)};this.onDevicesChange=t=>{this.devicesObserver.publish(t)};this.meetingStateUpdate=t=>{this.meetingStateObserver.publish(t)};this.onConnectionStatusChange=t=>{this.meetingConnectionObserver.publish(t)};this.onWaitingForHostDidChange=t=>{this.waitingForHostObserver.publish(t)};this.onParticipantListUpdate=t=>{this.participantListObserver.publish(t)};var Xe,Qe,et,tt;let{language:e,canUseCams:i,canUseChat:n,canUseScreenshare:s,canUseDefaultAvatars:a,canUseFollow:o,canUseGoTo:c,canUseGather:l,canShowAudienceList:u,canUseDefaultToolbar:p,canUseRecording:d,browserService:h,offset:f,locales:v,avatars:S,customColors:w,styles:j,waterMark:V,layoutPosition:H,camerasPosition:q,skipMeetingSettings:D,devices:G,layoutMode:$,collaborationMode:Z,callbacks:se}=t;this.browserService=h;let we=this.layoutModalsAndCamerasConfig(H,q),Me=document.createElement("div");this.frameConfig={apiKey:O.get("apiKey"),apiUrl:O.get("apiUrl"),debug:O.get("debug"),roomId:O.get("roomId"),limits:O.get("limits"),collaborationMode:Z,canUseFollow:o,canUseGoTo:c,canUseCams:i,canUseChat:n,canUseGather:l,canUseScreenshare:s,canUseDefaultAvatars:a,canUseRecording:d,canShowAudienceList:u,camerasPosition:(Xe=we.camerasPosition)!=null?Xe:"right",canUseDefaultToolbar:p,devices:{audioInput:(Qe=G==null?void 0:G.audioInput)!=null?Qe:!0,audioOutput:(et=G==null?void 0:G.audioOutput)!=null?et:!0,videoInput:(tt=G==null?void 0:G.videoInput)!=null?tt:!0},waterMark:V,layoutMode:$,skipMeetingSettings:D,layoutPosition:we.layoutPosition,transcriptLangs:O.get("features.transcriptLangs")},this.customColors=w,this.callbacks=se,this.styles=j,Me.classList.add("sv_video_wrapper"),Me.id="sv-video-wrapper",document.body.appendChild(Me),this.updateFrameState(1),this.bricklayer=new Ni,this.bricklayer.build(Me.id,O.get("conferenceLayerUrl"),lo,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(f),this.setFrameStyle(we.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:e,locales:v},this.meetingAvatars=S,typeof window!="undefined"&&(window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize))}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(t){t!==this.frameState&&(this.frameState=t,this.frameStateObserver.publish(this.frameState));let e={1:6,2:7,0:8};this.meetingStateUpdate(e[t])}start(t){this.messageBridge.publish("meeting.start",R(y({},t),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var t,e,i,n,s,a,o,c,l,u;(t=this.messageBridge)==null||t.destroy(),(e=this.bricklayer)==null||e.destroy(),(i=this.frameSizeObserver)==null||i.destroy(),(n=this.realtimeEventsObserver)==null||n.destroy(),(s=this.sameAccountErrorObserver)==null||s.destroy(),(a=this.devicesObserver)==null||a.destroy(),(o=this.meetingStateObserver)==null||o.destroy(),(c=this.meetingConnectionObserver)==null||c.destroy(),(l=this.participantJoinedObserver)==null||l.destroy(),(u=this.participantLeftObserver)==null||u.destroy(),this.bricklayer=null,this.frameState=null,typeof window!="undefined"&&(window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onWindowResize))}publishMessageToFrame(t,e){this.messageBridge&&this.messageBridge.publish(t,e)}};m();var Vr=class{constructor(){this.logger=new F("@superviz/sdk/core-bridge"),this.logger.log("CoreBridge initialized")}updateLocalParticipant(t){this.logger.log("updateLocalParticipant",t);let{localParticipant:e}=K("core-store");e.publish(t)}updateParticipantsList(t){this.logger.log("updateParticipantsList",t);let{participants:e}=K("core-store");e.publish(t)}},Nt=new Vr;var tu=1e3*60,Se=null,Ft=class extends Q{constructor(e){var i,n;super();this.participantsOnMeeting=[];this.kickParticipantsOnHostLeave=!1;this.startVideo=()=>{var i,n,s,a,o,c,l,u,p,d,h,f,v,S,w,j,V,H,q,D,G,$,Z,se,we,Me,Xe,Qe,et,tt,Hr,zr,$r,Zr,Jr,qr,Kr,Yr;let e=((i=this.params)==null?void 0:i.userType)!=="audience"&&((n=this.params)==null?void 0:n.defaultAvatars)===!0;this.videoConfig={language:(s=this.params)==null?void 0:s.language,canUseRecording:!!((a=this.params)!=null&&a.enableRecording),canShowAudienceList:(c=(o=this.params)==null?void 0:o.showAudienceList)!=null?c:!0,canUseChat:!((l=this.params)!=null&&l.chatOff),canUseCams:!((u=this.params)!=null&&u.camsOff),canUseScreenshare:!((p=this.params)!=null&&p.screenshareOff),canUseDefaultAvatars:e&&!((h=(d=this.localParticipant)==null?void 0:d.avatar)!=null&&h.model3DUrl),canUseGather:!!((f=this.params)!=null&&f.enableGather),canUseFollow:!!((v=this.params)!=null&&v.enableFollow),canUseGoTo:!!((S=this.params)!=null&&S.enableGoTo),canUseDefaultToolbar:(j=(w=this.params)==null?void 0:w.defaultToolbar)!=null?j:!0,camerasPosition:(H=(V=this.params)==null?void 0:V.collaborationMode)==null?void 0:H.position,devices:(q=this.params)==null?void 0:q.devices,skipMeetingSettings:(D=this.params)==null?void 0:D.skipMeetingSettings,browserService:this.browserService,offset:(G=this.params)==null?void 0:G.offset,locales:(Z=($=this.params)==null?void 0:$.locales)!=null?Z:[],avatars:(we=(se=this.params)==null?void 0:se.avatars)!=null?we:[],customColors:O.get("colors"),waterMark:O.get("waterMark"),styles:(Me=this.params)==null?void 0:Me.styles,collaborationMode:(et=(Qe=(Xe=this.params)==null?void 0:Xe.collaborationMode)==null?void 0:Qe.enabled)!=null?et:!0,layoutPosition:((Hr=(tt=this.params)==null?void 0:tt.collaborationMode)==null?void 0:Hr.enabled)===!1?"center":(Zr=($r=(zr=this.params)==null?void 0:zr.collaborationMode)==null?void 0:$r.modalPosition)!=null?Zr:"center",layoutMode:(Kr=(qr=(Jr=this.params)==null?void 0:Jr.collaborationMode)==null?void 0:qr.initialView)!=null?Kr:"list",callbacks:(Yr=this.params)==null?void 0:Yr.callbacks},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new xt(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.videoManager&&(this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange))};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.room.presence.on(A.UPDATE,this.onParticipantUpdateOnRealtime),this.room.presence.on(A.JOINED_ROOM,this.onParticipantJoinedOnRealtime),this.room.presence.on(A.LEAVE,this.onParticipantLeftOnRealtime)};this.unsubscribeFromRealtimeEvents=()=>{var e;this.logger.log("video conference @ unsubscribe from realtime events"),this.room.presence.off(A.UPDATE),this.room.presence.off(A.LEAVE),this.room.presence.off(A.JOINED_ROOM),(e=this.roomState)==null||e.kickParticipantObserver.unsubscribe(this.onKickLocalParticipant)};this.subscribeToStoreUpdates=()=>{let{localParticipant:e,group:i,participants:n}=this.useStore("global-store");n.subscribe(p=>{let d=Object.values(p);this.onRealtimeParticipantsDidChange(d)});let{drawing:s,hostId:a,isGridModeEnabled:o,transcript:c,followParticipantId:l,gather:u}=this.useStore("video-store");e.subscribe(p=>{this.localParticipant=R(y(y({},this.localParticipant),p),{type:this.params.userType})}),s.subscribe(this.setDrawing),a.subscribe(this.setHost),o.subscribe(this.setGridMode),c.subscribe(this.setTranscript),l.subscribe(this.setFollowParticipant),u.subscribe(this.setGather),i.subscribe()};this.createParticipantFromPresence=e=>{var i;return{participantId:e.id,id:e.id,color:((i=e.data.slot)==null?void 0:i.color)||ie.gray,avatar:e.data.avatar,type:e.data.type,name:e.data.name,isHost:e.data.isHost,timestamp:e.timestamp,slot:e.data.slot}};this.onFrameSizeDidChange=e=>{this.publish("frame.dimensions-update",e)};this.onWaitingForHost=e=>{this.publish("meeting.waiting-for-host",e)};this.onConnectionStatusChange=e=>{this.logger.log("video conference @ on connection status change",e);let i=[2,4,3,6];i.includes(e)&&this.roomState.freezeSync(!0),i.includes(this.connectionService.oldConnectionStatus)&&!i.includes(e)&&this.roomState.freezeSync(!1),this.publish("meeting.connection-status-change",e)};this.onMeetingStateChange=e=>{this.logger.log("video conference @ on meeting state change",e),this.publish("meeting.state-update",e)};this.onSameAccountError=e=>{this.publish("meeting.same-participant-error",e),this.detach()};this.onDevicesChange=e=>{this.publish("meeting.devices-change",e)};this.onFrameStateChange=e=>{this.logger.log("video conference @ on frame state change",e),e===2&&(this.roomState=new xi(this.room,this.drawingRoom,this.logger),this.roomState.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.roomState.start(),this.params.userType!=="guest"&&(this.localParticipant=Object.assign(this.localParticipant,{type:this.params.userType}),this.roomState.updateMyProperties(y({},this.localParticipant))),this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:O.get("roomId")}),this.publish("meeting.start"))};this.onRealtimeEventFromFrame=({event:e,data:i})=>{this.logger.log("video conference @ on realtime event from frame",e,i);let n={"realtime.host-change":s=>this.roomState.setHost(s),"realtime.gather":s=>this.roomState.setGather(s),"realtime.grid-mode-change":s=>this.roomState.setGridMode(s),"realtime.drawing-change":s=>{this.roomState.setDrawing(s)},"realtime.follow-participant":s=>{this.roomState.setFollowParticipant(s)},"meeting.kick-participant":s=>{this.roomState.setKickParticipant(s)},"realtime.transcript-change":s=>{this.roomState.setTranscript(s)},"realtime.go-to-participant":s=>{this.eventBus.publish("realtime.go-to-participant",s)}}[e](i);this.publish(e,i)};this.onParticipantJoined=e=>{var a;this.logger.log("video conference @ on participant joined",e),this.publish("meeting.participant-joined",e),this.publish("my-participant.joined",e),this.kickParticipantsOnHostLeave=!((a=this.params)!=null&&a.allowGuests);let{localParticipant:i,participants:n}=this.useStore("global-store"),s=e.name.trim();if(this.videoConfig.canUseDefaultAvatars){this.roomState.updateMyProperties({avatar:e.avatar,name:e.name,type:e.type,joinedMeeting:!0}),Nt.updateLocalParticipant(R(y({},i.value),{avatar:e.avatar,name:e.name,type:this.params.userType})),Nt.updateParticipantsList(R(y({},n.value),{[e.id]:R(y({},n.value[e.id]),{avatar:e.avatar,name:e.name})}));return}Nt.updateLocalParticipant(R(y({},i.value),{name:s,type:this.params.userType})),Nt.updateParticipantsList(R(y({},n.value),{[e.id]:R(y({},n.value[e.id]),{name:s,type:this.params.userType})})),this.roomState.updateMyProperties({name:e.name,type:e.type,joinedMeeting:!0})};this.onParticipantLeft=e=>{var s,a;this.logger.log("video conference @ on participant left",this.localParticipant);let{localParticipant:i,participants:n}=this.useStore("global-store");i.publish(R(y({},i.value),{activeComponents:(s=i.value.activeComponents)==null?void 0:s.filter(o=>o!=="videoConference")})),n.publish(R(y({},n.value),{[this.localParticipant.id]:R(y({},i.value),{activeComponents:(a=i.value.activeComponents)==null?void 0:a.filter(o=>o!=="videoConference")})})),this.connectionService.removeListeners(),this.publish("my-participant.left",this.localParticipant),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.videoManager=void 0,this.connectionService=void 0,this.detach()};this.onParticipantListUpdate=e=>{this.logger.log("video conference @ on participant list update",e);let i=Object.values(e).map(n=>{var s,a;return{id:n.id,slot:n.slot,avatar:n.avatar,name:n.name,type:n.type,isHost:(s=n.isHost)!=null?s:!1,timestamp:n.timestamp,color:((a=n.slot)==null?void 0:a.color)||ie.gray}});this.publish("meeting.participant-list-update",i),this.participantsOnMeeting.length!==i.length&&this.publish("meeting.amount-of-participants-update",i.length),this.participantsOnMeeting=i,this.validateIfInTheRoomHasHost()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.setDrawing=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.drawing-change",e)};this.setHost=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.host-change",e),this.onHostParticipantDidChange(e)};this.setGridMode=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.grid-mode-change",e)};this.setTranscript=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.transcript-change",e)};this.setFollowParticipant=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.follow-participant",e),this.eventBus.publish("realtime.follow-participant",e)};this.setGather=e=>{if(!this.videoManager||!e)return;let{hostId:i,gather:n}=this.useStore("video-store");if(n.publish(!1),i.value!==this.localParticipant.id){this.eventBus.publish("realtime.go-to-participant",i.value);return}this.videoManager.publishMessageToFrame("realtime.gather",e)};this.onRealtimeParticipantsDidChange=e=>{var n;this.logger.log("video conference @ on participants did change",e);let i=e.map(s=>{var a,o;return{id:s.id,timestamp:s.timestamp,participantId:s.id,color:((a=s.slot)==null?void 0:a.color)||ie.gray,name:s.name,isHost:(o=s.isHost)!=null?o:!1,avatar:s.avatar,type:s.type,slot:s.slot}});(n=this.videoManager)==null||n.publishMessageToFrame("realtime.participant-list-update",i)};this.onHostParticipantDidChange=e=>{var a,o;this.logger.log("video conference @ on host participant did change",e),(a=this.videoManager)==null||a.publishMessageToFrame("realtime.host-change",e);let{participants:i}=this.useStore("global-store"),n=Object.values(i.value).find(c=>c.id===e),s=n?{id:n.id,color:((o=n.slot)==null?void 0:o.color)||ie.gray,avatar:n.avatar,type:n.type,name:n.name,isHost:n.id===e}:null;Se&&s&&(this.logger.log("video conference @ on host participant did change - clear kick all participants timeout"),clearTimeout(Se),Se=null),this.publish("meeting.host-change",s)};this.onHostAvailabilityChange=e=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),e){this.publish("meeting.host-available");return}this.publish("meeting.no-host-available")};this.onParticipantJoinedOnRealtime=e=>{this.logger.log("video conference @ on participant joined on realtime",e),this.publish("meeting.participant-joined",this.createParticipantFromPresence(e)),e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onParticipantLeftOnRealtime=e=>{this.logger.log("video conference @ on participant left on realtime",e),this.publish("meeting.participant-left",this.createParticipantFromPresence(e))};this.onParticipantUpdateOnRealtime=e=>{this.logger.log("video conference @ on participant update on realtime",e);let{localParticipant:i,participants:n}=this.useStore("global-store");e.data.id===this.localParticipant.id&&this.publish("my-participant.update",this.createParticipantFromPresence(e)),n.publish(R(y({},n.value),{[e.data.id]:y(y({},i.value),e.data)}))};this.validateIfInTheRoomHasHost=()=>{var c,l;if(!this.roomState)return;let{hostId:e}=this.useStore("video-store"),{participants:i}=this.useStore("global-store"),n=Object.values(i.value),s=n.filter(u=>u.type==="host"&&this.participantsOnMeeting.some(p=>p.id===u.id));!s.length&&this.kickParticipantsOnHostLeave&&((c=this.localParticipant)==null?void 0:c.type)!=="host"&&!Se&&(this.logger.log("video conference @ validate if in the room has host - init kick all participants timeout"),Se=setTimeout(()=>{this.logger.log("video conference @ validate if in the room has host - kick all participants"),this.onKickLocalParticipant()},tu)),s.length&&Se&&(this.logger.log("video conference @ validade if in the room has host - clear kick all participants timeout"),clearTimeout(Se),Se=null),this.onHostAvailabilityChange(!!s.length);let a=n.find(u=>(u==null?void 0:u.id)===(e==null?void 0:e.value));if(!s.length||a)return;let o=s.reduce((u,p)=>(this.logger.log("video conference @ validate if in the room has host - reducing participants",{previous:u,current:p}),!u||(p==null?void 0:p.id)===e.value?p:(p==null?void 0:p.timestamp)>u.timestamp?u:p),null);this.room.presence.update(R(y({},this.localParticipant),{isHost:o.id===this.localParticipant.id})),!(!o||o.id!==((l=this.localParticipant)==null?void 0:l.id))&&(this.logger.log("video conference @ validate if in the room has host - set host",o),e.publish(o.id),this.roomState.setHost(o.id))};this.params=R(y({},e),{userType:(n=(i=e==null?void 0:e.participantType)!=null?i:e==null?void 0:e.userType)!=null?n:"guest"}),this.name="videoConference",this.logger=new F("@superviz/sdk/videoConference"),this.browserService=new ki,this.connectionService=new Ii,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){var e;return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle microphone");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle camera");return}(e=this.videoManager)==null||e.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle screen share");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){var e;return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-chat")}toggleRecording(){var e;if(this.localParticipant.isHost){console.warn("[SuperViz] Only host can toggle recording");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-recording")}hangUp(){var e;(e=this.videoManager)==null||e.publishMessageToFrame("hang-up")}start(){this.logger.log("video conference @ start"),this.drawingRoom=this.ioc.createRoom("drawing"),this.subscribeToStoreUpdates(),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){var i,n,s;this.logger.log("video conference @ destroy");let{destroy:e}=this.useStore("video-store");e(),(i=this.roomState)==null||i.destroy(),this.drawingRoom.disconnect(),this.kickParticipantsOnHostLeave=!1,this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),(n=this.videoManager)==null||n.leave(),(s=this.connectionService)==null||s.removeListeners()}};m();m();var uo=he(it());var Di=class extends Q{constructor(e,i){var s;super();this.camera={x:0,y:0,screen:{width:0,height:0},scale:1};this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(A.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(A.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(A.UPDATE,this.onPresenceUpdate)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(A.JOINED_ROOM),this.room.presence.off(A.LEAVE),this.room.presence.off(A.UPDATE)};this.setParticipantPrivate=e=>{this.isPrivate=e,this.room.presence.update({visible:!e})};this.onPresenceJoinedRoom=e=>{e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=e=>{this.removePresenceMouseParticipant(e.id)};this.onPresenceUpdate=e=>{if(this.following&&this.presences.get(this.following)&&this.goToMouse(this.following),e.id===this.localParticipant.id)return;let i=e.data;if(this.following&&i.id!==this.following&&this.presences.has(i.id)){this.removePresenceMouseParticipant(i.id);return}this.presences.set(i.id,i)};this.animate=()=>{this.getCamera(),this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.goToMouse=e=>{let i=this.presences.get(e);if(!(i!=null&&i.camera))return;let n=i.camera.x,s=i.camera.y,a=this.divWrapper.clientHeight/i.camera.screen.height,o=Math.min(a,1),c=this.divWrapper.clientWidth/i.camera.screen.width,l=Math.min(c,1);this.goToMouseCallback&&this.goToMouseCallback({x:n,y:s,scaleX:o,scaleY:l})};this.onMyParticipantMouseMove=(0,uo.throttle)(e=>{let i=this.canvas.getContext("2d"),n=this.canvas.getBoundingClientRect(),s=e.x-n.left,a=e.y-n.top,c=(i==null?void 0:i.getTransform()).inverse(),l=new DOMPoint(s,a).matrixTransform(c),u={x:l.x,y:l.y};this.room.presence.update(R(y(y({},this.localParticipant),u),{visible:!this.isPrivate,camera:this.camera}))},30);this.onMyParticipantMouseOut=e=>{let{x:i,y:n,width:s,height:a}=this.canvas.getBoundingClientRect();e.x>0&&e.y>0&&e.x<i+s&&e.y<n+a||this.room.presence.update({visible:!1})};this.updateParticipantsMouses=()=>{this.presences.forEach(e=>{if(!(e!=null&&e.visible)||this.following&&this.following!==e.id){this.removePresenceMouseParticipant(e.id);return}this.renderPresenceMouses(e)})};this.getCamera=()=>{var o;let e=(o=this.canvas)==null?void 0:o.getContext("2d"),i=e==null?void 0:e.getTransform(),n=i==null?void 0:i.e,s=i==null?void 0:i.f,a=i==null?void 0:i.a;this.camera={screen:{width:this.divWrapper.clientHeight,height:this.divWrapper.clientWidth},x:n,y:s,scale:a}};this.renderPresenceMouses=e=>{var H,q,D,G,$;let n=document.getElementById(`mouse-${e.id}`);n||(n=this.createMouseElement(e));let s=document.getElementById(`mouse-${e.id}`),a=document.getElementById(`mouse-${e.id}`);if(!s||!a)return;let o=s.getElementsByClassName("mouse-user-name")[0],c=a.getElementsByClassName("pointer-mouse")[0];c&&(c.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${(H=e.slot)==null?void 0:H.colorName}.svg)`),o&&(o.style.color=(D=(q=e.slot)==null?void 0:q.textColor)!=null?D:"#fff",o.style.backgroundColor=($=(G=e.slot)==null?void 0:G.color)!=null?$:ie.gray,o.innerHTML=e.name);let{x:l,y:u}=e,p=this.canvas.getContext("2d"),d=p==null?void 0:p.getTransform(),h=d==null?void 0:d.e,f=d==null?void 0:d.f,v=d.a,S=d.d,w=l*v+h,j=u*S+f,V=this.divWrapper.clientWidth>w&&this.divWrapper.clientHeight>j&&e.visible;n.style.opacity=V?"1":"0",n.style.left=`${w}px`,n.style.top=`${j}px`};this.followMouse=e=>{this.following=e,this.goToMouse(e)};if(this.name="presence",this.logger=new F("@superviz/sdk/presence"),this.canvas=document.getElementById(e),this.presences=new Map,!this.canvas){let a=`Canvas with id ${e} not found`;throw this.logger.log(a),new Error(a)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=(s=i==null?void 0:i.callbacks)==null?void 0:s.onGoToPresence;let{localParticipant:n}=this.useStore("global-store");n.subscribe(),this.getCamera()}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents()}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let e=this.canvas.getBoundingClientRect(),i=document.getElementById("superviz-presence-mouse-wrapper");return i||(i=document.createElement("div"),i.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(i)),i.style.position="fixed",i.style.top=`${e.top}px`,i.style.left=`${e.left}px`,i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.pointerEvents="none",i.style.overflow="hidden",i.style.zIndex="2",i}removePresenceMouseParticipant(e){let i=document.getElementById(`mouse-${e}`);i&&(i.remove(),this.presences.delete(e))}createMouseElement(e){let i=document.createElement("div");i.setAttribute("id",`mouse-${e.id}`),i.setAttribute("class","mouse-follower");let n=document.createElement("div");n.setAttribute("class","pointer-mouse");let s=document.createElement("div");return s.setAttribute("class","mouse-user-name"),s.innerHTML=e.name,i.appendChild(n),i.appendChild(s),i.style.left="0px",i.style.top="0px",this.divWrapper.appendChild(i),i}transform(e){console.warn("[SuperViz] - transform method not available when container is a canvas element.")}};m();var po=he(it());m();var Bi=(f=>(f.AREA="area",f.BASE="base",f.BR="br",f.COL="col",f.EMBED="embed",f.HR="hr",f.IMG="img",f.INPUT="input",f.LINK="link",f.META="meta",f.PARAM="param",f.SOURCE="source",f.TRACK="track",f.WBR="wbr",f))(Bi||{}),Ui=(i=>(i.RECT="rect",i.ELLIPSE="ellipse",i.SVG="svg",i))(Ui||{});var Gi=class extends Q{constructor(e,i){var s;super();this.presences=new Map;this.mouses=new Map;this.transformation={translate:{x:0,y:0},scale:1};this.onMyParticipantMouseMove=e=>{if(this.isPrivate)return;let i=e.currentTarget,{left:n,top:s}=i.getBoundingClientRect(),a=(e.x-n-this.transformation.translate.x)/this.transformation.scale,o=(e.y-s-this.transformation.translate.y)/this.transformation.scale;this.room.presence.update(R(y({},this.localParticipant),{x:a,y:o,visible:!0,camera:this.camera}))};this.onMyParticipantMouseLeave=e=>{if(typeof window=="undefined")return;let{left:i,top:n,right:s,bottom:a}=this.container.getBoundingClientRect(),o=e.x>i&&e.y>n&&e.x<s&&e.y<a,c=e.x>0&&e.y>0&&e.x<window.innerWidth&&e.y<window.innerHeight;o&&c||this.room.presence.update({visible:!1})};this.goToMouse=e=>{let i=this.mouses.get(e),n=this.presences.get(e);if(n){if(this.goToPresenceCallback){let s=this.camera.screen.width/n.camera.screen.width,a=this.camera.screen.height/n.camera.screen.height,o=n.camera.x*s,c=n.camera.y*a,l=n.camera.scale*s,u=n.camera.scale*a;this.goToPresenceCallback({x:o,y:c,scaleX:l,scaleY:u});return}i&&i.scrollIntoView({block:"center",inline:"center",behavior:"smooth"})}};this.followMouse=e=>{this.userBeingFollowedId=e,this.goToMouse(e)};this.setParticipantPrivate=e=>{this.isPrivate=e,this.room.presence.update({visible:!e})};this.onPresenceJoinedRoom=e=>{e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=e=>{this.removePresenceMouseParticipant(e.id)};this.onPresenceUpdate=e=>{if(e.id===this.localParticipant.id)return;let i=e.data;if(this.userBeingFollowedId&&i.id!==this.userBeingFollowedId&&this.presences.has(i.id)){this.removePresenceMouseParticipant(i.id);return}this.presences.set(i.id,i),this.animate(),this.updateParticipantsMouses()};this.animate=()=>{Bi[this.containerTagname]&&this.updateVoidElementWrapper(),Ui[this.containerTagname]&&this.updateSVGElementWrapper(),this.animationFrame=requestAnimationFrame(this.animate)};this.updateParticipantsMouses=e=>{if(this.presences.forEach(n=>{if(n.id!==this.localParticipant.id){if(!(n!=null&&n.visible)){this.removePresenceMouseParticipant(n.id);return}this.renderPresenceMouses(n)}}),e)return;this.presences.has(this.userBeingFollowedId)&&this.goToMouse(this.userBeingFollowedId)};this.renderPresenceMouses=e=>{var p,d,h,f,v;if(e.id===this.localParticipant.id)return;let i=document.getElementById(`mouse-${e.id}`);if(i||(i=this.createMouseElement(e)),!i)return;let n=i.getElementsByClassName("mouse-user-name")[0],s=i.getElementsByClassName("pointer-mouse")[0];s&&(s.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${(p=e.slot)==null?void 0:p.colorName}.svg)`),n&&(n.style.color=(h=(d=e.slot)==null?void 0:d.textColor)!=null?h:ie.gray,n.style.backgroundColor=(v=(f=e.slot)==null?void 0:f.color)!=null?v:"#fff",n.innerHTML=e.name);let{x:a,y:o}=e,{translate:{x:c,y:l},scale:u}=this.transformation;i.style.left=`${c+a*u}px`,i.style.top=`${l+o*u}px`};this.renderVoidElementWrapper=()=>{let e=document.createElement("div"),{width:i,height:n,left:s,top:a}=this.container.getBoundingClientRect();e.style.position="absolute",e.style.width=`${i}px`,e.style.height=`${n}px`,e.style.top=`${a}px`,e.style.left=`${s}px`,e.style.overflow="visible",e.style.pointerEvents="none",this.container.parentElement.appendChild(e),this.wrapper=e};this.renderSVGElementWrapper=()=>{let e=this.containerTagname.toLowerCase();if(e==="svg"){this.createSVGWrapper();return}if(e==="rect"){this.createRectWrapper();return}e==="ellipse"&&this.createEllipseWrapper()};if(this.container=document.getElementById(e),this.logger=new F("@superviz/sdk/presence"),!this.container){let a=`Element with id ${e} not found`;throw this.logger.log(a),new Error(a)}this.camera={x:0,y:0,scale:1,screen:{width:this.container.clientWidth,height:this.container.clientHeight}},this.name="presence";let{localParticipant:n}=this.useStore("global-store");n.subscribe(),this.containerTagname=this.container.tagName.toUpperCase(),this.goToPresenceCallback=(s=i==null?void 0:i.callbacks)==null?void 0:s.onGoToPresence}start(){this.logger.log("presence-mouse component @ start"),this.renderWrapper(),this.addListeners(),this.subscribeToRealtimeEvents(),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.animationFrame=requestAnimationFrame(this.animate),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse)}destroy(){cancelAnimationFrame(this.animationFrame),this.logger.log("presence-mouse component @ destroy"),this.removeListeners(),this.wrapper.remove(),this.presences.clear(),this.presences=void 0,this.container=void 0,this.wrapper=void 0,this.unsubscribeFromRealtimeEvents(),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.logger=void 0}subscribeToRealtimeEvents(){this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(A.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(A.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(A.UPDATE,this.onPresenceUpdate)}unsubscribeFromRealtimeEvents(){this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(A.JOINED_ROOM),this.room.presence.off(A.LEAVE),this.room.presence.off(A.UPDATE)}addListeners(){this.pointerMoveObserver=en(this.container,"pointermove").pipe(tn(30)).subscribe(this.onMyParticipantMouseMove),this.container.addEventListener("pointerleave",this.onMyParticipantMouseLeave)}removeListeners(){var e;(e=this.pointerMoveObserver)==null||e.unsubscribe(),this.container.removeEventListener("pointerleave",this.onMyParticipantMouseLeave)}setPositionNotStatic(){let{position:e}=window.getComputedStyle(this.container);e==="static"&&this.container.style.setProperty("position","relative")}createMouseElement(e){if(!this.wrapper)return;let i=document.createElement("div");i.setAttribute("id",`mouse-${e.id}`),i.setAttribute("class","mouse-follower");let n=document.createElement("div");n.setAttribute("class","pointer-mouse");let s=document.createElement("div");return s.setAttribute("class","mouse-user-name"),s.innerHTML=e.name,i.appendChild(n),i.appendChild(s),i.style.left="0px",i.style.top="0px",this.wrapper.appendChild(i),this.mouses.set(e.id,i),i}updateSVGPosition(){let e=this.container.parentElement.getBoundingClientRect(),i=this.container.getBoundingClientRect(),n=i.left-e.left,s=i.top-e.top,{width:a,height:o}=this.container.getBoundingClientRect();this.wrapper.style.setProperty("width",`${a}px`),this.wrapper.style.setProperty("height",`${o}px`),this.wrapper.style.setProperty("top",`${s}px`),this.wrapper.style.setProperty("left",`${n}px`)}createSVGWrapper(){let e=document.createElement("div"),i=this.container.parentElement.getBoundingClientRect(),n=this.container.getBoundingClientRect(),s=n.left-i.left,a=n.top-i.top,{width:o,height:c}=this.container.getBoundingClientRect();e.style.position="fixed",e.style.width=`${o}px`,e.style.height=`${c}px`,e.style.top=`${a}px`,e.style.left=`${s}px`,e.style.overflow="visible",e.style.pointerEvents="none",e.id="superviz-svg-wrapper",this.container.parentElement.appendChild(e),this.wrapper=e}createRectWrapper(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElement("div"),s=this.container.getAttribute("width"),a=this.container.getAttribute("height"),o=this.container.getAttribute("rx"),c=this.container.getAttribute("ry");i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("rx",o),i.setAttribute("ry",c),i.setAttribute("height",a),i.setAttribute("width",s),e.setAttribute("height",a),e.setAttribute("width",s),e.appendChild(i),n.appendChild(e);let l=this.container.getBoundingClientRect();n.style.position="fixed",n.style.top=`${l.top}px`,n.style.left=`${l.left}px`,n.style.width=`${l.width}px`,n.style.height=`${l.height}px`,n.style.overflow="visible",n.style.pointerEvents="none",n.id="superviz-rect-wrapper";let u=this.container.viewportElement;for(;u.viewportElement;)u=u.viewportElement;u.parentElement.appendChild(n),this.wrapper=n}createEllipseWrapper(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n=document.createElement("div"),s=this.container.getAttribute("cx"),a=this.container.getAttribute("cy"),o=this.container.getAttribute("rx"),c=this.container.getAttribute("ry"),l=Number(s)-Number(o),u=Number(a)-Number(c),p=String(2*Number(s)),d=String(2*Number(a));i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("rx",o),i.setAttribute("ry",c),i.setAttribute("cx",`${Number(s)-l}`),i.setAttribute("cy",`${Number(a)-u}`),i.setAttribute("height",d),i.setAttribute("width",p),e.setAttribute("height",d),e.setAttribute("width",p),e.appendChild(i),n.appendChild(e);let h=this.container.getBoundingClientRect();n.style.position="fixed",n.style.top=`${h.top}px`,n.style.left=`${h.left}px`,n.style.width=`${h.width}px`,n.style.height=`${h.height}px`,n.style.overflow="visible",n.style.pointerEvents="none",n.id="superviz-ellipse-wrapper";let f=this.container.viewportElement;for(;f.viewportElement;)f=f.viewportElement;f.parentElement.appendChild(n),this.wrapper=n}transform(e){var i,n;this.transformation=e,this.camera={x:e.translate.x,y:e.translate.y,scale:e.scale,screen:{width:((i=this.wrapper)==null?void 0:i.clientWidth)||1,height:((n=this.wrapper)==null?void 0:n.clientHeight)||1}},this.updateParticipantsMouses(!0)}updateVoidElementWrapper(){let e=this.container.getBoundingClientRect(),i=this.wrapper.getBoundingClientRect(),n=this.container;if((0,po.isEqual)(e,i))return;let s=n.offsetLeft,a=n.offsetTop;this.wrapper.style.setProperty("width",`${e.width}px`),this.wrapper.style.setProperty("height",`${e.height}px`),this.wrapper.style.setProperty("top",`${a}px`),this.wrapper.style.setProperty("left",`${s}px`),this.wrapper.id="superviz-void-wrapper"}updateSVGElementWrapper(){let{left:e,top:i,width:n,height:s}=this.container.getBoundingClientRect(),{left:a,top:o,width:c,height:l}=this.wrapper.getBoundingClientRect();if(!(e===a&&i===o&&n===c&&s===l)){if(this.containerTagname.toLowerCase()==="svg"){this.updateSVGPosition();return}this.wrapper.style.setProperty("width",`${n}px`),this.wrapper.style.setProperty("height",`${s}px`),this.wrapper.style.setProperty("top",`${i}px`),this.wrapper.style.setProperty("left",`${e}px`)}}renderWrapper(){if(!this.wrapper){if(Bi[this.containerTagname]){this.renderVoidElementWrapper();return}if(Ui[this.containerTagname]){this.renderSVGElementWrapper();return}this.renderElementWrapper()}}removePresenceMouseParticipant(e){let i=document.getElementById(`mouse-${e}`);i&&(i.remove(),this.presences.delete(e),this.mouses.delete(e))}renderElementWrapper(){let e=document.createElement("div");e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0",e.style.left="0",e.style.overflow="visible",e.style.pointerEvents="none",this.setPositionNotStatic(),this.container.appendChild(e),this.wrapper=e}};var Dt=class{constructor(t,e){let i=document.getElementById(t);if(!i)throw new Error(`[Superviz] Container with id ${t} not found`);return i.tagName.toLowerCase()==="canvas"?new Di(t,e):new Gi(t,e)}transform(t){}};m();m();var ho=he(Qi());m();var Wi=class{constructor(t){this.room=t;this.logger=new F("@superviz/sdk/realtime-presence")}update(t){this.logger.log("Realtime Presence @ update presence",t),this.room.presence.update(t)}subscribe(t,e){this.logger.log("Realtime Presence @ subscribe",t),this.room.presence.on(t,e)}unsubscribe(t){this.logger.log("Realtime Presence @ unsubscribe",t),this.room.presence.off(t)}getAll(){return M(this,null,function*(){return this.logger.log("Realtime Presence @ get all"),new Promise((t,e)=>{this.room.presence.get(i=>t(i),i=>{let n=`[SuperViz] ${i.name} - ${i.message}`;this.logger.log(i),console.error(n),e(i)})})})}};var Bt=class extends ye{constructor(e,i,n,s){super();this.state="DISCONNECTED";this.callbacksToSubscribeWhenJoined=[];this.publish=(0,ho.default)((e,i)=>{if(this.state!=="CONNECTED"){let n=`Realtime channel ${this.name} is not started yet. You can't publish event ${e} before start`;this.logger.log(n),console.warn(`[SuperViz] ${n}`);return}this.channel.emit(`message:${this.name}`,{name:e,payload:i})},30);this.subscribe=(e,i)=>{if(this.state!=="CONNECTED"){this.callbacksToSubscribeWhenJoined.push({event:e,callback:i});return}this.observers[e]||(this.observers[e]=new W),this.observers[e].subscribe(i)};this.unsubscribe=(e,i)=>{var n;(n=this.observers[e])==null||n.unsubscribe(i)};this.fetchHistory=e=>M(this,null,function*(){if(this.state!=="CONNECTED"){let n="Realtime component is not started yet. You can't retrieve history before start";return this.logger.log(n),console.warn(`[SuperViz] ${n}`),null}return yield new Promise((n,s)=>{let a=o=>{var l;(l=o.events)!=null&&l.length||n(null);let c=o.events.reduce((u,p)=>{var d;return u[p.data.name]||(u[p.data.name]=[]),u[p.data.name].push({data:p.data.payload,connectionId:p.connectionId,name:p.data.name,participantId:(d=p.presence)==null?void 0:d.id,timestamp:p.timestamp}),u},{});e&&!c[e]&&s(new Error(`Event ${e} not found in the history`)),e&&n(c[e]),n(c)};this.channel.history(a)})});this.publishEventToClient=(e,i)=>{var n;this.logger.log("realtime channel @ publishEventToClient",{event:e,data:i}),(n=this.observers[e])==null||n.publish(i)};this.name=e,this.ioc=i,this.logger=new F("@superviz/sdk/realtime-channel"),this.channel=this.ioc.createRoom(`realtime:${this.name}`,s),this.localParticipant=n,this.subscribeToRealtimeEvents(),this.logger.log("started"),this.participant=new Wi(this.channel)}disconnect(){return M(this,null,function*(){if(this.state==="DISCONNECTED"){this.logger.log("Realtime channel is already disconnected");return}this.logger.log("destroyed"),this.changeState("DISCONNECTED"),this.channel.disconnect()})}changeState(e){this.logger.log("realtime component @ changeState - state changed",e),this.state=e,this.publishEventToClient("realtime-channel.state-changed",this.state)}subscribeToRealtimeEvents(){this.channel.presence.on(A.JOINED_ROOM,e=>{e.id===this.localParticipant.id&&(this.changeState("CONNECTED"),this.callbacksToSubscribeWhenJoined.forEach(({event:i,callback:n})=>{this.subscribe(i,n)}),this.logger.log("joined room"),this.changeState("CONNECTED"))}),this.channel.on(`message:${this.name}`,e=>{var i,n;this.logger.log("message received",e),this.publishEventToClient(e.data.name,{data:e.data.payload,participantId:(n=(i=e==null?void 0:e.presence)==null?void 0:i.id)!=null?n:null,name:e.data.name,timestamp:e.timestamp,connectionId:e.connectionId})})}};var Ut=class extends Q{constructor(){super();this.state="STOPPED";this.channels=new Map;this.callbacksToSubscribeWhenJoined=[];this.subscribe=(e,i)=>{if(!this.channel){this.callbacksToSubscribeWhenJoined.push({event:e,callback:i});return}this.channel.subscribe(e,i)};this.publish=(e,i)=>{var n;if(rt[e.toUpperCase()]){this.channel.publishEventToClient(e,i);return}(n=this.channel)==null||n.publish(e,i)};this.unsubscribe=(e,i)=>{var n;(n=this.channel)==null||n.unsubscribe(e,i)};this.name="realtime",this.logger=new F("@superviz/sdk/realtime-component");let{localParticipant:e}=this.useStore("global-store");e.subscribe()}connect(e){if(!this.channel)return new Promise(n=>{let{localParticipant:s}=nt();s.subscribe("connect-after-init",a=>{a.activeComponents.includes("realtime")&&(s.unsubscribe("connect-after-init"),n(this.connect(e)))})});let i=this.channels.get(e);return i||(i=new Bt(e,this.ioc,this.localParticipant,this.connectionLimit),this.channels.set(e,i),this.state==="STARTED")?i:new Promise(n=>{this.subscribe("realtime-component.state-changed",s=>{s==="STARTED"&&n(i)})})}start(){this.logger.log("started"),this.channel=new Bt("default",this.ioc,this.localParticipant,this.connectionLimit),this.channel.subscribe("realtime-channel.state-changed",e=>{e==="CONNECTED"&&(this.callbacksToSubscribeWhenJoined.forEach(({event:i,callback:n})=>{this.channel.subscribe(i,n)}),this.changeState("STARTED"),this.callbacksToSubscribeWhenJoined=[],this.channel.unsubscribe("realtime-channel.state-changed"),this.participant=this.channel.participant,this.channels.set("default",this.channel))})}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.disconnectFromAllChannels()}disconnectFromAllChannels(){this.channels.forEach(e=>e.disconnect())}changeState(e){var i;this.logger.log("realtime component @ changeState - state changed",e),this.state=e,(i=this.channel)==null||i.publishEventToClient("realtime-component.state-changed",this.state)}};m();var Gt=class extends Q{constructor(e){var u;super();this.onParticipantListUpdate=e=>{if(this.localParticipantId===void 0||this.localParticipantId==="")return;if(!this.initialized){this.initialized=!0,this.initializeList();return}let i=R(y({},e.data),{tooltip:this.getTooltipData(e.data),controls:this.getControls(e.data)}),{participants:n,extras:s}=this.useStore("who-is-online-store");if(n.value.some(({id:l})=>l===e.data.id)){this.updateParticipant(i);return}if(s.value.some(({id:l})=>l===e.data.id)){this.updateExtra(i);return}if(n.value.length<4){n.publish([...n.value,i]);return}s.publish([...s.value,i])};this.onParticipantLeave=e=>{let{participants:i,extras:n}=this.useStore("who-is-online-store");if(i.value.findIndex(o=>o.id===e.id)===-1){let o=n.value.filter(c=>c.id!==e.id);n.publish(o);return}let a=i.value.filter(o=>o.id!==e.id);if(n.value.length){a.push(n.value[0]);let o=n.value.slice(1);n.publish(o)}i.publish(a)};this.updateParticipant=e=>{let{participants:i,extras:n}=this.useStore("who-is-online-store");if(e.isPrivate&&e.id!==this.localParticipantId){let a=i.value.filter(({id:c})=>c!==e.id),o=n.value.splice(0,1);i.publish([...a,...o]),n.publish([...n.value]);return}let s=i.value.map(a=>a.id===e.id?e:a);i.publish(s)};this.updateExtra=e=>{let{extras:i}=this.useStore("who-is-online-store");if(e.isPrivate&&e.id!==this.localParticipantId){let s=i.value.filter(({id:a})=>a!==e.id);i.publish(s);return}let n=i.value.map(s=>s.id===e.id?e:s);i.publish(n)};this.subscribeToLocalParticipantUpdates=e=>{if(!e.slot)return;this.localParticipantId=e.id;let{privateMode:i,joinedPresence:n}=this.useStore("who-is-online-store"),s=this.isInPresence(e.activeComponents);n.publish(s);let a=this.getParticipant(e);this.room.presence.update(R(y({},a),{isPrivate:i.value}))};this.goToMousePointer=e=>{var n,s,a;let i=(a=(n=e.presence)==null?void 0:n.id)!=null?a:(s=e.detail)==null?void 0:s.id;i!==this.localParticipantId&&(this.eventBus.publish("realtime.go-to-participant",i),this.publish("who-is-online.go-to-participant",i))};this.followMousePointer=({detail:e})=>{this.eventBus.publish("realtime.local-follow-participant",e.id),this.following&&this.publish("who-is-online.start-following-participant",this.following),this.following||this.publish("who-is-online.stop-following-participant"),e.source==="extras"&&this.highlightParticipantBeingFollowed(),this.updateParticipantsControls(e.id)};this.setPrivate=({detail:{isPrivate:e,id:i}})=>{let{privateMode:n,participants:s}=this.useStore("who-is-online-store"),a=s.value.find(o=>o.id===i);n.publish(e),this.eventBus.publish("realtime.private-mode",e),this.room.presence.update(R(y({},a),{isPrivate:e})),e&&this.publish("who-is-online.enter-private-mode"),e||this.publish("who-is-online.leave-private-mode")};this.setFollow=e=>{let{id:i}=e.presence;if(i===this.localParticipantId)return;let{data:n}=e,{following:s}=this.useStore("who-is-online-store");s.publish(n),this.followMousePointer({detail:{id:n}})};this.follow=({detail:e})=>{let{everyoneFollowsMe:i}=this.useStore("who-is-online-store");i.publish(!!(e!=null&&e.id)),this.room.emit("who-is-online.start-follow-me",e),this.following&&this.publish("who-is-online.start-follow-me",this.following),this.following||this.publish("who-is-online.stop-follow-me"),this.updateParticipantsControls(e==null?void 0:e.id)};this.stopFollowing=e=>{var n;if(e.id!==((n=this.following)==null?void 0:n.id))return;let{following:i}=this.useStore("who-is-online-store");i.publish(void 0),this.eventBus.publish("realtime.local-follow-participant",void 0),this.publish("who-is-online.stop-following-participant")};this.gather=e=>{this.room.emit("who-is-online.gather-all",e.detail.id),this.publish("who-is-online.gather-all",e.detail.id)};this.onJoinedRoom=e=>{if(e.id!==this.localParticipantId)return;let{localParticipant:i}=this.useStore("global-store");i.subscribe(this.subscribeToLocalParticipantUpdates)};this.name="whoIsOnline",this.logger=new F("@superviz/sdk/who-is-online-component");let{disablePresenceControls:i,disableGoToParticipant:n,disableFollowParticipant:s,disablePrivateMode:a,disableGatherAll:o,disableFollowMe:c,following:l}=this.useStore("who-is-online-store");if(l.subscribe(),typeof e!="object"){this.position=e!=null?e:"top-right";return}typeof e=="object"&&(this.position=(u=e.position)!=null?u:"top-right",this.setStyles(e.styles),i.publish(e.disablePresenceControls),n.publish(e.disableGoToParticipant),s.publish(e.disableFollowParticipant),a.publish(e.disablePrivateMode),o.publish(e.disableGatherAll),c.publish(e.disableFollowMe))}start(){let{localParticipant:e}=this.useStore("global-store");this.localParticipantId=e.value.id,this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners()}destroy(){this.unsubscribeFromRealtimeEvents(),this.removeListeners(),this.element.remove(),this.element=null;let{destroy:e}=this.useStore("who-is-online-store");e()}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.room.presence.on(A.UPDATE,this.onParticipantListUpdate),this.room.presence.on(A.LEAVE,this.onParticipantLeave),this.room.presence.on(A.LEAVE,this.stopFollowing),this.room.presence.on(A.JOINED_ROOM,this.onJoinedRoom),this.room.on("who-is-online.gather-all",this.goToMousePointer),this.room.on("who-is-online.start-follow-me",this.setFollow)}unsubscribeFromRealtimeEvents(){this.room.presence.off(A.UPDATE),this.room.presence.off(A.LEAVE),this.room.presence.off(A.JOINED_ROOM),this.room.off("who-is-online.gather-all",this.goToMousePointer),this.room.off("who-is-online.start-follow-me",this.setFollow)}initializeList(){let{participants:e,extras:i}=this.useStore("who-is-online-store");this.room.presence.get(n=>{let s=n.filter(l=>l.data.id).map(({data:l})=>{let u=l.avatar;u||(u=this.getAvatar({avatar:l.avatar,color:l.slot.color,name:l.name,letterColor:l.slot.textColor}));let p=this.getTooltipData(l),d=this.getControls(l);return R(y({},l),{tooltip:p,controls:d,avatar:u,isLocalParticipant:l.id===this.localParticipantId})});if(!s.length)return;let a=s.findIndex(l=>l.id===this.localParticipantId),o=s.splice(a,1)[0],c=s.splice(0,3);e.publish([o,...c]),i.publish(s)})}setStyles(e=""){if(!e)return;let i=document.createElement("style");i.textContent=e,i.id="superviz-who-is-online-styles",document.head.appendChild(i)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(on).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[n,s]=this.position.split("-");this.element.position=`${n}: 20px; ${s}: 40px;`;return}let i=document.getElementById(this.position);if(!i){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}i.appendChild(this.element),this.element.position="position: relative;"}getParticipant(e){let{avatar:i,activeComponents:n,id:s,name:a,slot:{color:o,textColor:c}}=e,l=this.shouldDisableDropdown({activeComponents:n,participantId:s}),u=this.getAvatar({avatar:i,color:o,name:a,letterColor:c});return{id:s,name:a,avatar:u,disableDropdown:l,activeComponents:n,isPrivate:!1}}shouldDisableDropdown({activeComponents:e,participantId:i}){let{joinedPresence:{value:n},disablePresenceControls:{value:s},disableFollowMe:{value:a},disableFollowParticipant:{value:o},disableGoToParticipant:{value:c},disableGatherAll:{value:l},disablePrivateMode:{value:u}}=this.useStore("who-is-online-store");return n===!1||s===!0||i===this.localParticipantId&&a&&u&&l||i!==this.localParticipantId&&o&&c?!0:!(e!=null&&e.some(p=>p.toLowerCase().includes("presence")))}getTooltipData(e){let{name:i,disableDropdown:n,id:s}=e,a=s===this.localParticipantId,o={name:i};return a&&(o.name+=" (You)"),!n&&!a&&(o.info="Click to follow"),o}getAvatar({avatar:e,color:i,name:n,letterColor:s}){var c,l;let a=e==null?void 0:e.imageUrl,o=(l=(c=n==null?void 0:n.at(0))==null?void 0:c.toUpperCase())!=null?l:"A";return{imageUrl:a,firstLetter:o,color:i,letterColor:s}}getControls(e){let{disablePresenceControls:i}=this.useStore("who-is-online-store"),{disableDropdown:n,id:s}=e;return i.value||n?[]:s===this.localParticipantId?this.getLocalParticipantControls():this.getOtherParticipantsControls(s)}getOtherParticipantsControls(e){var o;let{disableGoToParticipant:i,disableFollowParticipant:n,following:s}=this.useStore("who-is-online-store"),a=[];if(i.value||a.push({label:"go to",icon:"place"}),!n.value){let c=((o=s.value)==null?void 0:o.id)===e,l=c?"unfollow":"follow",u=c?"send-off":"send";a.push({label:l,icon:u})}return a}getLocalParticipantControls(){let{disableFollowMe:{value:e},disableGatherAll:{value:i},disablePrivateMode:{value:n},everyoneFollowsMe:{value:s},privateMode:{value:a}}=this.useStore("who-is-online-store"),o=[];if(i||o.push({label:"gather all",icon:"gather"}),!e){let c=s?"send-off":"send",l=s?"stop followers":"everyone follows me";o.push({label:l,icon:c})}if(!n){let c=a?"eye_inative":"eye",l=a?"leave private mode":"private mode";o.push({label:l,icon:c})}return o}updateParticipantsControls(e){let{participants:i}=this.useStore("who-is-online-store"),n=i.value.map(s=>{if(e&&s.id!==e)return s;let{id:a}=s,o=this.getControls(s);return R(y({},s),{controls:o})});i.publish(n)}highlightParticipantBeingFollowed(){let{extras:e,participants:i,following:{value:n}}=this.useStore("who-is-online-store"),s=i.value[0],a=e.value.findIndex(l=>l.id===n.id),o=e.value.splice(a,1)[0];i.value.unshift(s),i.value[1]=o;let c=i.value.pop();e.value.push(c),e.publish(e.value),i.publish(i.value)}isInPresence(e){return e==null?void 0:e.some(i=>i.includes("presence"))}};m();var Wt=class extends Q{constructor(e={}){super();this.fields={};this.fieldsOriginalOutline={};this.focusList={};this.enabledOutlineFields={};this.enabledRealtimeSyncFields={};this.flags={};this.allowedTagNames=["input","textarea"];this.allowedInputTypes=["text","email","date","color","datetime-local","month","number","password","range","search","tel","time","url","week","checkbox","radio"];this.throwError={onInvalidFieldsProp:e=>{throw new Error(`"Fields" property must be either a string or an array of strings. Received type: ${e}`)},onFieldNotFound:e=>{throw new Error(`You must pass the id of an existing element. Element with id ${e} not found`)},onInvalidTagName:e=>{throw new Error(`You can't register an element with tag ${e}. Only the tags "${this.allowedTagNames.join(", ")}" are allowed`)},onInvalidInputType:e=>{throw new Error(`You can't register an input element of type ${e}. Only the types "${this.allowedInputTypes.join(", ")}" are allowed`)},onDeregisterInvalidField:e=>{throw new Error(`You can't deregister field of id ${e}. No field was registered with id ${e} `)}};this.sync=e=>{var o,c;let i=this.fields[e],n=this.hasCheckedProperty(i),a={value:n?i.checked:i.value,color:this.localParticipant.slot.color,fieldId:e,showOutline:this.canUpdateColor(e),syncContent:this.canSyncContent(e),attribute:n?"checked":"value"};(o=this.room)==null||o.emit("field.content-change"+e,a),(c=this.room)==null||c.emit("field.interaction"+e,a)};this.handleInput=e=>{var a,o,c,l;let i=e.target;(o=this.room)==null||o.emit("field.interaction"+i.id,{fieldId:i.id,color:(a=this.localParticipant.slot)==null?void 0:a.color});let n=this.canSyncContent(i.id);if(!n)return;let s={value:i.value,color:(c=this.localParticipant.slot)==null?void 0:c.color,fieldId:i.id,showOutline:this.canUpdateColor(i.id),syncContent:n,attribute:"value"};(l=this.room)==null||l.emit("field.content-change"+i.id,s)};this.handleChange=e=>{var a;let i=e.target;if(!this.canSyncContent(i.id))return;let s={fieldId:i.id,value:i.checked,color:this.localParticipant.slot.color,showOutline:this.canUpdateColor(i.id),syncContent:this.canSyncContent(i.id),attribute:"checked"};(a=this.room)==null||a.emit("field.content-change"+i.id,s)};this.handleFocus=e=>{var s;let i=e.target,n={color:this.localParticipant.slot.color,fieldId:i.id};(s=this.room)==null||s.emit("field.focus"+i.id,n)};this.handleBlur=e=>{var s;let i=e.target,n={fieldId:i.id};(s=this.room)==null||s.emit("field.blur"+i.id,n)};this.removeFieldColor=({presence:e,data:{fieldId:i}})=>{var n,s;((n=this.focusList[i])==null?void 0:n.id)!==e.id||!this.fields[i]||(this.fields[i].style.outline=(s=this.fieldsOriginalOutline[i])!=null?s:"",delete this.fieldsOriginalOutline[i],delete this.focusList[i])};this.updateFieldColor=({presence:e,data:{color:i,fieldId:n},timestamp:s})=>{var f;let a=(f=this.focusList[n])!=null?f:{},o=!a.id,c=e.id===this.localParticipant.id;if(o&&c){this.focusList[n]={id:e.id,color:i,firstInteraction:s,lastInteraction:s};return}if(a.id===e.id){this.focusList[n].lastInteraction=s;return}let u=s-a.lastInteraction>=3e3,p=s-a.firstInteraction>=1e4;if(!(u||p||o))return;this.focusList[n]={id:e.id,color:i,firstInteraction:s,lastInteraction:s};let h=c?this.fieldsOriginalOutline[n]:`1px solid ${i}`;this.fields[n].style.outline=h};this.updateFieldContent=p=>{var d=p,{presence:e,data:{value:i,fieldId:n,color:s,showOutline:a,syncContent:o,attribute:c},timestamp:l}=d,u=ji(d,["presence","data","timestamp"]);this.publish("field.content-change",{value:i,fieldId:n,attribute:c,userId:e.id,userName:e.name,timestamp:l}),o&&this.canSyncContent(n)&&e.id!==this.localParticipant.id&&(this.fields[n][c]=i),a&&this.canUpdateColor(n)&&this.updateFieldColor(y({presence:e,data:{color:s,fieldId:n},timestamp:l},u))};this.publishTypedEvent=({presence:e,data:{fieldId:i,color:n}})=>{this.publish("field.interaction",{fieldId:i,userId:e.id,userName:e.name,color:n})};this.canSyncContent=e=>!this.flags.disableRealtimeSync&&this.enabledRealtimeSyncFields[e]!==!1||!!this.enabledRealtimeSyncFields[e];this.name="formElements",this.logger=new F("@superviz/sdk/presence-input-component");let s=e,{fields:i}=s,n=ji(s,["fields"]);if(this.flags=n!=null?n:{},typeof i=="string"){this.validateField(i),this.fields[i]=null;return}if(Array.isArray(i)){i.forEach(a=>{this.validateField(a),this.fields[a]=null});return}i!==void 0&&this.throwError.onInvalidFieldsProp(typeof i)}enableOutline(e){let i=this.fields[e];i&&(this.enabledOutlineFields[e]=!0,this.fieldsOriginalOutline[e]=i.style.outline,i.addEventListener("focus",this.handleFocus),i.addEventListener("blur",this.handleBlur),this.room.on("field.focus"+e,this.updateFieldColor),this.room.on("field.blur"+e,this.removeFieldColor))}disableOutline(e){var n,s;let i=this.fields[e];i&&(this.enabledOutlineFields[e]=!1,i.style.outline=(n=this.fieldsOriginalOutline[e])!=null?n:"",i.removeEventListener("focus",this.handleFocus),i.removeEventListener("blur",this.handleBlur),this.room.off("field.focus"+e,this.updateFieldColor),this.room.off("field.blur"+e,this.removeFieldColor),(s=this.room)==null||s.emit("field.blur"+e,{fieldId:e}))}enableRealtimeSync(e){this.enabledRealtimeSyncFields[e]=!0}disableRealtimeSync(e){this.enabledRealtimeSyncFields[e]=!1}registerField(e){this.validateField(e);let i=document.getElementById(e);this.fields[e]=i,this.addListenersToField(i),this.addRealtimeListenersToField(e),this.fieldsOriginalOutline[e]=i.style.outline}deregisterField(e){var i;this.fields[e]||this.throwError.onDeregisterInvalidField(e),this.removeListenersFromField(this.fields[e]),this.removeRealtimeListenersFromField(e),this.fields[e].style.outline=this.fieldsOriginalOutline[e],this.fields[e]=void 0,delete this.enabledOutlineFields[e],delete this.enabledRealtimeSyncFields[e],delete this.fieldsOriginalOutline[e],delete this.focusList[e],(i=this.room)==null||i.emit("field.blur"+e,{fieldId:e})}start(){let{localParticipant:e}=this.useStore("global-store");e.subscribe(),Object.entries(this.fields).forEach(([i])=>{this.registerField(i)})}destroy(){this.restoreOutlines(),this.deregisterAllFields(),this.fieldsOriginalOutline=void 0,this.focusList=void 0}addListenersToField(e){let{type:i}=e;this.hasCheckedProperty(e)?e.addEventListener("change",this.handleChange):e.addEventListener("input",this.handleInput),!this.flags.disableOutline&&(e.addEventListener("focus",this.handleFocus),e.addEventListener("blur",this.handleBlur))}addRealtimeListenersToField(e){this.room&&(this.room.on("field.content-change"+e,this.updateFieldContent),this.room.on("field.interaction"+e,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.on("field.focus"+e,this.updateFieldColor),this.room.on("field.blur"+e,this.removeFieldColor)))}removeListenersFromField(e){this.hasCheckedProperty(e)?e.removeEventListener("change",this.handleChange):e.removeEventListener("input",this.handleInput),!this.flags.disableOutline&&(e.removeEventListener("focus",this.handleFocus),e.removeEventListener("blur",this.handleBlur))}removeRealtimeListenersFromField(e){this.room&&(this.room.off("field.content-change"+e,this.updateFieldContent),this.room.off("field.interaction"+e,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.off("field.focus"+e,this.updateFieldColor),this.room.off("field.blur"+e,this.removeFieldColor)))}deregisterAllFields(){Object.keys(this.fields).forEach(e=>{this.deregisterField(e)}),this.fields=void 0}validateField(e){this.validateFieldId(e);let i=document.getElementById(e);this.validateFieldTagName(i),this.validateFieldType(i)}validateFieldTagName(e){let i=e.tagName.toLowerCase();this.allowedTagNames.includes(i)||(this.logger.log("invalid element tagname"),this.throwError.onInvalidTagName(i))}validateFieldType(e){if(e.tagName.toLowerCase()!=="input")return;let i=e.getAttribute("type"),n=this.allowedInputTypes.includes(i);i&&!n&&(this.logger.log("invalid input type"),this.throwError.onInvalidInputType(i))}validateFieldId(e){document.getElementById(e)||this.throwError.onFieldNotFound(e)}restoreOutlines(){Object.entries(this.fields).forEach(([e])=>{this.fields[e].style.outline=this.fieldsOriginalOutline[e]})}hasCheckedProperty(e){let i=e.tagName.toLowerCase(),n=e.getAttribute("type");return i==="input"&&(n==="radio"||n==="checkbox")}canUpdateColor(e){return!this.flags.disableOutline&&this.enabledOutlineFields[e]!==!1||this.enabledOutlineFields[e]}};typeof window!="undefined"&&(window.SuperVizRoom={init:Wr,CommentEvent:zi,MeetingEvent:jt,DeviceEvent:Xr,RealtimeEvent:Le,MeetingState:Vi,MeetingConnectionStatus:zt,MeetingControlsEvent:Ht,ParticipantEvent:Hi,FrameEvent:Vt,LayoutMode:Oi,VideoConference:Ft,MousePointers:Dt,Realtime:Ut,Comments:Lt,CanvasPin:Rt,HTMLPin:kt,WhoIsOnline:Gt,FormElements:Wt,ParticipantType:Ye,LayoutPosition:Mt,CamerasPosition:Si,RealtimeComponentState:Mi,RealtimeComponentEvent:Li,ComponentLifeCycleEvent:rt,WhoIsOnlineEvent:$i,StoreType:ee,PresenceEvents:A,FieldEvents:Ri,PinMode:$t,Comment});var lb=Wr;export{Si as CamerasPosition,Rt as CanvasPin,zi as CommentEvent,Lt as Comments,rt as ComponentLifeCycleEvent,Xr as DeviceEvent,Ri as FieldEvents,Wt as FormElements,Vt as FrameEvent,kt as HTMLPin,Oi as LayoutMode,Mt as LayoutPosition,zt as MeetingConnectionStatus,Ht as MeetingControlsEvent,jt as MeetingEvent,Vi as MeetingState,Dt as MousePointers,Hi as ParticipantEvent,Ye as ParticipantType,$t as PinMode,A as PresenceEvents,Ut as Realtime,Li as RealtimeComponentEvent,Mi as RealtimeComponentState,Le as RealtimeEvent,ee as StoreType,Ft as VideoConference,Gt as WhoIsOnline,$i as WhoIsOnlineEvent,lb as default};
//# sourceMappingURL=index.js.map
